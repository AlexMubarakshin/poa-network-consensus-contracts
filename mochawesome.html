<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets/app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:158,&quot;tests&quot;:598,&quot;passes&quot;:598,&quot;pending&quot;:0,&quot;failures&quot;:0,&quot;start&quot;:&quot;2018-10-08T07:17:12.914Z&quot;,&quot;end&quot;:&quot;2018-10-08T07:35:22.540Z&quot;,&quot;duration&quot;:1089626,&quot;testsRegistered&quot;:598,&quot;passPercent&quot;:100,&quot;pendingPercent&quot;:0,&quot;other&quot;:0,&quot;hasOther&quot;:false,&quot;skipped&quot;:0,&quot;hasSkipped&quot;:false,&quot;passPercentClass&quot;:&quot;success&quot;,&quot;pendingPercentClass&quot;:&quot;danger&quot;},&quot;suites&quot;:{&quot;uuid&quot;:&quot;9a7b9d62-015c-4489-b738-057515facba0&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0062acd0-5d24-4aec-b44b-a56b94c84441&quot;,&quot;title&quot;:&quot;BallotsStorageMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;BallotsStorageMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;eac653c5-6d23-43e2-8ca1-6ab9db2986dc&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;BallotsStorageMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3abbafd5-f4da-4fc1-a149-f15220e31ab0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;BallotsStorageMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2d8bda6f-5672-4869-9d9b-c58d4aeb959e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;5517aa14-4b8d-43c5-9088-f10d165fc307&quot;,&quot;title&quot;:&quot;EternalStorageProxyMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;EternalStorageProxyMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4717cb39-9bbf-4613-acfe-b4d83cc13af9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;EternalStorageProxyMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6fca41cb-2be7-432d-959b-82043bd6c9e6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;EternalStorageProxyMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8a847380-ea4e-47e9-8ea1-9dd310e01d60&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c1c96545-bde1-4189-8f61-66a295bd740b&quot;,&quot;title&quot;:&quot;KeysManagerMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;KeysManagerMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;30283440-12fa-4782-93fa-7db47da10655&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;KeysManagerMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;10a17910-dcec-40bb-b3ec-fe1618cf35dc&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;KeysManagerMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1b3e12ae-8e18-4366-af72-03788009c7c0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;8bb5856d-00f4-454b-a72d-47424be3144a&quot;,&quot;title&quot;:&quot;PoaNetworkConsensusMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;PoaNetworkConsensusMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6dc76d0a-14c4-413c-b9f7-f92860b1d6e1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;PoaNetworkConsensusMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a036fd9c-e318-46b0-a28f-1764291208c7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;PoaNetworkConsensusMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;51884402-700c-43b5-953a-946a69eaa353&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;0dd570a8-214a-47a5-846a-d2a6c4694820&quot;,&quot;title&quot;:&quot;ProxyStorageMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;ProxyStorageMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0ea4c67e-e946-4b9a-8b9c-02317c2589da&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;ProxyStorageMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;da8d1ffb-fd3b-4936-807a-7bf1ca4893b8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;ProxyStorageMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9cfd82ae-1d2b-45dc-8dc5-44e4b5eebdd9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;6c079898-762c-4c50-b47f-d307fee2eccf&quot;,&quot;title&quot;:&quot;RewardByBlockMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;RewardByBlockMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f3cc5544-38ee-4878-93e5-d040f799d62f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;RewardByBlockMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e0e7f7c1-0d3c-4f64-bfad-86284981236c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;RewardByBlockMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a293d1db-6775-4e88-a0ef-34ac06d27408&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;23c00d43-7b77-43d1-8650-fc384014e206&quot;,&quot;title&quot;:&quot;RewardByTimeMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;RewardByTimeMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;82c5b1d0-2d83-4123-bf26-a02e3a447e3a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;RewardByTimeMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;117711c0-dfac-4398-b427-9954211b8a49&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;RewardByTimeMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;06bced81-9437-4457-b708-000dd9411054&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ec5c4211-fed3-4935-abfc-9d09a1c4ae31&quot;,&quot;title&quot;:&quot;ValidatorMetadataMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;ValidatorMetadataMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4c612353-20f0-4431-9c74-95ef9fc9de52&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;ValidatorMetadataMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6c8f0280-a8cb-4516-a5c2-1369d347666e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;ValidatorMetadataMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b59bfa12-7b2a-4ff0-ba77-f97dc54e8a6f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;150ca55e-de04-4c17-812e-be444984086d&quot;,&quot;title&quot;:&quot;VotingToChangeKeysMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeKeysMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4f1cbe86-eddb-44f3-9243-fa4697b6a4d8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeKeysMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e07eb506-89db-43ca-a86d-2781ebf9d797&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeKeysMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;885c8c2c-23b3-42f0-9981-feba33b9a500&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b53142b2-801d-4dac-88fa-8ac40bdd7285&quot;,&quot;title&quot;:&quot;VotingToChangeMinThresholdMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeMinThresholdMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;21aba04d-9543-4f92-a4fc-e5de1b24a0b6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeMinThresholdMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d0868baf-8271-4c79-8724-6490c615de90&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeMinThresholdMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;69c80351-adb5-4aa0-80e7-e8e49b0fc83b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;97648e97-0d07-407b-9e93-490bf2f273b0&quot;,&quot;title&quot;:&quot;VotingToChangeMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;665bb8d9-dec8-4b0b-96d9-bffd6e77fc0c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cd398cd3-142a-4846-8f8c-30ce39b30fdb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3382c4ff-aeae-4c02-b7de-9cd788274c50&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;49b6edd4-afdf-404b-b44f-2a04fa52d936&quot;,&quot;title&quot;:&quot;VotingToChangeProxyAddressMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeProxyAddressMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;56bc3dce-5ca1-42f1-8846-f51dbd108276&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeProxyAddressMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;830e8253-209f-4a65-a8ca-9ed56a0e0600&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeProxyAddressMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f3c1ccb4-eb1a-419e-8abf-88f3f2df9204&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e362ca87-9a8b-4773-b7da-ce405f27a675&quot;,&quot;title&quot;:&quot;VotingToManageEmissionFundsMock&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;VotingToManageEmissionFundsMock \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fc2ad821-3702-435a-8643-bc7843d5554f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;VotingToManageEmissionFundsMock \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a126abeb-fc9d-461e-8c17-935d90b38210&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;VotingToManageEmissionFundsMock \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;26ab45ca-e577-4020-95d1-b320aedd8352&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;aa264dae-8688-46c1-9eb8-48d6ef46843d&quot;,&quot;title&quot;:&quot;VotingKey&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;VotingKey \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;82778b53-135a-4cd3-8de9-82f1ed630167&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;VotingKey \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ceabab59-92bf-4349-b5e1-e79092cbd48b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;VotingKey \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3d1c9f0e-89b8-4f4a-91d7-4204cb35f2d5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f42d6fb1-138b-462e-bccc-f6c8b057e6dd&quot;,&quot;title&quot;:&quot;BallotsStorageNew&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;BallotsStorageNew \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;22eb133e-1066-4d19-9519-ad68eb306d21&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;BallotsStorageNew \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ac4a67e8-bb45-457a-8f38-4d9bdd96cc97&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;BallotsStorageNew \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8a78645b-b3de-4be1-bb4e-d9b0aafbb93c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;4de4fe01-ee7c-49e3-9a70-110eeef6b144&quot;,&quot;title&quot;:&quot;KeysManagerNew&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;KeysManagerNew \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d7987ab9-c7a7-42cb-bca7-208a0fa9943b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;KeysManagerNew \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6dad3217-cad5-4467-b5ad-2773cb9212f5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;KeysManagerNew \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8e2b970e-c740-4b1f-9ea5-613bd0324cdf&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b58aca35-1972-4597-87cf-45d9bd40b065&quot;,&quot;title&quot;:&quot;ProxyStorageNew&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;ProxyStorageNew \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d160c35a-c084-436a-98e0-f0abf68f0134&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;ProxyStorageNew \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0897596c-6161-4125-a235-590dae76242d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;ProxyStorageNew \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;339b8122-09f6-44a7-acee-e561f0010a06&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b3e49878-76fa-4ac4-a0df-079ce9ca97f7&quot;,&quot;title&quot;:&quot;RewardByBlockNew&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;RewardByBlockNew \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2a0145d8-26e9-4222-bf70-6abffd157fc5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;RewardByBlockNew \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c590ce68-5b2f-484a-8e22-d1a7ea6deabc&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;RewardByBlockNew \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1837f000-fd1d-4a26-83a4-d1d89ab9da5e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;88661ad3-1b24-4466-8c0f-fafd075b947d&quot;,&quot;title&quot;:&quot;RewardByTimeNew&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;RewardByTimeNew \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3bdc8efd-aea8-46c3-a9d3-a46598933193&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;RewardByTimeNew \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ee666379-dac9-4561-bd55-771612a0199f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;RewardByTimeNew \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;42e728a5-4869-4ebc-b58f-91a7d1d3ceb3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f2fac7bd-58c8-4a5c-9d5e-03af14871554&quot;,&quot;title&quot;:&quot;ValidatorMetadataNew&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;ValidatorMetadataNew \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7a503d6a-4324-4d8b-8db8-5e775dcefda4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;ValidatorMetadataNew \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bf0a0f03-8542-4a1a-90d1-0e36b67a01b6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;ValidatorMetadataNew \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bc2385f4-ea85-444c-95ca-c5de8ac7ee05&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;74a832af-a359-44db-8505-22e775e90eb7&quot;,&quot;title&quot;:&quot;VotingToChangeKeysNew&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeKeysNew \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b301798e-fd76-443b-8fa9-b52d0a8e46a6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeKeysNew \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b13e06ca-40ee-4bdc-8868-0ec7421d9c86&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeKeysNew \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;37876f5f-2e88-4f62-9d4c-c41ead8b74f8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;012ca0e7-379c-4d61-886d-c750fc06acf4&quot;,&quot;title&quot;:&quot;VotingToChangeMinThresholdNew&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeMinThresholdNew \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6ad4b44d-879c-42cd-987b-52f8c9d89626&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeMinThresholdNew \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2acc48fe-2480-48af-9fc9-3f22d22ea027&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeMinThresholdNew \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bbfdda2e-fe8c-4b98-9c9b-bf508de42edb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;73fe0636-7a38-4070-9f43-1b499cd20dae&quot;,&quot;title&quot;:&quot;VotingToChangeProxyAddressNew&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeProxyAddressNew \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;283a9a22-4dd5-4fcb-ad3b-c9bdcc014aaa&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeProxyAddressNew \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;185adc5e-d410-4595-8d9c-2c7a4dada0c3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;VotingToChangeProxyAddressNew \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5056150f-d09e-4f90-95e7-254c6e3ce547&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;685c013a-f506-4969-a707-a82f601f046c&quot;,&quot;title&quot;:&quot;VotingToManageEmissionFundsNew&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;VotingToManageEmissionFundsNew \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;series([\n  runner.initialize.bind(runner),\n  self.compileNewAbstractInterface.bind(this, runner),\n  self.deployTestDependencies.bind(this, abstraction, dependency_paths, runner)\n], done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9db3bfa2-832c-4492-bcf9-0bc7a6afd3e3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;VotingToManageEmissionFundsNew \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e57dd5d2-dbff-48ec-8258-1700645ccabc&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;VotingToManageEmissionFundsNew \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1a5dd0e1-43f6-447d-9839-53cb8009310e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;49c16f10-dcce-4506-9c21-70c49d4dec12&quot;,&quot;title&quot;:&quot;Contract: BallotsStorage [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:208,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;44a15ac2-f81b-4d53-80cd-6d849117d891&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3777b867-f1b7-4a03-b4f2-ac7c5c7fc7c6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:709,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;masterOfCeremony = accounts[0];\nvotingToChangeKeys = accounts[0];\nvotingToChangeMinThreshold = accounts[3];\nvotingToChangeProxy = accounts[4];\nvotingToManageEmissionFunds = accounts[5];\nrewardByBlock = accounts[8];\npoaNetworkConsensus = await PoaNetworkConsensus.new(masterOfCeremony, []);\n\nproxyStorage = await ProxyStorageMock.new();\nconst proxyStorageEternalStorage = await EternalStorageProxy.new(0, proxyStorage.address);\nproxyStorage = await ProxyStorageMock.at(proxyStorageEternalStorage.address);\nawait proxyStorage.init(poaNetworkConsensus.address).should.be.fulfilled;\n\nballotsStorage = await BallotsStorage.new();\nballotsEternalStorage = await EternalStorageProxy.new(proxyStorage.address, ballotsStorage.address);\nballotsStorage = await BallotsStorage.at(ballotsEternalStorage.address);\nawait ballotsStorage.init([3, 2], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait ballotsStorage.init([3, 3]).should.be.rejectedWith(ERROR_MSG);\nawait ballotsStorage.init([3, 2]).should.be.fulfilled;\nkeysManager = await KeysManagerMock.new();\nconst keysManagerEternalStorage = await EternalStorageProxy.new(proxyStorage.address, keysManager.address);\nkeysManager = await KeysManagerMock.at(keysManagerEternalStorage.address);\nawait keysManager.init(\n  \&quot;0x0000000000000000000000000000000000000000\&quot;\n).should.be.fulfilled;\nconst validatorMetadata = await ValidatorMetadata.new();\nconst validatorMetadataEternalStorage = await EternalStorageProxy.new(proxyStorage.address, validatorMetadata.address);\n\nawait poaNetworkConsensus.setProxyStorage(proxyStorage.address);\nawait proxyStorage.initializeAddresses(\n  keysManager.address,\n  votingToChangeKeys,\n  votingToChangeMinThreshold,\n  votingToChangeProxy,\n  votingToManageEmissionFunds,\n  ballotsEternalStorage.address,\n  validatorMetadataEternalStorage.address,\n  rewardByBlock\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e3895293-c163-46e9-8f66-0bd647fa7768&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7e65ed1b-58fc-4ce4-a1d2-a142a6f89a64&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;2694d1aa-0d23-424f-bbc5-4764d6bcce87&quot;,&quot;title&quot;:&quot;#init&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;prevent from double init&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #init prevent from double init&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await ballotsStorage.init([3, 2]).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a9c57ff1-cf35-4b8b-875a-f587ddf24f9d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;thresholds are correct&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #init thresholds are correct&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;new web3.BigNumber(3).should.be.bignumber.equal(\n  await ballotsStorage.getBallotThreshold.call(1)\n);\nnew web3.BigNumber(2).should.be.bignumber.equal(\n  await ballotsStorage.getBallotThreshold.call(2)\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8e4f4e52-d4e9-4ba4-aab6-d104db6dac7f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a9c57ff1-cf35-4b8b-875a-f587ddf24f9d&quot;,&quot;8e4f4e52-d4e9-4ba4-aab6-d104db6dac7f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:59,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;e51d2ca4-f75c-4a11-9417-631fd13d665e&quot;,&quot;title&quot;:&quot;#migrate&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should copy thresholds from an old contract&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #migrate should copy thresholds from an old contract&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:280,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let ballotsStorageNew = await BallotsStorage.new();\nconst ballotsEternalStorageNew = await EternalStorageProxy.new(proxyStorage.address, ballotsStorageNew.address);\nballotsStorageNew = await BallotsStorage.at(ballotsEternalStorageNew.address);\n(await ballotsStorageNew.getBallotThreshold.call(1)).should.be.bignumber.equal(0);\n(await ballotsStorageNew.getBallotThreshold.call(2)).should.be.bignumber.equal(0);\nawait ballotsStorageNew.migrate(&#x27;0x0000000000000000000000000000000000000000&#x27;).should.be.rejectedWith(ERROR_MSG);\nawait ballotsStorageNew.migrate(ballotsStorage.address, {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait ballotsStorageNew.migrate(ballotsStorage.address).should.be.fulfilled;\n(await ballotsStorageNew.getBallotThreshold.call(1)).should.be.bignumber.equal(3);\n(await ballotsStorageNew.getBallotThreshold.call(2)).should.be.bignumber.equal(2);\nawait ballotsStorageNew.migrate(ballotsStorage.address).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2c5bd31c-4d98-4003-a6cb-7292e316ded8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2c5bd31c-4d98-4003-a6cb-7292e316ded8&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:280,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;317d5d19-f3d8-49a5-bb34-d1db576d15ae&quot;,&quot;title&quot;:&quot;#setThreshold&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;can only be called from votingToChangeThreshold address&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #setThreshold can only be called from votingToChangeThreshold address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:76,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await ballotsStorage.setThreshold(4, 1, {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait setThreshold(4, 1, true, {from: accounts[3]});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bc2a0e8d-27f9-4afc-8f3d-9e5046057337&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot be set for Invalid threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #setThreshold cannot be set for Invalid threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:206,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await setThreshold(3, 1, false, {from: accounts[3]});\nawait setThreshold(5, 0, false, {from: accounts[3]});\nawait setThreshold(5, -10, false, {from: accounts[3]});\nawait setThreshold(5, -1, false, {from: accounts[3]});\nawait setThreshold(5, 3, false, {from: accounts[3]});\nawait setThreshold(3, 2, false, {from: accounts[3]});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fd1c0a35-a317-4ee0-ac79-b8055f356831&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new value cannot be equal to 0&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #setThreshold new value cannot be equal to 0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:142,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await setThreshold(0, 1, false, {from: accounts[3]});\nawait setThreshold(0, 2, false, {from: accounts[3]});\nawait setThreshold(4, 1, true, {from: accounts[3]});\nawait setThreshold(1, 2, true, {from: accounts[3]});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f203f42b-7c77-472d-abde-49ccd3fc3fa6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets new value for Keys threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #setThreshold sets new value for Keys threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await setThreshold(5, 1, true, {from: accounts[3]});\nnew web3.BigNumber(5).should.be.bignumber.equal(await ballotsStorage.getBallotThreshold.call(1));&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a4fce3a1-d3a7-4591-8aa6-a05d3ef82b11&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets new value for MetadataChange threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #setThreshold sets new value for MetadataChange threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:71,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;new web3.BigNumber(2).should.be.bignumber.equal(await ballotsStorage.getBallotThreshold.call(2));\nawait setThreshold(1, 2, true, {from: accounts[3]});\nnew web3.BigNumber(1).should.be.bignumber.equal(await ballotsStorage.getBallotThreshold.call(2));&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9c9a93e9-0cb3-4adf-9b9d-e7e2342013c2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;bc2a0e8d-27f9-4afc-8f3d-9e5046057337&quot;,&quot;fd1c0a35-a317-4ee0-ac79-b8055f356831&quot;,&quot;f203f42b-7c77-472d-abde-49ccd3fc3fa6&quot;,&quot;a4fce3a1-d3a7-4591-8aa6-a05d3ef82b11&quot;,&quot;9c9a93e9-0cb3-4adf-9b9d-e7e2342013c2&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:550,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;95ae26ac-92b4-44b9-94c7-b7b79a0bb90c&quot;,&quot;title&quot;:&quot;#getProxyThreshold&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;return value is correct&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #getProxyThreshold return value is correct&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:416,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;new web3.BigNumber(1).should.be.bignumber.equal(await ballotsStorage.getProxyThreshold.call())\nawait proxyStorage.setKeysManagerMock(masterOfCeremony);\nawait addValidator(accounts[1]);\nawait addValidator(accounts[2]);\nawait addValidator(accounts[3]);\nawait addValidator(accounts[4]);\nawait addValidator(accounts[5]);\nawait proxyStorage.setKeysManagerMock(keysManager.address);\nawait poaNetworkConsensus.setSystemAddress(accounts[0]);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nconst getValidators = await poaNetworkConsensus.getValidators.call();\nnew web3.BigNumber(6).should.be.bignumber.equal(getValidators.length);\n(await poaNetworkConsensus.isMasterOfCeremonyRemoved.call()).should.be.equal(false);\nnew web3.BigNumber(3).should.be.bignumber.equal(await ballotsStorage.getProxyThreshold.call())&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b528a399-e46c-42fe-9918-704710fe112b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;return value is correct if MoC is removed&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #getProxyThreshold return value is correct if MoC is removed&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1304,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;new web3.BigNumber(1).should.be.bignumber.equal(await ballotsStorage.getProxyThreshold.call())\nawait proxyStorage.setKeysManagerMock(masterOfCeremony);\nawait addValidator(accounts[1]);\nawait addValidator(accounts[2]);\nawait addValidator(accounts[3]);\nawait addValidator(accounts[4]);\nawait addValidator(accounts[5]);\nawait addValidator(accounts[6]);\nawait proxyStorage.setKeysManagerMock(keysManager.address);\nawait poaNetworkConsensus.setSystemAddress(accounts[0]);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nconst getValidators = await poaNetworkConsensus.getValidators.call();\nnew web3.BigNumber(7).should.be.bignumber.equal(getValidators.length);\nnew web3.BigNumber(4).should.be.bignumber.equal(await ballotsStorage.getProxyThreshold.call());\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000001&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000002&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000003&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000004&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000005&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000006&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000007&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000008&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000009&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000010&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000011&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000012&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nconst {logs} = await keysManager.removeMiningKey(masterOfCeremony, {from: votingToChangeKeys});\nlogs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\n(await poaNetworkConsensus.isMasterOfCeremonyRemoved.call()).should.be.equal(true);\n(await poaNetworkConsensus.getCurrentValidatorsLength.call()).should.be.bignumber.equal(6);\nnew web3.BigNumber(4).should.be.bignumber.equal(await ballotsStorage.getProxyThreshold.call());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8b28e04a-c471-4278-ad05-a03077b53c83&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b528a399-e46c-42fe-9918-704710fe112b&quot;,&quot;8b28e04a-c471-4278-ad05-a03077b53c83&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1720,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;9d2567ea-c327-4f2a-ae91-4dcc0ad0bdb8&quot;,&quot;title&quot;:&quot;#getVotingToChangeThreshold&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns voting to change min threshold address&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #getVotingToChangeThreshold returns voting to change min threshold address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:65,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;votingToChangeMinThreshold.should.be.equal(await ballotsStorage.getVotingToChangeThreshold.call())\nawait proxyStorage.setVotingToChangeMinThresholdMock(accounts[4]);\naccounts[4].should.be.equal(await ballotsStorage.getVotingToChangeThreshold.call())&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f2b3edc8-201b-44da-ab15-767692a9329d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f2b3edc8-201b-44da-ab15-767692a9329d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:65,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;ad2a6640-d3ad-4408-94f7-f4fb816185b2&quot;,&quot;title&quot;:&quot;#getBallotLimitPerValidator&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns correct limit&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #getBallotLimitPerValidator returns correct limit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:352,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let limit = await ballotsStorage.getBallotLimitPerValidator.call();\nlimit.should.be.bignumber.equal(200);\nawait addMiningKey(accounts[1]);\nawait addMiningKey(accounts[2]);\nawait poaNetworkConsensus.setSystemAddress(accounts[0]);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nlimit = await ballotsStorage.getBallotLimitPerValidator.call();\nlimit.should.be.bignumber.equal(100);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1aef0fa3-b33b-4908-a910-caaf6f0add8b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns correct limit if MoC is removed&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #getBallotLimitPerValidator returns correct limit if MoC is removed&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1065,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let limit = await ballotsStorage.getBallotLimitPerValidator.call();\nlimit.should.be.bignumber.equal(200);\nawait addMiningKey(accounts[1]);\nawait addMiningKey(accounts[2]);\nawait poaNetworkConsensus.setSystemAddress(accounts[0]);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\n(await poaNetworkConsensus.getCurrentValidatorsLength.call()).should.be.bignumber.equal(3);\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000001&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000002&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000003&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000004&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000005&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000006&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000007&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000008&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000009&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000010&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000011&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000012&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nconst {logs} = await keysManager.removeMiningKey(masterOfCeremony, {from: votingToChangeKeys});\nlogs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\n(await poaNetworkConsensus.isMasterOfCeremonyRemoved.call()).should.be.equal(true);\n(await poaNetworkConsensus.getCurrentValidatorsLength.call()).should.be.bignumber.equal(2);\nlimit = await ballotsStorage.getBallotLimitPerValidator.call();\nlimit.should.be.bignumber.equal(100);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d4033bda-b9d6-44b2-a9b5-920645e6a4e1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1aef0fa3-b33b-4908-a910-caaf6f0add8b&quot;,&quot;d4033bda-b9d6-44b2-a9b5-920645e6a4e1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1417,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;5f89f1c3-3931-4050-b2e0-992f3b805535&quot;,&quot;title&quot;:&quot;#upgradeTo&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #upgradeTo \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:95,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;proxyStorageStubAddress = accounts[8];\nballotsStorage = await BallotsStorage.new();\nballotsStorageOldImplementation = ballotsStorage.address;\nballotsEternalStorage = await EternalStorageProxy.new(proxyStorage.address, ballotsStorage.address);\nballotsStorage = await BallotsStorage.at(ballotsEternalStorage.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a904fbcc-4da2-41f1-83b4-daa7d5bdd43e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called by ProxyStorage&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #upgradeTo may only be called by ProxyStorage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:134,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const ballotsStorageNew = await BallotsStorageNew.new();\nawait ballotsEternalStorage.setProxyStorage(proxyStorageStubAddress);\nawait ballotsEternalStorage.upgradeTo(ballotsStorageNew.address, {from: accounts[0]}).should.be.rejectedWith(ERROR_MSG);\nawait upgradeTo(ballotsStorageNew.address, {from: proxyStorageStubAddress});\nawait ballotsEternalStorage.setProxyStorage(proxyStorage.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c5a1f1ae-9ec0-4767-9535-451308510550&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change implementation address&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #upgradeTo should change implementation address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:229,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let ballotsStorageNew = await BallotsStorageNew.new();\nconst newImplementation = ballotsStorageNew.address;\n(await ballotsEternalStorage.implementation.call()).should.be.equal(ballotsStorageOldImplementation);\nawait ballotsEternalStorage.setProxyStorage(proxyStorageStubAddress);\nawait upgradeTo(newImplementation, {from: proxyStorageStubAddress});\nawait ballotsEternalStorage.setProxyStorage(proxyStorage.address);\n(await ballotsEternalStorage.implementation.call()).should.be.equal(newImplementation);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1fae036c-5211-4305-ab1d-69cd8df28323&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should increment implementation version&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #upgradeTo should increment implementation version&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:122,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let ballotsStorageNew = await BallotsStorageNew.new();\nconst oldVersion = await ballotsEternalStorage.version.call();\nconst newVersion = oldVersion.add(1);\nawait ballotsEternalStorage.setProxyStorage(proxyStorageStubAddress);\nawait upgradeTo(ballotsStorageNew.address, {from: proxyStorageStubAddress});\nawait ballotsEternalStorage.setProxyStorage(proxyStorage.address);\n(await ballotsEternalStorage.version.call()).should.be.bignumber.equal(newVersion);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1f746495-7376-4b17-82f1-0ef9db83568e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should work&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #upgradeTo new implementation should work&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:153,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let ballotsStorageNew = await BallotsStorageNew.new();\nawait ballotsEternalStorage.setProxyStorage(proxyStorageStubAddress);\nawait upgradeTo(ballotsStorageNew.address, {from: proxyStorageStubAddress});\nawait ballotsEternalStorage.setProxyStorage(proxyStorage.address);\nballotsStorageNew = await BallotsStorageNew.at(ballotsEternalStorage.address);\n(await ballotsStorageNew.initialized.call()).should.be.equal(false);\nawait ballotsStorageNew.initialize();\n(await ballotsStorageNew.initialized.call()).should.be.equal(true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d7c742af-6850-4617-9047-725eceb9042c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should use the same proxyStorage address&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #upgradeTo new implementation should use the same proxyStorage address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:133,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let ballotsStorageNew = await BallotsStorageNew.new();\nawait ballotsEternalStorage.setProxyStorage(proxyStorageStubAddress);\nawait upgradeTo(ballotsStorageNew.address, {from: proxyStorageStubAddress});\nballotsStorageNew = await BallotsStorageNew.at(ballotsEternalStorage.address);\n(await ballotsStorageNew.proxyStorage.call()).should.be.equal(proxyStorageStubAddress);\nawait ballotsEternalStorage.setProxyStorage(proxyStorage.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2b497afc-5224-4b77-ac13-f2244c9894d5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should use the same storage&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage [all features] #upgradeTo new implementation should use the same storage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:166,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await setThreshold(6, 1, true, {from: votingToChangeMinThreshold});\nlet ballotsStorageNew = await BallotsStorageNew.new();\nawait ballotsEternalStorage.setProxyStorage(proxyStorageStubAddress);\nawait upgradeTo(ballotsStorageNew.address, {from: proxyStorageStubAddress});\nballotsStorageNew = await BallotsStorageNew.at(ballotsEternalStorage.address);\nconst threshold = await ballotsStorageNew.getBallotThreshold.call(1);\nthreshold.should.be.bignumber.equal(6);\nawait ballotsEternalStorage.setProxyStorage(proxyStorage.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;92b75a29-5d3f-428c-a475-b0b0bd85a715&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c5a1f1ae-9ec0-4767-9535-451308510550&quot;,&quot;1fae036c-5211-4305-ab1d-69cd8df28323&quot;,&quot;1f746495-7376-4b17-82f1-0ef9db83568e&quot;,&quot;d7c742af-6850-4617-9047-725eceb9042c&quot;,&quot;2b497afc-5224-4b77-ac13-f2244c9894d5&quot;,&quot;92b75a29-5d3f-428c-a475-b0b0bd85a715&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:937,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;9d35b2ec-36be-4065-87a9-1edac7e72b98&quot;,&quot;title&quot;:&quot;Contract: BallotsStorage upgraded [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage upgraded [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1313,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;48f2029f-aac5-494c-8e43-cb975e9aaccc&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage upgraded [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;525a3204-0826-43a8-99df-4e8c70f6798b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage upgraded [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:691,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;masterOfCeremony = accounts[0];\nvotingToChangeKeys = accounts[0];\nvotingToChangeMinThreshold = accounts[3];\nvotingToChangeProxy = accounts[4];\nvotingToManageEmissionFunds = accounts[5];\nrewardByBlock = accounts[8];\npoaNetworkConsensus = await PoaNetworkConsensus.new(masterOfCeremony, []);\n\nproxyStorage = await ProxyStorageMock.new();\nconst proxyStorageEternalStorage = await EternalStorageProxy.new(0, proxyStorage.address);\nproxyStorage = await ProxyStorageMock.at(proxyStorageEternalStorage.address);\nawait proxyStorage.init(poaNetworkConsensus.address).should.be.fulfilled;\n\nballotsStorage = await BallotsStorage.new();\nballotsEternalStorage = await EternalStorageProxy.new(proxyStorage.address, ballotsStorage.address);\nballotsStorage = await BallotsStorage.at(ballotsEternalStorage.address);\nawait ballotsStorage.init([3, 2], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait ballotsStorage.init([3, 3]).should.be.rejectedWith(ERROR_MSG);\nawait ballotsStorage.init([3, 2]).should.be.fulfilled;\nkeysManager = await KeysManagerMock.new();\nconst keysManagerEternalStorage = await EternalStorageProxy.new(proxyStorage.address, keysManager.address);\nkeysManager = await KeysManagerMock.at(keysManagerEternalStorage.address);\nawait keysManager.init(\n  \&quot;0x0000000000000000000000000000000000000000\&quot;\n).should.be.fulfilled;\nconst validatorMetadata = await ValidatorMetadata.new();\nconst validatorMetadataEternalStorage = await EternalStorageProxy.new(proxyStorage.address, validatorMetadata.address);\n\nawait poaNetworkConsensus.setProxyStorage(proxyStorage.address);\nawait proxyStorage.initializeAddresses(\n  keysManager.address,\n  votingToChangeKeys,\n  votingToChangeMinThreshold,\n  votingToChangeProxy,\n  votingToManageEmissionFunds,\n  ballotsEternalStorage.address,\n  validatorMetadataEternalStorage.address,\n  rewardByBlock\n);\nlet ballotsStorageNew = await BallotsStorageNew.new();\nawait ballotsEternalStorage.setProxyStorage(accounts[6]);\nconst {logs} = await ballotsEternalStorage.upgradeTo(ballotsStorageNew.address, {from: accounts[6]});\nlogs[0].event.should.be.equal(\&quot;Upgraded\&quot;);\nawait ballotsEternalStorage.setProxyStorage(proxyStorage.address);\nballotsStorage = await BallotsStorageNew.at(ballotsEternalStorage.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c9e4abd9-abd6-47ae-bad3-d9b5b1060b3a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage upgraded [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e0045eff-186f-4951-97e2-c0dc1bc71247&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;64184fdc-5354-4423-b318-fab3ef6d29f3&quot;,&quot;title&quot;:&quot;#init&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;prevent from double init&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage upgraded [all features] #init prevent from double init&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:106,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await ballotsStorage.init([3, 2]).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a3cacac9-fc39-4606-8138-cc34e2e35098&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;thresholds are correct&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage upgraded [all features] #init thresholds are correct&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;new web3.BigNumber(3).should.be.bignumber.equal(\n  await ballotsStorage.getBallotThreshold.call(1)\n);\nnew web3.BigNumber(2).should.be.bignumber.equal(\n  await ballotsStorage.getBallotThreshold.call(2)\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f903aedc-2592-44f3-9b4c-4665f8bb3fbc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a3cacac9-fc39-4606-8138-cc34e2e35098&quot;,&quot;f903aedc-2592-44f3-9b4c-4665f8bb3fbc&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:137,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;da9b70fa-be2f-4aea-b6f2-0f20d32aebbd&quot;,&quot;title&quot;:&quot;#migrate&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should copy thresholds from an old contract&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage upgraded [all features] #migrate should copy thresholds from an old contract&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:224,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let ballotsStorageNew = await BallotsStorage.new();\nconst ballotsEternalStorageNew = await EternalStorageProxy.new(proxyStorage.address, ballotsStorageNew.address);\nballotsStorageNew = await BallotsStorage.at(ballotsEternalStorageNew.address);\n(await ballotsStorageNew.getBallotThreshold.call(1)).should.be.bignumber.equal(0);\n(await ballotsStorageNew.getBallotThreshold.call(2)).should.be.bignumber.equal(0);\nawait ballotsStorageNew.migrate(&#x27;0x0000000000000000000000000000000000000000&#x27;).should.be.rejectedWith(ERROR_MSG);\nawait ballotsStorageNew.migrate(ballotsStorage.address, {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait ballotsStorageNew.migrate(ballotsStorage.address).should.be.fulfilled;\n(await ballotsStorageNew.getBallotThreshold.call(1)).should.be.bignumber.equal(3);\n(await ballotsStorageNew.getBallotThreshold.call(2)).should.be.bignumber.equal(2);\nawait ballotsStorageNew.migrate(ballotsStorage.address).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;15a0bef4-ac41-4afb-9441-51ba5a5bd70f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;15a0bef4-ac41-4afb-9441-51ba5a5bd70f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:224,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;449424b1-ad79-4870-a1ae-2955560c2b9b&quot;,&quot;title&quot;:&quot;#setThreshold&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;can only be called from votingToChangeThreshold address&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage upgraded [all features] #setThreshold can only be called from votingToChangeThreshold address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await ballotsStorage.setThreshold(4, 1, {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait setThreshold(4, 1, true, {from: accounts[3]});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8eea5ba0-c5bb-4299-8090-a22d592a7f1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot be set for Invalid threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage upgraded [all features] #setThreshold cannot be set for Invalid threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:184,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await setThreshold(3, 1, false, {from: accounts[3]});\nawait setThreshold(5, 0, false, {from: accounts[3]});\nawait setThreshold(5, -10, false, {from: accounts[3]});\nawait setThreshold(5, -1, false, {from: accounts[3]});\nawait setThreshold(5, 3, false, {from: accounts[3]});\nawait setThreshold(3, 2, false, {from: accounts[3]});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;acaf43e3-5dcc-4811-977c-b89e31caebd4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new value cannot be equal to 0&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage upgraded [all features] #setThreshold new value cannot be equal to 0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:132,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await setThreshold(0, 1, false, {from: accounts[3]});\nawait setThreshold(0, 2, false, {from: accounts[3]});\nawait setThreshold(4, 1, true, {from: accounts[3]});\nawait setThreshold(1, 2, true, {from: accounts[3]});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bb4f2d4d-9759-4a25-ae02-2d4ddc22595f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets new value for Keys threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage upgraded [all features] #setThreshold sets new value for Keys threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await setThreshold(5, 1, true, {from: accounts[3]});\nnew web3.BigNumber(5).should.be.bignumber.equal(await ballotsStorage.getBallotThreshold.call(1));&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8e8fb516-1e05-4b1d-973f-250eb34ab66d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets new value for MetadataChange threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage upgraded [all features] #setThreshold sets new value for MetadataChange threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:60,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;new web3.BigNumber(2).should.be.bignumber.equal(await ballotsStorage.getBallotThreshold.call(2));\nawait setThreshold(1, 2, true, {from: accounts[3]});\nnew web3.BigNumber(1).should.be.bignumber.equal(await ballotsStorage.getBallotThreshold.call(2));&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bbc018bd-cba1-4c46-8232-16d38c512b81&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8eea5ba0-c5bb-4299-8090-a22d592a7f1c&quot;,&quot;acaf43e3-5dcc-4811-977c-b89e31caebd4&quot;,&quot;bb4f2d4d-9759-4a25-ae02-2d4ddc22595f&quot;,&quot;8e8fb516-1e05-4b1d-973f-250eb34ab66d&quot;,&quot;bbc018bd-cba1-4c46-8232-16d38c512b81&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:488,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;4b57f814-d9eb-45aa-99d4-bf11f5621408&quot;,&quot;title&quot;:&quot;#getProxyThreshold&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;return value is correct&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage upgraded [all features] #getProxyThreshold return value is correct&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:381,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;new web3.BigNumber(1).should.be.bignumber.equal(await ballotsStorage.getProxyThreshold.call())\nawait proxyStorage.setKeysManagerMock(masterOfCeremony);\nawait addValidator(accounts[1]);\nawait addValidator(accounts[2]);\nawait addValidator(accounts[3]);\nawait addValidator(accounts[4]);\nawait addValidator(accounts[5]);\nawait proxyStorage.setKeysManagerMock(keysManager.address);\nawait poaNetworkConsensus.setSystemAddress(accounts[0]);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nconst getValidators = await poaNetworkConsensus.getValidators.call();\nnew web3.BigNumber(6).should.be.bignumber.equal(getValidators.length);\n(await poaNetworkConsensus.isMasterOfCeremonyRemoved.call()).should.be.equal(false);\nnew web3.BigNumber(3).should.be.bignumber.equal(await ballotsStorage.getProxyThreshold.call())&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ffd76ea6-5c11-48fe-94f9-49bac4e41b90&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;return value is correct if MoC is removed&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage upgraded [all features] #getProxyThreshold return value is correct if MoC is removed&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1174,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;new web3.BigNumber(1).should.be.bignumber.equal(await ballotsStorage.getProxyThreshold.call())\nawait proxyStorage.setKeysManagerMock(masterOfCeremony);\nawait addValidator(accounts[1]);\nawait addValidator(accounts[2]);\nawait addValidator(accounts[3]);\nawait addValidator(accounts[4]);\nawait addValidator(accounts[5]);\nawait addValidator(accounts[6]);\nawait proxyStorage.setKeysManagerMock(keysManager.address);\nawait poaNetworkConsensus.setSystemAddress(accounts[0]);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nconst getValidators = await poaNetworkConsensus.getValidators.call();\nnew web3.BigNumber(7).should.be.bignumber.equal(getValidators.length);\nnew web3.BigNumber(4).should.be.bignumber.equal(await ballotsStorage.getProxyThreshold.call());\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000001&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000002&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000003&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000004&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000005&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000006&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000007&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000008&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000009&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000010&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000011&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000012&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nconst {logs} = await keysManager.removeMiningKey(masterOfCeremony, {from: votingToChangeKeys});\nlogs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\n(await poaNetworkConsensus.isMasterOfCeremonyRemoved.call()).should.be.equal(true);\n(await poaNetworkConsensus.getCurrentValidatorsLength.call()).should.be.bignumber.equal(6);\nnew web3.BigNumber(4).should.be.bignumber.equal(await ballotsStorage.getProxyThreshold.call());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;afb5e7e0-40f8-4398-af10-4bf22cd8a916&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ffd76ea6-5c11-48fe-94f9-49bac4e41b90&quot;,&quot;afb5e7e0-40f8-4398-af10-4bf22cd8a916&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1555,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;9d1970c9-3dfe-400e-b017-f37ca82e56d6&quot;,&quot;title&quot;:&quot;#getVotingToChangeThreshold&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns voting to change min threshold address&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage upgraded [all features] #getVotingToChangeThreshold returns voting to change min threshold address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;votingToChangeMinThreshold.should.be.equal(await ballotsStorage.getVotingToChangeThreshold.call())\nawait proxyStorage.setVotingToChangeMinThresholdMock(accounts[4]);\naccounts[4].should.be.equal(await ballotsStorage.getVotingToChangeThreshold.call())&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;16b21d0f-8568-45eb-8d61-4476893520da&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;16b21d0f-8568-45eb-8d61-4476893520da&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:49,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;131c58e4-4651-4113-89b6-1817991a1d31&quot;,&quot;title&quot;:&quot;#getBallotLimitPerValidator&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/ballots_storage_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/ballots_storage_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns correct limit&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage upgraded [all features] #getBallotLimitPerValidator returns correct limit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:262,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let limit = await ballotsStorage.getBallotLimitPerValidator.call();\nlimit.should.be.bignumber.equal(200);\nawait addMiningKey(accounts[1]);\nawait addMiningKey(accounts[2]);\nawait poaNetworkConsensus.setSystemAddress(accounts[0]);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nlimit = await ballotsStorage.getBallotLimitPerValidator.call();\nlimit.should.be.bignumber.equal(100);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;99a5e4bc-eb2f-426c-bafd-a3ed40691362&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns correct limit if MoC is removed&quot;,&quot;fullTitle&quot;:&quot;Contract: BallotsStorage upgraded [all features] #getBallotLimitPerValidator returns correct limit if MoC is removed&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1064,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let limit = await ballotsStorage.getBallotLimitPerValidator.call();\nlimit.should.be.bignumber.equal(200);\nawait addMiningKey(accounts[1]);\nawait addMiningKey(accounts[2]);\nawait poaNetworkConsensus.setSystemAddress(accounts[0]);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\n(await poaNetworkConsensus.getCurrentValidatorsLength.call()).should.be.bignumber.equal(3);\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000001&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000002&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000003&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000004&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000005&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000006&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000007&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000008&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000009&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000010&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000011&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000012&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nconst {logs} = await keysManager.removeMiningKey(masterOfCeremony, {from: votingToChangeKeys});\nlogs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\n(await poaNetworkConsensus.isMasterOfCeremonyRemoved.call()).should.be.equal(true);\n(await poaNetworkConsensus.getCurrentValidatorsLength.call()).should.be.bignumber.equal(2);\nlimit = await ballotsStorage.getBallotLimitPerValidator.call();\nlimit.should.be.bignumber.equal(100);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;93f04f69-ba95-416f-a6df-0523b35cf5b9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;99a5e4bc-eb2f-426c-bafd-a3ed40691362&quot;,&quot;93f04f69-ba95-416f-a6df-0523b35cf5b9&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1326,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;7f7a2a5a-b336-46ec-9009-2092a86e29b3&quot;,&quot;title&quot;:&quot;Contract: EmissionFunds [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/emission_funds_test.js&quot;,&quot;file&quot;:&quot;/test/emission_funds_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: EmissionFunds [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:964,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;497890ab-8700-4898-9179-ae6c2b60e332&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: EmissionFunds [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c7c8ece8-dec9-4de3-a46a-5a74f11b519b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: EmissionFunds [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:359,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;amount = web3.toWei(10, &#x27;ether&#x27;);\nvotingToManageEmissionFunds = accounts[0];\nawait EmissionFunds.new(0).should.be.rejectedWith(ERROR_MSG);\n\nemissionFunds = await EmissionFunds.new(\n  votingToManageEmissionFunds\n).should.be.fulfilled;\n\nawait web3.eth.sendTransaction({\n  from: accounts[1],\n  to: emissionFunds.address,\n  value: amount\n});\namount.should.be.bignumber.equal(\n  await web3.eth.getBalance(emissionFunds.address)\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;957d610c-1ad1-42e2-a2eb-619ce6b8d648&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: EmissionFunds [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e8e73ac2-b9c0-4199-bb38-debc5b86ccac&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;6bd1c418-774e-46a8-8694-17553e921ae3&quot;,&quot;title&quot;:&quot;constructor&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/emission_funds_test.js&quot;,&quot;file&quot;:&quot;/test/emission_funds_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should save VotingToManageEmissionFunds address&quot;,&quot;fullTitle&quot;:&quot;Contract: EmissionFunds [all features] constructor should save VotingToManageEmissionFunds address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await emissionFunds.votingToManageEmissionFunds.call()).should.be.equal(\n  votingToManageEmissionFunds\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a7b5910b-ea53-455b-8ab8-004fd8bb5332&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a7b5910b-ea53-455b-8ab8-004fd8bb5332&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:14,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;8f6a4a0e-57df-442d-a2c8-0ee523b8f6a5&quot;,&quot;title&quot;:&quot;#fallback&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/emission_funds_test.js&quot;,&quot;file&quot;:&quot;/test/emission_funds_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should receive funds&quot;,&quot;fullTitle&quot;:&quot;Contract: EmissionFunds [all features] #fallback should receive funds&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:315,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await web3.eth.sendTransaction({\n  from: accounts[1],\n  to: emissionFunds.address,\n  value: amount\n});\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.equal(\n  amount * 2\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;57ee9eaa-d8c6-4748-a66a-0fcc3c09c520&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;57ee9eaa-d8c6-4748-a66a-0fcc3c09c520&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:315,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;eef5ba69-cd8a-4fe6-bf2d-88a2550dd723&quot;,&quot;title&quot;:&quot;#sendFundsTo&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/emission_funds_test.js&quot;,&quot;file&quot;:&quot;/test/emission_funds_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: EmissionFunds [all features] #sendFundsTo \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:150,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;receiver = accounts[2];\nreceiverInitBalance = await web3.eth.getBalance(receiver);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cecb7f19-25b9-4eee-a56d-fc1ca315320a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called by VotingToManageEmissionFunds&quot;,&quot;fullTitle&quot;:&quot;Contract: EmissionFunds [all features] #sendFundsTo may only be called by VotingToManageEmissionFunds&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const amountToSend = web3.toWei(5, &#x27;ether&#x27;);\nawait emissionFunds.sendFundsTo(\n  receiver,\n  amountToSend,\n  {from: accounts[3]}\n).should.be.rejectedWith(ERROR_MSG);\nawait emissionFunds.sendFundsTo(\n  receiver,\n  amountToSend,\n  {from: votingToManageEmissionFunds}\n).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;917d60c0-6d1c-4d34-bad2-20a128b90d98&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send funds to receiver&quot;,&quot;fullTitle&quot;:&quot;Contract: EmissionFunds [all features] #sendFundsTo should send funds to receiver&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:309,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const amountToSend = web3.toWei(4, &#x27;ether&#x27;);\nconst amountRemain = amount - amountToSend;\nconst {logs} = await emissionFunds.sendFundsTo(\n  receiver,\n  amountToSend,\n  {from: votingToManageEmissionFunds}\n).should.be.fulfilled;\n\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.equal(\n  amountRemain\n);\n(await web3.eth.getBalance(receiver)).should.be.bignumber.equal(\n  receiverInitBalance.add(amountToSend)\n);\nlogs[0].event.should.be.equal(\&quot;FundsSentTo\&quot;);\nlogs[0].args.receiver.should.be.equal(receiver);\nlogs[0].args.caller.should.be.equal(votingToManageEmissionFunds);\nlogs[0].args.amount.should.be.bignumber.equal(amountToSend);\nlogs[0].args.success.should.be.equal(true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6ec1649e-7dc9-4315-9f87-2ace695b075a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should send entire amount&quot;,&quot;fullTitle&quot;:&quot;Contract: EmissionFunds [all features] #sendFundsTo should send entire amount&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:329,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await emissionFunds.sendFundsTo(\n  receiver,\n  amount,\n  {from: votingToManageEmissionFunds}\n).should.be.fulfilled;\n\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.equal(0);\n(await web3.eth.getBalance(receiver)).should.be.bignumber.equal(\n  receiverInitBalance.add(amount)\n);\nlogs[0].event.should.be.equal(\&quot;FundsSentTo\&quot;);\nlogs[0].args.receiver.should.be.equal(receiver);\nlogs[0].args.caller.should.be.equal(votingToManageEmissionFunds);\nlogs[0].args.amount.should.be.bignumber.equal(amount);\nlogs[0].args.success.should.be.equal(true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3f7d39ef-a591-4977-9ff7-3893acaf1cbf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not send funds if amount greater than balance&quot;,&quot;fullTitle&quot;:&quot;Contract: EmissionFunds [all features] #sendFundsTo should not send funds if amount greater than balance&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:318,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const amountToSend = amount + 1;\nconst {logs} = await emissionFunds.sendFundsTo(\n  receiver,\n  amountToSend,\n  {from: votingToManageEmissionFunds}\n).should.be.fulfilled;\namount.should.be.bignumber.equal(\n  await web3.eth.getBalance(emissionFunds.address)\n);\nreceiverInitBalance.should.be.bignumber.equal(\n  await web3.eth.getBalance(receiver)\n);\nlogs[0].event.should.be.equal(\&quot;FundsSentTo\&quot;);\nlogs[0].args.receiver.should.be.equal(receiver);\nlogs[0].args.caller.should.be.equal(votingToManageEmissionFunds);\nlogs[0].args.amount.should.be.bignumber.equal(amountToSend);\nlogs[0].args.success.should.be.equal(false);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;19deb22c-f9cd-46a9-835a-fa6ef0b94ba5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not send funds if amount is too much&quot;,&quot;fullTitle&quot;:&quot;Contract: EmissionFunds [all features] #sendFundsTo should not send funds if amount is too much&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:310,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const amountToSend = web3.toWei(11, &#x27;ether&#x27;);\nconst {logs} = await emissionFunds.sendFundsTo(\n  receiver,\n  amountToSend,\n  {from: votingToManageEmissionFunds}\n).should.be.fulfilled;\namount.should.be.bignumber.equal(\n  await web3.eth.getBalance(emissionFunds.address)\n);\nreceiverInitBalance.should.be.bignumber.equal(\n  await web3.eth.getBalance(receiver)\n);\nlogs[0].event.should.be.equal(\&quot;FundsSentTo\&quot;);\nlogs[0].args.receiver.should.be.equal(receiver);\nlogs[0].args.caller.should.be.equal(votingToManageEmissionFunds);\nlogs[0].args.amount.should.be.bignumber.equal(amountToSend);\nlogs[0].args.success.should.be.equal(false);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;04a3f9e8-9adc-4d17-8279-a95016ae50d4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should be fulfilled if receiver is 0x0&quot;,&quot;fullTitle&quot;:&quot;Contract: EmissionFunds [all features] #sendFundsTo should be fulfilled if receiver is 0x0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:175,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const amountToSend = web3.toWei(5, &#x27;ether&#x27;);\nconst amountRemain = amount - amountToSend;\nconst {logs} = await emissionFunds.sendFundsTo(\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  amountToSend,\n  {from: votingToManageEmissionFunds}\n).should.be.fulfilled;\namountRemain.should.be.bignumber.equal(\n  await web3.eth.getBalance(emissionFunds.address)\n);\nlogs[0].event.should.be.equal(\&quot;FundsSentTo\&quot;);\nlogs[0].args.receiver.should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);\nlogs[0].args.caller.should.be.equal(votingToManageEmissionFunds);\nlogs[0].args.amount.should.be.bignumber.equal(amountToSend);\nlogs[0].args.success.should.be.equal(true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;23605669-c502-487f-b9fd-dbc1cb618d9f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should be fulfilled if amount is zero&quot;,&quot;fullTitle&quot;:&quot;Contract: EmissionFunds [all features] #sendFundsTo should be fulfilled if amount is zero&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:320,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const amountToSend = 0;\nconst {logs} = await emissionFunds.sendFundsTo(\n  receiver,\n  amountToSend,\n  {from: votingToManageEmissionFunds}\n).should.be.fulfilled;\namount.should.be.bignumber.equal(\n  await web3.eth.getBalance(emissionFunds.address)\n);\nreceiverInitBalance.should.be.bignumber.equal(\n  await web3.eth.getBalance(receiver)\n);\nlogs[0].event.should.be.equal(\&quot;FundsSentTo\&quot;);\nlogs[0].args.receiver.should.be.equal(receiver);\nlogs[0].args.caller.should.be.equal(votingToManageEmissionFunds);\nlogs[0].args.amount.should.be.bignumber.equal(0);\nlogs[0].args.success.should.be.equal(true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c3f4686a-77e2-4bc4-aefe-dc40cff84291&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fail if receiver address is not full&quot;,&quot;fullTitle&quot;:&quot;Contract: EmissionFunds [all features] #sendFundsTo should fail if receiver address is not full&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:639,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const signature = web3.sha3(&#x27;sendFundsTo(address,uint256)&#x27;).slice(0, 10);\nlet data = signature;\ndata += &#x27;0000000000000000000000000000000000000000000000000000000000000A&#x27;;\ndata += &#x27;0000000000000000000000000000000000000000000000004563918244F40000&#x27;;\nlet receipt = await web3.eth.getTransactionReceipt(\n  await web3.eth.sendTransaction({\n    from: votingToManageEmissionFunds,\n    to: emissionFunds.address,\n    data: data\n  })\n);\nreceipt.logs.length.should.be.equal(0);\ndata = signature;\ndata += &#x27;000000000000000000000000000000000000000000000000000000000000000A&#x27;;\ndata += &#x27;0000000000000000000000000000000000000000000000004563918244F40000&#x27;;\nreceipt = await web3.eth.getTransactionReceipt(\n  await web3.eth.sendTransaction({\n    from: votingToManageEmissionFunds,\n    to: emissionFunds.address,\n    data: data\n  })\n);\nreceipt.logs.length.should.be.equal(1);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d607ef78-ccf9-4d83-92f5-e012a3b4c81c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;917d60c0-6d1c-4d34-bad2-20a128b90d98&quot;,&quot;6ec1649e-7dc9-4315-9f87-2ace695b075a&quot;,&quot;3f7d39ef-a591-4977-9ff7-3893acaf1cbf&quot;,&quot;19deb22c-f9cd-46a9-835a-fa6ef0b94ba5&quot;,&quot;04a3f9e8-9adc-4d17-8279-a95016ae50d4&quot;,&quot;23605669-c502-487f-b9fd-dbc1cb618d9f&quot;,&quot;c3f4686a-77e2-4bc4-aefe-dc40cff84291&quot;,&quot;d607ef78-ccf9-4d83-92f5-e012a3b4c81c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2437,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;1f32a48b-6ad7-46c1-a7b4-69c4f32715c3&quot;,&quot;title&quot;:&quot;#burnFunds&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/emission_funds_test.js&quot;,&quot;file&quot;:&quot;/test/emission_funds_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called by VotingToManageEmissionFunds&quot;,&quot;fullTitle&quot;:&quot;Contract: EmissionFunds [all features] #burnFunds may only be called by VotingToManageEmissionFunds&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const amountToBurn = web3.toWei(5, &#x27;ether&#x27;);\nawait emissionFunds.burnFunds(\n  amountToBurn,\n  {from: accounts[3]}\n).should.be.rejectedWith(ERROR_MSG);\nawait emissionFunds.burnFunds(\n  amountToBurn,\n  {from: votingToManageEmissionFunds}\n).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;796d786b-6915-49f4-9ed4-a098391df765&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should burn funds&quot;,&quot;fullTitle&quot;:&quot;Contract: EmissionFunds [all features] #burnFunds should burn funds&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:171,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const amountToBurn = web3.toWei(4, &#x27;ether&#x27;);\nconst amountRemain = amount - amountToBurn;\nconst {logs} = await emissionFunds.burnFunds(\n  amountToBurn,\n  {from: votingToManageEmissionFunds}\n).should.be.fulfilled;\n\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.equal(\n  amountRemain\n);\nlogs[0].event.should.be.equal(\&quot;FundsBurnt\&quot;);\nlogs[0].args.caller.should.be.equal(votingToManageEmissionFunds);\nlogs[0].args.amount.should.be.bignumber.equal(amountToBurn);\nlogs[0].args.success.should.be.equal(true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bebbaddb-0cae-49be-a817-f48aa108bb43&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should burn entire amount&quot;,&quot;fullTitle&quot;:&quot;Contract: EmissionFunds [all features] #burnFunds should burn entire amount&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:160,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await emissionFunds.burnFunds(\n  amount,\n  {from: votingToManageEmissionFunds}\n).should.be.fulfilled;\n\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.equal(0);\n\nlogs[0].event.should.be.equal(\&quot;FundsBurnt\&quot;);\nlogs[0].args.caller.should.be.equal(votingToManageEmissionFunds);\nlogs[0].args.amount.should.be.bignumber.equal(amount);\nlogs[0].args.success.should.be.equal(true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6052137f-1e6b-4987-a2b0-8b9269f090c7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not burn funds if amount greater than balance&quot;,&quot;fullTitle&quot;:&quot;Contract: EmissionFunds [all features] #burnFunds should not burn funds if amount greater than balance&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:171,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const amountToBurn = amount + 1;\nconst {logs} = await emissionFunds.burnFunds(\n  amountToBurn,\n  {from: votingToManageEmissionFunds}\n).should.be.fulfilled;\namount.should.be.bignumber.equal(\n  await web3.eth.getBalance(emissionFunds.address)\n);\nlogs[0].event.should.be.equal(\&quot;FundsBurnt\&quot;);\nlogs[0].args.caller.should.be.equal(votingToManageEmissionFunds);\nlogs[0].args.amount.should.be.bignumber.equal(amountToBurn);\nlogs[0].args.success.should.be.equal(false);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;06126952-8650-45d6-a375-26a47dc6910f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not burn funds if amount is too much&quot;,&quot;fullTitle&quot;:&quot;Contract: EmissionFunds [all features] #burnFunds should not burn funds if amount is too much&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:162,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const amountToBurn = web3.toWei(11, &#x27;ether&#x27;);\nconst {logs} = await emissionFunds.burnFunds(\n  amountToBurn,\n  {from: votingToManageEmissionFunds}\n).should.be.fulfilled;\namount.should.be.bignumber.equal(\n  await web3.eth.getBalance(emissionFunds.address)\n);\nlogs[0].event.should.be.equal(\&quot;FundsBurnt\&quot;);\nlogs[0].args.caller.should.be.equal(votingToManageEmissionFunds);\nlogs[0].args.amount.should.be.bignumber.equal(amountToBurn);\nlogs[0].args.success.should.be.equal(false);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e9a9d924-9ad6-44e3-9579-5ec8032d094d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should be fulfilled if amount is zero&quot;,&quot;fullTitle&quot;:&quot;Contract: EmissionFunds [all features] #burnFunds should be fulfilled if amount is zero&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:164,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const amountToBurn = 0;\nconst {logs} = await emissionFunds.burnFunds(\n  amountToBurn,\n  {from: votingToManageEmissionFunds}\n).should.be.fulfilled;\namount.should.be.bignumber.equal(\n  await web3.eth.getBalance(emissionFunds.address)\n);\nlogs[0].event.should.be.equal(\&quot;FundsBurnt\&quot;);\nlogs[0].args.caller.should.be.equal(votingToManageEmissionFunds);\nlogs[0].args.amount.should.be.bignumber.equal(0);\nlogs[0].args.success.should.be.equal(true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;81d8f0e8-e629-47df-be9b-135d83804413&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;796d786b-6915-49f4-9ed4-a098391df765&quot;,&quot;bebbaddb-0cae-49be-a817-f48aa108bb43&quot;,&quot;6052137f-1e6b-4987-a2b0-8b9269f090c7&quot;,&quot;06126952-8650-45d6-a375-26a47dc6910f&quot;,&quot;e9a9d924-9ad6-44e3-9579-5ec8032d094d&quot;,&quot;81d8f0e8-e629-47df-be9b-135d83804413&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:874,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;2299995b-5285-43e9-a2b4-8e7886ef5d2f&quot;,&quot;title&quot;:&quot;#freezeFunds&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/emission_funds_test.js&quot;,&quot;file&quot;:&quot;/test/emission_funds_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called by VotingToManageEmissionFunds&quot;,&quot;fullTitle&quot;:&quot;Contract: EmissionFunds [all features] #freezeFunds may only be called by VotingToManageEmissionFunds&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:42,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const amountToFreeze = web3.toWei(5, &#x27;ether&#x27;);\nawait emissionFunds.freezeFunds(\n  amountToFreeze,\n  {from: accounts[3]}\n).should.be.rejectedWith(ERROR_MSG);\nawait emissionFunds.freezeFunds(\n  amountToFreeze,\n  {from: votingToManageEmissionFunds}\n).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;afcb4c29-b43c-4d9d-b73b-f60d28903da3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should freeze funds&quot;,&quot;fullTitle&quot;:&quot;Contract: EmissionFunds [all features] #freezeFunds should freeze funds&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:164,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const amountToFreeze = web3.toWei(4, &#x27;ether&#x27;);\nconst {logs} = await emissionFunds.freezeFunds(\n  amountToFreeze,\n  {from: votingToManageEmissionFunds}\n).should.be.fulfilled;\n\namount.should.be.bignumber.equal(\n  await web3.eth.getBalance(emissionFunds.address)\n);\nlogs[0].event.should.be.equal(\&quot;FundsFrozen\&quot;);\nlogs[0].args.caller.should.be.equal(votingToManageEmissionFunds);\nlogs[0].args.amount.should.be.bignumber.equal(amountToFreeze);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;52c41018-6a40-45c4-a88a-30fb10646c27&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should be fulfilled if amount is zero&quot;,&quot;fullTitle&quot;:&quot;Contract: EmissionFunds [all features] #freezeFunds should be fulfilled if amount is zero&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:160,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const amountToFreeze = 0;\nconst {logs} = await emissionFunds.freezeFunds(\n  amountToFreeze,\n  {from: votingToManageEmissionFunds}\n).should.be.fulfilled;\namount.should.be.bignumber.equal(\n  await web3.eth.getBalance(emissionFunds.address)\n);\nlogs[0].event.should.be.equal(\&quot;FundsFrozen\&quot;);\nlogs[0].args.caller.should.be.equal(votingToManageEmissionFunds);\nlogs[0].args.amount.should.be.bignumber.equal(0);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1f256420-96c1-4a54-ac0c-727ca140eda2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;afcb4c29-b43c-4d9d-b73b-f60d28903da3&quot;,&quot;52c41018-6a40-45c4-a88a-30fb10646c27&quot;,&quot;1f256420-96c1-4a54-ac0c-727ca140eda2&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:366,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;d9ecd49f-b65b-4ab3-a6ec-65a1ef37b7f2&quot;,&quot;title&quot;:&quot;Contract: EternalStorageProxy [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/eternal_storage_proxy_test.js&quot;,&quot;file&quot;:&quot;/test/eternal_storage_proxy_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: EternalStorageProxy [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:336,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4458358c-10fe-4f45-b8e4-262502dc349d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: EternalStorageProxy [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b4df82df-e884-4d7e-88c6-271dfc5e37f5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: EternalStorageProxy [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;90688731-3a0b-4303-aa36-b7bb1e1112ad&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;47ff864b-2732-403c-88ea-23fd1a1eb256&quot;,&quot;title&quot;:&quot;constructor&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/eternal_storage_proxy_test.js&quot;,&quot;file&quot;:&quot;/test/eternal_storage_proxy_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should revert if implementation address is equal to 0x0&quot;,&quot;fullTitle&quot;:&quot;Contract: EternalStorageProxy [all features] constructor should revert if implementation address is equal to 0x0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await EternalStorageProxy.new(\n  accounts[1],\n  &#x27;0x0000000000000000000000000000000000000000&#x27;\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bb0bbbe7-d4fd-4266-a210-afd07ad0260f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow ProxyStorage address equal to 0x0&quot;,&quot;fullTitle&quot;:&quot;Contract: EternalStorageProxy [all features] constructor should allow ProxyStorage address equal to 0x0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:42,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const instance = await EternalStorageProxy.new(\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  accounts[1]\n).should.be.fulfilled;\ninstance.address.should.be.equal(\n  await instance.getProxyStorage.call()\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a0596416-c3a0-4b03-9cfc-8ff6cf771e6f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set ProxyStorage address&quot;,&quot;fullTitle&quot;:&quot;Contract: EternalStorageProxy [all features] constructor should set ProxyStorage address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:60,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const instance = await EternalStorageProxy.new(\n  accounts[1],\n  accounts[2]\n).should.be.fulfilled;\n(await instance.getProxyStorage.call()).should.be.equal(accounts[1]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2e238e79-41dc-4634-8cd0-19241a6b473a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set implementation address&quot;,&quot;fullTitle&quot;:&quot;Contract: EternalStorageProxy [all features] constructor should set implementation address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const instance = await EternalStorageProxy.new(\n  accounts[1],\n  accounts[2]\n).should.be.fulfilled;\n(await instance.implementation.call()).should.be.equal(accounts[2]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;877884ef-db1b-4ab5-a0fb-4bb082156eee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set owner&quot;,&quot;fullTitle&quot;:&quot;Contract: EternalStorageProxy [all features] constructor should set owner&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const instance = await EternalStorageProxy.new(\n  accounts[1],\n  accounts[2]\n).should.be.fulfilled;\n(await instance.getOwner.call()).should.be.equal(accounts[0]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1b082b24-002e-4b6d-ae02-f415a38af5ea&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;bb0bbbe7-d4fd-4266-a210-afd07ad0260f&quot;,&quot;a0596416-c3a0-4b03-9cfc-8ff6cf771e6f&quot;,&quot;2e238e79-41dc-4634-8cd0-19241a6b473a&quot;,&quot;877884ef-db1b-4ab5-a0fb-4bb082156eee&quot;,&quot;1b082b24-002e-4b6d-ae02-f415a38af5ea&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:203,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;f61eb91f-dbcb-45e2-b69b-c49731730932&quot;,&quot;title&quot;:&quot;#renounceOwnership&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/eternal_storage_proxy_test.js&quot;,&quot;file&quot;:&quot;/test/eternal_storage_proxy_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: EternalStorageProxy [all features] #renounceOwnership \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;instance = await EternalStorageProxy.new(\n  accounts[1],\n  accounts[2]\n).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0372b736-c329-487f-b714-741468b74427&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called by an owner&quot;,&quot;fullTitle&quot;:&quot;Contract: EternalStorageProxy [all features] #renounceOwnership may only be called by an owner&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await instance.renounceOwnership({from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);\nawait instance.renounceOwnership().should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e221a3aa-e280-43af-ad42-dfc7e28d6092&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set owner to 0x0&quot;,&quot;fullTitle&quot;:&quot;Contract: EternalStorageProxy [all features] #renounceOwnership should set owner to 0x0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:42,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await instance.renounceOwnership().should.be.fulfilled;\n(await instance.getOwner.call()).should.be.equal(\n  &#x27;0x0000000000000000000000000000000000000000&#x27;\n);\nlogs[0].event.should.be.equal(\&quot;OwnershipRenounced\&quot;);\nlogs[0].args.previousOwner.should.be.equal(accounts[0]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2020c379-46d2-45e2-aa91-dc0e47166990&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e221a3aa-e280-43af-ad42-dfc7e28d6092&quot;,&quot;2020c379-46d2-45e2-aa91-dc0e47166990&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:77,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;eb8254b9-fcbe-450d-826c-0ef9961315c6&quot;,&quot;title&quot;:&quot;#transferOwnership&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/eternal_storage_proxy_test.js&quot;,&quot;file&quot;:&quot;/test/eternal_storage_proxy_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: EternalStorageProxy [all features] #transferOwnership \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;instance = await EternalStorageProxy.new(\n  accounts[1],\n  accounts[2]\n).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fead28d8-a608-4605-8a6d-aac377aa216a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called by an owner&quot;,&quot;fullTitle&quot;:&quot;Contract: EternalStorageProxy [all features] #transferOwnership may only be called by an owner&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await instance.transferOwnership(\n  accounts[3],\n  {from: accounts[4]}\n).should.be.rejectedWith(ERROR_MSG);\nawait instance.transferOwnership(accounts[3]).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c5f99156-5d3a-44a1-8d47-044171386b21&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change owner&quot;,&quot;fullTitle&quot;:&quot;Contract: EternalStorageProxy [all features] #transferOwnership should change owner&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:51,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await instance.transferOwnership(accounts[3]).should.be.fulfilled;\n(await instance.getOwner.call()).should.be.equal(accounts[3]);\nlogs[0].event.should.be.equal(\&quot;OwnershipTransferred\&quot;);\nlogs[0].args.previousOwner.should.be.equal(accounts[0]);\nlogs[0].args.newOwner.should.be.equal(accounts[3]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;28679d36-3997-4364-8e55-d9eb36977a94&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not change owner if its address is 0x0&quot;,&quot;fullTitle&quot;:&quot;Contract: EternalStorageProxy [all features] #transferOwnership should not change owner if its address is 0x0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await instance.transferOwnership(\n  &#x27;0x0000000000000000000000000000000000000000&#x27;\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0e1e50e5-56d7-4c48-9833-e5024aee9a6f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c5f99156-5d3a-44a1-8d47-044171386b21&quot;,&quot;28679d36-3997-4364-8e55-d9eb36977a94&quot;,&quot;0e1e50e5-56d7-4c48-9833-e5024aee9a6f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:107,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;693bc294-2b20-40f4-a636-d5f51aaa9e29&quot;,&quot;title&quot;:&quot;#upgradeTo&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/eternal_storage_proxy_test.js&quot;,&quot;file&quot;:&quot;/test/eternal_storage_proxy_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: EternalStorageProxy [all features] #upgradeTo \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:33,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;instance = await EternalStorageProxy.new(\n  accounts[1],\n  accounts[2]\n).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b6771e79-624a-4446-9a1a-664354b31832&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called by ProxyStorage&quot;,&quot;fullTitle&quot;:&quot;Contract: EternalStorageProxy [all features] #upgradeTo may only be called by ProxyStorage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:54,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await instance.upgradeTo(accounts[3]).should.be.rejectedWith(ERROR_MSG);\nconst {logs} = await instance.upgradeTo(accounts[3], {from: accounts[1]});\nlogs[0].event.should.be.equal(\&quot;Upgraded\&quot;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e2f44c11-3c7f-4048-aa63-cf52bc44359e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not change implementation address if it is the same&quot;,&quot;fullTitle&quot;:&quot;Contract: EternalStorageProxy [all features] #upgradeTo should not change implementation address if it is the same&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:34,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = await instance.upgradeTo(\n  accounts[2],\n  {from: accounts[1]}\n).should.be.fulfilled;\nresult.logs.length.should.be.equal(0);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c7dc991b-88d8-4d30-8c60-867be0757c7d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not change implementation address if it is 0x0&quot;,&quot;fullTitle&quot;:&quot;Contract: EternalStorageProxy [all features] #upgradeTo should not change implementation address if it is 0x0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = await instance.upgradeTo(\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  {from: accounts[1]}\n);\nresult.logs.length.should.be.equal(0);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4a999261-befe-46e0-8d83-561c9f51df88&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change implementation address&quot;,&quot;fullTitle&quot;:&quot;Contract: EternalStorageProxy [all features] #upgradeTo should change implementation address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await instance.upgradeTo(\n  accounts[3],\n  {from: accounts[1]}\n).should.be.fulfilled;\n(await instance.implementation.call()).should.be.equal(accounts[3]);\nlogs[0].event.should.be.equal(\&quot;Upgraded\&quot;);\nlogs[0].args.version.should.be.bignumber.equal(1);\nlogs[0].args.implementation.should.be.equal(accounts[3]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;27ba2b3c-74c7-4bfa-9221-24ac5d71aa37&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should increment version&quot;,&quot;fullTitle&quot;:&quot;Contract: EternalStorageProxy [all features] #upgradeTo should increment version&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:51,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await instance.version.call()).should.be.bignumber.equal(0);\nconst {logs} = await instance.upgradeTo(\n  accounts[3],\n  {from: accounts[1]}\n);\nlogs[0].event.should.be.equal(\&quot;Upgraded\&quot;);\n(await instance.version.call()).should.be.bignumber.equal(1);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a7f990ef-69ea-4196-a35f-c8ac3956053b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e2f44c11-3c7f-4048-aa63-cf52bc44359e&quot;,&quot;c7dc991b-88d8-4d30-8c60-867be0757c7d&quot;,&quot;4a999261-befe-46e0-8d83-561c9f51df88&quot;,&quot;27ba2b3c-74c7-4bfa-9221-24ac5d71aa37&quot;,&quot;a7f990ef-69ea-4196-a35f-c8ac3956053b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:201,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;924a0ab1-51fa-480f-9791-8f0878571986&quot;,&quot;title&quot;:&quot;Contract: KeysManager [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:439,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c9425210-c77c-45f2-89f8-1d9a028f76fc&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2f004a3a-e85c-45fe-86f4-a3c1162227dc&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:675,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;masterOfCeremony = accounts[0];\npoaNetworkConsensusMock = await PoaNetworkConsensusMock.new(masterOfCeremony, []);\n\nproxyStorageMock = await ProxyStorageMock.new();\nconst proxyStorageEternalStorage = await EternalStorageProxy.new(0, proxyStorageMock.address);\nproxyStorageMock = await ProxyStorageMock.at(proxyStorageEternalStorage.address);\nawait proxyStorageMock.init(poaNetworkConsensusMock.address).should.be.fulfilled;\n\nkeysManager = await KeysManagerMock.new();\nkeysManagerEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, keysManager.address);\nkeysManager = await KeysManagerMock.at(keysManagerEternalStorage.address);\nawait keysManager.init(\n  \&quot;0x0000000000000000000000000000000000000000\&quot;,\n  {from: accounts[1]}\n).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.init(\n  \&quot;0x0000000000000000000000000000000000000000\&quot;\n).should.be.fulfilled;\nlet ballotsStorage = await BallotsStorage.new();\nlet ballotsEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, ballotsStorage.address);\nballotsStorage = await BallotsStorage.at(ballotsEternalStorage.address);\nawait ballotsStorage.init([3, 2]).should.be.fulfilled;\nvalidatorMetadata = await ValidatorMetadata.new();\nlet validatorMetadataEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, validatorMetadata.address);\nvalidatorMetadata = ValidatorMetadata.at(validatorMetadataEternalStorage.address);\n\nawait poaNetworkConsensusMock.setProxyStorage(proxyStorageMock.address);\nawait proxyStorageMock.initializeAddresses(\n  keysManager.address,\n  accounts[0],\n  accounts[0],\n  accounts[0],\n  accounts[0],\n  ballotsStorage.address,\n  validatorMetadata.address,\n  accounts[0]\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f7baa675-27fc-4f39-bf7e-93210adab394&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d77cd18d-f65e-473d-a022-303a6386853f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1cc35c65-5fcc-4687-833e-dfafde21cb7d&quot;,&quot;title&quot;:&quot;#constructor&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;sets masterOfCeremony, proxyStorage, poaConsensus&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #constructor sets masterOfCeremony, proxyStorage, poaConsensus&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:59,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;masterOfCeremony.should.be.equal(await keysManager.masterOfCeremony.call());\nproxyStorageMock.address.should.be.equal(await keysManager.proxyStorage.call());\npoaNetworkConsensusMock.address.should.be.equal(await keysManager.poaNetworkConsensus.call());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;32e0bd0d-1082-4332-8087-1d40ece323c2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;adds masterOfCeremony to validators hash&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #constructor adds masterOfCeremony to validators hash&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:42,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const validator = await keysManager.validatorKeys.call(masterOfCeremony);\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  false,\n  false]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4cb9dd47-23fd-441e-8d74-de5f93b48e39&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot be called twice&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #constructor cannot be called twice&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.init(\n  &#x27;0x0000000000000000000000000000000000000000&#x27;\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c2ee90c3-a275-4cd1-83dd-cbb3942ba7ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;32e0bd0d-1082-4332-8087-1d40ece323c2&quot;,&quot;4cb9dd47-23fd-441e-8d74-de5f93b48e39&quot;,&quot;c2ee90c3-a275-4cd1-83dd-cbb3942ba7ba&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:123,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;b90ae9d8-27e8-4e5e-b60c-8c36c2961964&quot;,&quot;title&quot;:&quot;#initiateKeys&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;can only be called by master of ceremony&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #initiateKeys can only be called by master of ceremony&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:84,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[2], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.initiateKeys(accounts[2], {from: masterOfCeremony}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a09cb538-dee1-4427-aeb4-7ea0cdc36330&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot allow 0x0 addresses&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #initiateKeys cannot allow 0x0 addresses&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:63,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000000&#x27;).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.initiateKeys(&#x27;0x0&#x27;).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0b606586-5f47-439e-afef-415d3544ff01&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow to initialize already initialized key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #initiateKeys should not allow to initialize already initialized key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:80,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[2], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(accounts[2], {from: masterOfCeremony}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dbf0ac1b-aea7-4679-8a47-906203f1fe1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow to initialize already initialized key after validator created mining key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #initiateKeys should not allow to initialize already initialized key after validator created mining key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:251,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[2], {from: masterOfCeremony}).should.be.fulfilled;   \nawait keysManager.createKeys(accounts[3],accounts[4],accounts[5], {from: accounts[2]}).should.be.fulfilled;\nawait keysManager.initiateKeys(accounts[2], {from: masterOfCeremony}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1062609c-2835-41b0-9409-7dad8b523217&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not equal to master of ceremony&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #initiateKeys should not equal to master of ceremony&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(masterOfCeremony, {from: masterOfCeremony}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f6b2cd67-f4bc-4b5a-a2a1-667d0f82b3b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow to initialize more than maxNumberOfInitialKeys&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #initiateKeys should not allow to initialize more than maxNumberOfInitialKeys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:628,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let maxNumberOfInitialKeys = await keysManager.maxNumberOfInitialKeys.call();\nmaxNumberOfInitialKeys.should.be.bignumber.equal(12);\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000001&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000002&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000003&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000004&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000005&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000006&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000007&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000008&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000009&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000010&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000011&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000012&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000013&#x27;, {from: masterOfCeremony}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1069f772-af98-477c-83fc-ca4e595f451b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should increment initialKeyCount by 1&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #initiateKeys should increment initialKeyCount by 1&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:80,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let initialKeysCount = await keysManager.initialKeysCount.call();\ninitialKeysCount.should.be.bignumber.equal(0);\nawait keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\ninitialKeysCount = await keysManager.initialKeysCount.call();\ninitialKeysCount.should.be.bignumber.equal(1);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fed30d17-754f-4b54-ba11-f8de8df8a275&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set initialKeys hash to activated status&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #initiateKeys should set initialKeys hash to activated status&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:89,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;new web3.BigNumber(0).should.be.bignumber.equal(await keysManager.getInitialKeyStatus.call(accounts[1]));\nconst {logs} = await keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nnew web3.BigNumber(1).should.be.bignumber.equal(await keysManager.getInitialKeyStatus.call(accounts[1]));\nlet initialKeysCount = await keysManager.initialKeysCount.call();\n// event InitialKeyCreated(address indexed initialKey, uint256 time, uint256 initialKeysCount);\nlogs[0].event.should.equal(\&quot;InitialKeyCreated\&quot;);\nlogs[0].args.initialKey.should.be.equal(accounts[1]);\ninitialKeysCount.should.be.bignumber.equal(logs[0].args.initialKeysCount);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;29e0e675-aba0-4008-8791-29ca4ad676db&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a09cb538-dee1-4427-aeb4-7ea0cdc36330&quot;,&quot;0b606586-5f47-439e-afef-415d3544ff01&quot;,&quot;dbf0ac1b-aea7-4679-8a47-906203f1fe1c&quot;,&quot;1062609c-2835-41b0-9409-7dad8b523217&quot;,&quot;f6b2cd67-f4bc-4b5a-a2a1-667d0f82b3b8&quot;,&quot;1069f772-af98-477c-83fc-ca4e595f451b&quot;,&quot;fed30d17-754f-4b54-ba11-f8de8df8a275&quot;,&quot;29e0e675-aba0-4008-8791-29ca4ad676db&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1312,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;bb9ee8e9-4cad-4743-a887-eec34fc23d20&quot;,&quot;title&quot;:&quot;#createKeys&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should only be called from initialized key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #createKeys should only be called from initialized key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:173,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.createKeys(accounts[2], accounts[3], accounts[4], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(accounts[2], accounts[3], accounts[4], {from: accounts[1]}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;31be3df7-543d-4066-8519-ef6f582062d0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;params should not be equal to 0x0&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #createKeys params should not be equal to 0x0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:228,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  accounts[3],\n  accounts[4],\n  {from: accounts[1]}\n).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.createKeys(\n  accounts[2],\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  accounts[4],\n  {from: accounts[1]}\n).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.createKeys(\n  accounts[2],\n  accounts[3],\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  {from: accounts[1]}\n).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.createKeys(\n  accounts[2],\n  accounts[3],\n  accounts[4],\n  {from: accounts[1]}\n).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1063ac32-d5ff-419a-928d-e48aaaef460c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;params should not be equal to each other&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #createKeys params should not be equal to each other&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:215,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(masterOfCeremony, masterOfCeremony, accounts[2], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.createKeys(masterOfCeremony, accounts[2], accounts[2], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.createKeys(masterOfCeremony, accounts[2], masterOfCeremony, {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7e6b9143-c2f5-4f51-a19d-a1e7804f2f45&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;any of params should not be equal to initialKey&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #createKeys any of params should not be equal to initialKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:131,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(accounts[1], masterOfCeremony, accounts[2], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.createKeys(masterOfCeremony, accounts[1], accounts[2], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.createKeys(masterOfCeremony, accounts[2], accounts[1], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;146a96ac-67ea-4104-b5ac-15b9b41c6fb7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow passing the same key after it is already created&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #createKeys should not allow passing the same key after it is already created&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:360,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(accounts[4], accounts[3], accounts[2], {from: accounts[1]}).should.be.fulfilled;\nawait keysManager.initiateKeys(accounts[5], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(accounts[8], accounts[7], accounts[2], {from: accounts[5]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.createKeys(accounts[8], accounts[3], accounts[6], {from: accounts[5]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.createKeys(accounts[4], accounts[7], accounts[6], {from: accounts[5]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.createKeys(accounts[8], accounts[7], accounts[6], {from: accounts[5]}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4e8e9f17-6a09-4df2-a012-03c07c2cf645&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should assign mining, voting, payout keys to relative mappings&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #createKeys should assign mining, voting, payout keys to relative mappings&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:185,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nconst {logs} = await keysManager.createKeys(accounts[4], accounts[3], accounts[2], {from: accounts[1]}).should.be.fulfilled;\ntrue.should.be.equal(\n  await keysManager.isMiningActive.call(accounts[4])\n)\ntrue.should.be.equal(\n  await keysManager.isVotingActive.call(accounts[3])\n)\ntrue.should.be.equal(\n  await keysManager.isPayoutActive.call(accounts[4])\n)\n// event ValidatorInitialized(address indexed miningKey, address indexed votingKey, address indexed payoutKey);\nlogs[0].event.should.be.equal(&#x27;ValidatorInitialized&#x27;);\nlogs[0].args.miningKey.should.be.equal(accounts[4]);\nlogs[0].args.votingKey.should.be.equal(accounts[3]);\nlogs[0].args.payoutKey.should.be.equal(accounts[2]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;12bb4571-5f47-4e20-937d-d2d0a3a5b7ac&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should assign voting &lt;-&gt; mining key and payout &lt;-&gt; mining key relationships&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #createKeys should assign voting &lt;-&gt; mining key and payout &lt;-&gt; mining key relationships&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:190,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(accounts[4], accounts[3], accounts[2], {from: accounts[1]});\naccounts[4].should.be.equal(\n  await keysManager.getMiningKeyByVoting.call(accounts[3])\n);\naccounts[4].should.be.equal(\n  await keysManager.miningKeyByPayout.call(accounts[2])\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ecb56e0a-b87d-4266-899b-7d3464612541&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;adds validator to poaConsensus contract&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #createKeys adds validator to poaConsensus contract&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:151,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[4];\nawait keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(miningKey, accounts[3], accounts[2], {from: accounts[1]});\nconst index = await poaNetworkConsensusMock.getCurrentValidatorsLength.call();\n(await poaNetworkConsensusMock.pendingList.call(index)).should.be.equal(miningKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e547b065-ec00-46e0-88a5-7d38ba2bed58&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set validatorKeys hash&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #createKeys should set validatorKeys hash&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:148,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[4];\nawait keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(miningKey, accounts[3], accounts[2], {from: accounts[1]});\nconst validatorKey = await keysManager.validatorKeys.call(miningKey);\nvalidatorKey.should.be.deep.equal([\n  accounts[3],\n  accounts[2],\n  true,\n  true,\n  true\n])&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fb6a94a3-7686-4bfe-b78b-b5e72897987e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set validatorKeys hash&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #createKeys should set validatorKeys hash&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:146,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[4];\nawait keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(miningKey, accounts[3], accounts[2], {from: accounts[1]});\nnew web3.BigNumber(2).should.be.bignumber.equal(await keysManager.getInitialKeyStatus.call(accounts[1]));&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;30ae78f9-ca67-4e49-b3d9-8c64a284bc70&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;31be3df7-543d-4066-8519-ef6f582062d0&quot;,&quot;1063ac32-d5ff-419a-928d-e48aaaef460c&quot;,&quot;7e6b9143-c2f5-4f51-a19d-a1e7804f2f45&quot;,&quot;146a96ac-67ea-4104-b5ac-15b9b41c6fb7&quot;,&quot;4e8e9f17-6a09-4df2-a012-03c07c2cf645&quot;,&quot;12bb4571-5f47-4e20-937d-d2d0a3a5b7ac&quot;,&quot;ecb56e0a-b87d-4266-899b-7d3464612541&quot;,&quot;e547b065-ec00-46e0-88a5-7d38ba2bed58&quot;,&quot;fb6a94a3-7686-4bfe-b78b-b5e72897987e&quot;,&quot;30ae78f9-ca67-4e49-b3d9-8c64a284bc70&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1927,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;34bd3134-8516-4e70-af85-02402b362a30&quot;,&quot;title&quot;:&quot;#addMiningKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called if KeysManager.init had been called before&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addMiningKey may only be called if KeysManager.init had been called before&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:89,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.setInitEnabled().should.be.fulfilled;\nawait proxyStorageMock.setVotingContractMock(accounts[2]);\nawait addMiningKey(accounts[1], false, {from: accounts[2]});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;79137e8a-058f-44c6-9e83-dd43c424c936&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should only be called from votingToChangeKeys&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addMiningKey should only be called from votingToChangeKeys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:117,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.addMiningKey(accounts[1],{from: accounts[5]}).should.be.rejectedWith(ERROR_MSG);\nawait proxyStorageMock.setVotingContractMock(accounts[2]);\nawait addMiningKey(accounts[1], true, {from: accounts[2]});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;def1f8ea-1899-4d47-8e7b-b54188cb17bb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let add more than maxLimit&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addMiningKey should not let add more than maxLimit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await poaNetworkConsensusMock.setCurrentValidatorsLength(2001);\nawait addMiningKey(accounts[2], false);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;75592399-2158-4b3c-98a6-8ff07a0ac305&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set validatorKeys hash&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addMiningKey should set validatorKeys hash&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:96,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await keysManager.addMiningKey(accounts[2]).should.be.fulfilled;\nconst validator = await keysManager.validatorKeys.call(accounts[2]);\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  false,\n  false]\n)\nlogs[0].event.should.be.equal(&#x27;MiningKeyChanged&#x27;);\nlogs[0].args.key.should.be.equal(accounts[2]);\nlogs[0].args.action.should.be.equal(&#x27;added&#x27;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2121eb57-6ae0-467d-8ff8-bd9e02277b25&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;79137e8a-058f-44c6-9e83-dd43c424c936&quot;,&quot;def1f8ea-1899-4d47-8e7b-b54188cb17bb&quot;,&quot;75592399-2158-4b3c-98a6-8ff07a0ac305&quot;,&quot;2121eb57-6ae0-467d-8ff8-bd9e02277b25&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:359,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;072edeb5-f1f5-40f9-834b-31f241ecba54&quot;,&quot;title&quot;:&quot;#addVotingKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called if KeysManager.init had been called before&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addVotingKey may only be called if KeysManager.init had been called before&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:140,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addMiningKey(accounts[1], true);\nawait keysManager.setInitEnabled().should.be.fulfilled;\nawait addVotingKey(accounts[2], accounts[1], false);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b1a544df-2f52-4b39-8e66-62d22a71949d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;may only be called if params are not the same&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addVotingKey may only be called if params are not the same&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:147,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addMiningKey(accounts[1], true);\nawait addVotingKey(accounts[1], accounts[1], false);\nawait addVotingKey(accounts[2], accounts[1], true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8e3dc18a-0fb4-425b-8c18-079f830d2621&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should add VotingKey&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addVotingKey should add VotingKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:181,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.addVotingKey(accounts[2], accounts[1], {from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);\nawait addMiningKey(accounts[1], true);\nconst {logs} = await keysManager.addVotingKey(accounts[2], accounts[1]).should.be.fulfilled;\ntrue.should.be.equal(await keysManager.isVotingActive.call(accounts[2]));\nlogs[0].event.should.be.equal(&#x27;VotingKeyChanged&#x27;);\nlogs[0].args.key.should.be.equal(accounts[2]);\nlogs[0].args.miningKey.should.be.equal(accounts[1]);\nlogs[0].args.action.should.be.equal(&#x27;added&#x27;);\nconst miningKey = await keysManager.getMiningKeyByVoting.call(accounts[2]);\nminingKey.should.be.equal(accounts[1]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;12103bee-71d0-460a-b351-7444ab156252&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should only be called if mining is active&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addVotingKey should only be called if mining is active&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:322,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addMiningKey(accounts[1], true);\nconst {logs} = await keysManager.removeMiningKey(accounts[1]);\nlogs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nawait addVotingKey(accounts[2], accounts[1], false);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;acc34d41-e9cd-4802-b2fd-b332db45bc45&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;swaps keys if voting already exists&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addVotingKey swaps keys if voting already exists&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:235,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addMiningKey(accounts[1], true);\nawait addVotingKey(accounts[2], accounts[1], true);\nawait addVotingKey(accounts[3], accounts[1], true);\nfalse.should.be.equal(await keysManager.isVotingActive.call(accounts[2]));\ntrue.should.be.equal(await keysManager.isVotingActive.call(accounts[3]));\nconst validator = await keysManager.validatorKeys.call(accounts[1]);\nvalidator.should.be.deep.equal(\n  [ accounts[3],\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  true,\n  false]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fb590c08-67ac-40a5-b517-2e9801068e13&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b1a544df-2f52-4b39-8e66-62d22a71949d&quot;,&quot;8e3dc18a-0fb4-425b-8c18-079f830d2621&quot;,&quot;12103bee-71d0-460a-b351-7444ab156252&quot;,&quot;acc34d41-e9cd-4802-b2fd-b332db45bc45&quot;,&quot;fb590c08-67ac-40a5-b517-2e9801068e13&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1025,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;c4ae46c2-56aa-4b11-9a2e-b23badbc3b0a&quot;,&quot;title&quot;:&quot;#addPayoutKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called if KeysManager.init had been called before&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addPayoutKey may only be called if KeysManager.init had been called before&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:133,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addMiningKey(accounts[1], true);\nawait keysManager.setInitEnabled().should.be.fulfilled;\nawait addPayoutKey(accounts[2], accounts[1], false);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;38a11951-94d1-4660-9a66-ae73809d1c53&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;may only be called if params are not the same&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addPayoutKey may only be called if params are not the same&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:144,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addMiningKey(accounts[1], true);\nawait addPayoutKey(accounts[1], accounts[1], false);\nawait addPayoutKey(accounts[2], accounts[1], true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7dc7a846-5181-477a-82b9-5b70a379bdb6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should add PayoutKey&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addPayoutKey should add PayoutKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:276,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addPayoutKey(accounts[2], accounts[1], false);\nawait addMiningKey(accounts[1], true);\nconst {logs} = await keysManager.addPayoutKey(accounts[2], accounts[1]).should.be.fulfilled;\nlogs[0].event.should.be.equal(&#x27;PayoutKeyChanged&#x27;);\nlogs[0].args.key.should.be.equal(accounts[2]);\nlogs[0].args.miningKey.should.be.equal(accounts[1]);\nlogs[0].args.action.should.be.equal(&#x27;added&#x27;);\n(await keysManager.miningKeyByPayout.call(accounts[2])).should.be.equal(\n  accounts[1]\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ddf98097-63dc-47b6-a41c-9174fcc12250&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should only be called if mining is active&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addPayoutKey should only be called if mining is active&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:234,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addMiningKey(accounts[1], true);\nconst {logs} = await keysManager.removeMiningKey(accounts[1]);\nlogs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nawait addPayoutKey(accounts[2], accounts[1], false);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d2a1b508-80e5-44df-8ad5-b34d1587166a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;swaps keys if voting already exists&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #addPayoutKey swaps keys if voting already exists&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:250,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addMiningKey(accounts[1], true);\nawait addPayoutKey(accounts[2], accounts[1], true);\nawait addPayoutKey(accounts[3], accounts[1], true);\ntrue.should.be.equal(await keysManager.isPayoutActive.call(accounts[1]));\nconst validator = await keysManager.validatorKeys.call(accounts[1]);\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  accounts[3],\n  true,\n  false,\n  true]\n);\n(await keysManager.miningKeyByPayout.call(accounts[3])).should.be.equal(\n  accounts[1]\n);\n(await keysManager.miningKeyByPayout.call(accounts[2])).should.be.equal(\n  &#x27;0x0000000000000000000000000000000000000000&#x27;\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;197ee580-011a-42f1-87da-2f183218779a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;38a11951-94d1-4660-9a66-ae73809d1c53&quot;,&quot;7dc7a846-5181-477a-82b9-5b70a379bdb6&quot;,&quot;ddf98097-63dc-47b6-a41c-9174fcc12250&quot;,&quot;d2a1b508-80e5-44df-8ad5-b34d1587166a&quot;,&quot;197ee580-011a-42f1-87da-2f183218779a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1037,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;bff14d6c-b3a7-4728-a61c-e33696489b68&quot;,&quot;title&quot;:&quot;#removeMiningKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called if KeysManager.init had been called before&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #removeMiningKey may only be called if KeysManager.init had been called before&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:172,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addMiningKey(accounts[1], true);\nawait addVotingKey(accounts[3], accounts[1], true);\nawait keysManager.setInitEnabled().should.be.fulfilled;\nlet result = await keysManager.removeMiningKey(accounts[1]);\nresult.logs.length.should.be.equal(0);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9ee3f296-2198-4179-ada2-790ac42a88ae&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should remove miningKey&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #removeMiningKey should remove miningKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:635,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.removeMiningKey(accounts[1], {from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);\nawait addMiningKey(accounts[1], true);\nawait addVotingKey(accounts[3], accounts[1], true);\nconst validatorData = [\n  \&quot;Djamshut\&quot;, \&quot;Roosvelt\&quot;, \&quot;123asd\&quot;, \&quot;Moskva\&quot;, \&quot;ZZ\&quot;, \&quot;234\&quot;, 23423\n];\nawait validatorMetadata.setTime(55555);\nawait validatorMetadata.createMetadata(...validatorData, {from: accounts[3]}).should.be.fulfilled;\n(await validatorMetadata.validators.call(accounts[1])).should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);\nconst {logs} = await keysManager.removeMiningKey(accounts[1]).should.be.fulfilled;\n(await validatorMetadata.validators.call(accounts[1])).should.be.deep.equal([\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  \&quot;\&quot;,\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);\n\nconst validator = await keysManager.validatorKeys.call(accounts[1]);\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  false,\n  false,\n  false ]\n);\nlogs[0].event.should.be.equal(&#x27;MiningKeyChanged&#x27;);\nlogs[0].args.key.should.be.equal(accounts[1]);\nlogs[0].args.action.should.be.equal(&#x27;removed&#x27;);\nlogs[1].event.should.be.equal(&#x27;VotingKeyChanged&#x27;);\nlogs[1].args.key.should.be.equal(accounts[3]);\nlogs[1].args.miningKey.should.be.equal(accounts[1]);\nlogs[1].args.action.should.be.equal(&#x27;removed&#x27;);\n(await keysManager.getMiningKeyByVoting.call(validator[0])).should.be.equal(\n  &#x27;0x0000000000000000000000000000000000000000&#x27;\n);\n(await keysManager.miningKeyByPayout.call(validator[1])).should.be.equal(\n  &#x27;0x0000000000000000000000000000000000000000&#x27;\n);\nlet result = await keysManager.removeVotingKey(accounts[1]).should.be.fulfilled;\nresult.logs.length.should.be.equal(0);\nresult = await keysManager.removeMiningKey(accounts[1]);\nresult.logs.length.should.be.equal(0);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cfc6e176-1a6c-4a3b-962b-89c04758892f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;removes validator from poaConsensus&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #removeMiningKey removes validator from poaConsensus&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:345,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addMiningKey(accounts[1], true);\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nconst {logs} = await keysManager.removeMiningKey(accounts[1]);\nlogs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nlet currentValidatorsLength = await poaNetworkConsensusMock.getCurrentValidatorsLength.call();\nlet pendingList = [];\nfor(let i = 0; i &lt; currentValidatorsLength.sub(1).toNumber(); i++){\n    let pending = await poaNetworkConsensusMock.pendingList.call(i);\n    pendingList.push(pending);\n}\npendingList.should.not.contain(accounts[1]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nconst validators = await poaNetworkConsensusMock.getValidators.call();\nvalidators.should.not.contain(accounts[1]);\nconst expected = currentValidatorsLength.sub(1);\nconst actual = await poaNetworkConsensusMock.getCurrentValidatorsLength.call();\nexpected.should.be.bignumber.equal(actual);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;42fdf42b-ad0c-4c68-a1ff-88b7dc134e90&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;removes MoC from poaConsensus&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #removeMiningKey removes MoC from poaConsensus&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1079,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000001&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000002&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000003&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000004&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000005&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000006&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000007&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000008&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000009&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000010&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000011&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\n\nlet result = await keysManager.removeMiningKey(masterOfCeremony);\nresult.logs.length.should.be.equal(0);\n(await poaNetworkConsensusMock.isMasterOfCeremonyRemoved.call()).should.be.equal(false);\n(await keysManager.masterOfCeremony.call()).should.be.equal(masterOfCeremony);\n(await poaNetworkConsensusMock.isValidator.call(masterOfCeremony)).should.be.equal(true);\n(await poaNetworkConsensusMock.getCurrentValidatorsLength.call()).should.be.bignumber.equal(1);\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000012&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\n\nresult = await keysManager.removeMiningKey(masterOfCeremony);\nresult.logs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\n(await poaNetworkConsensusMock.isMasterOfCeremonyRemovedPending.call()).should.be.equal(true);\n(await keysManager.masterOfCeremony.call()).should.be.equal(masterOfCeremony);\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\n\n(await poaNetworkConsensusMock.isMasterOfCeremonyRemovedPending.call()).should.be.equal(false);\n(await poaNetworkConsensusMock.isMasterOfCeremonyRemoved.call()).should.be.equal(true);\n(await keysManager.masterOfCeremony.call()).should.be.equal(masterOfCeremony);\n(await poaNetworkConsensusMock.isValidator.call(masterOfCeremony)).should.be.equal(false);\n(await poaNetworkConsensusMock.getCurrentValidatorsLength.call()).should.be.bignumber.equal(0);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0f9378e4-9b06-469e-84b2-02c09c3cac49&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should still enforce removal of votingKey to 0x0 even if voting key did not exist&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #removeMiningKey should still enforce removal of votingKey to 0x0 even if voting key did not exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:306,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let result = await keysManager.removeMiningKey(accounts[1]).should.be.fulfilled;\nresult.logs.length.should.be.equal(0);\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait addMiningKey(accounts[1], true);\nresult = await keysManager.removeMiningKey(accounts[1]).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(&#x27;MiningKeyChanged&#x27;);\nresult.logs[0].args.key.should.be.equal(accounts[1]);\nresult.logs[0].args.action.should.be.equal(&#x27;removed&#x27;);\nconst validator = await keysManager.validatorKeys.call(accounts[1]);\n(await keysManager.getMiningKeyByVoting.call(validator[0])).should.be.equal(\n  &#x27;0x0000000000000000000000000000000000000000&#x27;\n);\n(await keysManager.miningKeyByPayout.call(validator[1])).should.be.equal(\n  &#x27;0x0000000000000000000000000000000000000000&#x27;\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2723b480-20b7-4885-8b48-356ec20435d7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9ee3f296-2198-4179-ada2-790ac42a88ae&quot;,&quot;cfc6e176-1a6c-4a3b-962b-89c04758892f&quot;,&quot;42fdf42b-ad0c-4c68-a1ff-88b7dc134e90&quot;,&quot;0f9378e4-9b06-469e-84b2-02c09c3cac49&quot;,&quot;2723b480-20b7-4885-8b48-356ec20435d7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2537,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;27aaebe2-c61d-4a01-9e87-77171f5adff3&quot;,&quot;title&quot;:&quot;#removeVotingKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called if KeysManager.init had been called before&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #removeVotingKey may only be called if KeysManager.init had been called before&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:226,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {mining, voting, payout} = {mining: accounts[1], voting: accounts[3], payout: accounts[2]};\nawait addMiningKey(mining, true);\nawait addVotingKey(voting, mining, true);\nawait addPayoutKey(payout, mining, true);\nawait keysManager.setInitEnabled().should.be.fulfilled;\nawait removeVotingKey(mining, false);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b9733b0c-fc27-471d-a21e-8ba178b35af8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should be successful only for active voting key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #removeVotingKey should be successful only for active voting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:224,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {mining, voting, payout} = {mining: accounts[1], voting: accounts[3], payout: accounts[2]};\nawait addMiningKey(mining, true);\nawait addPayoutKey(payout, mining, true);\nconst result = await keysManager.removeVotingKey(mining).should.be.fulfilled;\nresult.logs.length.should.be.equal(0);\nawait addVotingKey(voting, mining, true);\nconst {logs} = await keysManager.removeVotingKey(mining).should.be.fulfilled;\nlogs[0].event.should.be.equal(&#x27;VotingKeyChanged&#x27;);\nlogs[0].args.key.should.be.equal(voting);\nlogs[0].args.miningKey.should.be.equal(mining);\nlogs[0].args.action.should.be.equal(&#x27;removed&#x27;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;23f4125b-4164-4a16-bf46-8f63759a37e1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should remove votingKey&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #removeVotingKey should remove votingKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:341,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {mining, voting, payout} = {mining: accounts[1], voting: accounts[3], payout: accounts[2]};\nawait keysManager.removeVotingKey(mining, {from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);\nawait addMiningKey(mining, true);\nawait addVotingKey(voting, mining, true);\nawait addPayoutKey(payout, mining, true);\nconst {logs} = await keysManager.removeVotingKey(mining).should.be.fulfilled;\nconst validator = await keysManager.validatorKeys.call(mining);\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  payout,\n  true,\n  false,\n  true]\n)\nlogs[0].event.should.be.equal(&#x27;VotingKeyChanged&#x27;);\nlogs[0].args.key.should.be.equal(voting);\nlogs[0].args.action.should.be.equal(&#x27;removed&#x27;);\nconst miningKey = await keysManager.getMiningKeyByVoting.call(voting);\nminingKey.should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d4bbbf84-e3ee-41e8-8690-c397730cc783&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b9733b0c-fc27-471d-a21e-8ba178b35af8&quot;,&quot;23f4125b-4164-4a16-bf46-8f63759a37e1&quot;,&quot;d4bbbf84-e3ee-41e8-8690-c397730cc783&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:791,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;f997dfae-6e2a-423c-9e29-af988842b632&quot;,&quot;title&quot;:&quot;#removePayoutKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called if KeysManager.init had been called before&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #removePayoutKey may only be called if KeysManager.init had been called before&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:213,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addMiningKey(accounts[1], true);\nawait addPayoutKey(accounts[2], accounts[1], true);\nawait addVotingKey(accounts[3], accounts[1], true);\nawait keysManager.setInitEnabled().should.be.fulfilled;\nawait removePayoutKey(accounts[1], false);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;264be429-ee80-4693-97ee-8f2915039a25&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should be successful only for active payout key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #removePayoutKey should be successful only for active payout key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:241,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addMiningKey(accounts[1], true);\nawait addVotingKey(accounts[3], accounts[1], true);\nawait removePayoutKey(accounts[1], false);\nawait addPayoutKey(accounts[2], accounts[1], true);\nconst {logs} = await keysManager.removePayoutKey(accounts[1]).should.be.fulfilled;\nlogs[0].event.should.be.equal(&#x27;PayoutKeyChanged&#x27;);\nlogs[0].args.key.should.be.equal(accounts[2]);\nlogs[0].args.miningKey.should.be.equal(accounts[1]);\nlogs[0].args.action.should.be.equal(&#x27;removed&#x27;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;66dc9189-3e6f-4ac2-a618-d1e147b34c5a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should remove payoutKey&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #removePayoutKey should remove payoutKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:273,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.removePayoutKey(accounts[1], {from: accounts[4]}).should.be.rejectedWith(ERROR_MSG);\nawait addMiningKey(accounts[1], true);\nawait addPayoutKey(accounts[2], accounts[1], true);\nawait addVotingKey(accounts[3], accounts[1], true);\nconst {logs} = await keysManager.removePayoutKey(accounts[1]).should.be.fulfilled;\nconst validator = await keysManager.validatorKeys.call(accounts[1]);\nvalidator.should.be.deep.equal(\n  [ accounts[3],\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  true,\n  false]\n)\nlogs[0].event.should.be.equal(&#x27;PayoutKeyChanged&#x27;);\nlogs[0].args.key.should.be.equal(accounts[2]);\nlogs[0].args.action.should.be.equal(&#x27;removed&#x27;);\nconst miningKey = await keysManager.miningKeyByPayout.call(accounts[2]);\nminingKey.should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bd2e0011-df0a-4ab7-b580-d5416fe22e47&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;264be429-ee80-4693-97ee-8f2915039a25&quot;,&quot;66dc9189-3e6f-4ac2-a618-d1e147b34c5a&quot;,&quot;bd2e0011-df0a-4ab7-b580-d5416fe22e47&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:727,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;e30e29eb-9199-45bd-a27e-eaa5daf08ee6&quot;,&quot;title&quot;:&quot;#swapMiningKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should swap mining key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #swapMiningKey should swap mining key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:679,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.swapMiningKey(accounts[1], accounts[2], {from: accounts[4]}).should.be.rejectedWith(ERROR_MSG);\nawait addMiningKey(accounts[1], true);\nawait addVotingKey(accounts[5], accounts[1], true);\nconst validatorData = [\n  \&quot;Djamshut\&quot;, \&quot;Roosvelt\&quot;, \&quot;123asd\&quot;, \&quot;Moskva\&quot;, \&quot;ZZ\&quot;, \&quot;234\&quot;, 23423\n];\nawait validatorMetadata.setTime(55555);\nawait validatorMetadata.createMetadata(...validatorData, {from: accounts[5]}).should.be.fulfilled;\nawait swapMiningKey(accounts[2], accounts[1], true);\nawait swapMiningKey(accounts[4], accounts[3], false);\nconst validator = await keysManager.validatorKeys.call(accounts[1]);\nvalidator.should.be.deep.equal([\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  false,\n  false,\n  false\n]);\nconst validatorNew = await keysManager.validatorKeys.call(accounts[2]);\nvalidatorNew.should.be.deep.equal([\n  accounts[5],\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  true,\n  false\n]);\n(await validatorMetadata.validators.call(accounts[2])).should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);\n(await validatorMetadata.validators.call(accounts[1])).should.be.deep.equal([\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  \&quot;\&quot;,\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;044c1166-0349-4b50-8fe7-fda82f103f55&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should swap MoC&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #swapMiningKey should swap MoC&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:355,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await keysManager.masterOfCeremony.call()).should.be.equal(masterOfCeremony);\n(await poaNetworkConsensusMock.masterOfCeremony.call()).should.be.equal(masterOfCeremony);\nawait swapMiningKey(accounts[1], masterOfCeremony, true);\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\n(await keysManager.masterOfCeremony.call()).should.be.equal(accounts[1]);\n(await poaNetworkConsensusMock.masterOfCeremony.call()).should.be.equal(accounts[1]);\n(await poaNetworkConsensusMock.isValidator.call(masterOfCeremony)).should.be.equal(false);\n(await poaNetworkConsensusMock.isValidator.call(accounts[1])).should.be.equal(true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;43a8aa26-3d86-4578-8123-d0f6b3a5d1a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should keep voting and payout keys&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #swapMiningKey should keep voting and payout keys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:553,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const oldMining = accounts[1];\nconst voting = accounts[2];\nconst payout = accounts[3];\nconst newMining = accounts[4];\nawait addMiningKey(oldMining, true);\nawait addVotingKey(voting, oldMining, true);\nawait addPayoutKey(payout, oldMining, true);\nconst {logs} = await keysManager.swapMiningKey(newMining, oldMining).should.be.fulfilled;\n//const mining = await keysManager.getMiningKeyByVoting.call(voting);\nconst validator = await keysManager.validatorKeys.call(oldMining);\nnewMining.should.be.equal(await keysManager.getMiningKeyByVoting.call(voting));\nnewMining.should.be.equal(await keysManager.miningKeyByPayout.call(payout));\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  false,\n  false,\n  false ]\n)\nconst validatorNew = await keysManager.validatorKeys.call(newMining);\nvalidatorNew.should.be.deep.equal(\n  [ voting,\n  payout,\n  true,\n  true,\n  true]\n)\noldMining.should.be.equal(await keysManager.getMiningKeyHistory.call(newMining));\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nconst validators = await poaNetworkConsensusMock.getValidators.call();\nvalidators.should.not.contain(oldMining);\nvalidators.should.contain(newMining);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6bd87f11-b182-49fc-8ca8-19ccbec9ba4f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;044c1166-0349-4b50-8fe7-fda82f103f55&quot;,&quot;43a8aa26-3d86-4578-8123-d0f6b3a5d1a1&quot;,&quot;6bd87f11-b182-49fc-8ca8-19ccbec9ba4f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1587,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;c66a4733-a24e-43ee-ac1e-219dd47ac76a&quot;,&quot;title&quot;:&quot;#swapVotingKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should swap voting key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #swapVotingKey should swap voting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:215,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.swapVotingKey(accounts[1], accounts[2], {from: accounts[4]}).should.be.rejectedWith(ERROR_MSG);\nawait addMiningKey(accounts[1], true);\nawait addVotingKey(accounts[2], accounts[1], true);\nawait swapVotingKey(accounts[3], accounts[1], true);\nconst validator = await keysManager.validatorKeys.call(accounts[1]);\nvalidator.should.be.deep.equal(\n  [ accounts[3],\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  true,\n  false]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;05fbfeb7-4f64-4eb4-a087-1d6e5a516a0b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;05fbfeb7-4f64-4eb4-a087-1d6e5a516a0b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:215,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;3c693af0-cd48-4d30-b1dc-b43dcfcdf855&quot;,&quot;title&quot;:&quot;#swapPayoutKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should swap payout key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #swapPayoutKey should swap payout key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:244,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.swapPayoutKey(accounts[1], accounts[2], {from: accounts[4]}).should.be.rejectedWith(ERROR_MSG);\nawait addMiningKey(accounts[1], true);\nawait addPayoutKey(accounts[2], accounts[1], true);\nconst {logs} = await keysManager.swapPayoutKey(accounts[3], accounts[1]);\nlogs[0].event.should.be.equal(\&quot;PayoutKeyChanged\&quot;);\nconst validator = await keysManager.validatorKeys.call(accounts[1]);\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  accounts[3],\n  true,\n  false,\n  true]\n);\n(await keysManager.miningKeyByPayout.call(accounts[2])).should.be.equal(\n  &#x27;0x0000000000000000000000000000000000000000&#x27;\n);\n(await keysManager.miningKeyByPayout.call(accounts[3])).should.be.equal(\n  accounts[1]\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;37a6be2c-dcc6-4788-8600-691b9f665869&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;37a6be2c-dcc6-4788-8600-691b9f665869&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:244,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;6dbbb98a-f34d-45c1-a4a5-c7b91539d34d&quot;,&quot;title&quot;:&quot;#migrateInitialKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;can copy initial keys&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #migrateInitialKey can copy initial keys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:472,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[1]);\n\nlet newKeysManager = await KeysManagerMock.new();\nconst newKeysManagerEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, newKeysManager.address);\nnewKeysManager = await KeysManagerMock.at(newKeysManagerEternalStorage.address);\nawait newKeysManager.init(keysManager.address).should.be.fulfilled;\n\nkeysManager.address.should.be.equal(\n  await newKeysManager.previousKeysManager.call()\n);\nlet initialKeys = await newKeysManager.initialKeysCount.call();\ninitialKeys.should.be.bignumber.equal(1);\n\nawait newKeysManager.migrateInitialKey(\n  accounts[1],\n  {from: accounts[9]}\n).should.be.rejectedWith(ERROR_MSG);\nawait newKeysManager.migrateInitialKey(\n  &#x27;0x0000000000000000000000000000000000000000&#x27;\n).should.be.rejectedWith(ERROR_MSG);\nlet {logs} = await newKeysManager.migrateInitialKey(accounts[1]).should.be.fulfilled;\nlogs[0].event.should.equal(\&quot;Migrated\&quot;);\nlogs[0].args.key.should.be.equal(accounts[1]);\nlogs[0].args.name.should.be.equal(\&quot;initialKey\&quot;);\nawait newKeysManager.migrateInitialKey(accounts[1]).should.be.rejectedWith(ERROR_MSG);\nnew web3.BigNumber(1).should.be.bignumber.equal(\n  await newKeysManager.getInitialKeyStatus.call(accounts[1])\n)\nawait newKeysManager.migrateInitialKey(accounts[2]).should.be.rejectedWith(ERROR_MSG);\nnew web3.BigNumber(0).should.be.bignumber.equal(\n  await newKeysManager.getInitialKeyStatus.call(accounts[2])\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;761656de-7a41-45cd-a650-c95b31974493&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;761656de-7a41-45cd-a650-c95b31974493&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:472,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;7e700561-3b3a-430f-aeef-04d2c662b4c7&quot;,&quot;title&quot;:&quot;#migrateMiningKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;copies validator keys&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #migrateMiningKey copies validator keys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1112,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const miningKey = accounts[2];\nconst votingKey = accounts[3];\nconst payoutKey = accounts[4];\nconst miningKey2 = accounts[5];\nconst miningKey3 = accounts[6];\n\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(miningKey2, true);\nawait swapMiningKey(miningKey3, miningKey2, true);\nawait keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(miningKey, votingKey, payoutKey, {from: accounts[1]}).should.be.fulfilled;\n\nconst validatorKeyFromOld = await keysManager.validatorKeys.call(miningKey);\nvalidatorKeyFromOld.should.be.deep.equal([\n  votingKey,\n  payoutKey,\n  true,\n  true,\n  true\n]);\n\nlet newKeysManager = await KeysManagerMock.new();\nconst newKeysManagerEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, newKeysManager.address);\nnewKeysManager = await KeysManagerMock.at(newKeysManagerEternalStorage.address);\nawait newKeysManager.init(keysManager.address).should.be.fulfilled;\n\n// mining #1\nawait newKeysManager.migrateMiningKey(\n  &#x27;0x0000000000000000000000000000000000000000&#x27;\n).should.be.rejectedWith(ERROR_MSG);\nawait newKeysManager.migrateMiningKey(accounts[9]).should.be.rejectedWith(ERROR_MSG);\nlet {logs} = await newKeysManager.migrateMiningKey(miningKey).should.be.fulfilled;\nlogs[0].event.should.equal(\&quot;Migrated\&quot;);\nlogs[0].args.key.should.be.equal(miningKey);\nlogs[0].args.name.should.be.equal(\&quot;miningKey\&quot;);\nawait newKeysManager.migrateMiningKey(miningKey).should.be.rejectedWith(ERROR_MSG);\nlet initialKeys = await newKeysManager.initialKeysCount.call();\ninitialKeys.should.be.bignumber.equal(1);\nconst validatorKey = await newKeysManager.validatorKeys.call(miningKey);\nvalidatorKey.should.be.deep.equal([\n  votingKey,\n  payoutKey,\n  true,\n  true,\n  true\n]);\ntrue.should.be.equal(\n  await newKeysManager.successfulValidatorClone.call(miningKey)\n);\nminingKey.should.be.equal(\n  await newKeysManager.getMiningKeyByVoting.call(votingKey)\n);\nminingKey.should.be.equal(\n  await newKeysManager.miningKeyByPayout.call(payoutKey)\n);\ntrue.should.be.equal(\n  await newKeysManager.isMiningActive.call(miningKey)\n)\ntrue.should.be.equal(\n  await newKeysManager.isVotingActive.call(votingKey)\n)\ntrue.should.be.equal(\n  await newKeysManager.isPayoutActive.call(miningKey)\n)\n// mining #2\nawait newKeysManager.migrateMiningKey(miningKey3).should.be.fulfilled;\nconst validatorKey2 = await newKeysManager.validatorKeys.call(miningKey3);\nvalidatorKey2.should.be.deep.equal([\n  \&quot;0x0000000000000000000000000000000000000000\&quot;,\n  \&quot;0x0000000000000000000000000000000000000000\&quot;,\n  true,\n  false,\n  false\n]);\ntrue.should.be.equal(\n  await newKeysManager.isMiningActive.call(miningKey3)\n);\ntrue.should.be.equal(\n  await newKeysManager.successfulValidatorClone.call(miningKey3)\n);\n(await keysManager.getMiningKeyHistory.call(miningKey3)).should.be.equal(\n  miningKey2\n);\n(await newKeysManager.getMiningKeyHistory.call(miningKey3)).should.be.equal(\n  miningKey2\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ae2edf64-c49d-4840-861e-717f6588da82&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;throws when trying to copy invalid mining key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #migrateMiningKey throws when trying to copy invalid mining key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:228,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let newKeysManager = await KeysManagerMock.new();\nconst newKeysManagerEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, newKeysManager.address);\nnewKeysManager = await KeysManagerMock.at(newKeysManagerEternalStorage.address);\nawait newKeysManager.init(keysManager.address).should.be.fulfilled;\n\ntrue.should.be.equal(\n  await newKeysManager.successfulValidatorClone.call(masterOfCeremony)\n);\nawait newKeysManager.migrateMiningKey(masterOfCeremony).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;60f3db34-74bf-4aa8-baae-e4461e6b7f1d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ae2edf64-c49d-4840-861e-717f6588da82&quot;,&quot;60f3db34-74bf-4aa8-baae-e4461e6b7f1d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1340,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;9874326f-1ed5-4709-897b-8dde15eff105&quot;,&quot;title&quot;:&quot;#upgradeTo&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #upgradeTo \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:182,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;proxyStorageStubAddress = accounts[8];\nkeysManager = await KeysManagerMock.new();\nkeysManagerOldImplementation = keysManager.address;\nkeysManagerEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, keysManager.address);\nkeysManager = await KeysManagerMock.at(keysManagerEternalStorage.address);\nawait keysManager.init(\n  \&quot;0x0000000000000000000000000000000000000000\&quot;\n).should.be.fulfilled;\nawait keysManager.setProxyStorage(proxyStorageStubAddress);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;97e956df-8aaa-4b96-a432-24d80e716ccb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called by ProxyStorage&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #upgradeTo may only be called by ProxyStorage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:90,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let keysManagerNew = await KeysManagerNew.new();\nawait keysManagerEternalStorage.upgradeTo(keysManagerNew.address, {from: accounts[0]}).should.be.rejectedWith(ERROR_MSG);\nawait upgradeTo(keysManagerNew.address, {from: proxyStorageStubAddress});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f52c7194-f1ac-4596-b250-2688528b8a2a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change implementation address&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #upgradeTo should change implementation address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:91,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let keysManagerNew = await KeysManagerNew.new();\nlet newImplementation = keysManagerNew.address;\n(await keysManagerEternalStorage.implementation.call()).should.be.equal(keysManagerOldImplementation);\nawait upgradeTo(newImplementation, {from: proxyStorageStubAddress});\n(await keysManagerEternalStorage.implementation.call()).should.be.equal(newImplementation);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f9d45a4d-878d-4d27-9af1-c74c089286c8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should increment implementation version&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #upgradeTo should increment implementation version&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:91,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let keysManagerNew = await KeysManagerNew.new();\nlet oldVersion = await keysManagerEternalStorage.version.call();\nlet newVersion = oldVersion.add(1);\nawait upgradeTo(keysManagerNew.address, {from: proxyStorageStubAddress});\n(await keysManagerEternalStorage.version.call()).should.be.bignumber.equal(newVersion);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1e076a5e-6b3b-4021-b5dd-cbee40da1a2d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should work&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #upgradeTo new implementation should work&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:123,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let keysManagerNew = await KeysManagerNew.new();\nawait upgradeTo(keysManagerNew.address, {from: proxyStorageStubAddress});\nkeysManagerNew = await KeysManagerNew.at(keysManagerEternalStorage.address);\n(await keysManagerNew.initialized.call()).should.be.equal(false);\nawait keysManagerNew.initialize();\n(await keysManagerNew.initialized.call()).should.be.equal(true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ede88e61-58ac-4d62-8435-feb3a486a2e0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should use the same proxyStorage address&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #upgradeTo new implementation should use the same proxyStorage address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:94,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let keysManagerNew = await KeysManagerNew.new();\nawait upgradeTo(keysManagerNew.address, {from: proxyStorageStubAddress});\nkeysManagerNew = await KeysManagerNew.at(keysManagerEternalStorage.address);\n(await keysManagerNew.proxyStorage.call()).should.be.equal(proxyStorageStubAddress);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e9fcb45a-6547-478e-a17c-88279fd7f6a4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should use the same storage&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager [all features] #upgradeTo new implementation should use the same storage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:312,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let keys = await keysManager.validatorKeys.call(accounts[2]);\nkeys.should.be.deep.equal([\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  false,\n  false,\n  false\n]);\nawait keysManager.setProxyStorage(proxyStorageMock.address);\nawait keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait proxyStorageMock.setKeysManagerMock(keysManager.address);\nawait keysManager.createKeys(accounts[2], accounts[3], accounts[4], {from: accounts[1]}).should.be.fulfilled;\nlet keysManagerNew = await KeysManagerNew.new();\nawait keysManager.setProxyStorage(proxyStorageStubAddress);\nawait upgradeTo(keysManagerNew.address, {from: proxyStorageStubAddress});\nkeysManagerNew = await KeysManagerNew.at(keysManagerEternalStorage.address);\nkeys = await keysManagerNew.validatorKeys.call(accounts[2]);\nkeys.should.be.deep.equal([accounts[3], accounts[4], true, true, true]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4d637597-4eb2-40dc-95de-cb1591eb7e50&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f52c7194-f1ac-4596-b250-2688528b8a2a&quot;,&quot;f9d45a4d-878d-4d27-9af1-c74c089286c8&quot;,&quot;1e076a5e-6b3b-4021-b5dd-cbee40da1a2d&quot;,&quot;ede88e61-58ac-4d62-8435-feb3a486a2e0&quot;,&quot;e9fcb45a-6547-478e-a17c-88279fd7f6a4&quot;,&quot;4d637597-4eb2-40dc-95de-cb1591eb7e50&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:801,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;e16f51de-4835-4644-943f-b4c69b911c9c&quot;,&quot;title&quot;:&quot;Contract: KeysManager upgraded [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2982,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;155a6c18-04cc-4b23-85a3-a0dbf4a8527b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9747e3b1-b3ea-42d8-ada7-2e8fdcde43f4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:704,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;masterOfCeremony = accounts[0];\npoaNetworkConsensusMock = await PoaNetworkConsensusMock.new(masterOfCeremony, []);\n\nproxyStorageMock = await ProxyStorageMock.new();\nconst proxyStorageEternalStorage = await EternalStorageProxy.new(0, proxyStorageMock.address);\nproxyStorageMock = await ProxyStorageMock.at(proxyStorageEternalStorage.address);\nawait proxyStorageMock.init(poaNetworkConsensusMock.address).should.be.fulfilled;\n\nkeysManager = await KeysManagerMock.new();\nkeysManagerEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, keysManager.address);\nkeysManager = await KeysManagerMock.at(keysManagerEternalStorage.address);\nawait keysManager.init(\n  \&quot;0x0000000000000000000000000000000000000000\&quot;,\n  {from: accounts[1]}\n).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.init(\n  \&quot;0x0000000000000000000000000000000000000000\&quot;\n).should.be.fulfilled;\nlet ballotsStorage = await BallotsStorage.new();\nlet ballotsEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, ballotsStorage.address);\nballotsStorage = await BallotsStorage.at(ballotsEternalStorage.address);\nawait ballotsStorage.init([3, 2]).should.be.fulfilled;\nvalidatorMetadata = await ValidatorMetadata.new();\nlet validatorMetadataEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, validatorMetadata.address);\nvalidatorMetadata = ValidatorMetadata.at(validatorMetadataEternalStorage.address);\nlet keysManagerNew = await KeysManagerNew.new();\nawait keysManagerEternalStorage.setProxyStorage(accounts[6]);\nconst {logs} = await keysManagerEternalStorage.upgradeTo(keysManagerNew.address, {from: accounts[6]});\nlogs[0].event.should.be.equal(\&quot;Upgraded\&quot;);\nawait keysManagerEternalStorage.setProxyStorage(proxyStorageMock.address);\nkeysManager = await KeysManagerNew.at(keysManagerEternalStorage.address);\n\nawait poaNetworkConsensusMock.setProxyStorage(proxyStorageMock.address);\nawait proxyStorageMock.initializeAddresses(\n  keysManager.address,\n  accounts[0],\n  accounts[0],\n  accounts[0],\n  accounts[0],\n  ballotsStorage.address,\n  validatorMetadata.address,\n  accounts[0]\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;13907a5e-e973-49a1-9fb5-a5c3d8a518e6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;59c16d5d-c797-4824-aac1-925fc7bf52a8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;285c5686-2669-4405-a428-c0a2cc5e6883&quot;,&quot;title&quot;:&quot;#constructor&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;sets masterOfCeremony, proxyStorage, poaConsensus&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #constructor sets masterOfCeremony, proxyStorage, poaConsensus&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:58,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;masterOfCeremony.should.be.equal(await keysManager.masterOfCeremony.call());\nproxyStorageMock.address.should.be.equal(await keysManager.proxyStorage.call());\npoaNetworkConsensusMock.address.should.be.equal(await keysManager.poaNetworkConsensus.call());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e0c88f0a-9732-4658-9f6d-9bf2f154af2e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;adds masterOfCeremony to validators hash&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #constructor adds masterOfCeremony to validators hash&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:34,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const validator = await keysManager.validatorKeys.call(masterOfCeremony);\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  false,\n  false]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b0702dc8-1b4b-4844-a457-dc184130debb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot be called twice&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #constructor cannot be called twice&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.init(\n  &#x27;0x0000000000000000000000000000000000000000&#x27;\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b0794324-cccb-4b28-a902-1966c3f8204e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e0c88f0a-9732-4658-9f6d-9bf2f154af2e&quot;,&quot;b0702dc8-1b4b-4844-a457-dc184130debb&quot;,&quot;b0794324-cccb-4b28-a902-1966c3f8204e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:108,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;628f3906-0870-4a42-8f44-4d502c945282&quot;,&quot;title&quot;:&quot;#initiateKeys&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;can only be called by master of ceremony&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #initiateKeys can only be called by master of ceremony&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:76,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[2], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.initiateKeys(accounts[2], {from: masterOfCeremony}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;650ffa8e-0084-4b80-8341-a40f1c88114d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot allow 0x0 addresses&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #initiateKeys cannot allow 0x0 addresses&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000000&#x27;).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.initiateKeys(&#x27;0x0&#x27;).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c0fe9cce-a8db-4c2f-a4a5-2e974a94993b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow to initialize already initialized key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #initiateKeys should not allow to initialize already initialized key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:72,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[2], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(accounts[2], {from: masterOfCeremony}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f2117bcb-c2da-420e-9073-ba666597bdd5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow to initialize already initialized key after validator created mining key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #initiateKeys should not allow to initialize already initialized key after validator created mining key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:170,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[2], {from: masterOfCeremony}).should.be.fulfilled;   \nawait keysManager.createKeys(accounts[3],accounts[4],accounts[5], {from: accounts[2]}).should.be.fulfilled;\nawait keysManager.initiateKeys(accounts[2], {from: masterOfCeremony}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;51e3e293-edfd-47f2-a8da-5169a2406462&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not equal to master of ceremony&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #initiateKeys should not equal to master of ceremony&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(masterOfCeremony, {from: masterOfCeremony}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;97b196ea-f52c-4754-880c-32a9aaef1896&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow to initialize more than maxNumberOfInitialKeys&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #initiateKeys should not allow to initialize more than maxNumberOfInitialKeys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:578,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let maxNumberOfInitialKeys = await keysManager.maxNumberOfInitialKeys.call();\nmaxNumberOfInitialKeys.should.be.bignumber.equal(12);\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000001&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000002&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000003&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000004&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000005&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000006&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000007&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000008&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000009&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000010&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000011&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000012&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000013&#x27;, {from: masterOfCeremony}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6b563301-df86-4437-874d-aa450bf7f800&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should increment initialKeyCount by 1&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #initiateKeys should increment initialKeyCount by 1&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:100,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let initialKeysCount = await keysManager.initialKeysCount.call();\ninitialKeysCount.should.be.bignumber.equal(0);\nawait keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\ninitialKeysCount = await keysManager.initialKeysCount.call();\ninitialKeysCount.should.be.bignumber.equal(1);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b9f867c6-e4f5-44e6-a5c8-e24e28ce298e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set initialKeys hash to activated status&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #initiateKeys should set initialKeys hash to activated status&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:91,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;new web3.BigNumber(0).should.be.bignumber.equal(await keysManager.getInitialKeyStatus.call(accounts[1]));\nconst {logs} = await keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nnew web3.BigNumber(1).should.be.bignumber.equal(await keysManager.getInitialKeyStatus.call(accounts[1]));\nlet initialKeysCount = await keysManager.initialKeysCount.call();\n// event InitialKeyCreated(address indexed initialKey, uint256 time, uint256 initialKeysCount);\nlogs[0].event.should.equal(\&quot;InitialKeyCreated\&quot;);\nlogs[0].args.initialKey.should.be.equal(accounts[1]);\ninitialKeysCount.should.be.bignumber.equal(logs[0].args.initialKeysCount);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;67aa8ed6-e1e0-4bc7-b784-961e47e8c859&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;650ffa8e-0084-4b80-8341-a40f1c88114d&quot;,&quot;c0fe9cce-a8db-4c2f-a4a5-2e974a94993b&quot;,&quot;f2117bcb-c2da-420e-9073-ba666597bdd5&quot;,&quot;51e3e293-edfd-47f2-a8da-5169a2406462&quot;,&quot;97b196ea-f52c-4754-880c-32a9aaef1896&quot;,&quot;6b563301-df86-4437-874d-aa450bf7f800&quot;,&quot;b9f867c6-e4f5-44e6-a5c8-e24e28ce298e&quot;,&quot;67aa8ed6-e1e0-4bc7-b784-961e47e8c859&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1179,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;8dd8ac90-82c3-4361-ac38-e83ae387a706&quot;,&quot;title&quot;:&quot;#createKeys&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should only be called from initialized key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #createKeys should only be called from initialized key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:155,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.createKeys(accounts[2], accounts[3], accounts[4], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(accounts[2], accounts[3], accounts[4], {from: accounts[1]}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5620eb21-d0ec-4cf5-8587-06bd5ad5bec4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;params should not be equal to 0x0&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #createKeys params should not be equal to 0x0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:305,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  accounts[3],\n  accounts[4],\n  {from: accounts[1]}\n).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.createKeys(\n  accounts[2],\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  accounts[4],\n  {from: accounts[1]}\n).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.createKeys(\n  accounts[2],\n  accounts[3],\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  {from: accounts[1]}\n).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.createKeys(\n  accounts[2],\n  accounts[3],\n  accounts[4],\n  {from: accounts[1]}\n).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b9c5a0e0-1a0d-4e73-9133-4200547260e4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;params should not be equal to each other&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #createKeys params should not be equal to each other&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:142,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(masterOfCeremony, masterOfCeremony, accounts[2], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.createKeys(masterOfCeremony, accounts[2], accounts[2], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.createKeys(masterOfCeremony, accounts[2], masterOfCeremony, {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;085b4e84-37ae-4eeb-bd0c-89f7ae67f162&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;any of params should not be equal to initialKey&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #createKeys any of params should not be equal to initialKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:147,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(accounts[1], masterOfCeremony, accounts[2], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.createKeys(masterOfCeremony, accounts[1], accounts[2], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.createKeys(masterOfCeremony, accounts[2], accounts[1], {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;03ff1fb9-a09b-4f1e-bd36-e7104835ebe8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow passing the same key after it is already created&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #createKeys should not allow passing the same key after it is already created&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:474,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(accounts[4], accounts[3], accounts[2], {from: accounts[1]}).should.be.fulfilled;\nawait keysManager.initiateKeys(accounts[5], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(accounts[8], accounts[7], accounts[2], {from: accounts[5]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.createKeys(accounts[8], accounts[3], accounts[6], {from: accounts[5]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.createKeys(accounts[4], accounts[7], accounts[6], {from: accounts[5]}).should.be.rejectedWith(ERROR_MSG);\nawait keysManager.createKeys(accounts[8], accounts[7], accounts[6], {from: accounts[5]}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;127fb876-82ae-4fe8-afca-3d8bf3cdd3fa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should assign mining, voting, payout keys to relative mappings&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #createKeys should assign mining, voting, payout keys to relative mappings&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:177,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nconst {logs} = await keysManager.createKeys(accounts[4], accounts[3], accounts[2], {from: accounts[1]}).should.be.fulfilled;\ntrue.should.be.equal(\n  await keysManager.isMiningActive.call(accounts[4])\n)\ntrue.should.be.equal(\n  await keysManager.isVotingActive.call(accounts[3])\n)\ntrue.should.be.equal(\n  await keysManager.isPayoutActive.call(accounts[4])\n)\n// event ValidatorInitialized(address indexed miningKey, address indexed votingKey, address indexed payoutKey);\nlogs[0].event.should.be.equal(&#x27;ValidatorInitialized&#x27;);\nlogs[0].args.miningKey.should.be.equal(accounts[4]);\nlogs[0].args.votingKey.should.be.equal(accounts[3]);\nlogs[0].args.payoutKey.should.be.equal(accounts[2]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;10e39a61-a02f-4893-bffb-26ac66332fbc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should assign voting &lt;-&gt; mining key and payout &lt;-&gt; mining key relationships&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #createKeys should assign voting &lt;-&gt; mining key and payout &lt;-&gt; mining key relationships&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:169,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(accounts[4], accounts[3], accounts[2], {from: accounts[1]});\naccounts[4].should.be.equal(\n  await keysManager.getMiningKeyByVoting.call(accounts[3])\n);\naccounts[4].should.be.equal(\n  await keysManager.miningKeyByPayout.call(accounts[2])\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9a247860-e903-44d9-91da-35bdc64fc2ff&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;adds validator to poaConsensus contract&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #createKeys adds validator to poaConsensus contract&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:160,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[4];\nawait keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(miningKey, accounts[3], accounts[2], {from: accounts[1]});\nconst index = await poaNetworkConsensusMock.getCurrentValidatorsLength.call();\n(await poaNetworkConsensusMock.pendingList.call(index)).should.be.equal(miningKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;24075985-26dd-45e8-8a07-ba68a529ee54&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set validatorKeys hash&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #createKeys should set validatorKeys hash&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:257,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[4];\nawait keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(miningKey, accounts[3], accounts[2], {from: accounts[1]});\nconst validatorKey = await keysManager.validatorKeys.call(miningKey);\nvalidatorKey.should.be.deep.equal([\n  accounts[3],\n  accounts[2],\n  true,\n  true,\n  true\n])&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7b8e0549-2d01-46e2-973a-7c7729f47cf4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set validatorKeys hash&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #createKeys should set validatorKeys hash&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:151,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[4];\nawait keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(miningKey, accounts[3], accounts[2], {from: accounts[1]});\nnew web3.BigNumber(2).should.be.bignumber.equal(await keysManager.getInitialKeyStatus.call(accounts[1]));&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9773051d-5c47-4ccb-89b9-cd118fcc6391&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5620eb21-d0ec-4cf5-8587-06bd5ad5bec4&quot;,&quot;b9c5a0e0-1a0d-4e73-9133-4200547260e4&quot;,&quot;085b4e84-37ae-4eeb-bd0c-89f7ae67f162&quot;,&quot;03ff1fb9-a09b-4f1e-bd36-e7104835ebe8&quot;,&quot;127fb876-82ae-4fe8-afca-3d8bf3cdd3fa&quot;,&quot;10e39a61-a02f-4893-bffb-26ac66332fbc&quot;,&quot;9a247860-e903-44d9-91da-35bdc64fc2ff&quot;,&quot;24075985-26dd-45e8-8a07-ba68a529ee54&quot;,&quot;7b8e0549-2d01-46e2-973a-7c7729f47cf4&quot;,&quot;9773051d-5c47-4ccb-89b9-cd118fcc6391&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2137,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;3b33121a-dd24-477b-9570-5dbaf9793699&quot;,&quot;title&quot;:&quot;#addMiningKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called if KeysManager.init had been called before&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #addMiningKey may only be called if KeysManager.init had been called before&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:81,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.setInitEnabled().should.be.fulfilled;\nawait proxyStorageMock.setVotingContractMock(accounts[2]);\nawait addMiningKey(accounts[1], false, {from: accounts[2]});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4c34e5cd-cb1b-4129-a7f3-de4b7101f531&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should only be called from votingToChangeKeys&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #addMiningKey should only be called from votingToChangeKeys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:131,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.addMiningKey(accounts[1],{from: accounts[5]}).should.be.rejectedWith(ERROR_MSG);\nawait proxyStorageMock.setVotingContractMock(accounts[2]);\nawait addMiningKey(accounts[1], true, {from: accounts[2]});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;80669fc3-3d5e-4d18-94f1-1424b80d56e9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let add more than maxLimit&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #addMiningKey should not let add more than maxLimit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:61,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await poaNetworkConsensusMock.setCurrentValidatorsLength(2001);\nawait addMiningKey(accounts[2], false);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7c918063-cf2e-4802-afab-1f35a7d19dd1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set validatorKeys hash&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #addMiningKey should set validatorKeys hash&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:93,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await keysManager.addMiningKey(accounts[2]).should.be.fulfilled;\nconst validator = await keysManager.validatorKeys.call(accounts[2]);\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  false,\n  false]\n)\nlogs[0].event.should.be.equal(&#x27;MiningKeyChanged&#x27;);\nlogs[0].args.key.should.be.equal(accounts[2]);\nlogs[0].args.action.should.be.equal(&#x27;added&#x27;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;56c9593a-25c1-468d-b05c-8f6f4ef571dd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4c34e5cd-cb1b-4129-a7f3-de4b7101f531&quot;,&quot;80669fc3-3d5e-4d18-94f1-1424b80d56e9&quot;,&quot;7c918063-cf2e-4802-afab-1f35a7d19dd1&quot;,&quot;56c9593a-25c1-468d-b05c-8f6f4ef571dd&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:366,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;e92176ef-eb81-45a0-99ff-d650edbbcb74&quot;,&quot;title&quot;:&quot;#addVotingKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called if KeysManager.init had been called before&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #addVotingKey may only be called if KeysManager.init had been called before&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:132,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addMiningKey(accounts[1], true);\nawait keysManager.setInitEnabled().should.be.fulfilled;\nawait addVotingKey(accounts[2], accounts[1], false);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;370fedb6-9263-45b1-bbd1-8f4336bad6ad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;may only be called if params are not the same&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #addVotingKey may only be called if params are not the same&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:152,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addMiningKey(accounts[1], true);\nawait addVotingKey(accounts[1], accounts[1], false);\nawait addVotingKey(accounts[2], accounts[1], true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a0ab3aa3-dad7-4f44-a06d-691e998bcc8f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should add VotingKey&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #addVotingKey should add VotingKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:166,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.addVotingKey(accounts[2], accounts[1], {from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);\nawait addMiningKey(accounts[1], true);\nconst {logs} = await keysManager.addVotingKey(accounts[2], accounts[1]).should.be.fulfilled;\ntrue.should.be.equal(await keysManager.isVotingActive.call(accounts[2]));\nlogs[0].event.should.be.equal(&#x27;VotingKeyChanged&#x27;);\nlogs[0].args.key.should.be.equal(accounts[2]);\nlogs[0].args.miningKey.should.be.equal(accounts[1]);\nlogs[0].args.action.should.be.equal(&#x27;added&#x27;);\nconst miningKey = await keysManager.getMiningKeyByVoting.call(accounts[2]);\nminingKey.should.be.equal(accounts[1]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5fb09730-f45b-4dc6-bcda-35853b801bb0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should only be called if mining is active&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #addVotingKey should only be called if mining is active&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:231,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addMiningKey(accounts[1], true);\nconst {logs} = await keysManager.removeMiningKey(accounts[1]);\nlogs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nawait addVotingKey(accounts[2], accounts[1], false);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7ebb3e24-3b3a-4eef-8241-ecbe7a1d7ba0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;swaps keys if voting already exists&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #addVotingKey swaps keys if voting already exists&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:233,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addMiningKey(accounts[1], true);\nawait addVotingKey(accounts[2], accounts[1], true);\nawait addVotingKey(accounts[3], accounts[1], true);\nfalse.should.be.equal(await keysManager.isVotingActive.call(accounts[2]));\ntrue.should.be.equal(await keysManager.isVotingActive.call(accounts[3]));\nconst validator = await keysManager.validatorKeys.call(accounts[1]);\nvalidator.should.be.deep.equal(\n  [ accounts[3],\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  true,\n  false]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;82e51ae6-1db3-47a2-84c7-0c7bb74a4eda&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;370fedb6-9263-45b1-bbd1-8f4336bad6ad&quot;,&quot;a0ab3aa3-dad7-4f44-a06d-691e998bcc8f&quot;,&quot;5fb09730-f45b-4dc6-bcda-35853b801bb0&quot;,&quot;7ebb3e24-3b3a-4eef-8241-ecbe7a1d7ba0&quot;,&quot;82e51ae6-1db3-47a2-84c7-0c7bb74a4eda&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:914,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;795e6677-9d47-44d2-8bd3-42ee5144c7cf&quot;,&quot;title&quot;:&quot;#addPayoutKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called if KeysManager.init had been called before&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #addPayoutKey may only be called if KeysManager.init had been called before&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:120,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addMiningKey(accounts[1], true);\nawait keysManager.setInitEnabled().should.be.fulfilled;\nawait addPayoutKey(accounts[2], accounts[1], false);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fec655d0-999e-44e2-bb69-a244ebfab6d6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;may only be called if params are not the same&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #addPayoutKey may only be called if params are not the same&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:150,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addMiningKey(accounts[1], true);\nawait addPayoutKey(accounts[1], accounts[1], false);\nawait addPayoutKey(accounts[2], accounts[1], true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d2ee4547-a6c9-45da-8d31-4e4b47aef384&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should add PayoutKey&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #addPayoutKey should add PayoutKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:158,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addPayoutKey(accounts[2], accounts[1], false);\nawait addMiningKey(accounts[1], true);\nconst {logs} = await keysManager.addPayoutKey(accounts[2], accounts[1]).should.be.fulfilled;\nlogs[0].event.should.be.equal(&#x27;PayoutKeyChanged&#x27;);\nlogs[0].args.key.should.be.equal(accounts[2]);\nlogs[0].args.miningKey.should.be.equal(accounts[1]);\nlogs[0].args.action.should.be.equal(&#x27;added&#x27;);\n(await keysManager.miningKeyByPayout.call(accounts[2])).should.be.equal(\n  accounts[1]\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a3bc6e36-bcd7-48e6-8fd4-57a2e6fd5a7f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should only be called if mining is active&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #addPayoutKey should only be called if mining is active&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:240,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addMiningKey(accounts[1], true);\nconst {logs} = await keysManager.removeMiningKey(accounts[1]);\nlogs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nawait addPayoutKey(accounts[2], accounts[1], false);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;82197bde-3fe1-4c83-bac3-1af7ce380cbf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;swaps keys if voting already exists&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #addPayoutKey swaps keys if voting already exists&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:236,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addMiningKey(accounts[1], true);\nawait addPayoutKey(accounts[2], accounts[1], true);\nawait addPayoutKey(accounts[3], accounts[1], true);\ntrue.should.be.equal(await keysManager.isPayoutActive.call(accounts[1]));\nconst validator = await keysManager.validatorKeys.call(accounts[1]);\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  accounts[3],\n  true,\n  false,\n  true]\n);\n(await keysManager.miningKeyByPayout.call(accounts[3])).should.be.equal(\n  accounts[1]\n);\n(await keysManager.miningKeyByPayout.call(accounts[2])).should.be.equal(\n  &#x27;0x0000000000000000000000000000000000000000&#x27;\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8ab9cdac-a33a-41ad-afaa-820ca9a6d583&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;fec655d0-999e-44e2-bb69-a244ebfab6d6&quot;,&quot;d2ee4547-a6c9-45da-8d31-4e4b47aef384&quot;,&quot;a3bc6e36-bcd7-48e6-8fd4-57a2e6fd5a7f&quot;,&quot;82197bde-3fe1-4c83-bac3-1af7ce380cbf&quot;,&quot;8ab9cdac-a33a-41ad-afaa-820ca9a6d583&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:904,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;fc6e7c97-91dc-48a2-a406-4b666cd0290b&quot;,&quot;title&quot;:&quot;#removeMiningKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called if KeysManager.init had been called before&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #removeMiningKey may only be called if KeysManager.init had been called before&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:165,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addMiningKey(accounts[1], true);\nawait addVotingKey(accounts[3], accounts[1], true);\nawait keysManager.setInitEnabled().should.be.fulfilled;\nlet result = await keysManager.removeMiningKey(accounts[1]);\nresult.logs.length.should.be.equal(0);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;17ffc518-6986-4e26-9ea5-545a5b8d5dbd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should remove miningKey&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #removeMiningKey should remove miningKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:663,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.removeMiningKey(accounts[1], {from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);\nawait addMiningKey(accounts[1], true);\nawait addVotingKey(accounts[3], accounts[1], true);\nconst validatorData = [\n  \&quot;Djamshut\&quot;, \&quot;Roosvelt\&quot;, \&quot;123asd\&quot;, \&quot;Moskva\&quot;, \&quot;ZZ\&quot;, \&quot;234\&quot;, 23423\n];\nawait validatorMetadata.setTime(55555);\nawait validatorMetadata.createMetadata(...validatorData, {from: accounts[3]}).should.be.fulfilled;\n(await validatorMetadata.validators.call(accounts[1])).should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);\nconst {logs} = await keysManager.removeMiningKey(accounts[1]).should.be.fulfilled;\n(await validatorMetadata.validators.call(accounts[1])).should.be.deep.equal([\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  \&quot;\&quot;,\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);\n\nconst validator = await keysManager.validatorKeys.call(accounts[1]);\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  false,\n  false,\n  false ]\n);\nlogs[0].event.should.be.equal(&#x27;MiningKeyChanged&#x27;);\nlogs[0].args.key.should.be.equal(accounts[1]);\nlogs[0].args.action.should.be.equal(&#x27;removed&#x27;);\nlogs[1].event.should.be.equal(&#x27;VotingKeyChanged&#x27;);\nlogs[1].args.key.should.be.equal(accounts[3]);\nlogs[1].args.miningKey.should.be.equal(accounts[1]);\nlogs[1].args.action.should.be.equal(&#x27;removed&#x27;);\n(await keysManager.getMiningKeyByVoting.call(validator[0])).should.be.equal(\n  &#x27;0x0000000000000000000000000000000000000000&#x27;\n);\n(await keysManager.miningKeyByPayout.call(validator[1])).should.be.equal(\n  &#x27;0x0000000000000000000000000000000000000000&#x27;\n);\nlet result = await keysManager.removeVotingKey(accounts[1]).should.be.fulfilled;\nresult.logs.length.should.be.equal(0);\nresult = await keysManager.removeMiningKey(accounts[1]);\nresult.logs.length.should.be.equal(0);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6f3b1379-1615-45be-a8a1-85bbaa3a1c1b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;removes validator from poaConsensus&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #removeMiningKey removes validator from poaConsensus&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:332,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addMiningKey(accounts[1], true);\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nconst {logs} = await keysManager.removeMiningKey(accounts[1]);\nlogs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nlet currentValidatorsLength = await poaNetworkConsensusMock.getCurrentValidatorsLength.call();\nlet pendingList = [];\nfor(let i = 0; i &lt; currentValidatorsLength.sub(1).toNumber(); i++){\n    let pending = await poaNetworkConsensusMock.pendingList.call(i);\n    pendingList.push(pending);\n}\npendingList.should.not.contain(accounts[1]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nconst validators = await poaNetworkConsensusMock.getValidators.call();\nvalidators.should.not.contain(accounts[1]);\nconst expected = currentValidatorsLength.sub(1);\nconst actual = await poaNetworkConsensusMock.getCurrentValidatorsLength.call();\nexpected.should.be.bignumber.equal(actual);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4c61dec0-7d49-4d50-a10a-d9645a7bde48&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;removes MoC from poaConsensus&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #removeMiningKey removes MoC from poaConsensus&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1028,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000001&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000002&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000003&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000004&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000005&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000006&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000007&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000008&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000009&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000010&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000011&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\n\nlet result = await keysManager.removeMiningKey(masterOfCeremony);\nresult.logs.length.should.be.equal(0);\n(await poaNetworkConsensusMock.isMasterOfCeremonyRemoved.call()).should.be.equal(false);\n(await keysManager.masterOfCeremony.call()).should.be.equal(masterOfCeremony);\n(await poaNetworkConsensusMock.isValidator.call(masterOfCeremony)).should.be.equal(true);\n(await poaNetworkConsensusMock.getCurrentValidatorsLength.call()).should.be.bignumber.equal(1);\nawait keysManager.initiateKeys(&#x27;0x0000000000000000000000000000000000000012&#x27;, {from: masterOfCeremony}).should.be.fulfilled;\n\nresult = await keysManager.removeMiningKey(masterOfCeremony);\nresult.logs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\n(await poaNetworkConsensusMock.isMasterOfCeremonyRemovedPending.call()).should.be.equal(true);\n(await keysManager.masterOfCeremony.call()).should.be.equal(masterOfCeremony);\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\n\n(await poaNetworkConsensusMock.isMasterOfCeremonyRemovedPending.call()).should.be.equal(false);\n(await poaNetworkConsensusMock.isMasterOfCeremonyRemoved.call()).should.be.equal(true);\n(await keysManager.masterOfCeremony.call()).should.be.equal(masterOfCeremony);\n(await poaNetworkConsensusMock.isValidator.call(masterOfCeremony)).should.be.equal(false);\n(await poaNetworkConsensusMock.getCurrentValidatorsLength.call()).should.be.bignumber.equal(0);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;13288052-e9e2-44cd-8630-c6e688e0892e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should still enforce removal of votingKey to 0x0 even if voting key did not exist&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #removeMiningKey should still enforce removal of votingKey to 0x0 even if voting key did not exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:321,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let result = await keysManager.removeMiningKey(accounts[1]).should.be.fulfilled;\nresult.logs.length.should.be.equal(0);\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait addMiningKey(accounts[1], true);\nresult = await keysManager.removeMiningKey(accounts[1]).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(&#x27;MiningKeyChanged&#x27;);\nresult.logs[0].args.key.should.be.equal(accounts[1]);\nresult.logs[0].args.action.should.be.equal(&#x27;removed&#x27;);\nconst validator = await keysManager.validatorKeys.call(accounts[1]);\n(await keysManager.getMiningKeyByVoting.call(validator[0])).should.be.equal(\n  &#x27;0x0000000000000000000000000000000000000000&#x27;\n);\n(await keysManager.miningKeyByPayout.call(validator[1])).should.be.equal(\n  &#x27;0x0000000000000000000000000000000000000000&#x27;\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;85c31bcd-94a4-4970-9e12-5bed111f9f68&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;17ffc518-6986-4e26-9ea5-545a5b8d5dbd&quot;,&quot;6f3b1379-1615-45be-a8a1-85bbaa3a1c1b&quot;,&quot;4c61dec0-7d49-4d50-a10a-d9645a7bde48&quot;,&quot;13288052-e9e2-44cd-8630-c6e688e0892e&quot;,&quot;85c31bcd-94a4-4970-9e12-5bed111f9f68&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2509,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;8581943e-336d-4f74-9123-e2522761feac&quot;,&quot;title&quot;:&quot;#removeVotingKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called if KeysManager.init had been called before&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #removeVotingKey may only be called if KeysManager.init had been called before&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:217,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {mining, voting, payout} = {mining: accounts[1], voting: accounts[3], payout: accounts[2]};\nawait addMiningKey(mining, true);\nawait addVotingKey(voting, mining, true);\nawait addPayoutKey(payout, mining, true);\nawait keysManager.setInitEnabled().should.be.fulfilled;\nawait removeVotingKey(mining, false);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5051c924-0441-43fc-a655-81178de421ca&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should be successful only for active voting key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #removeVotingKey should be successful only for active voting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:325,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {mining, voting, payout} = {mining: accounts[1], voting: accounts[3], payout: accounts[2]};\nawait addMiningKey(mining, true);\nawait addPayoutKey(payout, mining, true);\nconst result = await keysManager.removeVotingKey(mining).should.be.fulfilled;\nresult.logs.length.should.be.equal(0);\nawait addVotingKey(voting, mining, true);\nconst {logs} = await keysManager.removeVotingKey(mining).should.be.fulfilled;\nlogs[0].event.should.be.equal(&#x27;VotingKeyChanged&#x27;);\nlogs[0].args.key.should.be.equal(voting);\nlogs[0].args.miningKey.should.be.equal(mining);\nlogs[0].args.action.should.be.equal(&#x27;removed&#x27;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;365a4354-fcdc-434f-aa1a-87d6db3596ee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should remove votingKey&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #removeVotingKey should remove votingKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:259,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {mining, voting, payout} = {mining: accounts[1], voting: accounts[3], payout: accounts[2]};\nawait keysManager.removeVotingKey(mining, {from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);\nawait addMiningKey(mining, true);\nawait addVotingKey(voting, mining, true);\nawait addPayoutKey(payout, mining, true);\nconst {logs} = await keysManager.removeVotingKey(mining).should.be.fulfilled;\nconst validator = await keysManager.validatorKeys.call(mining);\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  payout,\n  true,\n  false,\n  true]\n)\nlogs[0].event.should.be.equal(&#x27;VotingKeyChanged&#x27;);\nlogs[0].args.key.should.be.equal(voting);\nlogs[0].args.action.should.be.equal(&#x27;removed&#x27;);\nconst miningKey = await keysManager.getMiningKeyByVoting.call(voting);\nminingKey.should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;30db5c62-ebb4-45ef-916b-db100fb20977&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5051c924-0441-43fc-a655-81178de421ca&quot;,&quot;365a4354-fcdc-434f-aa1a-87d6db3596ee&quot;,&quot;30db5c62-ebb4-45ef-916b-db100fb20977&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:801,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;6a0a9c12-7046-409e-a668-491da1000a07&quot;,&quot;title&quot;:&quot;#removePayoutKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called if KeysManager.init had been called before&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #removePayoutKey may only be called if KeysManager.init had been called before&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:222,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addMiningKey(accounts[1], true);\nawait addPayoutKey(accounts[2], accounts[1], true);\nawait addVotingKey(accounts[3], accounts[1], true);\nawait keysManager.setInitEnabled().should.be.fulfilled;\nawait removePayoutKey(accounts[1], false);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4764040a-80e0-40da-aea1-e1d386d46dee&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should be successful only for active payout key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #removePayoutKey should be successful only for active payout key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:331,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addMiningKey(accounts[1], true);\nawait addVotingKey(accounts[3], accounts[1], true);\nawait removePayoutKey(accounts[1], false);\nawait addPayoutKey(accounts[2], accounts[1], true);\nconst {logs} = await keysManager.removePayoutKey(accounts[1]).should.be.fulfilled;\nlogs[0].event.should.be.equal(&#x27;PayoutKeyChanged&#x27;);\nlogs[0].args.key.should.be.equal(accounts[2]);\nlogs[0].args.miningKey.should.be.equal(accounts[1]);\nlogs[0].args.action.should.be.equal(&#x27;removed&#x27;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7998a8d4-01eb-434c-8113-58fc6dff4355&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should remove payoutKey&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #removePayoutKey should remove payoutKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:302,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.removePayoutKey(accounts[1], {from: accounts[4]}).should.be.rejectedWith(ERROR_MSG);\nawait addMiningKey(accounts[1], true);\nawait addPayoutKey(accounts[2], accounts[1], true);\nawait addVotingKey(accounts[3], accounts[1], true);\nconst {logs} = await keysManager.removePayoutKey(accounts[1]).should.be.fulfilled;\nconst validator = await keysManager.validatorKeys.call(accounts[1]);\nvalidator.should.be.deep.equal(\n  [ accounts[3],\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  true,\n  false]\n)\nlogs[0].event.should.be.equal(&#x27;PayoutKeyChanged&#x27;);\nlogs[0].args.key.should.be.equal(accounts[2]);\nlogs[0].args.action.should.be.equal(&#x27;removed&#x27;);\nconst miningKey = await keysManager.miningKeyByPayout.call(accounts[2]);\nminingKey.should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;64fd4ec8-7217-49d0-9e8e-8ece92f3f1b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4764040a-80e0-40da-aea1-e1d386d46dee&quot;,&quot;7998a8d4-01eb-434c-8113-58fc6dff4355&quot;,&quot;64fd4ec8-7217-49d0-9e8e-8ece92f3f1b8&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:855,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;0538fdd6-4770-409f-87a1-4a4cd69bb720&quot;,&quot;title&quot;:&quot;#swapMiningKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should swap mining key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #swapMiningKey should swap mining key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:727,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.swapMiningKey(accounts[1], accounts[2], {from: accounts[4]}).should.be.rejectedWith(ERROR_MSG);\nawait addMiningKey(accounts[1], true);\nawait addVotingKey(accounts[5], accounts[1], true);\nconst validatorData = [\n  \&quot;Djamshut\&quot;, \&quot;Roosvelt\&quot;, \&quot;123asd\&quot;, \&quot;Moskva\&quot;, \&quot;ZZ\&quot;, \&quot;234\&quot;, 23423\n];\nawait validatorMetadata.setTime(55555);\nawait validatorMetadata.createMetadata(...validatorData, {from: accounts[5]}).should.be.fulfilled;\nawait swapMiningKey(accounts[2], accounts[1], true);\nawait swapMiningKey(accounts[4], accounts[3], false);\nconst validator = await keysManager.validatorKeys.call(accounts[1]);\nvalidator.should.be.deep.equal([\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  false,\n  false,\n  false\n]);\nconst validatorNew = await keysManager.validatorKeys.call(accounts[2]);\nvalidatorNew.should.be.deep.equal([\n  accounts[5],\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  true,\n  false\n]);\n(await validatorMetadata.validators.call(accounts[2])).should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);\n(await validatorMetadata.validators.call(accounts[1])).should.be.deep.equal([\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  \&quot;\&quot;,\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3bcb3b9c-42b7-49dc-a675-d09da98dcad0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should swap MoC&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #swapMiningKey should swap MoC&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:355,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await keysManager.masterOfCeremony.call()).should.be.equal(masterOfCeremony);\n(await poaNetworkConsensusMock.masterOfCeremony.call()).should.be.equal(masterOfCeremony);\nawait swapMiningKey(accounts[1], masterOfCeremony, true);\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\n(await keysManager.masterOfCeremony.call()).should.be.equal(accounts[1]);\n(await poaNetworkConsensusMock.masterOfCeremony.call()).should.be.equal(accounts[1]);\n(await poaNetworkConsensusMock.isValidator.call(masterOfCeremony)).should.be.equal(false);\n(await poaNetworkConsensusMock.isValidator.call(accounts[1])).should.be.equal(true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c903cabb-abc9-4a3c-87dd-b9eaddf3e50e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should keep voting and payout keys&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #swapMiningKey should keep voting and payout keys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:655,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const oldMining = accounts[1];\nconst voting = accounts[2];\nconst payout = accounts[3];\nconst newMining = accounts[4];\nawait addMiningKey(oldMining, true);\nawait addVotingKey(voting, oldMining, true);\nawait addPayoutKey(payout, oldMining, true);\nconst {logs} = await keysManager.swapMiningKey(newMining, oldMining).should.be.fulfilled;\n//const mining = await keysManager.getMiningKeyByVoting.call(voting);\nconst validator = await keysManager.validatorKeys.call(oldMining);\nnewMining.should.be.equal(await keysManager.getMiningKeyByVoting.call(voting));\nnewMining.should.be.equal(await keysManager.miningKeyByPayout.call(payout));\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  false,\n  false,\n  false ]\n)\nconst validatorNew = await keysManager.validatorKeys.call(newMining);\nvalidatorNew.should.be.deep.equal(\n  [ voting,\n  payout,\n  true,\n  true,\n  true]\n)\noldMining.should.be.equal(await keysManager.getMiningKeyHistory.call(newMining));\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nconst validators = await poaNetworkConsensusMock.getValidators.call();\nvalidators.should.not.contain(oldMining);\nvalidators.should.contain(newMining);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;906f5df7-017b-4896-b7aa-0dcb91bb3f5a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3bcb3b9c-42b7-49dc-a675-d09da98dcad0&quot;,&quot;c903cabb-abc9-4a3c-87dd-b9eaddf3e50e&quot;,&quot;906f5df7-017b-4896-b7aa-0dcb91bb3f5a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1737,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;17eb0234-6948-456d-aec9-5c0a9c35ea81&quot;,&quot;title&quot;:&quot;#swapVotingKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should swap voting key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #swapVotingKey should swap voting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:278,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.swapVotingKey(accounts[1], accounts[2], {from: accounts[4]}).should.be.rejectedWith(ERROR_MSG);\nawait addMiningKey(accounts[1], true);\nawait addVotingKey(accounts[2], accounts[1], true);\nawait swapVotingKey(accounts[3], accounts[1], true);\nconst validator = await keysManager.validatorKeys.call(accounts[1]);\nvalidator.should.be.deep.equal(\n  [ accounts[3],\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  true,\n  false]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b4a97d0d-2432-4589-8177-2d4e7f9ed5f5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b4a97d0d-2432-4589-8177-2d4e7f9ed5f5&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:278,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;ec4f9d70-6025-4a0e-95f7-f4612200ae41&quot;,&quot;title&quot;:&quot;#swapPayoutKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should swap payout key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #swapPayoutKey should swap payout key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:247,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.swapPayoutKey(accounts[1], accounts[2], {from: accounts[4]}).should.be.rejectedWith(ERROR_MSG);\nawait addMiningKey(accounts[1], true);\nawait addPayoutKey(accounts[2], accounts[1], true);\nconst {logs} = await keysManager.swapPayoutKey(accounts[3], accounts[1]);\nlogs[0].event.should.be.equal(\&quot;PayoutKeyChanged\&quot;);\nconst validator = await keysManager.validatorKeys.call(accounts[1]);\nvalidator.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  accounts[3],\n  true,\n  false,\n  true]\n);\n(await keysManager.miningKeyByPayout.call(accounts[2])).should.be.equal(\n  &#x27;0x0000000000000000000000000000000000000000&#x27;\n);\n(await keysManager.miningKeyByPayout.call(accounts[3])).should.be.equal(\n  accounts[1]\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9939edb4-2ce7-4349-9862-cbdc690b54a9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9939edb4-2ce7-4349-9862-cbdc690b54a9&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:247,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;a22916c1-1077-419e-9602-1aaab93e76fa&quot;,&quot;title&quot;:&quot;#migrateInitialKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;can copy initial keys&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #migrateInitialKey can copy initial keys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:403,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await keysManager.initiateKeys(accounts[1]);\n\nlet newKeysManager = await KeysManagerMock.new();\nconst newKeysManagerEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, newKeysManager.address);\nnewKeysManager = await KeysManagerMock.at(newKeysManagerEternalStorage.address);\nawait newKeysManager.init(keysManager.address).should.be.fulfilled;\n\nkeysManager.address.should.be.equal(\n  await newKeysManager.previousKeysManager.call()\n);\nlet initialKeys = await newKeysManager.initialKeysCount.call();\ninitialKeys.should.be.bignumber.equal(1);\n\nawait newKeysManager.migrateInitialKey(\n  accounts[1],\n  {from: accounts[9]}\n).should.be.rejectedWith(ERROR_MSG);\nawait newKeysManager.migrateInitialKey(\n  &#x27;0x0000000000000000000000000000000000000000&#x27;\n).should.be.rejectedWith(ERROR_MSG);\nlet {logs} = await newKeysManager.migrateInitialKey(accounts[1]).should.be.fulfilled;\nlogs[0].event.should.equal(\&quot;Migrated\&quot;);\nlogs[0].args.key.should.be.equal(accounts[1]);\nlogs[0].args.name.should.be.equal(\&quot;initialKey\&quot;);\nawait newKeysManager.migrateInitialKey(accounts[1]).should.be.rejectedWith(ERROR_MSG);\nnew web3.BigNumber(1).should.be.bignumber.equal(\n  await newKeysManager.getInitialKeyStatus.call(accounts[1])\n)\nawait newKeysManager.migrateInitialKey(accounts[2]).should.be.rejectedWith(ERROR_MSG);\nnew web3.BigNumber(0).should.be.bignumber.equal(\n  await newKeysManager.getInitialKeyStatus.call(accounts[2])\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fc4b4f6c-9c00-4941-9e37-86fb8f8d6325&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;fc4b4f6c-9c00-4941-9e37-86fb8f8d6325&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:403,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;c013e8b0-9280-4a94-98cb-66707664af06&quot;,&quot;title&quot;:&quot;#migrateMiningKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/keys_manager_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/keys_manager_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;copies validator keys&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #migrateMiningKey copies validator keys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1078,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const miningKey = accounts[2];\nconst votingKey = accounts[3];\nconst payoutKey = accounts[4];\nconst miningKey2 = accounts[5];\nconst miningKey3 = accounts[6];\n\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(miningKey2, true);\nawait swapMiningKey(miningKey3, miningKey2, true);\nawait keysManager.initiateKeys(accounts[1], {from: masterOfCeremony}).should.be.fulfilled;\nawait keysManager.createKeys(miningKey, votingKey, payoutKey, {from: accounts[1]}).should.be.fulfilled;\n\nconst validatorKeyFromOld = await keysManager.validatorKeys.call(miningKey);\nvalidatorKeyFromOld.should.be.deep.equal([\n  votingKey,\n  payoutKey,\n  true,\n  true,\n  true\n]);\n\nlet newKeysManager = await KeysManagerMock.new();\nconst newKeysManagerEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, newKeysManager.address);\nnewKeysManager = await KeysManagerMock.at(newKeysManagerEternalStorage.address);\nawait newKeysManager.init(keysManager.address).should.be.fulfilled;\n\n// mining #1\nawait newKeysManager.migrateMiningKey(\n  &#x27;0x0000000000000000000000000000000000000000&#x27;\n).should.be.rejectedWith(ERROR_MSG);\nawait newKeysManager.migrateMiningKey(accounts[9]).should.be.rejectedWith(ERROR_MSG);\nlet {logs} = await newKeysManager.migrateMiningKey(miningKey).should.be.fulfilled;\nlogs[0].event.should.equal(\&quot;Migrated\&quot;);\nlogs[0].args.key.should.be.equal(miningKey);\nlogs[0].args.name.should.be.equal(\&quot;miningKey\&quot;);\nawait newKeysManager.migrateMiningKey(miningKey).should.be.rejectedWith(ERROR_MSG);\nlet initialKeys = await newKeysManager.initialKeysCount.call();\ninitialKeys.should.be.bignumber.equal(1);\nconst validatorKey = await newKeysManager.validatorKeys.call(miningKey);\nvalidatorKey.should.be.deep.equal([\n  votingKey,\n  payoutKey,\n  true,\n  true,\n  true\n]);\ntrue.should.be.equal(\n  await newKeysManager.successfulValidatorClone.call(miningKey)\n);\nminingKey.should.be.equal(\n  await newKeysManager.getMiningKeyByVoting.call(votingKey)\n);\nminingKey.should.be.equal(\n  await newKeysManager.miningKeyByPayout.call(payoutKey)\n);\ntrue.should.be.equal(\n  await newKeysManager.isMiningActive.call(miningKey)\n)\ntrue.should.be.equal(\n  await newKeysManager.isVotingActive.call(votingKey)\n)\ntrue.should.be.equal(\n  await newKeysManager.isPayoutActive.call(miningKey)\n)\n// mining #2\nawait newKeysManager.migrateMiningKey(miningKey3).should.be.fulfilled;\nconst validatorKey2 = await newKeysManager.validatorKeys.call(miningKey3);\nvalidatorKey2.should.be.deep.equal([\n  \&quot;0x0000000000000000000000000000000000000000\&quot;,\n  \&quot;0x0000000000000000000000000000000000000000\&quot;,\n  true,\n  false,\n  false\n]);\ntrue.should.be.equal(\n  await newKeysManager.isMiningActive.call(miningKey3)\n);\ntrue.should.be.equal(\n  await newKeysManager.successfulValidatorClone.call(miningKey3)\n);\n(await keysManager.getMiningKeyHistory.call(miningKey3)).should.be.equal(\n  miningKey2\n);\n(await newKeysManager.getMiningKeyHistory.call(miningKey3)).should.be.equal(\n  miningKey2\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6b1f95f9-c5e1-45ea-baa4-0297b1084d33&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;throws when trying to copy invalid mining key&quot;,&quot;fullTitle&quot;:&quot;Contract: KeysManager upgraded [all features] #migrateMiningKey throws when trying to copy invalid mining key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:254,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let newKeysManager = await KeysManagerMock.new();\nconst newKeysManagerEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, newKeysManager.address);\nnewKeysManager = await KeysManagerMock.at(newKeysManagerEternalStorage.address);\nawait newKeysManager.init(keysManager.address).should.be.fulfilled;\n\ntrue.should.be.equal(\n  await newKeysManager.successfulValidatorClone.call(masterOfCeremony)\n);\nawait newKeysManager.migrateMiningKey(masterOfCeremony).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b2d02c0e-cc64-4ab2-91af-a8207af8e914&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6b1f95f9-c5e1-45ea-baa4-0297b1084d33&quot;,&quot;b2d02c0e-cc64-4ab2-91af-a8207af8e914&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1332,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;e0f0dbbc-69ea-456d-ba52-951ad920d5a7&quot;,&quot;title&quot;:&quot;Contract: ValidatorMetadata [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3973,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0613577d-0ff6-47f7-aff8-89f8c306b645&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c69d4788-a5e1-4da7-8be1-527b33644ace&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:910,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (typeof masterOfCeremony === &#x27;undefined&#x27;) {\n  masterOfCeremony = accounts[0];\n}\nvotingKey = accounts[2];\nvotingKey2 = accounts[3];\nminingKey = accounts[1];\nminingKey2 = accounts[4];\nminingKey3 = accounts[5];\nvotingKey3 = accounts[7];\npoaNetworkConsensusMock = await PoaNetworkConsensusMock.new(masterOfCeremony, []);\n\nproxyStorageMock = await ProxyStorageMock.new();\nconst proxyStorageEternalStorage = await EternalStorageProxy.new(0, proxyStorageMock.address);\nproxyStorageMock = await ProxyStorageMock.at(proxyStorageEternalStorage.address);\nawait proxyStorageMock.init(poaNetworkConsensusMock.address).should.be.fulfilled;\n\nkeysManager = await KeysManagerMock.new();\nconst keysManagerEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, keysManager.address);\nkeysManager = await KeysManagerMock.at(keysManagerEternalStorage.address);\nawait keysManager.init(\n  \&quot;0x0000000000000000000000000000000000000000\&quot;\n).should.be.fulfilled;\n\nlet ballotsStorage = await BallotsStorage.new();\nconst ballotsEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, ballotsStorage.address);\nballotsStorage = await BallotsStorage.at(ballotsEternalStorage.address);\nawait ballotsStorage.init([3, 2]).should.be.fulfilled;\n\nawait poaNetworkConsensusMock.setProxyStorage(proxyStorageMock.address);\nmetadata = await ValidatorMetadata.new();\nmetadataEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, metadata.address);\nmetadata = await ValidatorMetadata.at(metadataEternalStorage.address);\n\nawait proxyStorageMock.initializeAddresses(\n  keysManager.address,\n  accounts[0],\n  accounts[0],\n  accounts[0],\n  accounts[0],\n  ballotsEternalStorage.address,\n  metadataEternalStorage.address,\n  accounts[0]\n);\n\nawait addMiningKey(miningKey);\nawait addVotingKey(votingKey, miningKey);\nawait addMiningKey(miningKey2);\nawait addVotingKey(votingKey2, miningKey2);\nawait addMiningKey(miningKey3);\nawait addVotingKey(votingKey3, miningKey3);\nawait metadata.setTime(55555);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6668ef04-ded6-4761-82ae-af89fa8c46b2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e66ca738-749b-43ef-91ec-560836d77b6b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4d9c4035-a0eb-4e9b-9a4e-31af262f9653&quot;,&quot;title&quot;:&quot;#createMetadata&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #createMetadata happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:212,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await metadata.getTime.call()).should.be.bignumber.equal(55555);\nconst {logs} = await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nconst validators = await metadata.validators.call(miningKey);\nvalidators.should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);\nlogs[0].event.should.be.equal(&#x27;MetadataCreated&#x27;);\nlogs[0].args.miningKey.should.be.equal(miningKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;18e58994-3a84-46d6-b9fe-1028c20a5a76&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create metadata if fullAddress is too long&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #createMetadata should not let create metadata if fullAddress is too long&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:202,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let localFakeData = fakeData.slice();\nlocalFakeData[3] = &#x27;a&#x27;.repeat(201);\nawait metadata.createMetadata(...localFakeData, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nlocalFakeData[3] = &#x27;a&#x27;.repeat(200);\nawait metadata.createMetadata(...localFakeData, {from: votingKey}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;53fc890b-7b08-43f9-8e7c-c764fc5ea92d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create metadata if called by non-voting key&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #createMetadata should not let create metadata if called by non-voting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:85,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await metadata.createMetadata(...fakeData, {from: miningKey}).should.be.rejectedWith(ERROR_MSG);\nconst validators = await metadata.validators.call(miningKey);\nvalidators.should.be.deep.equal([\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  \&quot;\&quot;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8da9dac9-7b14-4fac-b1f3-b44f0f819e92&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create metadata if called second time&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #createMetadata should not let create metadata if called second time&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:162,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.createMetadata(...fakeData, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e0292196-2355-4b24-ac71-78821cd1b439&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;18e58994-3a84-46d6-b9fe-1028c20a5a76&quot;,&quot;53fc890b-7b08-43f9-8e7c-c764fc5ea92d&quot;,&quot;8da9dac9-7b14-4fac-b1f3-b44f0f819e92&quot;,&quot;e0292196-2355-4b24-ac71-78821cd1b439&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:661,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;d0e806c2-b927-41a8-9305-abe46588c907&quot;,&quot;title&quot;:&quot;#clearMetadata&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #clearMetadata happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:730,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let result = await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\n(await metadata.validators.call(miningKey)).should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);\nresult.logs[0].event.should.be.equal(&#x27;MetadataCreated&#x27;);\nresult.logs[0].args.miningKey.should.be.equal(miningKey);\nawait metadata.setTime(4444);\nresult = await metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\n(await metadata.pendingChanges.call(miningKey)).should.be.deep.equal([\n  toHex(\&quot;Feodosiy\&quot;),\n  toHex(\&quot;Kennedy\&quot;),\n  pad(web3.toHex(\&quot;123123\&quot;)),\n  \&quot;Petrovka 38\&quot;,\n  toHex(\&quot;ZA\&quot;),\n  pad(web3.toHex(\&quot;1337\&quot;)),\n  new web3.BigNumber(71),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(4444),\n  new web3.BigNumber(2)\n]);\nresult.logs[0].event.should.be.equal(\&quot;ChangeRequestInitiated\&quot;);\nresult.logs[0].args.miningKey.should.be.equal(miningKey);\nawait metadata.confirmPendingChange(miningKey, {from: votingKey2}).should.be.fulfilled;\nlet confirmations = await metadata.confirmations.call(miningKey);\nconfirmations[0].should.be.bignumber.equal(1); // voters count\nconfirmations[1][0].should.be.equal(miningKey2); // voters array\nawait proxyStorageMock.setKeysManagerMock(accounts[0]);\nresult = await metadata.clearMetadata(miningKey);\nresult.logs[0].event.should.be.equal(&#x27;MetadataCleared&#x27;);\nresult.logs[0].args.miningKey.should.be.equal(miningKey);\nawait proxyStorageMock.setKeysManagerMock(keysManager.address);\nconfirmations = await metadata.confirmations.call(miningKey);\nconfirmations[0].should.be.bignumber.equal(0); // voters count\n(await metadata.validators.call(miningKey)).should.be.deep.equal([\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  \&quot;\&quot;,\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);\n(await metadata.pendingChanges.call(miningKey)).should.be.deep.equal([\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  \&quot;\&quot;,\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7750bdda-c392-49d4-bfc1-0ce1c8e9fbd4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7750bdda-c392-49d4-bfc1-0ce1c8e9fbd4&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:730,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;30d96b0e-b7e7-40d6-9f69-a4ad30ccf014&quot;,&quot;title&quot;:&quot;#moveMetadata&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #moveMetadata happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1120,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let result = await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\n(await metadata.validators.call(miningKey)).should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);\nresult.logs[0].event.should.be.equal(&#x27;MetadataCreated&#x27;);\nresult.logs[0].args.miningKey.should.be.equal(miningKey);\nawait metadata.setTime(4444);\nresult = await metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\n(await metadata.pendingChanges.call(miningKey)).should.be.deep.equal([\n  toHex(\&quot;Feodosiy\&quot;),\n  toHex(\&quot;Kennedy\&quot;),\n  pad(web3.toHex(\&quot;123123\&quot;)),\n  \&quot;Petrovka 38\&quot;,\n  toHex(\&quot;ZA\&quot;),\n  pad(web3.toHex(\&quot;1337\&quot;)),\n  new web3.BigNumber(71),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(4444),\n  new web3.BigNumber(2)\n]);\nresult.logs[0].event.should.be.equal(\&quot;ChangeRequestInitiated\&quot;);\nresult.logs[0].args.miningKey.should.be.equal(miningKey);\nawait metadata.confirmPendingChange(miningKey, {from: votingKey3}).should.be.fulfilled;\nlet confirmations = await metadata.confirmations.call(miningKey);\nconfirmations[0].should.be.bignumber.equal(1); // voters count\nconfirmations[1][0].should.be.equal(miningKey3); // voters array\n(await metadata.validators.call(miningKey2)).should.be.deep.equal([\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  \&quot;\&quot;,\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);\n(await metadata.pendingChanges.call(miningKey2)).should.be.deep.equal([\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  \&quot;\&quot;,\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);\nawait proxyStorageMock.setKeysManagerMock(accounts[0]);\nresult = await metadata.moveMetadata(miningKey, miningKey2);\nresult.logs[0].event.should.be.equal(&#x27;MetadataMoved&#x27;);\nresult.logs[0].args.oldMiningKey.should.be.equal(miningKey);\nresult.logs[0].args.newMiningKey.should.be.equal(miningKey2);\nawait proxyStorageMock.setKeysManagerMock(keysManager.address);\nconfirmations = await metadata.confirmations.call(miningKey);\nconfirmations[0].should.be.bignumber.equal(0); // voters count\n(await metadata.validators.call(miningKey)).should.be.deep.equal([\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  \&quot;\&quot;,\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);\n(await metadata.pendingChanges.call(miningKey)).should.be.deep.equal([\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  \&quot;\&quot;,\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);\nconfirmations = await metadata.confirmations.call(miningKey2);\nconfirmations[0].should.be.bignumber.equal(1); // voters count\nconfirmations[1][0].should.be.equal(miningKey3); // voters array\n(await metadata.validators.call(miningKey2)).should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);\n(await metadata.pendingChanges.call(miningKey2)).should.be.deep.equal([\n  toHex(\&quot;Feodosiy\&quot;),\n  toHex(\&quot;Kennedy\&quot;),\n  pad(web3.toHex(\&quot;123123\&quot;)),\n  \&quot;Petrovka 38\&quot;,\n  toHex(\&quot;ZA\&quot;),\n  pad(web3.toHex(\&quot;1337\&quot;)),\n  new web3.BigNumber(71),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(4444),\n  new web3.BigNumber(2)\n]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;63f18837-22f8-4585-b289-70b6c4dea4e3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;63f18837-22f8-4585-b289-70b6c4dea4e3&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1120,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;73c34193-6a05-4adb-abdd-bf5663c87104&quot;,&quot;title&quot;:&quot;#initMetadata&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #initMetadata happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:604,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let validatorData = [\n  \&quot;Djamshut\&quot;, // bytes32 _firstName\n  \&quot;Roosvelt\&quot;, // bytes32 _lastName\n  \&quot;123asd\&quot;,   // bytes32 _licenseId\n  \&quot;Moskva\&quot;,   // string _fullAddress\n  \&quot;ZZ\&quot;,       // bytes32 _state\n  \&quot;234\&quot;,      // bytes32 _zipcode\n  23423,      // uint256 _expirationDate\n  123,        // uint256 _createdDate\n  0,          // uint256 _updatedDate\n  3,          // uint256 _minThreshold\n  accounts[8] // address _miningKey\n];\nawait metadata.initMetadata(...validatorData, {from: accounts[8]}).should.be.rejectedWith(ERROR_MSG);\nawait metadata.initMetadata(...validatorData).should.be.rejectedWith(ERROR_MSG);\nvalidatorData[10] = miningKey;\nawait metadata.initMetadata(...validatorData).should.be.fulfilled;\nawait metadata.initMetadata(...validatorData).should.be.rejectedWith(ERROR_MSG);\n(await metadata.validators.call(miningKey)).should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(123),\n  new web3.BigNumber(0),\n  new web3.BigNumber(3)\n]);\nvalidatorData[7] = 0;\nvalidatorData[10] = miningKey2;\nawait metadata.initMetadata(...validatorData).should.be.rejectedWith(ERROR_MSG);\nvalidatorData[7] = 123;\nawait metadata.initMetadata(...validatorData).should.be.fulfilled;\n(await metadata.validators.call(miningKey2)).should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(123),\n  new web3.BigNumber(0),\n  new web3.BigNumber(3)\n]);\nvalidatorData[10] = miningKey3;\nawait metadata.initMetadataDisable({from: accounts[8]}).should.be.rejectedWith(ERROR_MSG);\nawait metadata.initMetadataDisable().should.be.fulfilled;\n(await metadata.initMetadataDisabled.call()).should.be.equal(true);\nawait metadata.initMetadata(...validatorData).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4c13f665-8a63-4b10-98f6-11a638509a26&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4c13f665-8a63-4b10-98f6-11a638509a26&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:604,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;87922d16-cae9-46ad-badc-27be1f0dd7b9&quot;,&quot;title&quot;:&quot;#changeRequest&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #changeRequest \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:109,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;548fc019-9872-4106-9a99-3e4d181e53ee&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #changeRequest happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:176,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.setTime(4444);\nconst {logs} = await metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nconst pendingChanges = await metadata.pendingChanges.call(miningKey);\npendingChanges.should.be.deep.equal([\n  toHex(\&quot;Feodosiy\&quot;),\n  toHex(\&quot;Kennedy\&quot;),\n  pad(web3.toHex(\&quot;123123\&quot;)),\n  \&quot;Petrovka 38\&quot;,\n  toHex(\&quot;ZA\&quot;),\n  pad(web3.toHex(\&quot;1337\&quot;)),\n  new web3.BigNumber(71),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(4444),\n  new web3.BigNumber(2)\n]);\nlogs[0].event.should.be.equal(\&quot;ChangeRequestInitiated\&quot;);\nlogs[0].args.miningKey.should.be.equal(miningKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cff2759b-37b8-4632-be63-d2d869a16f0e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let call if there is no metadata&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #changeRequest should not let call if there is no metadata&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:36,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.changeRequest(...newMetadata, {from: accounts[4]}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3b3ea1de-886a-4d95-b58d-99e191a17bfa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;resets confirmations when changeRequest recreated&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #changeRequest resets confirmations when changeRequest recreated&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:508,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.setTime(4444);\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey2});\nawait metadata.confirmPendingChange(miningKey, {from: votingKey3});\nlet confirmations = await metadata.confirmations.call(miningKey);\nconfirmations[0].should.be.bignumber.equal(2); // voters count\nconst {logs} = await metadata.changeRequest(...anotherData, {from: votingKey}).should.be.fulfilled;\nconfirmations = await metadata.confirmations.call(miningKey);\nconfirmations[0].should.be.bignumber.equal(0); // voters count\nawait metadata.confirmPendingChange(miningKey, {from: votingKey2});\nconfirmations = await metadata.confirmations.call(miningKey);\nconfirmations[0].should.be.bignumber.equal(1); // voters count&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fd964c6d-0b6f-4e48-bcbd-d85eef5216a7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;cff2759b-37b8-4632-be63-d2d869a16f0e&quot;,&quot;3b3ea1de-886a-4d95-b58d-99e191a17bfa&quot;,&quot;fd964c6d-0b6f-4e48-bcbd-d85eef5216a7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:720,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;66388bce-a7a3-4fbe-b460-8ab70c59a0de&quot;,&quot;title&quot;:&quot;#cancelPendingChange&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #cancelPendingChange happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:495,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.cancelPendingChange({from: votingKey}).should.be.fulfilled;\nawait metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.setTime(4444);\nconst {logs} = await metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.cancelPendingChange({from: votingKey}).should.be.fulfilled;\nconst pendingChanges = await metadata.pendingChanges.call(miningKey);\npendingChanges.should.be.deep.equal([\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  \&quot;\&quot;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);\nconst validators = await metadata.validators.call(miningKey);\nvalidators.should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);\nlogs[0].event.should.be.equal(\&quot;ChangeRequestInitiated\&quot;);\nlogs[0].args.miningKey.should.be.equal(miningKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ec44441d-3b04-4553-bad3-91e2045844fa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let delete records for someone else miningKey&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #cancelPendingChange should not let delete records for someone else miningKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:583,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.cancelPendingChange({from: votingKey}).should.be.fulfilled;\nawait metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.setTime(4444);\nconst {logs} = await metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.cancelPendingChange({from: votingKey2}).should.be.fulfilled;\nconst pendingChanges = await metadata.pendingChanges.call(miningKey);\npendingChanges.should.be.deep.equal([\n  toHex(\&quot;Feodosiy\&quot;),\n  toHex(\&quot;Kennedy\&quot;),\n  pad(web3.toHex(\&quot;123123\&quot;)),\n  \&quot;Petrovka 38\&quot;,\n  toHex(\&quot;ZA\&quot;),\n  pad(web3.toHex(\&quot;1337\&quot;)),\n  new web3.BigNumber(71),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(4444),\n  new web3.BigNumber(2)\n]);\nconst validators = await metadata.validators.call(miningKey);\nvalidators.should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;649e4df5-a79d-43db-a3f9-8e9d8489277b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ec44441d-3b04-4553-bad3-91e2045844fa&quot;,&quot;649e4df5-a79d-43db-a3f9-8e9d8489277b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1078,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;100986a0-24a9-4640-b378-7dd37072f4c9&quot;,&quot;title&quot;:&quot;#confirmPendingChange&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should not let confirm your own changes&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #confirmPendingChange should not let confirm your own changes&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:244,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;39009dab-8ab7-4268-8a8c-4744d88d3bd3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should confirm changes&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #confirmPendingChange should confirm changes&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:326,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nconst {logs} = await metadata.confirmPendingChange(miningKey, {from: votingKey2}).should.be.fulfilled;\nconst confirmations = await metadata.confirmations.call(miningKey);\nconfirmations[0].should.be.bignumber.equal(1); // voters count\nlogs[0].event.should.be.equal(&#x27;Confirmed&#x27;);\nlogs[0].args.miningKey.should.be.equal(miningKey);\nlogs[0].args.votingSender.should.be.equal(votingKey2);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ac2cf21c-e26c-4c23-8768-fcd70970215c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;prevent from double voting&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #confirmPendingChange prevent from double voting&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:458,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nconst {logs} = await metadata.confirmPendingChange(miningKey, {from: votingKey2}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey2}).should.be.rejectedWith(ERROR_MSG);\nconst confirmations = await metadata.confirmations.call(miningKey);\nconfirmations[0].should.be.bignumber.equal(1); // voters count&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a9073c40-2e0e-41d1-be71-21574d6a52c1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not exceed confirmations limit&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #confirmPendingChange should not exceed confirmations limit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:576,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const miningKey4 = accounts[8];\nconst votingKey4 = accounts[9];\nawait addMiningKey(miningKey4);\nawait addVotingKey(votingKey4, miningKey4);\nawait metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey2}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey4}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey3}).should.be.rejectedWith(ERROR_MSG);\nconst confirmations = await metadata.confirmations.call(miningKey);\nconfirmations[0].should.be.bignumber.equal(2); // voters count&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b4427110-44f5-45f6-87c3-26968da9c3d9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;39009dab-8ab7-4268-8a8c-4744d88d3bd3&quot;,&quot;ac2cf21c-e26c-4c23-8768-fcd70970215c&quot;,&quot;a9073c40-2e0e-41d1-be71-21574d6a52c1&quot;,&quot;b4427110-44f5-45f6-87c3-26968da9c3d9&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1604,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;5b4a8c85-d059-4b1e-927f-ba7b69977b67&quot;,&quot;title&quot;:&quot;#finalize&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #finalize happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:853,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.setTime(4444);\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait metadata.confirmPendingChange(miningKey, {from: votingKey2});\nawait metadata.finalize(miningKey, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait metadata.confirmPendingChange(miningKey, {from: votingKey3});\nconst {logs} = await metadata.finalize(miningKey, {from: votingKey}).should.be.fulfilled;\nawait metadata.finalize(miningKey2, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nconst validators = await metadata.validators.call(miningKey);\nvalidators.should.be.deep.equal([\n  toHex(\&quot;Feodosiy\&quot;),\n  toHex(\&quot;Kennedy\&quot;),\n  pad(web3.toHex(\&quot;123123\&quot;)),\n  \&quot;Petrovka 38\&quot;,\n  toHex(\&quot;ZA\&quot;),\n  pad(web3.toHex(\&quot;1337\&quot;)),\n  new web3.BigNumber(71),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(4444),\n  new web3.BigNumber(2)\n]);\nconst pendingChanges = await metadata.pendingChanges.call(miningKey);\npendingChanges.should.be.deep.equal([\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  \&quot;\&quot;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);\nlogs[0].event.should.be.equal(&#x27;FinalizedChange&#x27;);\nlogs[0].args.miningKey.should.be.equal(miningKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a0b00c49-6c07-4f31-81cd-054d1495baa0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a0b00c49-6c07-4f31-81cd-054d1495baa0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:853,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;d005e3ca-5d87-44d7-93b7-8603d741c827&quot;,&quot;title&quot;:&quot;#getMinThreshold&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns default value&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #getMinThreshold returns default value&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await metadata.getMinThreshold.call()).should.be.bignumber.equal(2);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f5e668ea-ab1a-4998-8476-fb1945b69850&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f5e668ea-ab1a-4998-8476-fb1945b69850&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:21,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;64c2c13f-d4b4-405e-abfe-dbcb2c2f9af0&quot;,&quot;title&quot;:&quot;#upgradeTo&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #upgradeTo \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:91,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;proxyStorageStubAddress = accounts[8];\nmetadata = await ValidatorMetadata.new();\nmetadataOldImplementation = metadata.address;\nmetadataEternalStorage = await EternalStorageProxy.new(proxyStorageStubAddress, metadata.address);\nmetadata = await ValidatorMetadata.at(metadataEternalStorage.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4bcd98a7-9121-44d7-874c-8964974cfbd2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called by ProxyStorage&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #upgradeTo may only be called by ProxyStorage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:86,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let metadataNew = await ValidatorMetadataNew.new();\nawait metadataEternalStorage.upgradeTo(metadataNew.address, {from: accounts[0]}).should.be.rejectedWith(ERROR_MSG);\nawait upgradeTo(metadataNew.address, {from: proxyStorageStubAddress});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;35434fbe-a998-4c8c-b44b-d8f87c479b88&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change implementation address&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #upgradeTo should change implementation address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:92,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let metadataNew = await ValidatorMetadataNew.new();\nlet newImplementation = metadataNew.address;\n(await metadataEternalStorage.implementation.call()).should.be.equal(metadataOldImplementation);\nawait upgradeTo(newImplementation, {from: proxyStorageStubAddress});\n(await metadataEternalStorage.implementation.call()).should.be.equal(newImplementation);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;541cc3a2-d226-4dbd-9f91-0a7a31633407&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should increment implementation version&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #upgradeTo should increment implementation version&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:89,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let metadataNew = await ValidatorMetadataNew.new();\nlet oldVersion = await metadataEternalStorage.version.call();\nlet newVersion = oldVersion.add(1);\nawait upgradeTo(metadataNew.address, {from: proxyStorageStubAddress});\n(await metadataEternalStorage.version.call()).should.be.bignumber.equal(newVersion);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1238fd55-70a9-418d-9680-c43e4a7acf5f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should work&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #upgradeTo new implementation should work&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:121,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let metadataNew = await ValidatorMetadataNew.new();\nawait upgradeTo(metadataNew.address, {from: proxyStorageStubAddress});\nmetadataNew = await ValidatorMetadataNew.at(metadataEternalStorage.address);\n(await metadataNew.initialized.call()).should.be.equal(false);\nawait metadataNew.initialize();\n(await metadataNew.initialized.call()).should.be.equal(true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;16c294d6-bf4b-46a0-970a-b17442b8e802&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should use the same proxyStorage address&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #upgradeTo new implementation should use the same proxyStorage address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:86,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let metadataNew = await ValidatorMetadataNew.new();\nawait upgradeTo(metadataNew.address, {from: proxyStorageStubAddress});\nmetadataNew = await ValidatorMetadataNew.at(metadataEternalStorage.address);\n(await metadataNew.proxyStorage.call()).should.be.equal(proxyStorageStubAddress);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5e3589b4-8685-452e-8b4e-f6df83fa0f93&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should use the same storage&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata [all features] #upgradeTo new implementation should use the same storage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:304,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.setTime(55555);\nawait metadataEternalStorage.setProxyStorage(proxyStorageMock.address);\nawait metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadataEternalStorage.setProxyStorage(proxyStorageStubAddress);\nlet metadataNew = await ValidatorMetadataNew.new();\nawait upgradeTo(metadataNew.address, {from: proxyStorageStubAddress});\nmetadataNew = await ValidatorMetadataNew.at(metadataEternalStorage.address);\nconst validators = await metadataNew.validators.call(miningKey);\nvalidators.should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a92e6cb2-b782-476b-83a7-49703ce93f8c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;35434fbe-a998-4c8c-b44b-d8f87c479b88&quot;,&quot;541cc3a2-d226-4dbd-9f91-0a7a31633407&quot;,&quot;1238fd55-70a9-418d-9680-c43e4a7acf5f&quot;,&quot;16c294d6-bf4b-46a0-970a-b17442b8e802&quot;,&quot;5e3589b4-8685-452e-8b4e-f6df83fa0f93&quot;,&quot;a92e6cb2-b782-476b-83a7-49703ce93f8c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:778,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;953b312c-7225-475d-a638-278fce7b2a2c&quot;,&quot;title&quot;:&quot;Contract: ValidatorMetadata upgraded [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1836,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c6817dac-be45-4441-9e55-274a2d3baf3f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;42c3f384-9e35-4673-8b79-b6a409c263fc&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1142,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (typeof masterOfCeremony === &#x27;undefined&#x27;) {\n  masterOfCeremony = accounts[0];\n}\nvotingKey = accounts[2];\nvotingKey2 = accounts[3];\nminingKey = accounts[1];\nminingKey2 = accounts[4];\nminingKey3 = accounts[5];\nvotingKey3 = accounts[7];\npoaNetworkConsensusMock = await PoaNetworkConsensusMock.new(masterOfCeremony, []);\n\nproxyStorageMock = await ProxyStorageMock.new();\nconst proxyStorageEternalStorage = await EternalStorageProxy.new(0, proxyStorageMock.address);\nproxyStorageMock = await ProxyStorageMock.at(proxyStorageEternalStorage.address);\nawait proxyStorageMock.init(poaNetworkConsensusMock.address).should.be.fulfilled;\n\nkeysManager = await KeysManagerMock.new();\nconst keysManagerEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, keysManager.address);\nkeysManager = await KeysManagerMock.at(keysManagerEternalStorage.address);\nawait keysManager.init(\n  \&quot;0x0000000000000000000000000000000000000000\&quot;\n).should.be.fulfilled;\n\nlet ballotsStorage = await BallotsStorage.new();\nconst ballotsEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, ballotsStorage.address);\nballotsStorage = await BallotsStorage.at(ballotsEternalStorage.address);\nawait ballotsStorage.init([3, 2]).should.be.fulfilled;\n\nawait poaNetworkConsensusMock.setProxyStorage(proxyStorageMock.address);\nmetadata = await ValidatorMetadata.new();\nmetadataEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, metadata.address);\nmetadata = await ValidatorMetadata.at(metadataEternalStorage.address);\n\nawait proxyStorageMock.initializeAddresses(\n  keysManager.address,\n  accounts[0],\n  accounts[0],\n  accounts[0],\n  accounts[0],\n  ballotsEternalStorage.address,\n  metadataEternalStorage.address,\n  accounts[0]\n);\nlet metadataNew = await ValidatorMetadataNew.new();\nawait metadataEternalStorage.setProxyStorage(accounts[6]);\nconst {logs} = await metadataEternalStorage.upgradeTo(metadataNew.address, {from: accounts[6]});\nlogs[0].event.should.be.equal(\&quot;Upgraded\&quot;);\nawait metadataEternalStorage.setProxyStorage(proxyStorageMock.address);\nmetadata = await ValidatorMetadataNew.at(metadataEternalStorage.address);\nawait addMiningKey(miningKey);\nawait addVotingKey(votingKey, miningKey);\nawait addMiningKey(miningKey2);\nawait addVotingKey(votingKey2, miningKey2);\nawait addMiningKey(miningKey3);\nawait addVotingKey(votingKey3, miningKey3);\nawait metadata.setTime(55555);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;109097e0-9c72-4248-89f6-68c2acac4ca6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c8a224bb-426a-4a36-ab09-ae0daf6f8326&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;62ed6d6a-2274-4790-b4e2-49d718b31320&quot;,&quot;title&quot;:&quot;#createMetadata&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #createMetadata happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:162,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await metadata.getTime.call()).should.be.bignumber.equal(55555);\nconst {logs} = await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nconst validators = await metadata.validators.call(miningKey);\nvalidators.should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);\nlogs[0].event.should.be.equal(&#x27;MetadataCreated&#x27;);\nlogs[0].args.miningKey.should.be.equal(miningKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e3da3de6-f7d0-4e3a-9159-4ca6f5717a6a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create metadata if fullAddress is too long&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #createMetadata should not let create metadata if fullAddress is too long&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:197,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let localFakeData = fakeData.slice();\nlocalFakeData[3] = &#x27;a&#x27;.repeat(201);\nawait metadata.createMetadata(...localFakeData, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nlocalFakeData[3] = &#x27;a&#x27;.repeat(200);\nawait metadata.createMetadata(...localFakeData, {from: votingKey}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8298aa30-83a2-4459-991f-50a3364f7b72&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create metadata if called by non-voting key&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #createMetadata should not let create metadata if called by non-voting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:156,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await metadata.createMetadata(...fakeData, {from: miningKey}).should.be.rejectedWith(ERROR_MSG);\nconst validators = await metadata.validators.call(miningKey);\nvalidators.should.be.deep.equal([\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  \&quot;\&quot;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3fa5a372-b7a3-485f-b1e3-c277a7e5ca55&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create metadata if called second time&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #createMetadata should not let create metadata if called second time&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:153,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.createMetadata(...fakeData, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f9c48c55-55a3-42e8-bc0d-432b9836743e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e3da3de6-f7d0-4e3a-9159-4ca6f5717a6a&quot;,&quot;8298aa30-83a2-4459-991f-50a3364f7b72&quot;,&quot;3fa5a372-b7a3-485f-b1e3-c277a7e5ca55&quot;,&quot;f9c48c55-55a3-42e8-bc0d-432b9836743e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:668,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;3ad5a33e-1b91-4fc0-9639-b624787e20e0&quot;,&quot;title&quot;:&quot;#clearMetadata&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #clearMetadata happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:675,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let result = await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\n(await metadata.validators.call(miningKey)).should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);\nresult.logs[0].event.should.be.equal(&#x27;MetadataCreated&#x27;);\nresult.logs[0].args.miningKey.should.be.equal(miningKey);\nawait metadata.setTime(4444);\nresult = await metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\n(await metadata.pendingChanges.call(miningKey)).should.be.deep.equal([\n  toHex(\&quot;Feodosiy\&quot;),\n  toHex(\&quot;Kennedy\&quot;),\n  pad(web3.toHex(\&quot;123123\&quot;)),\n  \&quot;Petrovka 38\&quot;,\n  toHex(\&quot;ZA\&quot;),\n  pad(web3.toHex(\&quot;1337\&quot;)),\n  new web3.BigNumber(71),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(4444),\n  new web3.BigNumber(2)\n]);\nresult.logs[0].event.should.be.equal(\&quot;ChangeRequestInitiated\&quot;);\nresult.logs[0].args.miningKey.should.be.equal(miningKey);\nawait metadata.confirmPendingChange(miningKey, {from: votingKey2}).should.be.fulfilled;\nlet confirmations = await metadata.confirmations.call(miningKey);\nconfirmations[0].should.be.bignumber.equal(1); // voters count\nconfirmations[1][0].should.be.equal(miningKey2); // voters array\nawait proxyStorageMock.setKeysManagerMock(accounts[0]);\nresult = await metadata.clearMetadata(miningKey);\nresult.logs[0].event.should.be.equal(&#x27;MetadataCleared&#x27;);\nresult.logs[0].args.miningKey.should.be.equal(miningKey);\nawait proxyStorageMock.setKeysManagerMock(keysManager.address);\nconfirmations = await metadata.confirmations.call(miningKey);\nconfirmations[0].should.be.bignumber.equal(0); // voters count\n(await metadata.validators.call(miningKey)).should.be.deep.equal([\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  \&quot;\&quot;,\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);\n(await metadata.pendingChanges.call(miningKey)).should.be.deep.equal([\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  \&quot;\&quot;,\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3356a17d-87ed-4a54-b30b-b70c977d1ea8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3356a17d-87ed-4a54-b30b-b70c977d1ea8&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:675,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;2aa90bf0-3892-4baa-8dde-637fb30b2389&quot;,&quot;title&quot;:&quot;#moveMetadata&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #moveMetadata happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1074,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let result = await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\n(await metadata.validators.call(miningKey)).should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);\nresult.logs[0].event.should.be.equal(&#x27;MetadataCreated&#x27;);\nresult.logs[0].args.miningKey.should.be.equal(miningKey);\nawait metadata.setTime(4444);\nresult = await metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\n(await metadata.pendingChanges.call(miningKey)).should.be.deep.equal([\n  toHex(\&quot;Feodosiy\&quot;),\n  toHex(\&quot;Kennedy\&quot;),\n  pad(web3.toHex(\&quot;123123\&quot;)),\n  \&quot;Petrovka 38\&quot;,\n  toHex(\&quot;ZA\&quot;),\n  pad(web3.toHex(\&quot;1337\&quot;)),\n  new web3.BigNumber(71),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(4444),\n  new web3.BigNumber(2)\n]);\nresult.logs[0].event.should.be.equal(\&quot;ChangeRequestInitiated\&quot;);\nresult.logs[0].args.miningKey.should.be.equal(miningKey);\nawait metadata.confirmPendingChange(miningKey, {from: votingKey3}).should.be.fulfilled;\nlet confirmations = await metadata.confirmations.call(miningKey);\nconfirmations[0].should.be.bignumber.equal(1); // voters count\nconfirmations[1][0].should.be.equal(miningKey3); // voters array\n(await metadata.validators.call(miningKey2)).should.be.deep.equal([\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  \&quot;\&quot;,\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);\n(await metadata.pendingChanges.call(miningKey2)).should.be.deep.equal([\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  \&quot;\&quot;,\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);\nawait proxyStorageMock.setKeysManagerMock(accounts[0]);\nresult = await metadata.moveMetadata(miningKey, miningKey2);\nresult.logs[0].event.should.be.equal(&#x27;MetadataMoved&#x27;);\nresult.logs[0].args.oldMiningKey.should.be.equal(miningKey);\nresult.logs[0].args.newMiningKey.should.be.equal(miningKey2);\nawait proxyStorageMock.setKeysManagerMock(keysManager.address);\nconfirmations = await metadata.confirmations.call(miningKey);\nconfirmations[0].should.be.bignumber.equal(0); // voters count\n(await metadata.validators.call(miningKey)).should.be.deep.equal([\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  \&quot;\&quot;,\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);\n(await metadata.pendingChanges.call(miningKey)).should.be.deep.equal([\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  \&quot;\&quot;,\n  toHex(\&quot;\&quot;),\n  toHex(\&quot;\&quot;),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);\nconfirmations = await metadata.confirmations.call(miningKey2);\nconfirmations[0].should.be.bignumber.equal(1); // voters count\nconfirmations[1][0].should.be.equal(miningKey3); // voters array\n(await metadata.validators.call(miningKey2)).should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);\n(await metadata.pendingChanges.call(miningKey2)).should.be.deep.equal([\n  toHex(\&quot;Feodosiy\&quot;),\n  toHex(\&quot;Kennedy\&quot;),\n  pad(web3.toHex(\&quot;123123\&quot;)),\n  \&quot;Petrovka 38\&quot;,\n  toHex(\&quot;ZA\&quot;),\n  pad(web3.toHex(\&quot;1337\&quot;)),\n  new web3.BigNumber(71),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(4444),\n  new web3.BigNumber(2)\n]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4e51f10c-6ec7-4fe1-be6a-8da606f14a39&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4e51f10c-6ec7-4fe1-be6a-8da606f14a39&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1074,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;a145a22f-26d5-4e59-9d2d-aef954483987&quot;,&quot;title&quot;:&quot;#initMetadata&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #initMetadata happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:454,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let validatorData = [\n  \&quot;Djamshut\&quot;, // bytes32 _firstName\n  \&quot;Roosvelt\&quot;, // bytes32 _lastName\n  \&quot;123asd\&quot;,   // bytes32 _licenseId\n  \&quot;Moskva\&quot;,   // string _fullAddress\n  \&quot;ZZ\&quot;,       // bytes32 _state\n  \&quot;234\&quot;,      // bytes32 _zipcode\n  23423,      // uint256 _expirationDate\n  123,        // uint256 _createdDate\n  0,          // uint256 _updatedDate\n  3,          // uint256 _minThreshold\n  accounts[8] // address _miningKey\n];\nawait metadata.initMetadata(...validatorData, {from: accounts[8]}).should.be.rejectedWith(ERROR_MSG);\nawait metadata.initMetadata(...validatorData).should.be.rejectedWith(ERROR_MSG);\nvalidatorData[10] = miningKey;\nawait metadata.initMetadata(...validatorData).should.be.fulfilled;\nawait metadata.initMetadata(...validatorData).should.be.rejectedWith(ERROR_MSG);\n(await metadata.validators.call(miningKey)).should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(123),\n  new web3.BigNumber(0),\n  new web3.BigNumber(3)\n]);\nvalidatorData[7] = 0;\nvalidatorData[10] = miningKey2;\nawait metadata.initMetadata(...validatorData).should.be.rejectedWith(ERROR_MSG);\nvalidatorData[7] = 123;\nawait metadata.initMetadata(...validatorData).should.be.fulfilled;\n(await metadata.validators.call(miningKey2)).should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(123),\n  new web3.BigNumber(0),\n  new web3.BigNumber(3)\n]);\nvalidatorData[10] = miningKey3;\nawait metadata.initMetadataDisable({from: accounts[8]}).should.be.rejectedWith(ERROR_MSG);\nawait metadata.initMetadataDisable().should.be.fulfilled;\n(await metadata.initMetadataDisabled.call()).should.be.equal(true);\nawait metadata.initMetadata(...validatorData).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;304736c0-88cf-4375-a6de-2547b776c99b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;304736c0-88cf-4375-a6de-2547b776c99b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:454,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;d5badd85-17b0-4ad0-82ab-5aad1f0d3860&quot;,&quot;title&quot;:&quot;#changeRequest&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #changeRequest \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:111,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b8ad6436-b827-45db-98b1-a0f96f859ede&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #changeRequest happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:178,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.setTime(4444);\nconst {logs} = await metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nconst pendingChanges = await metadata.pendingChanges.call(miningKey);\npendingChanges.should.be.deep.equal([\n  toHex(\&quot;Feodosiy\&quot;),\n  toHex(\&quot;Kennedy\&quot;),\n  pad(web3.toHex(\&quot;123123\&quot;)),\n  \&quot;Petrovka 38\&quot;,\n  toHex(\&quot;ZA\&quot;),\n  pad(web3.toHex(\&quot;1337\&quot;)),\n  new web3.BigNumber(71),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(4444),\n  new web3.BigNumber(2)\n]);\nlogs[0].event.should.be.equal(\&quot;ChangeRequestInitiated\&quot;);\nlogs[0].args.miningKey.should.be.equal(miningKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b8bc69fd-bbb2-47f7-9dd8-b7eceb7c7d31&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let call if there is no metadata&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #changeRequest should not let call if there is no metadata&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.changeRequest(...newMetadata, {from: accounts[4]}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;821839b9-433d-40fa-889c-2d5b6fd2a959&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;resets confirmations when changeRequest recreated&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #changeRequest resets confirmations when changeRequest recreated&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:597,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.setTime(4444);\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey2});\nawait metadata.confirmPendingChange(miningKey, {from: votingKey3});\nlet confirmations = await metadata.confirmations.call(miningKey);\nconfirmations[0].should.be.bignumber.equal(2); // voters count\nconst {logs} = await metadata.changeRequest(...anotherData, {from: votingKey}).should.be.fulfilled;\nconfirmations = await metadata.confirmations.call(miningKey);\nconfirmations[0].should.be.bignumber.equal(0); // voters count\nawait metadata.confirmPendingChange(miningKey, {from: votingKey2});\nconfirmations = await metadata.confirmations.call(miningKey);\nconfirmations[0].should.be.bignumber.equal(1); // voters count&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f195e45c-5a7d-4fb6-a051-50b0c3dabd78&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b8bc69fd-bbb2-47f7-9dd8-b7eceb7c7d31&quot;,&quot;821839b9-433d-40fa-889c-2d5b6fd2a959&quot;,&quot;f195e45c-5a7d-4fb6-a051-50b0c3dabd78&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:802,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;fabd9175-d679-4cb1-bc11-1d5fbd950701&quot;,&quot;title&quot;:&quot;#cancelPendingChange&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #cancelPendingChange happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:476,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.cancelPendingChange({from: votingKey}).should.be.fulfilled;\nawait metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.setTime(4444);\nconst {logs} = await metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.cancelPendingChange({from: votingKey}).should.be.fulfilled;\nconst pendingChanges = await metadata.pendingChanges.call(miningKey);\npendingChanges.should.be.deep.equal([\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  \&quot;\&quot;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);\nconst validators = await metadata.validators.call(miningKey);\nvalidators.should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);\nlogs[0].event.should.be.equal(\&quot;ChangeRequestInitiated\&quot;);\nlogs[0].args.miningKey.should.be.equal(miningKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9e6deb4f-70c9-48df-ba41-0be1c184557d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let delete records for someone else miningKey&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #cancelPendingChange should not let delete records for someone else miningKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:657,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.cancelPendingChange({from: votingKey}).should.be.fulfilled;\nawait metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.setTime(4444);\nconst {logs} = await metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.cancelPendingChange({from: votingKey2}).should.be.fulfilled;\nconst pendingChanges = await metadata.pendingChanges.call(miningKey);\npendingChanges.should.be.deep.equal([\n  toHex(\&quot;Feodosiy\&quot;),\n  toHex(\&quot;Kennedy\&quot;),\n  pad(web3.toHex(\&quot;123123\&quot;)),\n  \&quot;Petrovka 38\&quot;,\n  toHex(\&quot;ZA\&quot;),\n  pad(web3.toHex(\&quot;1337\&quot;)),\n  new web3.BigNumber(71),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(4444),\n  new web3.BigNumber(2)\n]);\nconst validators = await metadata.validators.call(miningKey);\nvalidators.should.be.deep.equal([\n  toHex(\&quot;Djamshut\&quot;),\n  toHex(\&quot;Roosvelt\&quot;),\n  pad(web3.toHex(\&quot;123asd\&quot;)),\n  \&quot;Moskva\&quot;,\n  toHex(\&quot;ZZ\&quot;),\n  pad(web3.toHex(\&quot;234\&quot;)),\n  new web3.BigNumber(23423),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(0),\n  new web3.BigNumber(2)\n]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;45c97b9c-ec3d-400a-85d7-2599ba90e7b3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9e6deb4f-70c9-48df-ba41-0be1c184557d&quot;,&quot;45c97b9c-ec3d-400a-85d7-2599ba90e7b3&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1133,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;15cc9832-9bd0-4302-9de5-e098b14719d3&quot;,&quot;title&quot;:&quot;#confirmPendingChange&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should not let confirm your own changes&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #confirmPendingChange should not let confirm your own changes&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:249,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6f491ead-492c-4417-a266-6ab5dcb2cf04&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should confirm changes&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #confirmPendingChange should confirm changes&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:407,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nconst {logs} = await metadata.confirmPendingChange(miningKey, {from: votingKey2}).should.be.fulfilled;\nconst confirmations = await metadata.confirmations.call(miningKey);\nconfirmations[0].should.be.bignumber.equal(1); // voters count\nlogs[0].event.should.be.equal(&#x27;Confirmed&#x27;);\nlogs[0].args.miningKey.should.be.equal(miningKey);\nlogs[0].args.votingSender.should.be.equal(votingKey2);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b33dec92-c23c-411b-b903-4e6e8bbc626b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;prevent from double voting&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #confirmPendingChange prevent from double voting&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:360,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nconst {logs} = await metadata.confirmPendingChange(miningKey, {from: votingKey2}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey2}).should.be.rejectedWith(ERROR_MSG);\nconst confirmations = await metadata.confirmations.call(miningKey);\nconfirmations[0].should.be.bignumber.equal(1); // voters count&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;91e166f9-69a1-4a6e-aaa0-4587dedfab8c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not exceed confirmations limit&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #confirmPendingChange should not exceed confirmations limit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:605,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const miningKey4 = accounts[8];\nconst votingKey4 = accounts[9];\nawait addMiningKey(miningKey4);\nawait addVotingKey(votingKey4, miningKey4);\nawait metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey2}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey4}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey3}).should.be.rejectedWith(ERROR_MSG);\nconst confirmations = await metadata.confirmations.call(miningKey);\nconfirmations[0].should.be.bignumber.equal(2); // voters count&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f6225ab3-d17e-41f2-90f7-80efa3744d27&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6f491ead-492c-4417-a266-6ab5dcb2cf04&quot;,&quot;b33dec92-c23c-411b-b903-4e6e8bbc626b&quot;,&quot;91e166f9-69a1-4a6e-aaa0-4587dedfab8c&quot;,&quot;f6225ab3-d17e-41f2-90f7-80efa3744d27&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1621,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;cac19db3-ef85-461a-8cb4-a76dc0389251&quot;,&quot;title&quot;:&quot;#finalize&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #finalize happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:763,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await metadata.createMetadata(...fakeData, {from: votingKey}).should.be.fulfilled;\nawait metadata.setTime(4444);\nawait metadata.changeRequest(...newMetadata, {from: votingKey}).should.be.fulfilled;\nawait metadata.confirmPendingChange(miningKey, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait metadata.confirmPendingChange(miningKey, {from: votingKey2});\nawait metadata.finalize(miningKey, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait metadata.confirmPendingChange(miningKey, {from: votingKey3});\nconst {logs} = await metadata.finalize(miningKey, {from: votingKey}).should.be.fulfilled;\nawait metadata.finalize(miningKey2, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nconst validators = await metadata.validators.call(miningKey);\nvalidators.should.be.deep.equal([\n  toHex(\&quot;Feodosiy\&quot;),\n  toHex(\&quot;Kennedy\&quot;),\n  pad(web3.toHex(\&quot;123123\&quot;)),\n  \&quot;Petrovka 38\&quot;,\n  toHex(\&quot;ZA\&quot;),\n  pad(web3.toHex(\&quot;1337\&quot;)),\n  new web3.BigNumber(71),\n  new web3.BigNumber(55555),\n  new web3.BigNumber(4444),\n  new web3.BigNumber(2)\n]);\nconst pendingChanges = await metadata.pendingChanges.call(miningKey);\npendingChanges.should.be.deep.equal([\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  \&quot;\&quot;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000000000000000000000000000&#x27;,\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0),\n  new web3.BigNumber(0)\n]);\nlogs[0].event.should.be.equal(&#x27;FinalizedChange&#x27;);\nlogs[0].args.miningKey.should.be.equal(miningKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;79520d51-7213-4730-b5c7-b6899772b8e7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;79520d51-7213-4730-b5c7-b6899772b8e7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:763,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;8feebe87-a802-479c-b668-81eca7533f42&quot;,&quot;title&quot;:&quot;#getMinThreshold&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/metadata_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/metadata_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns default value&quot;,&quot;fullTitle&quot;:&quot;Contract: ValidatorMetadata upgraded [all features] #getMinThreshold returns default value&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await metadata.getMinThreshold.call()).should.be.bignumber.equal(2);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0c759572-903d-4f29-9814-8c99c222a536&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0c759572-903d-4f29-9814-8c99c222a536&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:21,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;cd812828-3c87-4dd3-bb7d-e435fae30568&quot;,&quot;title&quot;:&quot;Contract: PoaNetworkConsensus [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/poa_network_consensus_test.js&quot;,&quot;file&quot;:&quot;/test/poa_network_consensus_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1472,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;141eadb1-a6de-4ebb-aecb-4a8ae9e512c3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b7c081ea-392b-42d7-8735-fa3fa809a727&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:229,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;masterOfCeremony = accounts[9];\nawait PoaNetworkConsensus.new(&#x27;0x0000000000000000000000000000000000000000&#x27;, []).should.be.rejectedWith(ERROR_MSG);\npoaNetworkConsensus = await PoaNetworkConsensus.new(masterOfCeremony, []).should.be.fulfilled;;\n\nproxyStorageMock = await ProxyStorageMock.new();\nconst proxyStorageEternalStorage = await EternalStorageProxy.new(0, proxyStorageMock.address);\nproxyStorageMock = await ProxyStorageMock.at(proxyStorageEternalStorage.address);\nawait proxyStorageMock.init(poaNetworkConsensus.address).should.be.fulfilled;\n\nawait poaNetworkConsensus.setProxyStorage(proxyStorageMock.address).should.be.fulfilled;\nawait poaNetworkConsensus.setProxyStorage(proxyStorageMock.address).should.be.rejectedWith(ERROR_MSG);\n\nawait proxyStorageMock.initializeAddresses(\n  accounts[0],\n  accounts[0],\n  accounts[0],\n  accounts[0],\n  accounts[0],\n  accounts[0],\n  accounts[0],\n  accounts[0]\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;36b9ab4a-660f-4e92-be94-6a2e24eb3e4d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0cd4fd43-1b49-4168-82bf-db5ec3493be0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3eeb11aa-086b-4257-8627-092057dab2ac&quot;,&quot;title&quot;:&quot;default values&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/poa_network_consensus_test.js&quot;,&quot;file&quot;:&quot;/test/poa_network_consensus_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;finalized should be false&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] default values finalized should be false&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let validators = await poaNetworkConsensus.getValidators.call();\nlet finalized = await poaNetworkConsensus.finalized.call();\nvalidators.should.be.deep.equal([\n  masterOfCeremony\n]);\nfinalized.should.be.false;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;98fbc6d0-1b80-4f07-b66d-599ddfe746d5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;checks systemAddress&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] default values checks systemAddress&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let systemAddress = await poaNetworkConsensus.systemAddress.call();\nsystemAddress.should.be.equal(&#x27;0xfffffffffffffffffffffffffffffffffffffffe&#x27;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6337d154-f92f-47cd-9f9d-7643d4b0a36e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;allows you to set current list of validators&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] default values allows you to set current list of validators&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:79,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let validatorsList = [accounts[2], accounts[3], accounts[4]];\nlet poa = await PoaNetworkConsensus.new(masterOfCeremony, validatorsList).should.be.fulfilled;\nlet validators = await poa.getValidators.call();\nvalidators.should.be.deep.equal([\n  masterOfCeremony,\n  ...validatorsList\n]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e1317c2d-a354-467f-a6a6-09ef21fa23c5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;validators in the list must differ&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] default values validators in the list must differ&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:128,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await PoaNetworkConsensus.new(\n  masterOfCeremony,\n  [masterOfCeremony, accounts[3], accounts[4]]\n).should.be.rejectedWith(ERROR_MSG);\nawait PoaNetworkConsensus.new(\n  masterOfCeremony,\n  [accounts[2], accounts[2], accounts[4]]\n).should.be.rejectedWith(ERROR_MSG);\nawait PoaNetworkConsensus.new(\n  masterOfCeremony,\n  [accounts[2], accounts[3], accounts[3]]\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;754c4d2f-6a95-4d66-a8d5-d3c53203b11d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;98fbc6d0-1b80-4f07-b66d-599ddfe746d5&quot;,&quot;6337d154-f92f-47cd-9f9d-7643d4b0a36e&quot;,&quot;e1317c2d-a354-467f-a6a6-09ef21fa23c5&quot;,&quot;754c4d2f-6a95-4d66-a8d5-d3c53203b11d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:236,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;259537a4-3531-4f0a-ac2a-cc937cd4dca0&quot;,&quot;title&quot;:&quot;#finalizeChange&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/poa_network_consensus_test.js&quot;,&quot;file&quot;:&quot;/test/poa_network_consensus_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should only be called by systemAddress&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #finalizeChange should only be called by systemAddress&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:65,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await poaNetworkConsensus.finalizeChange().should.be.rejectedWith(ERROR_MSG);\nawait poaNetworkConsensus.setSystemAddress(accounts[0]);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nawait poaNetworkConsensus.finalizeChange().should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;de08e773-fa8b-4cd4-8b81-7f6768f10a6f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set finalized to true&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #finalizeChange should set finalized to true&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let finalized = await poaNetworkConsensus.finalized.call();\nfinalized.should.be.false;\nawait poaNetworkConsensus.setSystemAddress(accounts[0]);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nfinalized = await poaNetworkConsensus.finalized.call();\nfinalized.should.be.true;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6b2433a0-75e7-4a54-8b54-7e580fb60282&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set currentValidators to pendingList&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #finalizeChange should set currentValidators to pendingList&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:75,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await poaNetworkConsensus.setSystemAddress(accounts[0]);\nconst { logs } = await poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nlet currentValidatorsLength = await poaNetworkConsensus.getCurrentValidatorsLength.call();\nlet currentValidators = [];\nlet pendingList = [];\nfor (let i = 0; i &lt; currentValidatorsLength.toNumber(10); i++) {\n  let validator = await poaNetworkConsensus.currentValidators.call(i);\n  currentValidators.push(validator);\n  let pending = await poaNetworkConsensus.pendingList.call(i);\n  pendingList.push(pending);\n}\ncurrentValidators.should.be.deep.equal(pendingList);\nlogs[0].event.should.be.equal(&#x27;ChangeFinalized&#x27;);\nlogs[0].args.newSet.should.be.deep.equal(currentValidators);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e02881b8-8dfd-4b7e-b67d-3302a7322f33&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;set currentValidators to pendingList after addValidator call&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #finalizeChange set currentValidators to pendingList after addValidator call&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:302,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await poaNetworkConsensus.addValidator(accounts[1], true, {from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait addValidator(accounts[1], true);\nawait poaNetworkConsensus.setSystemAddress(accounts[0]);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nlet currentValidatorsLength = await poaNetworkConsensus.getCurrentValidatorsLength.call();\nlet currentValidators = [];\nlet pendingList = [];\nfor (let i = 0; i &lt; currentValidatorsLength.toNumber(10); i++) {\n  let validator = await poaNetworkConsensus.currentValidators.call(i);\n  currentValidators.push(validator);\n  let pending = await poaNetworkConsensus.pendingList.call(i);\n  pendingList.push(pending);\n}\ncurrentValidators.should.be.deep.equal(pendingList);\nawait addValidator(accounts[2], true);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\ncurrentValidatorsLength = await poaNetworkConsensus.getCurrentValidatorsLength.call()\nconst expected = [masterOfCeremony, accounts[1], accounts[2]];\ncurrentValidatorsLength = await poaNetworkConsensus.getCurrentValidatorsLength.call();\ncurrentValidators = [];\npendingList = [];\nfor (let i = 0; i &lt; currentValidatorsLength.toNumber(10); i++) {\n  let validator = await poaNetworkConsensus.currentValidators.call(i);\n  currentValidators.push(validator);\n  let pending = await poaNetworkConsensus.pendingList.call(i);\n  pendingList.push(pending);\n}\nexpected.should.be.deep.equal(pendingList);\nexpected.should.be.deep.equal(currentValidators);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2d489900-307d-4ff3-b469-41e54cb00a70&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;de08e773-fa8b-4cd4-8b81-7f6768f10a6f&quot;,&quot;6b2433a0-75e7-4a54-8b54-7e580fb60282&quot;,&quot;e02881b8-8dfd-4b7e-b67d-3302a7322f33&quot;,&quot;2d489900-307d-4ff3-b469-41e54cb00a70&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:499,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;ae2eecd4-4e1d-418f-be46-bc017b20ac80&quot;,&quot;title&quot;:&quot;#addValidator&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/poa_network_consensus_test.js&quot;,&quot;file&quot;:&quot;/test/poa_network_consensus_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should only be called from keys manager&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #addValidator should only be called from keys manager&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:77,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await poaNetworkConsensus.addValidator(accounts[1], true, {from: accounts[2]}).should.be.rejectedWith(ERROR_MSG);\nawait proxyStorageMock.setKeysManagerMock(accounts[5]);\nawait addValidator(accounts[1], true, {from: accounts[5]});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;df21a920-7555-44dd-8e21-92781ba13413&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow to add already existing validator&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #addValidator should not allow to add already existing validator&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:80,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait addValidator(accounts[1], true);\nawait addValidator(accounts[1], false);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d931cf5c-9773-4c40-ab76-e4c5c4d6862f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not allow 0x0 addresses&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #addValidator should not allow 0x0 addresses&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:71,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait addValidator(&#x27;0x0&#x27;, false);\nawait addValidator(&#x27;0x0000000000000000000000000000000000000000&#x27;, false);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6d8be2a0-89df-4729-8c4f-2396ffc3c68e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set validatorsState for new validator&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #addValidator should set validatorsState for new validator&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:81,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait addValidator(accounts[1], true);\nlet state = await poaNetworkConsensus.validatorsState.call(accounts[1]);\nlet pendingList = await poaNetworkConsensus.getPendingList.call();\nstate[0].should.be.true;\nstate[2].should.be.bignumber.equal(pendingList.length - 1)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;137234b1-1d7e-4388-9b47-8480f4daac66&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set finalized to false&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #addValidator should set finalized to false&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:73,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait addValidator(accounts[1], true);\nlet finalized = await poaNetworkConsensus.finalized.call();\nfinalized.should.be.false;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a729f27a-d5d5-4f7a-8104-bcd072296af6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should emit InitiateChange with blockhash and pendingList as params&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #addValidator should emit InitiateChange with blockhash and pendingList as params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:178,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nconst {logs} = await poaNetworkConsensus.addValidator(accounts[1], true).should.be.fulfilled;\nlet currentValidatorsLength = await poaNetworkConsensus.getCurrentValidatorsLength.call();\nlet currentValidators = [];\nfor (let i = 0; i &lt; currentValidatorsLength.toNumber(10); i++) {\n  let validator = await poaNetworkConsensus.currentValidators.call(i);\n  currentValidators.push(validator);\n}\ncurrentValidators.push(accounts[1]);\nlogs[0].args[&#x27;newSet&#x27;].should.deep.equal(currentValidators);  \nlogs[0].event.should.be.equal(&#x27;InitiateChange&#x27;);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cfdb57d5-b4a3-432c-8ae2-dc363f695d48&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;df21a920-7555-44dd-8e21-92781ba13413&quot;,&quot;d931cf5c-9773-4c40-ab76-e4c5c4d6862f&quot;,&quot;6d8be2a0-89df-4729-8c4f-2396ffc3c68e&quot;,&quot;137234b1-1d7e-4388-9b47-8480f4daac66&quot;,&quot;a729f27a-d5d5-4f7a-8104-bcd072296af6&quot;,&quot;cfdb57d5-b4a3-432c-8ae2-dc363f695d48&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:560,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;02cf3b13-d2db-4795-9eee-792d310dc928&quot;,&quot;title&quot;:&quot;#swapValidatorKey&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/poa_network_consensus_test.js&quot;,&quot;file&quot;:&quot;/test/poa_network_consensus_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should swap validator key&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #swapValidatorKey should swap validator key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:268,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait poaNetworkConsensus.setSystemAddress(accounts[0]);\nawait addValidator(accounts[1], true);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\n(await poaNetworkConsensus.getCurrentValidatorsLength.call()).should.be.bignumber.equal(2);\n(await poaNetworkConsensus.isValidator.call(accounts[1])).should.be.equal(true);\n(await poaNetworkConsensus.isValidator.call(accounts[2])).should.be.equal(false);\n\nawait swapValidatorKey(accounts[2], accounts[3], false);\nawait swapValidatorKey(accounts[2], accounts[1], true);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\n(await poaNetworkConsensus.getCurrentValidatorsLength.call()).should.be.bignumber.equal(2);\n(await poaNetworkConsensus.isValidator.call(accounts[1])).should.be.equal(false);\n(await poaNetworkConsensus.isValidator.call(accounts[2])).should.be.equal(true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fe9c2765-25d7-43ee-8f2d-7d76ee06c2b7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should swap MoC&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #swapValidatorKey should swap MoC&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:257,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait poaNetworkConsensus.setSystemAddress(accounts[0]);\n(await poaNetworkConsensus.getCurrentValidatorsLength.call()).should.be.bignumber.equal(1);\n(await poaNetworkConsensus.isValidator.call(masterOfCeremony)).should.be.equal(true);\n(await poaNetworkConsensus.isValidator.call(accounts[1])).should.be.equal(false);\n(await poaNetworkConsensus.masterOfCeremony.call()).should.be.equal(masterOfCeremony);\n(await poaNetworkConsensus.masterOfCeremonyPending.call()).should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);\n\nawait swapValidatorKey(accounts[1], masterOfCeremony, true);\n(await poaNetworkConsensus.masterOfCeremonyPending.call()).should.be.equal(accounts[1]);\n(await poaNetworkConsensus.isMasterOfCeremonyRemovedPending.call()).should.be.equal(false);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\n(await poaNetworkConsensus.getCurrentValidatorsLength.call()).should.be.bignumber.equal(1);\n(await poaNetworkConsensus.isValidator.call(masterOfCeremony)).should.be.equal(false);\n(await poaNetworkConsensus.isValidator.call(accounts[1])).should.be.equal(true);\n(await poaNetworkConsensus.masterOfCeremony.call()).should.be.equal(accounts[1]);\n(await poaNetworkConsensus.masterOfCeremonyPending.call()).should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);\n(await poaNetworkConsensus.isMasterOfCeremonyRemoved.call()).should.be.equal(false);\n(await poaNetworkConsensus.isMasterOfCeremonyRemovedPending.call()).should.be.equal(false);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5f550017-e2ef-4841-8f3d-db446f77064f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;fe9c2765-25d7-43ee-8f2d-7d76ee06c2b7&quot;,&quot;5f550017-e2ef-4841-8f3d-db446f77064f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:525,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;ac2a07f3-8375-41bc-bdfc-39e889216b5e&quot;,&quot;title&quot;:&quot;#removeValidator&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/poa_network_consensus_test.js&quot;,&quot;file&quot;:&quot;/test/poa_network_consensus_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should remove validator&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #removeValidator should remove validator&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:97,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait addValidator(accounts[1], true);\nawait removeValidator(accounts[1], true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f265d222-6c2a-497c-b695-9abac459399f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should remove MoC&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #removeValidator should remove MoC&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:235,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\n(await poaNetworkConsensus.isValidator.call(masterOfCeremony)).should.be.equal(true);\n(await poaNetworkConsensus.masterOfCeremony.call()).should.be.equal(masterOfCeremony);\n(await poaNetworkConsensus.isMasterOfCeremonyRemoved.call()).should.be.equal(false);\n(await poaNetworkConsensus.isMasterOfCeremonyRemovedPending.call()).should.be.equal(false);\n(await poaNetworkConsensus.getCurrentValidatorsLength.call()).should.be.bignumber.equal(1);\nawait removeValidator(masterOfCeremony, true);\n(await poaNetworkConsensus.isMasterOfCeremonyRemoved.call()).should.be.equal(false);\n(await poaNetworkConsensus.isMasterOfCeremonyRemovedPending.call()).should.be.equal(true);\nawait poaNetworkConsensus.setSystemAddress(accounts[0]);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\n(await poaNetworkConsensus.getCurrentValidatorsLength.call()).should.be.bignumber.equal(0);\n(await poaNetworkConsensus.isValidator.call(masterOfCeremony)).should.be.equal(false);\n(await poaNetworkConsensus.masterOfCeremony.call()).should.be.equal(masterOfCeremony);\n(await poaNetworkConsensus.isMasterOfCeremonyRemoved.call()).should.be.equal(true);\n(await poaNetworkConsensus.isMasterOfCeremonyRemovedPending.call()).should.be.equal(false);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a0119be5-df0e-4b4f-b547-d372027ea5f5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should only be called from keys manager&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #removeValidator should only be called from keys manager&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:120,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await removeValidator(accounts[1], false);\nawait proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait addValidator(accounts[1], true);\nawait removeValidator(accounts[1], true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;831a2d61-4810-45d1-94a8-0e4ef2318541&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should only be allowed to remove from existing set of validators&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #removeValidator should only be allowed to remove from existing set of validators&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:51,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait removeValidator(accounts[1], false);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2828040d-0193-466c-9b1f-d9a37e06184c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should decrease length of pendingList&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #removeValidator should decrease length of pendingList&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:377,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait addValidator(accounts[1], true);\nawait poaNetworkConsensus.setSystemAddress(accounts[0]);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nawait addValidator(accounts[2], true);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nlet currentValidatorsLength = await poaNetworkConsensus.getCurrentValidatorsLength.call();\nlet pendingList = [];\nfor(let i = 0; i &lt; currentValidatorsLength; i++){\n  let pending = await poaNetworkConsensus.pendingList.call(i);\n  pendingList.push(pending);\n}\nconst indexOfRemovedElement = pendingList.indexOf(accounts[1]);\npendingList.splice(indexOfRemovedElement, 1);\nconst { logs } = await poaNetworkConsensus.removeValidator(accounts[1],true).should.be.fulfilled;\nlet pendingListFromContract = logs[0].args[&#x27;newSet&#x27;];\npendingListFromContract.length.should.be.equal(currentValidatorsLength.toNumber(10) - 1);\npendingList.should.be.deep.equal(pendingListFromContract);\nlogs[0].event.should.be.equal(&#x27;InitiateChange&#x27;);\nconst expected = [masterOfCeremony, accounts[2]];\nexpected.should.be.deep.equal(pendingList);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;66e4c607-2738-4908-b922-1c88615e3e76&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change validatorsState&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #removeValidator should change validatorsState&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:101,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait addValidator(accounts[1], true);\nawait removeValidator(accounts[1], true);\nconst state = await poaNetworkConsensus.validatorsState.call(accounts[1]);\nstate[0].should.be.false;\nstate[2].should.be.bignumber.equal(0);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8ed9890a-146b-492e-b9ff-4bca02ee422e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should set finalized to false&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #removeValidator should set finalized to false&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:93,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setKeysManagerMock(accounts[0]);\nawait addValidator(accounts[1], true);\nawait removeValidator(accounts[1], true);\nconst finalized = await poaNetworkConsensus.finalized.call();\nfinalized.should.be.false;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6485f534-5919-4040-94b6-98b7c0950609&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f265d222-6c2a-497c-b695-9abac459399f&quot;,&quot;a0119be5-df0e-4b4f-b547-d372027ea5f5&quot;,&quot;831a2d61-4810-45d1-94a8-0e4ef2318541&quot;,&quot;2828040d-0193-466c-9b1f-d9a37e06184c&quot;,&quot;66e4c607-2738-4908-b922-1c88615e3e76&quot;,&quot;8ed9890a-146b-492e-b9ff-4bca02ee422e&quot;,&quot;6485f534-5919-4040-94b6-98b7c0950609&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1074,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;a36ae83b-179a-4f4d-a076-2f8b040b9a00&quot;,&quot;title&quot;:&quot;#setProxyStorage&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/poa_network_consensus_test.js&quot;,&quot;file&quot;:&quot;/test/poa_network_consensus_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;can be called by MoC&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #setProxyStorage can be called by MoC&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:58,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await poaNetworkConsensus.setWasProxyStorageSetMock(false);\nawait poaNetworkConsensus.setProxyStorage(accounts[5], {from: accounts[6]}).should.be.rejectedWith(ERROR_MSG);\nawait poaNetworkConsensus.setProxyStorage(accounts[5], {from: masterOfCeremony}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ed350dde-893f-4c22-94e7-ed2a6a6cd838&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;can be called by owner&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #setProxyStorage can be called by owner&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:52,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await poaNetworkConsensus.setWasProxyStorageSetMock(false);\nawait poaNetworkConsensus.setProxyStorage(accounts[5], {from: accounts[6]}).should.be.rejectedWith(ERROR_MSG);\nawait poaNetworkConsensus.setProxyStorage(accounts[5], {from: accounts[0]}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b97a5450-0cba-46d8-a4fe-2d80024cbfb9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;can only be called once&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #setProxyStorage can only be called once&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// we already call it in the beforeEach block, hence why I expect it to be rejected\nawait poaNetworkConsensus.setProxyStorage(nonOwner, {from: nonOwner}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;22e4234f-2e76-48df-8b93-18f54091e1cc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot be set to 0x0 address&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #setProxyStorage cannot be set to 0x0 address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await poaNetworkConsensus.setWasProxyStorageSetMock(false);\nawait poaNetworkConsensus.setProxyStorage(&#x27;0x0000000000000000000000000000000000000000&#x27;, {from: masterOfCeremony}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f767d424-7dd0-4bec-b4bc-0ebfb6d21659&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets proxyStorage&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #setProxyStorage sets proxyStorage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let newProxyStorage = accounts[3];\nawait poaNetworkConsensus.setWasProxyStorageSetMock(false);\nawait poaNetworkConsensus.setProxyStorage(newProxyStorage, {from: masterOfCeremony}).should.be.fulfilled;\n(await poaNetworkConsensus.proxyStorage.call()).should.be.equal(newProxyStorage);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e2046aac-81ea-4363-88d1-83a307bf9d03&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets wasProxyStorageSet&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #setProxyStorage sets wasProxyStorageSet&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let newProxyStorage = accounts[3];\nawait poaNetworkConsensus.setWasProxyStorageSetMock(false);\nawait poaNetworkConsensus.setProxyStorage(newProxyStorage, {from: masterOfCeremony}).should.be.fulfilled;\n(await poaNetworkConsensus.wasProxyStorageSet.call()).should.be.equal(true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b2c7db2e-ff7b-4457-b436-025cdb9eee7b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;emits MoCInitializedProxyStorage&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #setProxyStorage emits MoCInitializedProxyStorage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let newProxyStorage = accounts[3];\nawait poaNetworkConsensus.setWasProxyStorageSetMock(false);\nconst {logs} = await poaNetworkConsensus.setProxyStorage(newProxyStorage, {from: masterOfCeremony}).should.be.fulfilled;\nlogs[0].event.should.be.equal(&#x27;MoCInitializedProxyStorage&#x27;);\nlogs[0].args.proxyStorage.should.be.equal(newProxyStorage);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c5272606-31f6-4365-8814-675ef26b7dfb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;#getKeysManager&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #setProxyStorage #getKeysManager&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let newKeysManager = accounts[3];\nawait poaNetworkConsensus.setWasProxyStorageSetMock(false);\nawait proxyStorageMock.setKeysManagerMock(newKeysManager);\n(await poaNetworkConsensus.getKeysManager.call()).should.be.equal(newKeysManager);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6315d85d-7f1a-46f6-a152-27d5391830a7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ed350dde-893f-4c22-94e7-ed2a6a6cd838&quot;,&quot;b97a5450-0cba-46d8-a4fe-2d80024cbfb9&quot;,&quot;22e4234f-2e76-48df-8b93-18f54091e1cc&quot;,&quot;f767d424-7dd0-4bec-b4bc-0ebfb6d21659&quot;,&quot;e2046aac-81ea-4363-88d1-83a307bf9d03&quot;,&quot;b2c7db2e-ff7b-4457-b436-025cdb9eee7b&quot;,&quot;c5272606-31f6-4365-8814-675ef26b7dfb&quot;,&quot;6315d85d-7f1a-46f6-a152-27d5391830a7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:350,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;5b457b68-cc03-444b-bf55-6d15ceb030f1&quot;,&quot;title&quot;:&quot;#isValidator&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/poa_network_consensus_test.js&quot;,&quot;file&quot;:&quot;/test/poa_network_consensus_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns true for validator&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #isValidator returns true for validator&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await poaNetworkConsensus.isValidator.call(masterOfCeremony)).should.be.equal(true);\n(await poaNetworkConsensus.isValidator.call(accounts[2])).should.be.equal(false);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4f333383-1c6c-4438-b00b-27b9365be3e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4f333383-1c6c-4438-b00b-27b9365be3e6&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:20,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;c057448e-2a33-402e-87b6-5af58f57c3f7&quot;,&quot;title&quot;:&quot;#isValidatorFinalized&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/poa_network_consensus_test.js&quot;,&quot;file&quot;:&quot;/test/poa_network_consensus_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns true for finalized validator&quot;,&quot;fullTitle&quot;:&quot;Contract: PoaNetworkConsensus [all features] #isValidatorFinalized returns true for finalized validator&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1431,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await poaNetworkConsensus.isValidatorFinalized.call(masterOfCeremony)).should.be.equal(true);\n(await poaNetworkConsensus.validatorsState.call(masterOfCeremony))[1].should.be.equal(true);\nfor (let i = 1; i &lt;= 4; i++) {\n  (await poaNetworkConsensus.isValidatorFinalized.call(accounts[i])).should.be.equal(false);\n  (await poaNetworkConsensus.validatorsState.call(accounts[i]))[1].should.be.equal(false);\n}\nawait poaNetworkConsensus.setSystemAddress(accounts[0]);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\n(await poaNetworkConsensus.finalized.call()).should.be.true;\n(await poaNetworkConsensus.isValidatorFinalized.call(masterOfCeremony)).should.be.equal(true);\n(await poaNetworkConsensus.validatorsState.call(masterOfCeremony))[1].should.be.equal(true);\nfor (let i = 1; i &lt;= 4; i++) {\n  (await poaNetworkConsensus.isValidatorFinalized.call(accounts[i])).should.be.equal(false);\n  (await poaNetworkConsensus.validatorsState.call(accounts[i]))[1].should.be.equal(false);\n}\nfor (let i = 1; i &lt;= 4; i++) {\n  await addValidator(accounts[i], true);\n}\nfor (let i = 1; i &lt;= 4; i++) {\n  (await poaNetworkConsensus.isValidatorFinalized.call(accounts[i])).should.be.equal(false);\n  (await poaNetworkConsensus.validatorsState.call(accounts[i]))[1].should.be.equal(false);\n}\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\n\nfor (let i = 1; i &lt;= 4; i++) {\n  (await poaNetworkConsensus.isValidatorFinalized.call(accounts[i])).should.be.equal(true);\n  (await poaNetworkConsensus.validatorsState.call(accounts[i]))[1].should.be.equal(true);\n}\n(await poaNetworkConsensus.getValidators.call()).should.be.deep.equal(\n  await poaNetworkConsensus.getPendingList.call()\n);\n(await poaNetworkConsensus.getValidators.call()).should.be.deep.equal([\n  masterOfCeremony, accounts[1], accounts[2], accounts[3], accounts[4]\n]);\nawait swapValidatorKey(accounts[5], accounts[1], true);\n(await poaNetworkConsensus.getValidators.call()).should.not.be.deep.equal(\n  await poaNetworkConsensus.getPendingList.call()\n);\n(await poaNetworkConsensus.isValidatorFinalized.call(accounts[1])).should.be.equal(false);\n(await poaNetworkConsensus.validatorsState.call(accounts[1]))[1].should.be.equal(false);\nfor (let i = 2; i &lt;= 4; i++) {\n  (await poaNetworkConsensus.isValidatorFinalized.call(accounts[i])).should.be.equal(true);\n  (await poaNetworkConsensus.validatorsState.call(accounts[i]))[1].should.be.equal(true);\n}\n(await poaNetworkConsensus.isValidatorFinalized.call(accounts[5])).should.be.equal(false);\n(await poaNetworkConsensus.validatorsState.call(accounts[5]))[1].should.be.equal(false);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\n(await poaNetworkConsensus.getValidators.call()).should.be.deep.equal(\n  await poaNetworkConsensus.getPendingList.call()\n);\n(await poaNetworkConsensus.isValidatorFinalized.call(accounts[1])).should.be.equal(false);\n(await poaNetworkConsensus.validatorsState.call(accounts[1]))[1].should.be.equal(false);\nfor (let i = 2; i &lt;= 5; i++) {\n  (await poaNetworkConsensus.isValidatorFinalized.call(accounts[i])).should.be.equal(true);\n  (await poaNetworkConsensus.validatorsState.call(accounts[i]))[1].should.be.equal(true);\n}\nawait removeValidator(accounts[1], false);\nawait removeValidator(accounts[3], true);\n(await poaNetworkConsensus.isValidatorFinalized.call(masterOfCeremony)).should.be.equal(true);\n(await poaNetworkConsensus.validatorsState.call(masterOfCeremony))[1].should.be.equal(true);\n(await poaNetworkConsensus.isValidatorFinalized.call(accounts[1])).should.be.equal(false);\n(await poaNetworkConsensus.validatorsState.call(accounts[1]))[1].should.be.equal(false);\n(await poaNetworkConsensus.isValidatorFinalized.call(accounts[2])).should.be.equal(true);\n(await poaNetworkConsensus.validatorsState.call(accounts[2]))[1].should.be.equal(true);\n(await poaNetworkConsensus.isValidatorFinalized.call(accounts[3])).should.be.equal(false);\n(await poaNetworkConsensus.validatorsState.call(accounts[3]))[1].should.be.equal(false);\n(await poaNetworkConsensus.isValidatorFinalized.call(accounts[4])).should.be.equal(true);\n(await poaNetworkConsensus.validatorsState.call(accounts[4]))[1].should.be.equal(true);\n(await poaNetworkConsensus.isValidatorFinalized.call(accounts[5])).should.be.equal(true);\n(await poaNetworkConsensus.validatorsState.call(accounts[5]))[1].should.be.equal(true);\n(await poaNetworkConsensus.isValidatorFinalized.call(accounts[6])).should.be.equal(false);\n(await poaNetworkConsensus.validatorsState.call(accounts[6]))[1].should.be.equal(false);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\n(await poaNetworkConsensus.isValidatorFinalized.call(masterOfCeremony)).should.be.equal(true);\n(await poaNetworkConsensus.validatorsState.call(masterOfCeremony))[1].should.be.equal(true);\n(await poaNetworkConsensus.isValidatorFinalized.call(accounts[1])).should.be.equal(false);\n(await poaNetworkConsensus.validatorsState.call(accounts[1]))[1].should.be.equal(false);\n(await poaNetworkConsensus.isValidatorFinalized.call(accounts[2])).should.be.equal(true);\n(await poaNetworkConsensus.validatorsState.call(accounts[2]))[1].should.be.equal(true);\n(await poaNetworkConsensus.isValidatorFinalized.call(accounts[3])).should.be.equal(false);\n(await poaNetworkConsensus.validatorsState.call(accounts[3]))[1].should.be.equal(false);\n(await poaNetworkConsensus.isValidatorFinalized.call(accounts[4])).should.be.equal(true);\n(await poaNetworkConsensus.validatorsState.call(accounts[4]))[1].should.be.equal(true);\n(await poaNetworkConsensus.isValidatorFinalized.call(accounts[5])).should.be.equal(true);\n(await poaNetworkConsensus.validatorsState.call(accounts[5]))[1].should.be.equal(true);\n(await poaNetworkConsensus.isValidatorFinalized.call(accounts[6])).should.be.equal(false);\n(await poaNetworkConsensus.validatorsState.call(accounts[6]))[1].should.be.equal(false);\n(await poaNetworkConsensus.getValidators.call()).should.be.deep.equal([\n  masterOfCeremony, accounts[4], accounts[2], accounts[5]\n]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d8d63c49-1c25-492a-a7fb-545b207c4c68&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d8d63c49-1c25-492a-a7fb-545b207c4c68&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1431,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;11696d82-4c5b-497b-abba-a9d3f2c64e3b&quot;,&quot;title&quot;:&quot;Contract: ProxyStorage [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/proxy_storage_test.js&quot;,&quot;file&quot;:&quot;/test/proxy_storage_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1056,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;be4ab281-dee4-43d0-817d-fec27cd39d9d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;59929ffd-9aa5-4e4a-9b46-8801410603ae&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:942,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;masterOfCeremony = accounts[0];\npoaNetworkConsensus = await PoaNetworkConsensus.new(masterOfCeremony, []);\n\nproxyStorage = await ProxyStorageMock.new();\nproxyStorageEternalStorage = await EternalStorageProxy.new(0, proxyStorage.address);\nproxyStorage = await ProxyStorageMock.at(proxyStorageEternalStorage.address);\nawait proxyStorage.init(poaNetworkConsensus.address).should.be.fulfilled;\n(await proxyStorageEternalStorage.getProxyStorage.call()).should.be.equal(\n  proxyStorageEternalStorage.address\n);\nkeysManager = await KeysManager.new();\nkeysManagerEternalStorage = await EternalStorageProxy.new(proxyStorage.address, keysManager.address);\nkeysManager = await KeysManager.at(keysManagerEternalStorage.address);\nvalidatorMetadata = await ValidatorMetadata.new();\nvalidatorMetadataEternalStorage = await EternalStorageProxy.new(proxyStorage.address, validatorMetadata.address);\n\nballotsStorage = await BallotsStorage.new();\nballotsEternalStorage = await EternalStorageProxy.new(proxyStorage.address, ballotsStorage.address);\nvotingToChangeKeys = await VotingToChangeKeys.new();\nvotingToChangeKeysEternalStorage = await EternalStorageProxy.new(proxyStorage.address, votingToChangeKeys.address);\nvotingToChangeMinThreshold = await VotingToChangeMinThreshold.new();\nvotingToChangeMinThresholdEternalStorage = await EternalStorageProxy.new(proxyStorage.address, votingToChangeMinThreshold.address);\nvotingToChangeProxy = await VotingToChangeProxy.new();\nvotingToChangeProxyEternalStorage = await EternalStorageProxy.new(proxyStorage.address, votingToChangeProxy.address);\nvotingToManageEmissionFunds = await VotingToManageEmissionFunds.new();\nvotingToManageEmissionFundsEternalStorage = await EternalStorageProxy.new(proxyStorage.address, votingToManageEmissionFunds.address);\nrewardByBlock = await RewardByBlock.new();\nrewardByBlockEternalStorage = await EternalStorageProxy.new(proxyStorage.address, rewardByBlock.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3ef81482-b315-4e32-bc12-3e4eb0fec409&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e9a568c8-f94f-4276-b31e-65126095be60&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;864183fb-46c1-4bb1-a6b6-c8e0c527ed3d&quot;,&quot;title&quot;:&quot;#constructor&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/proxy_storage_test.js&quot;,&quot;file&quot;:&quot;/test/proxy_storage_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;sets PoA&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #constructor sets PoA&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;poaNetworkConsensus.address.should.be.equal(\n  await proxyStorage.getPoaConsensus.call()\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;78e1c9f8-8539-4585-8b85-4cd43046d88a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;78e1c9f8-8539-4585-8b85-4cd43046d88a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:27,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;2d2c22f4-d598-4c62-b698-5db272c8d3dc&quot;,&quot;title&quot;:&quot;#initializeAddresses&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/proxy_storage_test.js&quot;,&quot;file&quot;:&quot;/test/proxy_storage_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;sets all addresses&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #initializeAddresses sets all addresses&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:184,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.initializeAddresses(\n  keysManagerEternalStorage.address,\n  votingToChangeKeysEternalStorage.address,\n  votingToChangeMinThresholdEternalStorage.address,\n  votingToChangeProxyEternalStorage.address,\n  votingToManageEmissionFundsEternalStorage.address,\n  ballotsEternalStorage.address,\n  validatorMetadataEternalStorage.address,\n  rewardByBlockEternalStorage.address,\n  {from: accounts[2]}\n).should.be.rejectedWith(ERROR_MSG);\nconst {logs} = await proxyStorage.initializeAddresses(\n  keysManagerEternalStorage.address,\n  votingToChangeKeysEternalStorage.address,\n  votingToChangeMinThresholdEternalStorage.address,\n  votingToChangeProxyEternalStorage.address,\n  votingToManageEmissionFundsEternalStorage.address,\n  ballotsEternalStorage.address,\n  validatorMetadataEternalStorage.address,\n  rewardByBlockEternalStorage.address\n).should.be.fulfilled;\nkeysManagerEternalStorage.address.should.be.equal(\n  await proxyStorage.getKeysManager.call()\n);\nvotingToChangeKeysEternalStorage.address.should.be.equal(\n  await proxyStorage.getVotingToChangeKeys.call()\n);\nvotingToChangeMinThresholdEternalStorage.address.should.be.equal(\n  await proxyStorage.getVotingToChangeMinThreshold.call()\n);\nvotingToChangeProxyEternalStorage.address.should.be.equal(\n  await proxyStorage.getVotingToChangeProxy.call()\n);\nvotingToManageEmissionFundsEternalStorage.address.should.be.equal(\n  await proxyStorage.getVotingToManageEmissionFunds.call()\n);\nballotsEternalStorage.address.should.be.equal(\n  await proxyStorage.getBallotsStorage.call()\n);\nvalidatorMetadataEternalStorage.address.should.be.equal(\n  await proxyStorage.getValidatorMetadata.call()\n);\nrewardByBlockEternalStorage.address.should.be.equal(\n  await proxyStorage.getRewardByBlock.call()\n);\nlogs[0].event.should.be.equal(&#x27;ProxyInitialized&#x27;);\nlogs[0].args.keysManagerEternalStorage.should.be.equal(keysManagerEternalStorage.address);\nlogs[0].args.votingToChangeKeysEternalStorage.should.be.equal(votingToChangeKeysEternalStorage.address);\nlogs[0].args.votingToChangeMinThresholdEternalStorage.should.be.equal(votingToChangeMinThresholdEternalStorage.address);\nlogs[0].args.votingToChangeProxyEternalStorage.should.be.equal(votingToChangeProxyEternalStorage.address);\nlogs[0].args.votingToManageEmissionFundsEternalStorage.should.be.equal(votingToManageEmissionFundsEternalStorage.address);\nlogs[0].args.ballotsStorageEternalStorage.should.be.equal(ballotsEternalStorage.address);\nlogs[0].args.validatorMetadataEternalStorage.should.be.equal(validatorMetadataEternalStorage.address);\nlogs[0].args.rewardByBlockEternalStorage.should.be.equal(rewardByBlockEternalStorage.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;06564859-0c11-463b-859e-d28fee364b9f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;prevents Moc to call it more than once&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #initializeAddresses prevents Moc to call it more than once&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:85,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;false.should.be.equal(await proxyStorage.mocInitialized.call());\nconst {logs} = await proxyStorage.initializeAddresses(\n  keysManagerEternalStorage.address,\n  votingToChangeKeysEternalStorage.address,\n  votingToChangeMinThresholdEternalStorage.address,\n  votingToChangeProxyEternalStorage.address,\n  votingToManageEmissionFundsEternalStorage.address,\n  ballotsEternalStorage.address,\n  validatorMetadataEternalStorage.address,\n  rewardByBlockEternalStorage.address\n).should.be.fulfilled;\ntrue.should.be.equal(await proxyStorage.mocInitialized.call());\nawait proxyStorage.initializeAddresses(\n  keysManagerEternalStorage.address,\n  votingToChangeKeysEternalStorage.address,\n  votingToChangeMinThresholdEternalStorage.address,\n  votingToChangeProxyEternalStorage.address,\n  votingToManageEmissionFundsEternalStorage.address,\n  ballotsEternalStorage.address,\n  validatorMetadataEternalStorage.address,\n  rewardByBlockEternalStorage.address\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4f76f52b-cc26-44d6-87a8-96b4d0387ccf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;06564859-0c11-463b-859e-d28fee364b9f&quot;,&quot;4f76f52b-cc26-44d6-87a8-96b4d0387ccf&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:269,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;61fa4db9-6f40-4c89-9555-c46ebe77a9f0&quot;,&quot;title&quot;:&quot;#setContractAddress&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/proxy_storage_test.js&quot;,&quot;file&quot;:&quot;/test/proxy_storage_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.initializeAddresses(\n  keysManagerEternalStorage.address,\n  votingToChangeKeysEternalStorage.address,\n  votingToChangeMinThresholdEternalStorage.address,\n  votingToChangeProxyEternalStorage.address,\n  votingToManageEmissionFundsEternalStorage.address,\n  ballotsEternalStorage.address,\n  validatorMetadataEternalStorage.address,\n  rewardByBlockEternalStorage.address,\n  {from: masterOfCeremony}\n).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b6e75230-5bf7-49df-bdcd-4014f79576e1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;can only be called from votingToChangeProxy address&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress can only be called from votingToChangeProxy address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:259,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.setContractAddress(1, accounts[2], {from: accounts[0]}).should.be.rejectedWith(ERROR_MSG);\nawait proxyStorage.setVotingToChangeProxyMock(accounts[4]);\nawait setContractAddress(1, accounts[2], true, {from: accounts[4]});\nawait proxyStorage.setVotingToChangeProxyMock(votingToChangeProxyEternalStorage.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f4c9103f-68d6-407a-896e-28df3dea4aa8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot be set to 0x0 address&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress cannot be set to 0x0 address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:58,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.setVotingToChangeProxyMock(accounts[4]);\nawait setContractAddress(1, &#x27;0x0000000000000000000000000000000000000000&#x27;, false, {from: accounts[4]});\nawait proxyStorage.setVotingToChangeProxyMock(votingToChangeProxyEternalStorage.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7fc415ec-381e-4040-8a90-c6ece4071ae8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets keysManager&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress sets keysManager&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:145,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let keysManagerNew = await KeysManager.new();\nawait proxyStorage.setVotingToChangeProxyMock(accounts[4]);\nawait setContractAddress(1, keysManagerNew.address, true, {from: accounts[4]});\nawait proxyStorage.setVotingToChangeProxyMock(votingToChangeProxyEternalStorage.address);\n\nlet eternalProxyAddress = await proxyStorage.getKeysManager.call();\nlet eternalProxy = await EternalStorageProxy.at(eternalProxyAddress);\nkeysManagerNew.address.should.be.equal(\n  await eternalProxy.implementation.call()\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;267934bf-8781-48d8-acfa-8e23997149b5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets votingToChangeKeys&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress sets votingToChangeKeys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:253,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let votingToChangeKeysNew = await VotingToChangeKeys.new();\nawait proxyStorage.setVotingToChangeProxyMock(accounts[4]);\nawait setContractAddress(2, votingToChangeKeysNew.address, true, {from: accounts[4]});\nawait proxyStorage.setVotingToChangeProxyMock(votingToChangeProxyEternalStorage.address);\n\nlet eternalProxyAddress = await proxyStorage.getVotingToChangeKeys.call();\nlet eternalProxy = await EternalStorageProxy.at(eternalProxyAddress);\nvotingToChangeKeysNew.address.should.be.equal(\n  await eternalProxy.implementation.call()\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3bb2e161-26ea-4b60-b974-157dcb774a53&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets votingToChangeMinThreshold&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress sets votingToChangeMinThreshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:153,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let votingToChangeMinThresholdNew = await VotingToChangeMinThreshold.new();\nawait proxyStorage.setVotingToChangeProxyMock(accounts[4]);\nawait setContractAddress(3, votingToChangeMinThresholdNew.address, true, {from: accounts[4]});\nawait proxyStorage.setVotingToChangeProxyMock(votingToChangeProxyEternalStorage.address);\n\nlet eternalProxyAddress = await proxyStorage.getVotingToChangeMinThreshold.call();\nlet eternalProxy = await EternalStorageProxy.at(eternalProxyAddress);\nvotingToChangeMinThresholdNew.address.should.be.equal(\n  await eternalProxy.implementation.call()\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9bca2300-e87c-40f9-a5b5-2b4d22399416&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets ballotsStorage&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress sets ballotsStorage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:197,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let ballotsStorageNew = await BallotsStorage.new();\nawait proxyStorage.setVotingToChangeProxyMock(accounts[4]);\nawait setContractAddress(5, ballotsStorageNew.address, true, {from: accounts[4]});\nawait proxyStorage.setVotingToChangeProxyMock(votingToChangeProxyEternalStorage.address);\n\nlet eternalProxyAddress = await proxyStorage.getBallotsStorage.call();\nlet eternalProxy = await EternalStorageProxy.at(eternalProxyAddress);\nballotsStorageNew.address.should.be.equal(\n  await eternalProxy.implementation.call()\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;63ca6d5a-4bfb-4b26-b029-600d1767600f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets poaConsensus&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress sets poaConsensus&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:179,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.setVotingToChangeProxyMock(accounts[4]);\nawait setContractAddress(6, accounts[5], true, {from: accounts[4]});\nawait proxyStorage.setVotingToChangeProxyMock(votingToChangeProxyEternalStorage.address);\naccounts[5].should.be.equal(\n  await proxyStorage.getPoaConsensus.call()\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b10f125e-bada-46ca-af7b-dbb143150360&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets validatorMetadata&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress sets validatorMetadata&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:159,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let validatorMetadataNew = await ValidatorMetadata.new();\n\nawait proxyStorage.setVotingToChangeProxyMock(accounts[4]);\nawait setContractAddress(7, validatorMetadataNew.address, true, {from: accounts[4]});\nawait proxyStorage.setVotingToChangeProxyMock(votingToChangeProxyEternalStorage.address);\n\nlet eternalProxyAddress = await proxyStorage.getValidatorMetadata.call();\nlet eternalProxy = await EternalStorageProxy.at(eternalProxyAddress);\nvalidatorMetadataNew.address.should.be.equal(\n  await eternalProxy.implementation.call()\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;259260c0-ced1-42b4-918e-f8715d146aa9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;changes proxyStorage (itself) implementation&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #setContractAddress changes proxyStorage (itself) implementation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:148,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const oldVersion = await proxyStorageEternalStorage.version.call();\nconst newVersion = oldVersion.add(1);\nlet proxyStorageNew = await ProxyStorageMock.new();\nawait proxyStorage.setVotingToChangeProxyMock(accounts[4]);\nawait setContractAddress(8, proxyStorageNew.address, true, {from: accounts[4]});\nawait proxyStorage.setVotingToChangeProxyMock(votingToChangeProxyEternalStorage.address);\n\nproxyStorageNew.address.should.be.equal(\n  await proxyStorageEternalStorage.implementation.call()\n);\nnewVersion.should.be.bignumber.equal(\n  await proxyStorageEternalStorage.version.call()\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;142f7fff-6f4e-4024-9b9e-950e03fce793&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f4c9103f-68d6-407a-896e-28df3dea4aa8&quot;,&quot;7fc415ec-381e-4040-8a90-c6ece4071ae8&quot;,&quot;267934bf-8781-48d8-acfa-8e23997149b5&quot;,&quot;3bb2e161-26ea-4b60-b974-157dcb774a53&quot;,&quot;9bca2300-e87c-40f9-a5b5-2b4d22399416&quot;,&quot;63ca6d5a-4bfb-4b26-b029-600d1767600f&quot;,&quot;b10f125e-bada-46ca-af7b-dbb143150360&quot;,&quot;259260c0-ced1-42b4-918e-f8715d146aa9&quot;,&quot;142f7fff-6f4e-4024-9b9e-950e03fce793&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1551,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;5f14e7e5-9dd9-467a-bdf5-6ab886db4d7a&quot;,&quot;title&quot;:&quot;#upgradeTo&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/proxy_storage_test.js&quot;,&quot;file&quot;:&quot;/test/proxy_storage_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called by ProxyStorage (itself)&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #upgradeTo may only be called by ProxyStorage (itself)&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:239,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const proxyStorageNew = await ProxyStorageNew.new();\n(await proxyStorageEternalStorage.getProxyStorage.call()).should.be.equal(\n  proxyStorageEternalStorage.address\n);\nawait proxyStorageEternalStorage.upgradeTo(proxyStorageNew.address, {from: accounts[0]}).should.be.rejectedWith(ERROR_MSG);\nawait proxyStorageEternalStorage.setProxyStorage(accounts[0]);\nawait upgradeTo(proxyStorageNew.address, {from: accounts[0]});\n(await proxyStorageEternalStorage.implementation.call()).should.be.equal(\n  proxyStorageNew.address\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9eba8b10-ed1d-4a32-83c5-79a23aa58959&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change implementation address&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #upgradeTo should change implementation address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:127,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const proxyStorageNew = await ProxyStorageNew.new();\nawait proxyStorageEternalStorage.setProxyStorage(accounts[0]);\nawait upgradeTo(proxyStorageNew.address, {from: accounts[0]});\nawait proxyStorageEternalStorage.setProxyStorage(proxyStorageEternalStorage.address);\n(await proxyStorageEternalStorage.implementation.call()).should.be.equal(\n  proxyStorageNew.address\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fa18a3b2-549d-40aa-addc-8fc1cafe8528&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should increment implementation version&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #upgradeTo should increment implementation version&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:136,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let proxyStorageNew = await ProxyStorageNew.new();\nconst oldVersion = await proxyStorageEternalStorage.version.call();\nconst newVersion = oldVersion.add(1);\nawait proxyStorageEternalStorage.setProxyStorage(accounts[0]);\nawait upgradeTo(proxyStorageNew.address, {from: accounts[0]});\nawait proxyStorageEternalStorage.setProxyStorage(proxyStorageEternalStorage.address);\n(await proxyStorageEternalStorage.version.call()).should.be.bignumber.equal(newVersion);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7cbbc086-24e7-4fc2-8dc3-9b74cc29b957&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should work&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #upgradeTo new implementation should work&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:193,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let proxyStorageNew = await ProxyStorageNew.new();\nawait proxyStorageEternalStorage.setProxyStorage(accounts[0]);\nawait upgradeTo(proxyStorageNew.address, {from: accounts[0]});\nawait proxyStorageEternalStorage.setProxyStorage(proxyStorageEternalStorage.address);\nproxyStorageNew = await ProxyStorageNew.at(proxyStorageEternalStorage.address);\n(await proxyStorageNew.initialized.call()).should.be.equal(false);\nawait proxyStorageNew.initialize();\n(await proxyStorageNew.initialized.call()).should.be.equal(true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;49d43f58-def3-426c-9650-d34f172b1a1d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should use the same storage&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage [all features] #upgradeTo new implementation should use the same storage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:137,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let proxyStorageNew = await ProxyStorageNew.new();\nawait proxyStorageEternalStorage.setProxyStorage(accounts[0]);\nawait upgradeTo(proxyStorageNew.address, {from: accounts[0]});\nawait proxyStorageEternalStorage.setProxyStorage(proxyStorageEternalStorage.address);\nproxyStorageNew = await ProxyStorageNew.at(proxyStorageEternalStorage.address);\n(await proxyStorageNew.getPoaConsensus.call()).should.be.equal(poaNetworkConsensus.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ba1ada00-b512-4377-a80e-9833a65197d9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9eba8b10-ed1d-4a32-83c5-79a23aa58959&quot;,&quot;fa18a3b2-549d-40aa-addc-8fc1cafe8528&quot;,&quot;7cbbc086-24e7-4fc2-8dc3-9b74cc29b957&quot;,&quot;49d43f58-def3-426c-9650-d34f172b1a1d&quot;,&quot;ba1ada00-b512-4377-a80e-9833a65197d9&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:832,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;46c53f6d-8e0a-4220-aa20-f5d3d125bde8&quot;,&quot;title&quot;:&quot;Contract: ProxyStorage upgraded [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/proxy_storage_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/proxy_storage_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage upgraded [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1545,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;be1ceb62-ac9c-461a-ab46-b2aadf659ea4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage upgraded [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0437b712-1684-4fea-b73c-aed78cf2725d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage upgraded [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:961,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;masterOfCeremony = accounts[0];\npoaNetworkConsensus = await PoaNetworkConsensus.new(masterOfCeremony, []);\n\nproxyStorage = await ProxyStorageMock.new();\nproxyStorageEternalStorage = await EternalStorageProxy.new(0, proxyStorage.address);\nproxyStorage = await ProxyStorageMock.at(proxyStorageEternalStorage.address);\nawait proxyStorage.init(poaNetworkConsensus.address).should.be.fulfilled;\n(await proxyStorageEternalStorage.getProxyStorage.call()).should.be.equal(\n  proxyStorageEternalStorage.address\n);\nconst proxyStorageNew = await ProxyStorageNew.new();\nawait proxyStorageEternalStorage.setProxyStorage(accounts[6]);\nconst {logs} = await proxyStorageEternalStorage.upgradeTo(proxyStorageNew.address, {from: accounts[6]});\nlogs[0].event.should.be.equal(\&quot;Upgraded\&quot;);\nawait proxyStorageEternalStorage.setProxyStorage(proxyStorageEternalStorage.address);\nproxyStorage = await ProxyStorageNew.at(proxyStorageEternalStorage.address);\nkeysManager = await KeysManager.new();\nkeysManagerEternalStorage = await EternalStorageProxy.new(proxyStorage.address, keysManager.address);\nkeysManager = await KeysManager.at(keysManagerEternalStorage.address);\nvalidatorMetadata = await ValidatorMetadata.new();\nvalidatorMetadataEternalStorage = await EternalStorageProxy.new(proxyStorage.address, validatorMetadata.address);\n\nballotsStorage = await BallotsStorage.new();\nballotsEternalStorage = await EternalStorageProxy.new(proxyStorage.address, ballotsStorage.address);\nvotingToChangeKeys = await VotingToChangeKeys.new();\nvotingToChangeKeysEternalStorage = await EternalStorageProxy.new(proxyStorage.address, votingToChangeKeys.address);\nvotingToChangeMinThreshold = await VotingToChangeMinThreshold.new();\nvotingToChangeMinThresholdEternalStorage = await EternalStorageProxy.new(proxyStorage.address, votingToChangeMinThreshold.address);\nvotingToChangeProxy = await VotingToChangeProxy.new();\nvotingToChangeProxyEternalStorage = await EternalStorageProxy.new(proxyStorage.address, votingToChangeProxy.address);\nvotingToManageEmissionFunds = await VotingToManageEmissionFunds.new();\nvotingToManageEmissionFundsEternalStorage = await EternalStorageProxy.new(proxyStorage.address, votingToManageEmissionFunds.address);\nrewardByBlock = await RewardByBlock.new();\nrewardByBlockEternalStorage = await EternalStorageProxy.new(proxyStorage.address, rewardByBlock.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2748463a-70db-44c1-abcb-d7a415180179&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage upgraded [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d55af65f-e5df-439f-85b7-6e626c18e69b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;4ee46b6a-e2d5-41a9-9c54-faf27b28e17b&quot;,&quot;title&quot;:&quot;#constructor&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/proxy_storage_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/proxy_storage_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;sets PoA&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage upgraded [all features] #constructor sets PoA&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;poaNetworkConsensus.address.should.be.equal(\n  await proxyStorage.getPoaConsensus.call()\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;06493542-7709-444f-962a-942d9ba59748&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;06493542-7709-444f-962a-942d9ba59748&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:15,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;5d28476f-96b7-4ae8-833a-f918cd34c0b9&quot;,&quot;title&quot;:&quot;#initializeAddresses&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/proxy_storage_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/proxy_storage_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;sets all addresses&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage upgraded [all features] #initializeAddresses sets all addresses&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:154,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.initializeAddresses(\n  keysManagerEternalStorage.address,\n  votingToChangeKeysEternalStorage.address,\n  votingToChangeMinThresholdEternalStorage.address,\n  votingToChangeProxyEternalStorage.address,\n  votingToManageEmissionFundsEternalStorage.address,\n  ballotsEternalStorage.address,\n  validatorMetadataEternalStorage.address,\n  rewardByBlockEternalStorage.address,\n  {from: accounts[2]}\n).should.be.rejectedWith(ERROR_MSG);\nconst {logs} = await proxyStorage.initializeAddresses(\n  keysManagerEternalStorage.address,\n  votingToChangeKeysEternalStorage.address,\n  votingToChangeMinThresholdEternalStorage.address,\n  votingToChangeProxyEternalStorage.address,\n  votingToManageEmissionFundsEternalStorage.address,\n  ballotsEternalStorage.address,\n  validatorMetadataEternalStorage.address,\n  rewardByBlockEternalStorage.address\n).should.be.fulfilled;\nkeysManagerEternalStorage.address.should.be.equal(\n  await proxyStorage.getKeysManager.call()\n);\nvotingToChangeKeysEternalStorage.address.should.be.equal(\n  await proxyStorage.getVotingToChangeKeys.call()\n);\nvotingToChangeMinThresholdEternalStorage.address.should.be.equal(\n  await proxyStorage.getVotingToChangeMinThreshold.call()\n);\nvotingToChangeProxyEternalStorage.address.should.be.equal(\n  await proxyStorage.getVotingToChangeProxy.call()\n);\nvotingToManageEmissionFundsEternalStorage.address.should.be.equal(\n  await proxyStorage.getVotingToManageEmissionFunds.call()\n);\nballotsEternalStorage.address.should.be.equal(\n  await proxyStorage.getBallotsStorage.call()\n);\nvalidatorMetadataEternalStorage.address.should.be.equal(\n  await proxyStorage.getValidatorMetadata.call()\n);\nrewardByBlockEternalStorage.address.should.be.equal(\n  await proxyStorage.getRewardByBlock.call()\n);\nlogs[0].event.should.be.equal(&#x27;ProxyInitialized&#x27;);\nlogs[0].args.keysManagerEternalStorage.should.be.equal(keysManagerEternalStorage.address);\nlogs[0].args.votingToChangeKeysEternalStorage.should.be.equal(votingToChangeKeysEternalStorage.address);\nlogs[0].args.votingToChangeMinThresholdEternalStorage.should.be.equal(votingToChangeMinThresholdEternalStorage.address);\nlogs[0].args.votingToChangeProxyEternalStorage.should.be.equal(votingToChangeProxyEternalStorage.address);\nlogs[0].args.votingToManageEmissionFundsEternalStorage.should.be.equal(votingToManageEmissionFundsEternalStorage.address);\nlogs[0].args.ballotsStorageEternalStorage.should.be.equal(ballotsEternalStorage.address);\nlogs[0].args.validatorMetadataEternalStorage.should.be.equal(validatorMetadataEternalStorage.address);\nlogs[0].args.rewardByBlockEternalStorage.should.be.equal(rewardByBlockEternalStorage.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5d110e7d-692c-4d50-b85d-c7fe1f6533ca&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;prevents Moc to call it more than once&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage upgraded [all features] #initializeAddresses prevents Moc to call it more than once&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:94,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;false.should.be.equal(await proxyStorage.mocInitialized.call());\nconst {logs} = await proxyStorage.initializeAddresses(\n  keysManagerEternalStorage.address,\n  votingToChangeKeysEternalStorage.address,\n  votingToChangeMinThresholdEternalStorage.address,\n  votingToChangeProxyEternalStorage.address,\n  votingToManageEmissionFundsEternalStorage.address,\n  ballotsEternalStorage.address,\n  validatorMetadataEternalStorage.address,\n  rewardByBlockEternalStorage.address\n).should.be.fulfilled;\ntrue.should.be.equal(await proxyStorage.mocInitialized.call());\nawait proxyStorage.initializeAddresses(\n  keysManagerEternalStorage.address,\n  votingToChangeKeysEternalStorage.address,\n  votingToChangeMinThresholdEternalStorage.address,\n  votingToChangeProxyEternalStorage.address,\n  votingToManageEmissionFundsEternalStorage.address,\n  ballotsEternalStorage.address,\n  validatorMetadataEternalStorage.address,\n  rewardByBlockEternalStorage.address\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;72910d8c-d6e1-4498-8bf5-f7fa8b2495d7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5d110e7d-692c-4d50-b85d-c7fe1f6533ca&quot;,&quot;72910d8c-d6e1-4498-8bf5-f7fa8b2495d7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:248,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;6bb70fb9-040e-4c9d-8b10-18f8f068a0e4&quot;,&quot;title&quot;:&quot;#setContractAddress&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/proxy_storage_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/proxy_storage_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage upgraded [all features] #setContractAddress \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.initializeAddresses(\n  keysManagerEternalStorage.address,\n  votingToChangeKeysEternalStorage.address,\n  votingToChangeMinThresholdEternalStorage.address,\n  votingToChangeProxyEternalStorage.address,\n  votingToManageEmissionFundsEternalStorage.address,\n  ballotsEternalStorage.address,\n  validatorMetadataEternalStorage.address,\n  rewardByBlockEternalStorage.address,\n  {from: masterOfCeremony}\n).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c05255bc-d802-4aa9-95df-3e43337c94b1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;can only be called from votingToChangeProxy address&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage upgraded [all features] #setContractAddress can only be called from votingToChangeProxy address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:94,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.setContractAddress(1, accounts[2], {from: accounts[0]}).should.be.rejectedWith(ERROR_MSG);\nawait proxyStorage.setVotingToChangeProxyMock(accounts[4]);\nawait setContractAddress(1, accounts[2], true, {from: accounts[4]});\nawait proxyStorage.setVotingToChangeProxyMock(votingToChangeProxyEternalStorage.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;311d203a-765b-4156-ae99-06eb35368675&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot be set to 0x0 address&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage upgraded [all features] #setContractAddress cannot be set to 0x0 address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:70,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.setVotingToChangeProxyMock(accounts[4]);\nawait setContractAddress(1, &#x27;0x0000000000000000000000000000000000000000&#x27;, false, {from: accounts[4]});\nawait proxyStorage.setVotingToChangeProxyMock(votingToChangeProxyEternalStorage.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0161fea0-a39e-4955-a7e0-4f411d698848&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets keysManager&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage upgraded [all features] #setContractAddress sets keysManager&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:162,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let keysManagerNew = await KeysManager.new();\nawait proxyStorage.setVotingToChangeProxyMock(accounts[4]);\nawait setContractAddress(1, keysManagerNew.address, true, {from: accounts[4]});\nawait proxyStorage.setVotingToChangeProxyMock(votingToChangeProxyEternalStorage.address);\n\nlet eternalProxyAddress = await proxyStorage.getKeysManager.call();\nlet eternalProxy = await EternalStorageProxy.at(eternalProxyAddress);\nkeysManagerNew.address.should.be.equal(\n  await eternalProxy.implementation.call()\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e2ccf3a6-5fd0-453e-bd94-45754294af28&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets votingToChangeKeys&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage upgraded [all features] #setContractAddress sets votingToChangeKeys&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:147,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let votingToChangeKeysNew = await VotingToChangeKeys.new();\nawait proxyStorage.setVotingToChangeProxyMock(accounts[4]);\nawait setContractAddress(2, votingToChangeKeysNew.address, true, {from: accounts[4]});\nawait proxyStorage.setVotingToChangeProxyMock(votingToChangeProxyEternalStorage.address);\n\nlet eternalProxyAddress = await proxyStorage.getVotingToChangeKeys.call();\nlet eternalProxy = await EternalStorageProxy.at(eternalProxyAddress);\nvotingToChangeKeysNew.address.should.be.equal(\n  await eternalProxy.implementation.call()\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f5e741e3-8515-4ac9-8e7b-0926d0c847e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets votingToChangeMinThreshold&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage upgraded [all features] #setContractAddress sets votingToChangeMinThreshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:157,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let votingToChangeMinThresholdNew = await VotingToChangeMinThreshold.new();\nawait proxyStorage.setVotingToChangeProxyMock(accounts[4]);\nawait setContractAddress(3, votingToChangeMinThresholdNew.address, true, {from: accounts[4]});\nawait proxyStorage.setVotingToChangeProxyMock(votingToChangeProxyEternalStorage.address);\n\nlet eternalProxyAddress = await proxyStorage.getVotingToChangeMinThreshold.call();\nlet eternalProxy = await EternalStorageProxy.at(eternalProxyAddress);\nvotingToChangeMinThresholdNew.address.should.be.equal(\n  await eternalProxy.implementation.call()\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f6e1ae89-3609-4511-8258-670879a839d6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets ballotsStorage&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage upgraded [all features] #setContractAddress sets ballotsStorage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:134,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let ballotsStorageNew = await BallotsStorage.new();\nawait proxyStorage.setVotingToChangeProxyMock(accounts[4]);\nawait setContractAddress(5, ballotsStorageNew.address, true, {from: accounts[4]});\nawait proxyStorage.setVotingToChangeProxyMock(votingToChangeProxyEternalStorage.address);\n\nlet eternalProxyAddress = await proxyStorage.getBallotsStorage.call();\nlet eternalProxy = await EternalStorageProxy.at(eternalProxyAddress);\nballotsStorageNew.address.should.be.equal(\n  await eternalProxy.implementation.call()\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;101b0e3a-1ea2-4324-83e1-6aa3141ce2b9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets poaConsensus&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage upgraded [all features] #setContractAddress sets poaConsensus&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:82,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorage.setVotingToChangeProxyMock(accounts[4]);\nawait setContractAddress(6, accounts[5], true, {from: accounts[4]});\nawait proxyStorage.setVotingToChangeProxyMock(votingToChangeProxyEternalStorage.address);\naccounts[5].should.be.equal(\n  await proxyStorage.getPoaConsensus.call()\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;98cf4b14-2087-4dad-a941-2f461edf48f4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;sets validatorMetadata&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage upgraded [all features] #setContractAddress sets validatorMetadata&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:153,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let validatorMetadataNew = await ValidatorMetadata.new();\n\nawait proxyStorage.setVotingToChangeProxyMock(accounts[4]);\nawait setContractAddress(7, validatorMetadataNew.address, true, {from: accounts[4]});\nawait proxyStorage.setVotingToChangeProxyMock(votingToChangeProxyEternalStorage.address);\n\nlet eternalProxyAddress = await proxyStorage.getValidatorMetadata.call();\nlet eternalProxy = await EternalStorageProxy.at(eternalProxyAddress);\nvalidatorMetadataNew.address.should.be.equal(\n  await eternalProxy.implementation.call()\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;04bbcd54-ce70-4674-b927-3934374fa6a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;changes proxyStorage (itself) implementation&quot;,&quot;fullTitle&quot;:&quot;Contract: ProxyStorage upgraded [all features] #setContractAddress changes proxyStorage (itself) implementation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:154,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const oldVersion = await proxyStorageEternalStorage.version.call();\nconst newVersion = oldVersion.add(1);\nlet proxyStorageNew = await ProxyStorageMock.new();\nawait proxyStorage.setVotingToChangeProxyMock(accounts[4]);\nawait setContractAddress(8, proxyStorageNew.address, true, {from: accounts[4]});\nawait proxyStorage.setVotingToChangeProxyMock(votingToChangeProxyEternalStorage.address);\n\nproxyStorageNew.address.should.be.equal(\n  await proxyStorageEternalStorage.implementation.call()\n);\nnewVersion.should.be.bignumber.equal(\n  await proxyStorageEternalStorage.version.call()\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1be17557-3ebf-4575-b2ef-7d61c22158d0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;311d203a-765b-4156-ae99-06eb35368675&quot;,&quot;0161fea0-a39e-4955-a7e0-4f411d698848&quot;,&quot;e2ccf3a6-5fd0-453e-bd94-45754294af28&quot;,&quot;f5e741e3-8515-4ac9-8e7b-0926d0c847e6&quot;,&quot;f6e1ae89-3609-4511-8258-670879a839d6&quot;,&quot;101b0e3a-1ea2-4324-83e1-6aa3141ce2b9&quot;,&quot;98cf4b14-2087-4dad-a941-2f461edf48f4&quot;,&quot;04bbcd54-ce70-4674-b927-3934374fa6a1&quot;,&quot;1be17557-3ebf-4575-b2ef-7d61c22158d0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1153,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;dc375028-965f-49ed-b898-38e441e032d1&quot;,&quot;title&quot;:&quot;Contract: RewardByBlock [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/reward_by_block_test.js&quot;,&quot;file&quot;:&quot;/test/reward_by_block_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1419,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2c6f99ba-a1e5-433d-96ef-139d5a0b5aeb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8b51d676-3af7-4a61-8180-2875a6232992&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1011,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;coinbase = accounts[0];\nmasterOfCeremony = accounts[0];\nminingKey = accounts[1];\nminingKey2 = accounts[2];\nminingKey3 = accounts[3];\npayoutKey = accounts[4];\npayoutKey2 = accounts[5];\npayoutKey3 = accounts[6];\nsystemAddress = accounts[7];\nvotingToChangeKeys = accounts[9];\npoaNetworkConsensus = await PoaNetworkConsensus.new(masterOfCeremony, []);\nproxyStorage = await ProxyStorage.new();\nconst proxyStorageEternalStorage = await EternalStorageProxy.new(0, proxyStorage.address);\nproxyStorage = await ProxyStorage.at(proxyStorageEternalStorage.address);\nawait proxyStorage.init(poaNetworkConsensus.address).should.be.fulfilled;\nawait poaNetworkConsensus.setProxyStorage(proxyStorage.address);\nkeysManager = await KeysManager.new();\nconst keysManagerEternalStorage = await EternalStorageProxy.new(proxyStorage.address, keysManager.address);\nkeysManager = await KeysManager.at(keysManagerEternalStorage.address);\nawait keysManager.init(\n  \&quot;0x0000000000000000000000000000000000000000\&quot;\n).should.be.fulfilled;\nconst validatorMetadata = await ValidatorMetadata.new();\nconst validatorMetadataEternalStorage = await EternalStorageProxy.new(proxyStorage.address, validatorMetadata.address);\nawait proxyStorage.initializeAddresses(\n  keysManagerEternalStorage.address,\n  votingToChangeKeys,\n  accounts[9],\n  accounts[9],\n  accounts[9],\n  accounts[9],\n  validatorMetadataEternalStorage.address,\n  accounts[9]\n);\nawait addMiningKey(miningKey);\nawait addMiningKey(miningKey2);\nawait addMiningKey(miningKey3);\nawait addPayoutKey(payoutKey, miningKey);\nawait addPayoutKey(payoutKey2, miningKey2);\nawait addPayoutKey(payoutKey3, miningKey3);\nawait poaNetworkConsensus.setSystemAddress(coinbase);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nawait poaNetworkConsensus.setSystemAddress(&#x27;0xffffFFFfFFffffffffffffffFfFFFfffFFFfFFfE&#x27;);\nrewardByBlock = await RewardByBlock.new();\nrewardByBlockOldImplementation = rewardByBlock.address;\nrewardByBlockEternalStorage = await EternalStorageProxy.new(proxyStorage.address, rewardByBlock.address);\nrewardByBlock = await RewardByBlock.at(rewardByBlockEternalStorage.address);\nblockRewardAmount = web3.toWei(1, &#x27;ether&#x27;);\nemissionFundsAmount = web3.toWei(1, &#x27;ether&#x27;);\nemissionFundsAddress = &#x27;0x0000000000000000000000000000000000000000&#x27;;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bb06166a-bd0b-497a-bca2-a391bdac5144&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;94559937-f789-4331-860a-286ca97e58d4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ba4da9f3-8401-4a32-bd58-3ad7a0a881c2&quot;,&quot;title&quot;:&quot;#reward&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/reward_by_block_test.js&quot;,&quot;file&quot;:&quot;/test/reward_by_block_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called by system address&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock [all features] #reward may only be called by system address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:118,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await rewardByBlock.reward([miningKey], [0]).should.be.rejectedWith(ERROR_MSG);\nawait rewardByBlock.setSystemAddress(systemAddress);\nawait rewardByBlock.reward([miningKey], [0], {from: systemAddress}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f968fb1b-ac00-42fc-8ed6-e058dc340b19&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if input array contains more than one item&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock [all features] #reward should revert if input array contains more than one item&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:36,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await rewardByBlock.setSystemAddress(systemAddress);\nawait rewardByBlock.reward(\n  [miningKey, miningKey2],\n  [0, 0],\n  {from: systemAddress}\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6e2c89f5-ddf8-4e3d-aa31-a1065e9985cb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if lengths of input arrays are not equal&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock [all features] #reward should revert if lengths of input arrays are not equal&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:34,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await rewardByBlock.setSystemAddress(systemAddress);\nawait rewardByBlock.reward(\n  [miningKey],\n  [0, 0],\n  {from: systemAddress}\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;91d35ca6-5622-455b-b68e-6da4e07d0ac7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if `kind` parameter is not 0&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock [all features] #reward should revert if `kind` parameter is not 0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await rewardByBlock.setSystemAddress(systemAddress);\nawait rewardByBlock.reward(\n  [miningKey],\n  [1],\n  {from: systemAddress}\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;10ee50c2-b9ad-46f1-9b65-09bc49638308&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if mining key does not exist&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock [all features] #reward should revert if mining key does not exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:271,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await keysManager.removeMiningKey(miningKey3, {from: votingToChangeKeys});\nlogs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nawait rewardByBlock.setSystemAddress(systemAddress);\nawait rewardByBlock.reward(\n  [miningKey3],\n  [0],\n  {from: systemAddress}\n).should.be.rejectedWith(ERROR_MSG);\nawait rewardByBlock.reward(\n  [miningKey2],\n  [0],\n  {from: systemAddress}\n).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f95efa76-94b4-4e3a-9f2b-29a374db7210&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should assign rewards to payout key and EmissionFunds&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock [all features] #reward should assign rewards to payout key and EmissionFunds&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1111,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await rewardByBlock.mintedForAccount.call(payoutKey)).should.be.bignumber.equal(0);\n(await rewardByBlock.mintedForAccount.call(emissionFundsAddress)).should.be.bignumber.equal(0);\n(await rewardByBlock.mintedForAccountInBlock.call(payoutKey, web3.eth.blockNumber)).should.be.bignumber.equal(0);\n(await rewardByBlock.mintedForAccountInBlock.call(emissionFundsAddress, web3.eth.blockNumber)).should.be.bignumber.equal(0);\n(await rewardByBlock.mintedInBlock.call(web3.eth.blockNumber)).should.be.bignumber.equal(0);\n(await rewardByBlock.mintedTotally.call()).should.be.bignumber.equal(0);\nawait rewardByBlock.setSystemAddress(systemAddress);\nconst {logs} = await rewardByBlock.reward(\n  [miningKey],\n  [0],\n  {from: systemAddress}\n).should.be.fulfilled;\nlogs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\nlogs[0].args.receivers.should.be.deep.equal([payoutKey, emissionFundsAddress]);\nlogs[0].args.rewards[0].toString().should.be.equal(blockRewardAmount.toString());\nlogs[0].args.rewards[1].toString().should.be.equal(emissionFundsAmount.toString());\n(await rewardByBlock.mintedForAccount.call(payoutKey)).should.be.bignumber.equal(blockRewardAmount);\n(await rewardByBlock.mintedForAccount.call(emissionFundsAddress)).should.be.bignumber.equal(emissionFundsAmount);\n(await rewardByBlock.mintedForAccountInBlock.call(payoutKey, web3.eth.blockNumber)).should.be.bignumber.equal(blockRewardAmount);\n(await rewardByBlock.mintedForAccountInBlock.call(emissionFundsAddress, web3.eth.blockNumber)).should.be.bignumber.equal(emissionFundsAmount);\nconst totalMinted = web3.toBigNumber(blockRewardAmount).plus(emissionFundsAmount);\n(await rewardByBlock.mintedInBlock.call(web3.eth.blockNumber)).should.be.bignumber.equal(totalMinted);\n(await rewardByBlock.mintedTotally.call()).should.be.bignumber.equal(totalMinted);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1c5e4971-adac-4fd7-a822-a23030249331&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should assign reward to mining key if payout key is 0&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock [all features] #reward should assign reward to mining key if payout key is 0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:164,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = await keysManager.removePayoutKey(\n  miningKey,\n  {from: votingToChangeKeys}\n);\nresult.logs[0].event.should.be.equal(\&quot;PayoutKeyChanged\&quot;);\nawait rewardByBlock.setSystemAddress(systemAddress);\nconst {logs} = await rewardByBlock.reward(\n  [miningKey],\n  [0],\n  {from: systemAddress}\n).should.be.fulfilled;\nlogs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\nlogs[0].args.receivers.should.be.deep.equal([miningKey, emissionFundsAddress]);\nlogs[0].args.rewards[0].toString().should.be.equal(blockRewardAmount.toString());\nlogs[0].args.rewards[1].toString().should.be.equal(emissionFundsAmount.toString());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;18b0f630-e643-44a6-a0fc-98b2896bc916&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should assign rewards to extra receivers and clear extra receivers list&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock [all features] #reward should assign rewards to extra receivers and clear extra receivers list&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1583,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await rewardByBlock.bridgeAmount.call(accounts[1])).should.be.bignumber.equal(0);\n(await rewardByBlock.bridgeAmount.call(accounts[2])).should.be.bignumber.equal(0);\n(await rewardByBlock.bridgeAmount.call(accounts[3])).should.be.bignumber.equal(0);\nawait rewardByBlock.addExtraReceiver(2, accounts[2], {from: accounts[1]}).should.be.fulfilled;\nawait rewardByBlock.addExtraReceiver(3, accounts[3], {from: accounts[1]}).should.be.fulfilled;\n(await rewardByBlock.bridgeAmount.call(accounts[1])).should.be.bignumber.equal(5);\n(await rewardByBlock.bridgeAmount.call(accounts[2])).should.be.bignumber.equal(0);\n(await rewardByBlock.bridgeAmount.call(accounts[3])).should.be.bignumber.equal(0);\n(await rewardByBlock.mintedTotallyByBridge.call(accounts[1])).should.be.bignumber.equal(0);\n(await rewardByBlock.mintedTotallyByBridge.call(accounts[2])).should.be.bignumber.equal(0);\n(await rewardByBlock.mintedTotallyByBridge.call(accounts[3])).should.be.bignumber.equal(0);\nawait rewardByBlock.setSystemAddress(systemAddress);\nlet result = await rewardByBlock.reward(\n  [miningKey],\n  [0],\n  {from: systemAddress}\n).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\nresult.logs[0].args.receivers.should.be.deep.equal([payoutKey, emissionFundsAddress, accounts[2], accounts[3]]);\nresult.logs[0].args.rewards[0].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[1].toString().should.be.equal(emissionFundsAmount.toString());\nresult.logs[0].args.rewards[2].toString().should.be.equal(&#x27;2&#x27;);\nresult.logs[0].args.rewards[3].toString().should.be.equal(&#x27;3&#x27;);\n(await rewardByBlock.extraReceiverAmount.call(accounts[2])).should.be.bignumber.equal(0);\n(await rewardByBlock.extraReceiverAmount.call(accounts[3])).should.be.bignumber.equal(0);\n(await rewardByBlock.extraReceiversLength.call()).should.be.bignumber.equal(0);\n(await rewardByBlock.bridgeAmount.call(accounts[1])).should.be.bignumber.equal(0);\n(await rewardByBlock.bridgeAmount.call(accounts[2])).should.be.bignumber.equal(0);\n(await rewardByBlock.bridgeAmount.call(accounts[3])).should.be.bignumber.equal(0);\n(await rewardByBlock.mintedTotallyByBridge.call(accounts[1])).should.be.bignumber.equal(5);\n(await rewardByBlock.mintedTotallyByBridge.call(accounts[2])).should.be.bignumber.equal(0);\n(await rewardByBlock.mintedTotallyByBridge.call(accounts[3])).should.be.bignumber.equal(0);\nawait rewardByBlock.addExtraReceiver(2, accounts[2], {from: accounts[1]}).should.be.fulfilled;\nawait rewardByBlock.addExtraReceiver(3, accounts[3], {from: accounts[1]}).should.be.fulfilled;\nresult = await rewardByBlock.reward(\n  [miningKey],\n  [0],\n  {from: systemAddress}\n).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\nresult.logs[0].args.receivers.should.be.deep.equal([payoutKey, emissionFundsAddress, accounts[2], accounts[3]]);\nresult.logs[0].args.rewards[0].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[1].toString().should.be.equal(emissionFundsAmount.toString());\nresult.logs[0].args.rewards[2].toString().should.be.equal(&#x27;2&#x27;);\nresult.logs[0].args.rewards[3].toString().should.be.equal(&#x27;3&#x27;);\n(await rewardByBlock.extraReceiverAmount.call(accounts[2])).should.be.bignumber.equal(0);\n(await rewardByBlock.extraReceiverAmount.call(accounts[3])).should.be.bignumber.equal(0);\n(await rewardByBlock.extraReceiversLength.call()).should.be.bignumber.equal(0);\n(await rewardByBlock.mintedTotallyByBridge.call(accounts[1])).should.be.bignumber.equal(10);\n(await rewardByBlock.mintedTotallyByBridge.call(accounts[2])).should.be.bignumber.equal(0);\n(await rewardByBlock.mintedTotallyByBridge.call(accounts[3])).should.be.bignumber.equal(0);\n(await rewardByBlock.mintedForAccount.call(payoutKey)).should.be.bignumber.equal(blockRewardAmount * 2);\n(await rewardByBlock.mintedForAccount.call(emissionFundsAddress)).should.be.bignumber.equal(emissionFundsAmount * 2);\n(await rewardByBlock.mintedForAccount.call(accounts[2])).should.be.bignumber.equal(4);\n(await rewardByBlock.mintedForAccount.call(accounts[3])).should.be.bignumber.equal(6);\n\n(await rewardByBlock.mintedForAccountInBlock.call(payoutKey, web3.eth.blockNumber)).should.be.bignumber.equal(blockRewardAmount);\n(await rewardByBlock.mintedForAccountInBlock.call(emissionFundsAddress, web3.eth.blockNumber)).should.be.bignumber.equal(emissionFundsAmount);\n(await rewardByBlock.mintedForAccountInBlock.call(accounts[2], web3.eth.blockNumber)).should.be.bignumber.equal(2);\n(await rewardByBlock.mintedForAccountInBlock.call(accounts[3], web3.eth.blockNumber)).should.be.bignumber.equal(3);\n\n(await rewardByBlock.mintedInBlock.call(web3.eth.blockNumber)).should.be.bignumber.equal(\n  web3.toBigNumber(blockRewardAmount).plus(emissionFundsAmount).plus(2).plus(3)\n);\n(await rewardByBlock.mintedTotally.call()).should.be.bignumber.equal(\n  web3.toBigNumber(blockRewardAmount).plus(emissionFundsAmount).plus(2).plus(3).mul(2)\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c8d72d0b-eee1-4ee5-957d-8f878284789e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f968fb1b-ac00-42fc-8ed6-e058dc340b19&quot;,&quot;6e2c89f5-ddf8-4e3d-aa31-a1065e9985cb&quot;,&quot;91d35ca6-5622-455b-b68e-6da4e07d0ac7&quot;,&quot;10ee50c2-b9ad-46f1-9b65-09bc49638308&quot;,&quot;f95efa76-94b4-4e3a-9f2b-29a374db7210&quot;,&quot;1c5e4971-adac-4fd7-a822-a23030249331&quot;,&quot;18b0f630-e643-44a6-a0fc-98b2896bc916&quot;,&quot;c8d72d0b-eee1-4ee5-957d-8f878284789e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3348,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;55809eb2-8ab0-4d8f-9157-a530e92ae56e&quot;,&quot;title&quot;:&quot;#addExtraReceiver&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/reward_by_block_test.js&quot;,&quot;file&quot;:&quot;/test/reward_by_block_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called by bridge contract&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock [all features] #addExtraReceiver may only be called by bridge contract&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await rewardByBlock.addExtraReceiver(1, accounts[1]).should.be.rejectedWith(ERROR_MSG);\nawait rewardByBlock.addExtraReceiver(1, accounts[1], {from: accounts[2]}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fb2d9fac-4fe4-4cf4-a806-cf4b12e3ea37&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if receiver address is 0x0&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock [all features] #addExtraReceiver should revert if receiver address is 0x0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await rewardByBlock.addExtraReceiver(\n  1,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  {from: accounts[2]}\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;79d28466-b22d-4e96-bcdc-839f605758fb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if amount is 0&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock [all features] #addExtraReceiver should revert if amount is 0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await rewardByBlock.addExtraReceiver(\n  0,\n  accounts[1],\n  {from: accounts[2]}\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;110f1924-5e6c-451e-b7c9-46cf0c097ae7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;can be called repeatedly for the same recipient&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock [all features] #addExtraReceiver can be called repeatedly for the same recipient&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:535,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await rewardByBlock.bridgeAmount.call(accounts[1])).should.be.bignumber.equal(0);\n(await rewardByBlock.bridgeAmount.call(accounts[2])).should.be.bignumber.equal(0);\n(await rewardByBlock.bridgeAmount.call(accounts[3])).should.be.bignumber.equal(0);\nawait rewardByBlock.addExtraReceiver(\n  1,\n  accounts[1],\n  {from: accounts[2]}\n).should.be.fulfilled;\nawait rewardByBlock.addExtraReceiver(\n  2,\n  accounts[1],\n  {from: accounts[3]}\n).should.be.fulfilled;\n(await rewardByBlock.extraReceiversLength.call()).should.be.bignumber.equal(1);\n(await rewardByBlock.extraReceiverByIndex.call(0)).should.be.equal(accounts[1]);\n(await rewardByBlock.extraReceiverAmount.call(accounts[1])).should.be.bignumber.equal(3);\n(await rewardByBlock.bridgeAmount.call(accounts[1])).should.be.bignumber.equal(0);\n(await rewardByBlock.bridgeAmount.call(accounts[2])).should.be.bignumber.equal(1);\n(await rewardByBlock.bridgeAmount.call(accounts[3])).should.be.bignumber.equal(2);\nawait rewardByBlock.setSystemAddress(systemAddress);\nconst result = await rewardByBlock.reward(\n  [miningKey],\n  [0],\n  {from: systemAddress}\n).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\nresult.logs[0].args.receivers.should.be.deep.equal([payoutKey, emissionFundsAddress, accounts[1]]);\nresult.logs[0].args.rewards[0].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[1].toString().should.be.equal(emissionFundsAmount.toString());\nresult.logs[0].args.rewards[2].toString().should.be.equal(&#x27;3&#x27;);\n(await rewardByBlock.extraReceiversLength.call()).should.be.bignumber.equal(0);\n(await rewardByBlock.extraReceiverAmount.call(accounts[1])).should.be.bignumber.equal(0);\n(await rewardByBlock.bridgeAmount.call(accounts[1])).should.be.bignumber.equal(0);\n(await rewardByBlock.bridgeAmount.call(accounts[2])).should.be.bignumber.equal(0);\n(await rewardByBlock.bridgeAmount.call(accounts[3])).should.be.bignumber.equal(0);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;38ae8231-fd18-47d5-aa55-ce1ab18d54dd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should add receivers&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock [all features] #addExtraReceiver should add receivers&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:208,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await rewardByBlock.extraReceiverAmount.call(accounts[2])).should.be.bignumber.equal(0);\n(await rewardByBlock.extraReceiversLength.call()).should.be.bignumber.equal(0);\nlet result = await rewardByBlock.addExtraReceiver(2, accounts[2], {from: accounts[1]}).should.be.fulfilled;\n(await rewardByBlock.extraReceiverByIndex.call(0)).should.be.equal(accounts[2]);\n(await rewardByBlock.extraReceiverAmount.call(accounts[2])).should.be.bignumber.equal(2);\n(await rewardByBlock.extraReceiversLength.call()).should.be.bignumber.equal(1);\nresult.logs[0].event.should.be.equal(&#x27;AddedReceiver&#x27;);\nresult.logs[0].args.receiver.should.be.equal(accounts[2]);\nresult.logs[0].args.amount.should.be.bignumber.equal(2);\nresult.logs[0].args.bridge.should.be.equal(accounts[1]);\nresult = await rewardByBlock.addExtraReceiver(3, accounts[3], {from: accounts[1]}).should.be.fulfilled;\n(await rewardByBlock.extraReceiverByIndex.call(0)).should.be.equal(accounts[2]);\n(await rewardByBlock.extraReceiverByIndex.call(1)).should.be.equal(accounts[3]);\n(await rewardByBlock.extraReceiverAmount.call(accounts[2])).should.be.bignumber.equal(2);\n(await rewardByBlock.extraReceiverAmount.call(accounts[3])).should.be.bignumber.equal(3);\n(await rewardByBlock.extraReceiversLength.call()).should.be.bignumber.equal(2);\nresult.logs[0].event.should.be.equal(&#x27;AddedReceiver&#x27;);\nresult.logs[0].args.receiver.should.be.equal(accounts[3]);\nresult.logs[0].args.amount.should.be.bignumber.equal(3);\nresult.logs[0].args.bridge.should.be.equal(accounts[1]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;586c0c58-5573-4c5f-a3e5-9a924f994ec9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;fb2d9fac-4fe4-4cf4-a806-cf4b12e3ea37&quot;,&quot;79d28466-b22d-4e96-bcdc-839f605758fb&quot;,&quot;110f1924-5e6c-451e-b7c9-46cf0c097ae7&quot;,&quot;38ae8231-fd18-47d5-aa55-ce1ab18d54dd&quot;,&quot;586c0c58-5573-4c5f-a3e5-9a924f994ec9&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:834,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;29db6fa0-2f5c-4b63-a10e-536fb1715c69&quot;,&quot;title&quot;:&quot;#upgradeTo&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/reward_by_block_test.js&quot;,&quot;file&quot;:&quot;/test/reward_by_block_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called by ProxyStorage&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock [all features] #upgradeTo may only be called by ProxyStorage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:115,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const rewardByBlockNew = await RewardByBlockNew.new();\nawait rewardByBlockEternalStorage.setProxyStorage(proxyStorageStubAddress);\nawait rewardByBlockEternalStorage.upgradeTo(rewardByBlockNew.address, {from: accounts[0]}).should.be.rejectedWith(ERROR_MSG);\nawait upgradeTo(rewardByBlockNew.address, {from: proxyStorageStubAddress});\nawait rewardByBlockEternalStorage.setProxyStorage(proxyStorage.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9cbc9924-a3e9-412d-8acd-83d548b331aa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change implementation address&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock [all features] #upgradeTo should change implementation address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:123,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let rewardByBlockNew = await RewardByBlockNew.new();\nconst newImplementation = rewardByBlockNew.address;\n(await rewardByBlockEternalStorage.implementation.call()).should.be.equal(rewardByBlockOldImplementation);\nawait rewardByBlockEternalStorage.setProxyStorage(proxyStorageStubAddress);\nawait upgradeTo(newImplementation, {from: proxyStorageStubAddress});\nawait rewardByBlockEternalStorage.setProxyStorage(proxyStorage.address);\n(await rewardByBlockEternalStorage.implementation.call()).should.be.equal(newImplementation);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8bd07d67-c17a-4589-b9b8-b45ff4b58ded&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should increment implementation version&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock [all features] #upgradeTo should increment implementation version&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:119,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let rewardByBlockNew = await RewardByBlockNew.new();\nconst oldVersion = await rewardByBlockEternalStorage.version.call();\nconst newVersion = oldVersion.add(1);\nawait rewardByBlockEternalStorage.setProxyStorage(proxyStorageStubAddress);\nawait upgradeTo(rewardByBlockNew.address, {from: proxyStorageStubAddress});\nawait rewardByBlockEternalStorage.setProxyStorage(proxyStorage.address);\n(await rewardByBlockEternalStorage.version.call()).should.be.bignumber.equal(newVersion);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b1057628-7673-4d8d-98f8-d26bdb254bd1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should work&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock [all features] #upgradeTo new implementation should work&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:145,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let rewardByBlockNew = await RewardByBlockNew.new();\nawait rewardByBlockEternalStorage.setProxyStorage(proxyStorageStubAddress);\nawait upgradeTo(rewardByBlockNew.address, {from: proxyStorageStubAddress});\nawait rewardByBlockEternalStorage.setProxyStorage(proxyStorage.address);\nrewardByBlockNew = await RewardByBlockNew.at(rewardByBlockEternalStorage.address);\n(await rewardByBlockNew.initialized.call()).should.be.equal(false);\nawait rewardByBlockNew.initialize();\n(await rewardByBlockNew.initialized.call()).should.be.equal(true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1c5a585b-e261-4b9c-8c2f-5665101d58a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should use the same proxyStorage address&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock [all features] #upgradeTo new implementation should use the same proxyStorage address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:118,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let rewardByBlockNew = await RewardByBlockNew.new();\nawait rewardByBlockEternalStorage.setProxyStorage(proxyStorageStubAddress);\nawait upgradeTo(rewardByBlockNew.address, {from: proxyStorageStubAddress});\nrewardByBlockNew = await RewardByBlockNew.at(rewardByBlockEternalStorage.address);\n(await rewardByBlockNew.proxyStorage.call()).should.be.equal(proxyStorageStubAddress);\nawait rewardByBlockEternalStorage.setProxyStorage(proxyStorage.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;161f7979-d0d6-48ec-8450-c0265674be5e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9cbc9924-a3e9-412d-8acd-83d548b331aa&quot;,&quot;8bd07d67-c17a-4589-b9b8-b45ff4b58ded&quot;,&quot;b1057628-7673-4d8d-98f8-d26bdb254bd1&quot;,&quot;1c5a585b-e261-4b9c-8c2f-5665101d58a6&quot;,&quot;161f7979-d0d6-48ec-8450-c0265674be5e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:620,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;c2c3f724-5533-4f91-9949-afc5d7329196&quot;,&quot;title&quot;:&quot;Contract: RewardByBlock upgraded [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/reward_by_block_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/reward_by_block_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock upgraded [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1412,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;16673936-2158-4181-90f4-243d70e054b2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock upgraded [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d05dacb8-ad12-43ac-99f7-d92408f54a79&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock upgraded [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1031,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;coinbase = accounts[0];\nmasterOfCeremony = accounts[0];\nminingKey = accounts[1];\nminingKey2 = accounts[2];\nminingKey3 = accounts[3];\npayoutKey = accounts[4];\npayoutKey2 = accounts[5];\npayoutKey3 = accounts[6];\nsystemAddress = accounts[7];\nvotingToChangeKeys = accounts[9];\npoaNetworkConsensus = await PoaNetworkConsensus.new(masterOfCeremony, []);\nproxyStorage = await ProxyStorage.new();\nconst proxyStorageEternalStorage = await EternalStorageProxy.new(0, proxyStorage.address);\nproxyStorage = await ProxyStorage.at(proxyStorageEternalStorage.address);\nawait proxyStorage.init(poaNetworkConsensus.address).should.be.fulfilled;\nawait poaNetworkConsensus.setProxyStorage(proxyStorage.address);\nkeysManager = await KeysManager.new();\nconst keysManagerEternalStorage = await EternalStorageProxy.new(proxyStorage.address, keysManager.address);\nkeysManager = await KeysManager.at(keysManagerEternalStorage.address);\nawait keysManager.init(\n  \&quot;0x0000000000000000000000000000000000000000\&quot;\n).should.be.fulfilled;\nconst validatorMetadata = await ValidatorMetadata.new();\nconst validatorMetadataEternalStorage = await EternalStorageProxy.new(proxyStorage.address, validatorMetadata.address);\nawait proxyStorage.initializeAddresses(\n  keysManagerEternalStorage.address,\n  votingToChangeKeys,\n  accounts[9],\n  accounts[9],\n  accounts[9],\n  accounts[9],\n  validatorMetadataEternalStorage.address,\n  accounts[9]\n);\nawait addMiningKey(miningKey);\nawait addMiningKey(miningKey2);\nawait addMiningKey(miningKey3);\nawait addPayoutKey(payoutKey, miningKey);\nawait addPayoutKey(payoutKey2, miningKey2);\nawait addPayoutKey(payoutKey3, miningKey3);\nawait poaNetworkConsensus.setSystemAddress(coinbase);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nawait poaNetworkConsensus.setSystemAddress(&#x27;0xffffFFFfFFffffffffffffffFfFFFfffFFFfFFfE&#x27;);\nrewardByBlock = await RewardByBlock.new();\nrewardByBlockEternalStorage = await EternalStorageProxy.new(proxyStorage.address, rewardByBlock.address);\nrewardByBlock = await RewardByBlock.at(rewardByBlockEternalStorage.address);\nconst rewardByBlockNew = await RewardByBlockNew.new();\nawait rewardByBlockEternalStorage.setProxyStorage(accounts[8]);\nconst {logs} = await rewardByBlockEternalStorage.upgradeTo(rewardByBlockNew.address, {from: accounts[8]});\nlogs[0].event.should.be.equal(\&quot;Upgraded\&quot;);\nawait rewardByBlockEternalStorage.setProxyStorage(proxyStorage.address);\nrewardByBlock = await RewardByBlockNew.at(rewardByBlockEternalStorage.address);\nblockRewardAmount = web3.toWei(1, &#x27;ether&#x27;);\nemissionFundsAmount = web3.toWei(1, &#x27;ether&#x27;);\nemissionFundsAddress = &#x27;0x0000000000000000000000000000000000000000&#x27;;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d4b7bc7f-756a-439a-bbde-bb0b75cd7463&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock upgraded [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;33ee455f-ed84-4e31-be5d-a6bbffc7781c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;73d4cadc-10a5-4260-8132-7bedb76c4947&quot;,&quot;title&quot;:&quot;#reward&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/reward_by_block_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/reward_by_block_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called by system address&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock upgraded [all features] #reward may only be called by system address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:117,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await rewardByBlock.reward([miningKey], [0]).should.be.rejectedWith(ERROR_MSG);\nawait rewardByBlock.setSystemAddress(systemAddress);\nawait rewardByBlock.reward([miningKey], [0], {from: systemAddress}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bf705b79-8cd4-4ecf-82de-eb9d177a3e8b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if input array contains more than one item&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock upgraded [all features] #reward should revert if input array contains more than one item&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await rewardByBlock.setSystemAddress(systemAddress);\nawait rewardByBlock.reward(\n  [miningKey, miningKey2],\n  [0, 0],\n  {from: systemAddress}\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8eae88a8-148d-402b-8279-39bb83c09701&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if lengths of input arrays are not equal&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock upgraded [all features] #reward should revert if lengths of input arrays are not equal&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await rewardByBlock.setSystemAddress(systemAddress);\nawait rewardByBlock.reward(\n  [miningKey],\n  [0, 0],\n  {from: systemAddress}\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fe7aceef-0d58-4980-85b9-2ac5641d58ae&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if `kind` parameter is not 0&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock upgraded [all features] #reward should revert if `kind` parameter is not 0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:33,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await rewardByBlock.setSystemAddress(systemAddress);\nawait rewardByBlock.reward(\n  [miningKey],\n  [1],\n  {from: systemAddress}\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a2c78827-2262-47f1-b9f5-5bea188d8098&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if mining key does not exist&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock upgraded [all features] #reward should revert if mining key does not exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:262,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await keysManager.removeMiningKey(miningKey3, {from: votingToChangeKeys});\nlogs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nawait rewardByBlock.setSystemAddress(systemAddress);\nawait rewardByBlock.reward(\n  [miningKey3],\n  [0],\n  {from: systemAddress}\n).should.be.rejectedWith(ERROR_MSG);\nawait rewardByBlock.reward(\n  [miningKey2],\n  [0],\n  {from: systemAddress}\n).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;becd7d3d-09d7-4c83-adb6-b178abfaace2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should assign rewards to payout key and EmissionFunds&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock upgraded [all features] #reward should assign rewards to payout key and EmissionFunds&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1112,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await rewardByBlock.mintedForAccount.call(payoutKey)).should.be.bignumber.equal(0);\n(await rewardByBlock.mintedForAccount.call(emissionFundsAddress)).should.be.bignumber.equal(0);\n(await rewardByBlock.mintedForAccountInBlock.call(payoutKey, web3.eth.blockNumber)).should.be.bignumber.equal(0);\n(await rewardByBlock.mintedForAccountInBlock.call(emissionFundsAddress, web3.eth.blockNumber)).should.be.bignumber.equal(0);\n(await rewardByBlock.mintedInBlock.call(web3.eth.blockNumber)).should.be.bignumber.equal(0);\n(await rewardByBlock.mintedTotally.call()).should.be.bignumber.equal(0);\nawait rewardByBlock.setSystemAddress(systemAddress);\nconst {logs} = await rewardByBlock.reward(\n  [miningKey],\n  [0],\n  {from: systemAddress}\n).should.be.fulfilled;\nlogs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\nlogs[0].args.receivers.should.be.deep.equal([payoutKey, emissionFundsAddress]);\nlogs[0].args.rewards[0].toString().should.be.equal(blockRewardAmount.toString());\nlogs[0].args.rewards[1].toString().should.be.equal(emissionFundsAmount.toString());\n(await rewardByBlock.mintedForAccount.call(payoutKey)).should.be.bignumber.equal(blockRewardAmount);\n(await rewardByBlock.mintedForAccount.call(emissionFundsAddress)).should.be.bignumber.equal(emissionFundsAmount);\n(await rewardByBlock.mintedForAccountInBlock.call(payoutKey, web3.eth.blockNumber)).should.be.bignumber.equal(blockRewardAmount);\n(await rewardByBlock.mintedForAccountInBlock.call(emissionFundsAddress, web3.eth.blockNumber)).should.be.bignumber.equal(emissionFundsAmount);\nconst totalMinted = web3.toBigNumber(blockRewardAmount).plus(emissionFundsAmount);\n(await rewardByBlock.mintedInBlock.call(web3.eth.blockNumber)).should.be.bignumber.equal(totalMinted);\n(await rewardByBlock.mintedTotally.call()).should.be.bignumber.equal(totalMinted);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;88957399-7787-4789-a551-48c41bc78287&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should assign reward to mining key if payout key is 0&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock upgraded [all features] #reward should assign reward to mining key if payout key is 0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:142,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const result = await keysManager.removePayoutKey(\n  miningKey,\n  {from: votingToChangeKeys}\n);\nresult.logs[0].event.should.be.equal(\&quot;PayoutKeyChanged\&quot;);\nawait rewardByBlock.setSystemAddress(systemAddress);\nconst {logs} = await rewardByBlock.reward(\n  [miningKey],\n  [0],\n  {from: systemAddress}\n).should.be.fulfilled;\nlogs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\nlogs[0].args.receivers.should.be.deep.equal([miningKey, emissionFundsAddress]);\nlogs[0].args.rewards[0].toString().should.be.equal(blockRewardAmount.toString());\nlogs[0].args.rewards[1].toString().should.be.equal(emissionFundsAmount.toString());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bf07df65-233e-4d3c-97e3-101611e82e1b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should assign rewards to extra receivers and clear extra receivers list&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock upgraded [all features] #reward should assign rewards to extra receivers and clear extra receivers list&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1556,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await rewardByBlock.bridgeAmount.call(accounts[1])).should.be.bignumber.equal(0);\n(await rewardByBlock.bridgeAmount.call(accounts[2])).should.be.bignumber.equal(0);\n(await rewardByBlock.bridgeAmount.call(accounts[3])).should.be.bignumber.equal(0);\nawait rewardByBlock.addExtraReceiver(2, accounts[2], {from: accounts[1]}).should.be.fulfilled;\nawait rewardByBlock.addExtraReceiver(3, accounts[3], {from: accounts[1]}).should.be.fulfilled;\n(await rewardByBlock.bridgeAmount.call(accounts[1])).should.be.bignumber.equal(5);\n(await rewardByBlock.bridgeAmount.call(accounts[2])).should.be.bignumber.equal(0);\n(await rewardByBlock.bridgeAmount.call(accounts[3])).should.be.bignumber.equal(0);\n(await rewardByBlock.mintedTotallyByBridge.call(accounts[1])).should.be.bignumber.equal(0);\n(await rewardByBlock.mintedTotallyByBridge.call(accounts[2])).should.be.bignumber.equal(0);\n(await rewardByBlock.mintedTotallyByBridge.call(accounts[3])).should.be.bignumber.equal(0);\nawait rewardByBlock.setSystemAddress(systemAddress);\nlet result = await rewardByBlock.reward(\n  [miningKey],\n  [0],\n  {from: systemAddress}\n).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\nresult.logs[0].args.receivers.should.be.deep.equal([payoutKey, emissionFundsAddress, accounts[2], accounts[3]]);\nresult.logs[0].args.rewards[0].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[1].toString().should.be.equal(emissionFundsAmount.toString());\nresult.logs[0].args.rewards[2].toString().should.be.equal(&#x27;2&#x27;);\nresult.logs[0].args.rewards[3].toString().should.be.equal(&#x27;3&#x27;);\n(await rewardByBlock.extraReceiverAmount.call(accounts[2])).should.be.bignumber.equal(0);\n(await rewardByBlock.extraReceiverAmount.call(accounts[3])).should.be.bignumber.equal(0);\n(await rewardByBlock.extraReceiversLength.call()).should.be.bignumber.equal(0);\n(await rewardByBlock.bridgeAmount.call(accounts[1])).should.be.bignumber.equal(0);\n(await rewardByBlock.bridgeAmount.call(accounts[2])).should.be.bignumber.equal(0);\n(await rewardByBlock.bridgeAmount.call(accounts[3])).should.be.bignumber.equal(0);\n(await rewardByBlock.mintedTotallyByBridge.call(accounts[1])).should.be.bignumber.equal(5);\n(await rewardByBlock.mintedTotallyByBridge.call(accounts[2])).should.be.bignumber.equal(0);\n(await rewardByBlock.mintedTotallyByBridge.call(accounts[3])).should.be.bignumber.equal(0);\nawait rewardByBlock.addExtraReceiver(2, accounts[2], {from: accounts[1]}).should.be.fulfilled;\nawait rewardByBlock.addExtraReceiver(3, accounts[3], {from: accounts[1]}).should.be.fulfilled;\nresult = await rewardByBlock.reward(\n  [miningKey],\n  [0],\n  {from: systemAddress}\n).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\nresult.logs[0].args.receivers.should.be.deep.equal([payoutKey, emissionFundsAddress, accounts[2], accounts[3]]);\nresult.logs[0].args.rewards[0].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[1].toString().should.be.equal(emissionFundsAmount.toString());\nresult.logs[0].args.rewards[2].toString().should.be.equal(&#x27;2&#x27;);\nresult.logs[0].args.rewards[3].toString().should.be.equal(&#x27;3&#x27;);\n(await rewardByBlock.extraReceiverAmount.call(accounts[2])).should.be.bignumber.equal(0);\n(await rewardByBlock.extraReceiverAmount.call(accounts[3])).should.be.bignumber.equal(0);\n(await rewardByBlock.extraReceiversLength.call()).should.be.bignumber.equal(0);\n(await rewardByBlock.mintedTotallyByBridge.call(accounts[1])).should.be.bignumber.equal(10);\n(await rewardByBlock.mintedTotallyByBridge.call(accounts[2])).should.be.bignumber.equal(0);\n(await rewardByBlock.mintedTotallyByBridge.call(accounts[3])).should.be.bignumber.equal(0);\n(await rewardByBlock.mintedForAccount.call(payoutKey)).should.be.bignumber.equal(blockRewardAmount * 2);\n(await rewardByBlock.mintedForAccount.call(emissionFundsAddress)).should.be.bignumber.equal(emissionFundsAmount * 2);\n(await rewardByBlock.mintedForAccount.call(accounts[2])).should.be.bignumber.equal(4);\n(await rewardByBlock.mintedForAccount.call(accounts[3])).should.be.bignumber.equal(6);\n\n(await rewardByBlock.mintedForAccountInBlock.call(payoutKey, web3.eth.blockNumber)).should.be.bignumber.equal(blockRewardAmount);\n(await rewardByBlock.mintedForAccountInBlock.call(emissionFundsAddress, web3.eth.blockNumber)).should.be.bignumber.equal(emissionFundsAmount);\n(await rewardByBlock.mintedForAccountInBlock.call(accounts[2], web3.eth.blockNumber)).should.be.bignumber.equal(2);\n(await rewardByBlock.mintedForAccountInBlock.call(accounts[3], web3.eth.blockNumber)).should.be.bignumber.equal(3);\n\n(await rewardByBlock.mintedInBlock.call(web3.eth.blockNumber)).should.be.bignumber.equal(\n  web3.toBigNumber(blockRewardAmount).plus(emissionFundsAmount).plus(2).plus(3)\n);\n(await rewardByBlock.mintedTotally.call()).should.be.bignumber.equal(\n  web3.toBigNumber(blockRewardAmount).plus(emissionFundsAmount).plus(2).plus(3).mul(2)\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ff074588-f037-46d5-809d-342e6520a519&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;bf705b79-8cd4-4ecf-82de-eb9d177a3e8b&quot;,&quot;8eae88a8-148d-402b-8279-39bb83c09701&quot;,&quot;fe7aceef-0d58-4980-85b9-2ac5641d58ae&quot;,&quot;a2c78827-2262-47f1-b9f5-5bea188d8098&quot;,&quot;becd7d3d-09d7-4c83-adb6-b178abfaace2&quot;,&quot;88957399-7787-4789-a551-48c41bc78287&quot;,&quot;bf07df65-233e-4d3c-97e3-101611e82e1b&quot;,&quot;ff074588-f037-46d5-809d-342e6520a519&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3301,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;3c3e49c4-95fa-403b-9e17-743bdd578ca9&quot;,&quot;title&quot;:&quot;#addExtraReceiver&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/reward_by_block_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/reward_by_block_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called by bridge contract&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock upgraded [all features] #addExtraReceiver may only be called by bridge contract&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:74,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await rewardByBlock.addExtraReceiver(1, accounts[1]).should.be.rejectedWith(ERROR_MSG);\nawait rewardByBlock.addExtraReceiver(1, accounts[1], {from: accounts[2]}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fee0026d-fb4b-41ae-b12a-0dc66cc9e6d4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if receiver address is 0x0&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock upgraded [all features] #addExtraReceiver should revert if receiver address is 0x0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await rewardByBlock.addExtraReceiver(\n  1,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  {from: accounts[2]}\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0513a1ec-f649-48f9-937c-5c145c7bd672&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should revert if amount is 0&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock upgraded [all features] #addExtraReceiver should revert if amount is 0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await rewardByBlock.addExtraReceiver(\n  0,\n  accounts[1],\n  {from: accounts[2]}\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;49c4e9bf-d3ad-4f25-8c6e-f4cf0bcdac4c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;can be called repeatedly for the same recipient&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock upgraded [all features] #addExtraReceiver can be called repeatedly for the same recipient&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:379,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await rewardByBlock.bridgeAmount.call(accounts[1])).should.be.bignumber.equal(0);\n(await rewardByBlock.bridgeAmount.call(accounts[2])).should.be.bignumber.equal(0);\n(await rewardByBlock.bridgeAmount.call(accounts[3])).should.be.bignumber.equal(0);\nawait rewardByBlock.addExtraReceiver(\n  1,\n  accounts[1],\n  {from: accounts[2]}\n).should.be.fulfilled;\nawait rewardByBlock.addExtraReceiver(\n  2,\n  accounts[1],\n  {from: accounts[3]}\n).should.be.fulfilled;\n(await rewardByBlock.extraReceiversLength.call()).should.be.bignumber.equal(1);\n(await rewardByBlock.extraReceiverByIndex.call(0)).should.be.equal(accounts[1]);\n(await rewardByBlock.extraReceiverAmount.call(accounts[1])).should.be.bignumber.equal(3);\n(await rewardByBlock.bridgeAmount.call(accounts[1])).should.be.bignumber.equal(0);\n(await rewardByBlock.bridgeAmount.call(accounts[2])).should.be.bignumber.equal(1);\n(await rewardByBlock.bridgeAmount.call(accounts[3])).should.be.bignumber.equal(2);\nawait rewardByBlock.setSystemAddress(systemAddress);\nconst result = await rewardByBlock.reward(\n  [miningKey],\n  [0],\n  {from: systemAddress}\n).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\nresult.logs[0].args.receivers.should.be.deep.equal([payoutKey, emissionFundsAddress, accounts[1]]);\nresult.logs[0].args.rewards[0].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[1].toString().should.be.equal(emissionFundsAmount.toString());\nresult.logs[0].args.rewards[2].toString().should.be.equal(&#x27;3&#x27;);\n(await rewardByBlock.extraReceiversLength.call()).should.be.bignumber.equal(0);\n(await rewardByBlock.extraReceiverAmount.call(accounts[1])).should.be.bignumber.equal(0);\n(await rewardByBlock.bridgeAmount.call(accounts[1])).should.be.bignumber.equal(0);\n(await rewardByBlock.bridgeAmount.call(accounts[2])).should.be.bignumber.equal(0);\n(await rewardByBlock.bridgeAmount.call(accounts[3])).should.be.bignumber.equal(0);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6c98f66d-de3d-43d5-93a3-73c6af6990f2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should add receivers&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByBlock upgraded [all features] #addExtraReceiver should add receivers&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:195,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await rewardByBlock.extraReceiverAmount.call(accounts[2])).should.be.bignumber.equal(0);\n(await rewardByBlock.extraReceiversLength.call()).should.be.bignumber.equal(0);\nlet result = await rewardByBlock.addExtraReceiver(2, accounts[2], {from: accounts[1]}).should.be.fulfilled;\n(await rewardByBlock.extraReceiverByIndex.call(0)).should.be.equal(accounts[2]);\n(await rewardByBlock.extraReceiverAmount.call(accounts[2])).should.be.bignumber.equal(2);\n(await rewardByBlock.extraReceiversLength.call()).should.be.bignumber.equal(1);\nresult.logs[0].event.should.be.equal(&#x27;AddedReceiver&#x27;);\nresult.logs[0].args.receiver.should.be.equal(accounts[2]);\nresult.logs[0].args.amount.should.be.bignumber.equal(2);\nresult.logs[0].args.bridge.should.be.equal(accounts[1]);\nresult = await rewardByBlock.addExtraReceiver(3, accounts[3], {from: accounts[1]}).should.be.fulfilled;\n(await rewardByBlock.extraReceiverByIndex.call(0)).should.be.equal(accounts[2]);\n(await rewardByBlock.extraReceiverByIndex.call(1)).should.be.equal(accounts[3]);\n(await rewardByBlock.extraReceiverAmount.call(accounts[2])).should.be.bignumber.equal(2);\n(await rewardByBlock.extraReceiverAmount.call(accounts[3])).should.be.bignumber.equal(3);\n(await rewardByBlock.extraReceiversLength.call()).should.be.bignumber.equal(2);\nresult.logs[0].event.should.be.equal(&#x27;AddedReceiver&#x27;);\nresult.logs[0].args.receiver.should.be.equal(accounts[3]);\nresult.logs[0].args.amount.should.be.bignumber.equal(3);\nresult.logs[0].args.bridge.should.be.equal(accounts[1]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;016532dc-419f-4aef-8818-d655e83d662e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;fee0026d-fb4b-41ae-b12a-0dc66cc9e6d4&quot;,&quot;0513a1ec-f649-48f9-937c-5c145c7bd672&quot;,&quot;49c4e9bf-d3ad-4f25-8c6e-f4cf0bcdac4c&quot;,&quot;6c98f66d-de3d-43d5-93a3-73c6af6990f2&quot;,&quot;016532dc-419f-4aef-8818-d655e83d662e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:682,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;27671cdb-9f81-4f95-a072-e9c541a7a032&quot;,&quot;title&quot;:&quot;Contract: RewardByTime [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/reward_by_time_test.js&quot;,&quot;file&quot;:&quot;/test/reward_by_time_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByTime [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1299,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;32d7613e-bd3b-4fbe-b630-681d5493959d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByTime [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cf281dc5-a236-4ec0-bb51-e9c59266280f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByTime [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1033,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;coinbase = accounts[0];\nmasterOfCeremony = accounts[0];\nminingKey = accounts[1];\nminingKey2 = accounts[2];\nminingKey3 = accounts[3];\npayoutKey = accounts[4];\npayoutKey2 = accounts[5];\npayoutKey3 = accounts[6];\nsystemAddress = accounts[7];\nvotingToChangeKeys = accounts[9];\npoaNetworkConsensus = await PoaNetworkConsensus.new(masterOfCeremony, []);\nproxyStorage = await ProxyStorage.new();\nconst proxyStorageEternalStorage = await EternalStorageProxy.new(0, proxyStorage.address);\nproxyStorage = await ProxyStorage.at(proxyStorageEternalStorage.address);\nawait proxyStorage.init(poaNetworkConsensus.address).should.be.fulfilled;\nawait poaNetworkConsensus.setProxyStorage(proxyStorage.address);\nkeysManager = await KeysManager.new();\nconst keysManagerEternalStorage = await EternalStorageProxy.new(proxyStorage.address, keysManager.address);\nkeysManager = await KeysManager.at(keysManagerEternalStorage.address);\nawait keysManager.init(\n  \&quot;0x0000000000000000000000000000000000000000\&quot;\n).should.be.fulfilled;\nconst validatorMetadata = await ValidatorMetadata.new();\nconst validatorMetadataEternalStorage = await EternalStorageProxy.new(proxyStorage.address, validatorMetadata.address);\nawait proxyStorage.initializeAddresses(\n  keysManagerEternalStorage.address,\n  votingToChangeKeys,\n  accounts[9],\n  accounts[9],\n  accounts[9],\n  accounts[9],\n  validatorMetadataEternalStorage.address,\n  accounts[9]\n);\nawait addMiningKey(miningKey);\nawait addMiningKey(miningKey2);\nawait addMiningKey(miningKey3);\nawait addPayoutKey(payoutKey, miningKey);\nawait addPayoutKey(payoutKey2, miningKey2);\nawait addPayoutKey(payoutKey3, miningKey3);\nawait poaNetworkConsensus.setSystemAddress(coinbase);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nawait poaNetworkConsensus.setSystemAddress(&#x27;0xffffFFFfFFffffffffffffffFfFFFfffFFFfFFfE&#x27;);\nrewardByTime = await RewardByTime.new();\nrewardByTimeOldImplementation = rewardByTime.address;\nrewardByTimeEternalStorage = await EternalStorageProxy.new(proxyStorage.address, rewardByTime.address);\nrewardByTime = await RewardByTime.at(rewardByTimeEternalStorage.address);\nblockRewardAmount = web3.toWei(1, &#x27;ether&#x27;);\nemissionFundsAmount = web3.toWei(1, &#x27;ether&#x27;);\nemissionFundsAddress = &#x27;0x0000000000000000000000000000000000000000&#x27;;\nthreshold = 5;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1ae22e45-c097-4ce8-bf35-281fb16a2c1a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByTime [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8b604f92-3dd0-472f-9ae6-9438f757edf6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a8da9ca9-fd83-43ca-91c9-34c5a664ca0a&quot;,&quot;title&quot;:&quot;#reward&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/reward_by_time_test.js&quot;,&quot;file&quot;:&quot;/test/reward_by_time_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called by system address&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByTime [all features] #reward may only be called by system address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:144,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await rewardByTime.reward().should.be.rejectedWith(ERROR_MSG);\nawait rewardByTime.setSystemAddress(systemAddress);\nawait rewardByTime.reward({from: systemAddress}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6de8652e-6062-42e2-9a40-c1c0ea990f21&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should assign rewards to payout keys and EmissionFunds&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByTime [all features] #reward should assign rewards to payout keys and EmissionFunds&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2991,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await rewardByTime.setSystemAddress(systemAddress);\nlet result;\n\nawait rewardByTime.setTime(100);\nresult = await rewardByTime.reward({from: systemAddress}).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\nresult.logs[0].args.receivers.should.be.deep.equal([masterOfCeremony, emissionFundsAddress]);\nresult.logs[0].args.rewards[0].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[1].toString().should.be.equal(emissionFundsAmount.toString());\n(await rewardByTime.lastTime.call()).should.be.bignumber.equal(100);\n(await rewardByTime.keyIndex.call()).should.be.bignumber.equal(1);\nawait rewardByTime.setTime(107);\nresult = await rewardByTime.reward({from: systemAddress}).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\nresult.logs[0].args.receivers.should.be.deep.equal([payoutKey, emissionFundsAddress]);\nresult.logs[0].args.rewards[0].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[1].toString().should.be.equal(emissionFundsAmount.toString());\n(await rewardByTime.lastTime.call()).should.be.bignumber.equal(100 + threshold);\n(await rewardByTime.keyIndex.call()).should.be.bignumber.equal(2);\nawait rewardByTime.setTime(123);\nresult = await rewardByTime.reward({from: systemAddress}).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\nresult.logs[0].args.receivers.should.be.deep.equal([\n  payoutKey2,\n  payoutKey3,\n  masterOfCeremony,\n  emissionFundsAddress\n]);\nresult.logs[0].args.rewards[0].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[1].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[2].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[3].toString().should.be.equal((emissionFundsAmount * 3).toString());\nlet lastTime = 100 + threshold * 4;\nlet keyIndex = 1;\n(await rewardByTime.lastTime.call()).should.be.bignumber.equal(lastTime);\n(await rewardByTime.keyIndex.call()).should.be.bignumber.equal(keyIndex);\nconst keysArray = [\n  masterOfCeremony,\n  payoutKey,\n  payoutKey2,\n  payoutKey3\n];\n(await rewardByTime.getPayoutKeys.call()).should.be.deep.equal(keysArray);\nfor (let k = 0; k &lt; 10; k++) {\n  const time = getRandomInt(lastTime + 4, lastTime + 81);\n  //console.log(&#x27;time = &#x27; + time);\n  const receiversCount = Math.floor((time - lastTime) / threshold);\n  let receivers = [];\n  await rewardByTime.setTime(time);\n  result = await rewardByTime.reward({from: systemAddress}).should.be.fulfilled;\n  if (receiversCount &gt; 0) {\n    result.logs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\n  }\n  let i, n;\n  for (i = keyIndex, n = 0; n &lt; receiversCount; i++, n++) {\n    receivers.push(keysArray[i % keysArray.length]);\n    result.logs[0].args.rewards[n].toString().should.be.equal(blockRewardAmount.toString());\n  }\n  if (receiversCount &gt; 0) {\n    receivers.push(emissionFundsAddress);\n    result.logs[0].args.receivers.should.be.deep.equal(receivers);\n    result.logs[0].args.rewards[n].toString().should.be.equal((emissionFundsAmount * receiversCount).toString());\n    lastTime = lastTime + threshold * receiversCount;\n    keyIndex = i % keysArray.length;\n    (await rewardByTime.lastTime.call()).should.be.bignumber.equal(lastTime);\n    (await rewardByTime.keyIndex.call()).should.be.bignumber.equal(keyIndex);\n  }\n}&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6253da24-8573-493a-948b-f4f6010e64de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should work fine after some validators are removed and added&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByTime [all features] #reward should work fine after some validators are removed and added&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1475,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await rewardByTime.setSystemAddress(systemAddress);\nlet result;\n\nawait rewardByTime.setTime(100);\nresult = await rewardByTime.reward({from: systemAddress}).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\nresult.logs[0].args.receivers.should.be.deep.equal([masterOfCeremony, emissionFundsAddress]);\nresult.logs[0].args.rewards[0].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[1].toString().should.be.equal(emissionFundsAmount.toString());\n(await rewardByTime.lastTime.call()).should.be.bignumber.equal(100);\n(await rewardByTime.keyIndex.call()).should.be.bignumber.equal(1);\n(await rewardByTime.getPayoutKeys.call()).should.be.deep.equal([\n  masterOfCeremony,\n  payoutKey,\n  payoutKey2,\n  payoutKey3\n]);\nresult = await keysManager.removeMiningKey(miningKey2, {from: votingToChangeKeys});\nresult.logs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nawait poaNetworkConsensus.setSystemAddress(coinbase);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nawait poaNetworkConsensus.setSystemAddress(&#x27;0xffffFFFfFFffffffffffffffFfFFFfffFFFfFFfE&#x27;);\n(await rewardByTime.getPayoutKeys.call()).should.be.deep.equal([\n  masterOfCeremony,\n  payoutKey,\n  payoutKey2,\n  payoutKey3\n]);\nawait rewardByTime.setTime(107);\nresult = await rewardByTime.reward({from: systemAddress}).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\nresult.logs[0].args.receivers.should.be.deep.equal([payoutKey, emissionFundsAddress]);\nresult.logs[0].args.rewards[0].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[1].toString().should.be.equal(emissionFundsAmount.toString());\n(await rewardByTime.lastTime.call()).should.be.bignumber.equal(100 + threshold);\n(await rewardByTime.keyIndex.call()).should.be.bignumber.equal(2);\n(await rewardByTime.getPayoutKeys.call()).should.be.deep.equal([\n  masterOfCeremony,\n  payoutKey,\n  payoutKey2,\n  payoutKey3\n]);\nawait rewardByTime.setTime(123);\nresult = await rewardByTime.reward({from: systemAddress}).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\nresult.logs[0].args.receivers.should.be.deep.equal([\n  payoutKey2,\n  payoutKey3,\n  masterOfCeremony,\n  emissionFundsAddress\n]);\nresult.logs[0].args.rewards[0].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[1].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[2].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[3].toString().should.be.equal((emissionFundsAmount * 3).toString());\n(await rewardByTime.lastTime.call()).should.be.bignumber.equal(100 + threshold * 4);\n(await rewardByTime.keyIndex.call()).should.be.bignumber.equal(1);\n(await rewardByTime.getPayoutKeys.call()).should.be.deep.equal([\n  masterOfCeremony,\n  payoutKey,\n  payoutKey3\n]);\nawait rewardByTime.setTime(135);\nresult = await rewardByTime.reward({from: systemAddress}).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\nresult.logs[0].args.receivers.should.be.deep.equal([\n  payoutKey,\n  payoutKey3,\n  masterOfCeremony,\n  emissionFundsAddress\n]);\nresult.logs[0].args.rewards[0].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[1].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[2].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[3].toString().should.be.equal((emissionFundsAmount * 3).toString());\n(await rewardByTime.lastTime.call()).should.be.bignumber.equal(100 + threshold * 7);\n(await rewardByTime.keyIndex.call()).should.be.bignumber.equal(1);\nawait addMiningKey(miningKey2);\nawait addPayoutKey(payoutKey2, miningKey2);\nawait poaNetworkConsensus.setSystemAddress(coinbase);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nawait poaNetworkConsensus.setSystemAddress(&#x27;0xffffFFFfFFffffffffffffffFfFFFfffFFFfFFfE&#x27;);\n(await rewardByTime.getPayoutKeys.call()).should.be.deep.equal([\n  masterOfCeremony,\n  payoutKey,\n  payoutKey3\n]);\nawait rewardByTime.setTime(147);\nresult = await rewardByTime.reward({from: systemAddress}).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\nresult.logs[0].args.receivers.should.be.deep.equal([\n  payoutKey,\n  payoutKey3,\n  emissionFundsAddress\n]);\n(await rewardByTime.getPayoutKeys.call()).should.be.deep.equal([\n  masterOfCeremony,\n  payoutKey,\n  payoutKey3,\n  payoutKey2\n]);\nawait rewardByTime.setTime(166);\nresult = await rewardByTime.reward({from: systemAddress}).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\nresult.logs[0].args.receivers.should.be.deep.equal([\n  masterOfCeremony,\n  payoutKey,\n  payoutKey3,\n  payoutKey2,\n  emissionFundsAddress\n]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1eebdbab-7984-49c2-8e1a-facea3b6900b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6de8652e-6062-42e2-9a40-c1c0ea990f21&quot;,&quot;6253da24-8573-493a-948b-f4f6010e64de&quot;,&quot;1eebdbab-7984-49c2-8e1a-facea3b6900b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4610,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;5ebf741f-13c2-47cb-bbb5-c4b6c1b9baf2&quot;,&quot;title&quot;:&quot;#upgradeTo&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/reward_by_time_test.js&quot;,&quot;file&quot;:&quot;/test/reward_by_time_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called by ProxyStorage&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByTime [all features] #upgradeTo may only be called by ProxyStorage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:109,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const rewardByTimeNew = await RewardByTimeNew.new();\nawait rewardByTimeEternalStorage.setProxyStorage(proxyStorageStubAddress);\nawait rewardByTimeEternalStorage.upgradeTo(rewardByTimeNew.address, {from: accounts[0]}).should.be.rejectedWith(ERROR_MSG);\nawait upgradeTo(rewardByTimeNew.address, {from: proxyStorageStubAddress});\nawait rewardByTimeEternalStorage.setProxyStorage(proxyStorage.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0fb42293-043f-452f-9d84-dcddf0e3ed87&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change implementation address&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByTime [all features] #upgradeTo should change implementation address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:116,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let rewardByTimeNew = await RewardByTimeNew.new();\nconst newImplementation = rewardByTimeNew.address;\n(await rewardByTimeEternalStorage.implementation.call()).should.be.equal(rewardByTimeOldImplementation);\nawait rewardByTimeEternalStorage.setProxyStorage(proxyStorageStubAddress);\nawait upgradeTo(newImplementation, {from: proxyStorageStubAddress});\nawait rewardByTimeEternalStorage.setProxyStorage(proxyStorage.address);\n(await rewardByTimeEternalStorage.implementation.call()).should.be.equal(newImplementation);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;62789d53-bf94-4621-be79-c83a07a2d550&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should increment implementation version&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByTime [all features] #upgradeTo should increment implementation version&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:117,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let rewardByTimeNew = await RewardByTimeNew.new();\nconst oldVersion = await rewardByTimeEternalStorage.version.call();\nconst newVersion = oldVersion.add(1);\nawait rewardByTimeEternalStorage.setProxyStorage(proxyStorageStubAddress);\nawait upgradeTo(rewardByTimeNew.address, {from: proxyStorageStubAddress});\nawait rewardByTimeEternalStorage.setProxyStorage(proxyStorage.address);\n(await rewardByTimeEternalStorage.version.call()).should.be.bignumber.equal(newVersion);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4c9c23b3-5027-4176-8862-a57ca48d65ef&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should work&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByTime [all features] #upgradeTo new implementation should work&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:151,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let rewardByTimeNew = await RewardByTimeNew.new();\nawait rewardByTimeEternalStorage.setProxyStorage(proxyStorageStubAddress);\nawait upgradeTo(rewardByTimeNew.address, {from: proxyStorageStubAddress});\nawait rewardByTimeEternalStorage.setProxyStorage(proxyStorage.address);\nrewardByTimeNew = await RewardByTimeNew.at(rewardByTimeEternalStorage.address);\n(await rewardByTimeNew.initialized.call()).should.be.equal(false);\nawait rewardByTimeNew.initialize();\n(await rewardByTimeNew.initialized.call()).should.be.equal(true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a8972d74-7b2e-4f4a-924d-5688d465e8ef&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should use the same proxyStorage address&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByTime [all features] #upgradeTo new implementation should use the same proxyStorage address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:120,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let rewardByTimeNew = await RewardByTimeNew.new();\nawait rewardByTimeEternalStorage.setProxyStorage(proxyStorageStubAddress);\nawait upgradeTo(rewardByTimeNew.address, {from: proxyStorageStubAddress});\nrewardByTimeNew = await RewardByTimeNew.at(rewardByTimeEternalStorage.address);\n(await rewardByTimeNew.proxyStorage.call()).should.be.equal(proxyStorageStubAddress);\nawait rewardByTimeEternalStorage.setProxyStorage(proxyStorage.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d4b148e9-da52-4934-8fae-2c6f35917a6a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0fb42293-043f-452f-9d84-dcddf0e3ed87&quot;,&quot;62789d53-bf94-4621-be79-c83a07a2d550&quot;,&quot;4c9c23b3-5027-4176-8862-a57ca48d65ef&quot;,&quot;a8972d74-7b2e-4f4a-924d-5688d465e8ef&quot;,&quot;d4b148e9-da52-4934-8fae-2c6f35917a6a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:613,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;edb60176-7eb4-4784-b3bd-f9440ce50ed9&quot;,&quot;title&quot;:&quot;Contract: RewardByTime upgraded [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/reward_by_time_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/reward_by_time_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByTime upgraded [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:741,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d363c822-20d9-40bf-b6cb-b30d81d90c91&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByTime upgraded [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5252fbb8-769a-40ef-88fa-f1fe516df3ea&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByTime upgraded [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1087,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;coinbase = accounts[0];\nmasterOfCeremony = accounts[0];\nminingKey = accounts[1];\nminingKey2 = accounts[2];\nminingKey3 = accounts[3];\npayoutKey = accounts[4];\npayoutKey2 = accounts[5];\npayoutKey3 = accounts[6];\nsystemAddress = accounts[7];\nvotingToChangeKeys = accounts[9];\npoaNetworkConsensus = await PoaNetworkConsensus.new(masterOfCeremony, []);\nproxyStorage = await ProxyStorage.new();\nconst proxyStorageEternalStorage = await EternalStorageProxy.new(0, proxyStorage.address);\nproxyStorage = await ProxyStorage.at(proxyStorageEternalStorage.address);\nawait proxyStorage.init(poaNetworkConsensus.address).should.be.fulfilled;\nawait poaNetworkConsensus.setProxyStorage(proxyStorage.address);\nkeysManager = await KeysManager.new();\nconst keysManagerEternalStorage = await EternalStorageProxy.new(proxyStorage.address, keysManager.address);\nkeysManager = await KeysManager.at(keysManagerEternalStorage.address);\nawait keysManager.init(\n  \&quot;0x0000000000000000000000000000000000000000\&quot;\n).should.be.fulfilled;\nconst validatorMetadata = await ValidatorMetadata.new();\nconst validatorMetadataEternalStorage = await EternalStorageProxy.new(proxyStorage.address, validatorMetadata.address);\nawait proxyStorage.initializeAddresses(\n  keysManagerEternalStorage.address,\n  votingToChangeKeys,\n  accounts[9],\n  accounts[9],\n  accounts[9],\n  accounts[9],\n  validatorMetadataEternalStorage.address,\n  accounts[9]\n);\nawait addMiningKey(miningKey);\nawait addMiningKey(miningKey2);\nawait addMiningKey(miningKey3);\nawait addPayoutKey(payoutKey, miningKey);\nawait addPayoutKey(payoutKey2, miningKey2);\nawait addPayoutKey(payoutKey3, miningKey3);\nawait poaNetworkConsensus.setSystemAddress(coinbase);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nawait poaNetworkConsensus.setSystemAddress(&#x27;0xffffFFFfFFffffffffffffffFfFFFfffFFFfFFfE&#x27;);\nrewardByTime = await RewardByTime.new();\nrewardByTimeEternalStorage = await EternalStorageProxy.new(proxyStorage.address, rewardByTime.address);\nrewardByTime = await RewardByTime.at(rewardByTimeEternalStorage.address);\nconst rewardByTimeNew = await RewardByTimeNew.new();\nawait rewardByTimeEternalStorage.setProxyStorage(accounts[8]);\nconst {logs} = await rewardByTimeEternalStorage.upgradeTo(rewardByTimeNew.address, {from: accounts[8]});\nlogs[0].event.should.be.equal(\&quot;Upgraded\&quot;);\nawait rewardByTimeEternalStorage.setProxyStorage(proxyStorage.address);\nrewardByTime = await RewardByTimeNew.at(rewardByTimeEternalStorage.address);\nblockRewardAmount = web3.toWei(1, &#x27;ether&#x27;);\nemissionFundsAmount = web3.toWei(1, &#x27;ether&#x27;);\nemissionFundsAddress = &#x27;0x0000000000000000000000000000000000000000&#x27;;\nthreshold = 5;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;67c0ea8d-bcd8-4f21-88a5-d0c2b5496be3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByTime upgraded [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6612f364-5e76-4d5a-b75f-96fbf64bc12b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b6ce9637-ae6d-4e0f-b01e-b415d415f5b6&quot;,&quot;title&quot;:&quot;#reward&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/reward_by_time_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/reward_by_time_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called by system address&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByTime upgraded [all features] #reward may only be called by system address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:149,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await rewardByTime.reward().should.be.rejectedWith(ERROR_MSG);\nawait rewardByTime.setSystemAddress(systemAddress);\nawait rewardByTime.reward({from: systemAddress}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0267993a-3ec7-4c41-a693-87ca61f1e0cf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should assign rewards to payout keys and EmissionFunds&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByTime upgraded [all features] #reward should assign rewards to payout keys and EmissionFunds&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3132,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await rewardByTime.setSystemAddress(systemAddress);\nlet result;\n\nawait rewardByTime.setTime(100);\nresult = await rewardByTime.reward({from: systemAddress}).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\nresult.logs[0].args.receivers.should.be.deep.equal([masterOfCeremony, emissionFundsAddress]);\nresult.logs[0].args.rewards[0].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[1].toString().should.be.equal(emissionFundsAmount.toString());\n(await rewardByTime.lastTime.call()).should.be.bignumber.equal(100);\n(await rewardByTime.keyIndex.call()).should.be.bignumber.equal(1);\nawait rewardByTime.setTime(107);\nresult = await rewardByTime.reward({from: systemAddress}).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\nresult.logs[0].args.receivers.should.be.deep.equal([payoutKey, emissionFundsAddress]);\nresult.logs[0].args.rewards[0].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[1].toString().should.be.equal(emissionFundsAmount.toString());\n(await rewardByTime.lastTime.call()).should.be.bignumber.equal(100 + threshold);\n(await rewardByTime.keyIndex.call()).should.be.bignumber.equal(2);\nawait rewardByTime.setTime(123);\nresult = await rewardByTime.reward({from: systemAddress}).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\nresult.logs[0].args.receivers.should.be.deep.equal([\n  payoutKey2,\n  payoutKey3,\n  masterOfCeremony,\n  emissionFundsAddress\n]);\nresult.logs[0].args.rewards[0].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[1].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[2].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[3].toString().should.be.equal((emissionFundsAmount * 3).toString());\nlet lastTime = 100 + threshold * 4;\nlet keyIndex = 1;\n(await rewardByTime.lastTime.call()).should.be.bignumber.equal(lastTime);\n(await rewardByTime.keyIndex.call()).should.be.bignumber.equal(keyIndex);\nconst keysArray = [\n  masterOfCeremony,\n  payoutKey,\n  payoutKey2,\n  payoutKey3\n];\n(await rewardByTime.getPayoutKeys.call()).should.be.deep.equal(keysArray);\nfor (let k = 0; k &lt; 10; k++) {\n  const time = getRandomInt(lastTime + 4, lastTime + 81);\n  //console.log(&#x27;time = &#x27; + time);\n  const receiversCount = Math.floor((time - lastTime) / threshold);\n  let receivers = [];\n  await rewardByTime.setTime(time);\n  result = await rewardByTime.reward({from: systemAddress}).should.be.fulfilled;\n  if (receiversCount &gt; 0) {\n    result.logs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\n  }\n  let i, n;\n  for (i = keyIndex, n = 0; n &lt; receiversCount; i++, n++) {\n    receivers.push(keysArray[i % keysArray.length]);\n    result.logs[0].args.rewards[n].toString().should.be.equal(blockRewardAmount.toString());\n  }\n  if (receiversCount &gt; 0) {\n    receivers.push(emissionFundsAddress);\n    result.logs[0].args.receivers.should.be.deep.equal(receivers);\n    result.logs[0].args.rewards[n].toString().should.be.equal((emissionFundsAmount * receiversCount).toString());\n    lastTime = lastTime + threshold * receiversCount;\n    keyIndex = i % keysArray.length;\n    (await rewardByTime.lastTime.call()).should.be.bignumber.equal(lastTime);\n    (await rewardByTime.keyIndex.call()).should.be.bignumber.equal(keyIndex);\n  }\n}&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;24390987-8406-4c8c-915b-63f0f06e6e77&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should work fine after some validators are removed and added&quot;,&quot;fullTitle&quot;:&quot;Contract: RewardByTime upgraded [all features] #reward should work fine after some validators are removed and added&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1396,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await rewardByTime.setSystemAddress(systemAddress);\nlet result;\n\nawait rewardByTime.setTime(100);\nresult = await rewardByTime.reward({from: systemAddress}).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\nresult.logs[0].args.receivers.should.be.deep.equal([masterOfCeremony, emissionFundsAddress]);\nresult.logs[0].args.rewards[0].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[1].toString().should.be.equal(emissionFundsAmount.toString());\n(await rewardByTime.lastTime.call()).should.be.bignumber.equal(100);\n(await rewardByTime.keyIndex.call()).should.be.bignumber.equal(1);\n(await rewardByTime.getPayoutKeys.call()).should.be.deep.equal([\n  masterOfCeremony,\n  payoutKey,\n  payoutKey2,\n  payoutKey3\n]);\nresult = await keysManager.removeMiningKey(miningKey2, {from: votingToChangeKeys});\nresult.logs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nawait poaNetworkConsensus.setSystemAddress(coinbase);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nawait poaNetworkConsensus.setSystemAddress(&#x27;0xffffFFFfFFffffffffffffffFfFFFfffFFFfFFfE&#x27;);\n(await rewardByTime.getPayoutKeys.call()).should.be.deep.equal([\n  masterOfCeremony,\n  payoutKey,\n  payoutKey2,\n  payoutKey3\n]);\nawait rewardByTime.setTime(107);\nresult = await rewardByTime.reward({from: systemAddress}).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\nresult.logs[0].args.receivers.should.be.deep.equal([payoutKey, emissionFundsAddress]);\nresult.logs[0].args.rewards[0].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[1].toString().should.be.equal(emissionFundsAmount.toString());\n(await rewardByTime.lastTime.call()).should.be.bignumber.equal(100 + threshold);\n(await rewardByTime.keyIndex.call()).should.be.bignumber.equal(2);\n(await rewardByTime.getPayoutKeys.call()).should.be.deep.equal([\n  masterOfCeremony,\n  payoutKey,\n  payoutKey2,\n  payoutKey3\n]);\nawait rewardByTime.setTime(123);\nresult = await rewardByTime.reward({from: systemAddress}).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\nresult.logs[0].args.receivers.should.be.deep.equal([\n  payoutKey2,\n  payoutKey3,\n  masterOfCeremony,\n  emissionFundsAddress\n]);\nresult.logs[0].args.rewards[0].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[1].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[2].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[3].toString().should.be.equal((emissionFundsAmount * 3).toString());\n(await rewardByTime.lastTime.call()).should.be.bignumber.equal(100 + threshold * 4);\n(await rewardByTime.keyIndex.call()).should.be.bignumber.equal(1);\n(await rewardByTime.getPayoutKeys.call()).should.be.deep.equal([\n  masterOfCeremony,\n  payoutKey,\n  payoutKey3\n]);\nawait rewardByTime.setTime(135);\nresult = await rewardByTime.reward({from: systemAddress}).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\nresult.logs[0].args.receivers.should.be.deep.equal([\n  payoutKey,\n  payoutKey3,\n  masterOfCeremony,\n  emissionFundsAddress\n]);\nresult.logs[0].args.rewards[0].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[1].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[2].toString().should.be.equal(blockRewardAmount.toString());\nresult.logs[0].args.rewards[3].toString().should.be.equal((emissionFundsAmount * 3).toString());\n(await rewardByTime.lastTime.call()).should.be.bignumber.equal(100 + threshold * 7);\n(await rewardByTime.keyIndex.call()).should.be.bignumber.equal(1);\nawait addMiningKey(miningKey2);\nawait addPayoutKey(payoutKey2, miningKey2);\nawait poaNetworkConsensus.setSystemAddress(coinbase);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nawait poaNetworkConsensus.setSystemAddress(&#x27;0xffffFFFfFFffffffffffffffFfFFFfffFFFfFFfE&#x27;);\n(await rewardByTime.getPayoutKeys.call()).should.be.deep.equal([\n  masterOfCeremony,\n  payoutKey,\n  payoutKey3\n]);\nawait rewardByTime.setTime(147);\nresult = await rewardByTime.reward({from: systemAddress}).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\nresult.logs[0].args.receivers.should.be.deep.equal([\n  payoutKey,\n  payoutKey3,\n  emissionFundsAddress\n]);\n(await rewardByTime.getPayoutKeys.call()).should.be.deep.equal([\n  masterOfCeremony,\n  payoutKey,\n  payoutKey3,\n  payoutKey2\n]);\nawait rewardByTime.setTime(166);\nresult = await rewardByTime.reward({from: systemAddress}).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(&#x27;Rewarded&#x27;);\nresult.logs[0].args.receivers.should.be.deep.equal([\n  masterOfCeremony,\n  payoutKey,\n  payoutKey3,\n  payoutKey2,\n  emissionFundsAddress\n]);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;385f1999-05f9-46c1-8bdf-f832e66bcb1d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0267993a-3ec7-4c41-a693-87ca61f1e0cf&quot;,&quot;24390987-8406-4c8c-915b-63f0f06e6e77&quot;,&quot;385f1999-05f9-46c1-8bdf-f832e66bcb1d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4677,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;acb38ead-1cc5-4c4c-bb59-1a985c55b356&quot;,&quot;title&quot;:&quot;Contract: Voting to change keys [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_keys_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_keys_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:504,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a1c87e9a-12fd-47e5-aa48-cd55df3c7a9f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2e74d377-2a63-446e-aab9-660b826dbf34&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:729,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;votingKey = accounts[2];\nminingKeyForVotingKey = accounts[1];\nmasterOfCeremony = accounts[0];\npoaNetworkConsensusMock = await PoaNetworkConsensusMock.new(masterOfCeremony, []);\n\nproxyStorageMock = await ProxyStorageMock.new();\nconst proxyStorageEternalStorage = await EternalStorageProxy.new(0, proxyStorageMock.address);\nproxyStorageMock = await ProxyStorageMock.at(proxyStorageEternalStorage.address);\nawait proxyStorageMock.init(poaNetworkConsensusMock.address).should.be.fulfilled;\n\nawait poaNetworkConsensusMock.setProxyStorage(proxyStorageMock.address);\nkeysManager = await KeysManagerMock.new();\nconst keysManagerEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, keysManager.address);\nkeysManager = await KeysManagerMock.at(keysManagerEternalStorage.address);\nawait keysManager.init(\n  \&quot;0x0000000000000000000000000000000000000000\&quot;\n).should.be.fulfilled;\nlet ballotsStorage = await BallotsStorage.new();\nconst ballotsEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, ballotsStorage.address);\nconst validatorMetadata = await ValidatorMetadata.new();\nconst validatorMetadataEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, validatorMetadata.address);\nvoting = await VotingToChangeKeysMock.new();\nvotingEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, voting.address);\nawait proxyStorageMock.initializeAddresses(\n  keysManagerEternalStorage.address,\n  votingEternalStorage.address,\n  accounts[0],\n  accounts[0],\n  accounts[0],\n  ballotsEternalStorage.address,\n  validatorMetadataEternalStorage.address,\n  accounts[0]\n);\nballotsStorage = await BallotsStorage.at(ballotsEternalStorage.address);\nawait ballotsStorage.init([3, 2]).should.be.fulfilled;\nvoting = await VotingToChangeKeysMock.at(votingEternalStorage.address);\nawait voting.init(172800).should.be.fulfilled;\nawait voting.migrateDisable().should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2cd11816-bbd1-4aed-b431-e9add1ba2b51&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;43c1445c-0c72-4591-83ec-15d649ee1247&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8a50ee79-7caf-45c5-868c-7bc360624499&quot;,&quot;title&quot;:&quot;#createBallot&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_keys_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_keys_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #createBallot happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:676,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(accounts[1]);\nlet result = await keysManager.swapMiningKey(accounts[3], accounts[1]);\nresult.logs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nawait addVotingKey(votingKey, accounts[3]);\nVOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nconst id = await voting.nextBallotId.call();\n\nawait voting.createBallot(\n  VOTING_START_DATE, // _startTime\n  VOTING_END_DATE,   // _endTime\n  1,                 // _ballotType (KeyAdding)\n  1,                 // _affectedKeyType (MiningKey)\n  \&quot;memo\&quot;,            // _memo\n  accounts[4],       // _affectedKey\n  accounts[5],       // _miningKey\n  {from: miningKeyForVotingKey}\n).should.be.rejectedWith(ERROR_MSG);\nawait voting.createBallot(\n  VOTING_START_DATE, // _startTime\n  VOTING_END_DATE,   // _endTime\n  1,                 // _ballotType (KeyAdding)\n  1,                 // _affectedKeyType (MiningKey)\n  \&quot;memo\&quot;,            // _memo\n  accounts[3],       // _affectedKey\n  accounts[5],       // _miningKey\n  {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);\nconst {logs} = await voting.createBallot(\n  VOTING_START_DATE, // _startTime\n  VOTING_END_DATE,   // _endTime\n  1,                 // _ballotType (KeyAdding)\n  1,                 // _affectedKeyType (MiningKey)\n  \&quot;memo\&quot;,            // _memo\n  accounts[4],       // _affectedKey\n  accounts[5],       // _miningKey\n  {from: votingKey}\n).should.be.fulfilled;\nconst ballotInfo = await voting.getBallotInfo.call(id);\nballotInfo[0].should.be.bignumber.equal(VOTING_START_DATE);\nballotInfo[1].should.be.bignumber.equal(VOTING_END_DATE);\n(await voting.getKeysManager.call()).should.be.equal(keysManager.address);\nlogs[0].event.should.be.equal(\&quot;BallotCreated\&quot;);\nlogs[0].args.id.should.be.bignumber.equal(0);\nlogs[0].args.creator.should.be.equal(votingKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;238d2aa6-1a16-44b3-a6c3-4b58979e9f83&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create voting with invalid duration&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #createBallot should not let create voting with invalid duration&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:176,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(2, &#x27;seconds&#x27;).unix();\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1, // _ballotType\n  1, // _affectedKeyType\n  \&quot;memo\&quot;,\n  accounts[1], // _affectedKey\n  accounts[2], // _miningKey\n  {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);\nVOTING_START_DATE = 0\nVOTING_END_DATE = moment.utc().add(2, &#x27;seconds&#x27;).unix();\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1, // _ballotType\n  1, // _affectedKeyType\n  \&quot;memo\&quot;,\n  accounts[1], // _affectedKey\n  accounts[2], // _miningKey\n  {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);\nVOTING_START_DATE = moment.utc().add(2, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = 0\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1, // _ballotType\n  1, // _affectedKeyType\n  \&quot;memo\&quot;,\n  accounts[1], // _affectedKey\n  accounts[2], // _miningKey\n  {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d573bc83-c7ef-403c-804c-ad0d93c82bdf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let add votingKey for MoC&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #createBallot should not let add votingKey for MoC&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:437,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait addMiningKey(accounts[1]);\nawait addVotingKey(votingKey, accounts[1]);\nawait addMiningKey(accounts[2]);\nawait proxyStorageMock.setVotingContractMock(voting.address);\nVOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1, // _ballotType\n  2, // _affectedKeyType\n  \&quot;memo\&quot;,\n  accounts[5], // _affectedKey\n  masterOfCeremony, // _miningKey\n  {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1, // _ballotType\n  2, // _affectedKeyType\n  \&quot;memo\&quot;,\n  accounts[5], // _affectedKey\n  accounts[2], // _miningKey\n  {from: votingKey}\n).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7e6d02fb-ede1-436a-9bce-b5f59dfa91fe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let add votingKey for 0x0&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #createBallot should not let add votingKey for 0x0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:441,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(accounts[1]);\nawait addVotingKey(votingKey, accounts[1]);\nawait addMiningKey(accounts[2]);\nawait proxyStorageMock.setVotingContractMock(voting.address);\nVOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1, // _ballotType\n  2, // _affectedKeyType\n  \&quot;memo\&quot;,\n  accounts[5], // _affectedKey\n  &#x27;0x0000000000000000000000000000000000000000&#x27;, // _miningKey\n  {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1, // _ballotType\n  2, // _affectedKeyType\n  \&quot;memo\&quot;,\n  accounts[5], // _affectedKey\n  accounts[2], // _miningKey\n  {from: votingKey}\n).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;22214e7a-86c4-4bc1-850f-f3441f2d1fc0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let add payoutKey for 0x0&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #createBallot should not let add payoutKey for 0x0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:423,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(accounts[1]);\nawait addVotingKey(votingKey, accounts[1]);\nawait addMiningKey(accounts[2]);\nawait proxyStorageMock.setVotingContractMock(voting.address);\nVOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1,\n  3,\n  \&quot;memo\&quot;,\n  accounts[5],\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1,\n  3,\n  \&quot;memo\&quot;,\n  accounts[5],\n  accounts[2],\n  {from: votingKey}\n).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1b5f9550-ed66-4da9-8ec3-fe4fc019d836&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create more ballots than the limit&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #createBallot should not let create more ballots than the limit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10399,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait addMiningKey(accounts[1]);\nawait addVotingKey(votingKey, accounts[1]);\nVOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1,\n  1,\n  \&quot;memo\&quot;,\n  accounts[3],\n  accounts[2],\n  {from: votingKey}\n);\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1,\n  1,\n  \&quot;memo\&quot;,\n  accounts[3],\n  accounts[2],\n  {from: votingKey}\n);\nnew web3.BigNumber(200).should.be.bignumber.equal(await voting.getBallotLimitPerValidator.call());\nawait addValidators({proxyStorageMock, keysManager, poaNetworkConsensusMock}); //add 100 validators, so total will be 101 validator\nnew web3.BigNumber(1).should.be.bignumber.equal(await voting.getBallotLimitPerValidator.call());\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1,\n  1,\n  \&quot;memo\&quot;,\n  accounts[3],\n  accounts[2],\n  {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5f232310-6752-42d6-9804-3642307d1abb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;238d2aa6-1a16-44b3-a6c3-4b58979e9f83&quot;,&quot;d573bc83-c7ef-403c-804c-ad0d93c82bdf&quot;,&quot;7e6d02fb-ede1-436a-9bce-b5f59dfa91fe&quot;,&quot;22214e7a-86c4-4bc1-850f-f3441f2d1fc0&quot;,&quot;1b5f9550-ed66-4da9-8ec3-fe4fc019d836&quot;,&quot;5f232310-6752-42d6-9804-3642307d1abb&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:12552,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;6d57c16e-4d71-4de2-944b-25632bc08de4&quot;,&quot;title&quot;:&quot;#createBallotToAddNewValidator&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_keys_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_keys_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #createBallotToAddNewValidator \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:215,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(miningKeyForVotingKey);\nawait addVotingKey(votingKey, miningKeyForVotingKey);\nawait addPayoutKey(accounts[6], miningKeyForVotingKey);\nawait proxyStorageMock.setVotingContractMock(voting.address);\nVOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nid = await voting.nextBallotId.call();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;970e9c08-eaa7-4081-95c1-25ec411421ff&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #createBallotToAddNewValidator happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:299,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallotToAddNewValidator(\n  VOTING_START_DATE, // _startTime\n  VOTING_END_DATE,   // _endTime\n  \&quot;memo\&quot;,            // _memo\n  accounts[3],       // _newMiningKey\n  accounts[4],       // _newVotingKey\n  accounts[5],       // _newPayoutKey\n  {from: miningKeyForVotingKey}\n).should.be.rejectedWith(ERROR_MSG);\nconst {logs} = await voting.createBallotToAddNewValidator(\n  VOTING_START_DATE, // _startTime\n  VOTING_END_DATE,   // _endTime\n  \&quot;memo\&quot;,            // _memo\n  accounts[3],       // _newMiningKey\n  accounts[4],       // _newVotingKey\n  accounts[5],       // _newPayoutKey\n  {from: votingKey}\n).should.be.fulfilled;\n\n(await voting.getKeysManager.call()).should.be.equal(keysManager.address);\nconst ballotInfo = await voting.getBallotInfo.call(id);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  accounts[3], // affectedKey\n  new web3.BigNumber(1), // affectedKeyType\n  accounts[4], // newVotingKey\n  accounts[5], // newPayoutKey\n  &#x27;0x0000000000000000000000000000000000000000&#x27;, // miningKey\n  new web3.BigNumber(0), // totalVoters\n  new web3.BigNumber(0), // progress\n  false, // isFinalized\n  new web3.BigNumber(1), // ballotType\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false // canBeFinalizedNow\n]);\n\nlogs[0].event.should.be.equal(\&quot;BallotCreated\&quot;);\nlogs[0].args.id.should.be.bignumber.equal(0);\nlogs[0].args.ballotType.should.be.bignumber.equal(1);\nlogs[0].args.creator.should.be.equal(votingKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;80325ed0-4fae-49f4-b3bc-897f2f19e531&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;deny adding already existed voting key&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #createBallotToAddNewValidator deny adding already existed voting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallotToAddNewValidator(\n  VOTING_START_DATE, // _startTime\n  VOTING_END_DATE,   // _endTime\n  \&quot;memo\&quot;,            // _memo\n  accounts[3],       // _newMiningKey\n  votingKey,         // _newVotingKey\n  accounts[5],       // _newPayoutKey\n  {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;25dab491-7974-4e91-9ef9-22ada3ea41a4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;deny adding already existed payout key&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #createBallotToAddNewValidator deny adding already existed payout key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:204,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallotToAddNewValidator(\n  VOTING_START_DATE, // _startTime\n  VOTING_END_DATE,   // _endTime\n  \&quot;memo\&quot;,            // _memo\n  accounts[3],       // _newMiningKey\n  accounts[4],       // _newVotingKey\n  accounts[6],       // _newPayoutKey\n  {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);\nawait voting.createBallotToAddNewValidator(\n  VOTING_START_DATE, // _startTime\n  VOTING_END_DATE,   // _endTime\n  \&quot;memo\&quot;,            // _memo\n  accounts[3],       // _newMiningKey\n  accounts[4],       // _newVotingKey\n  accounts[5],       // _newPayoutKey\n  {from: votingKey}\n).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;48fb2b27-7e94-4ac3-9fb9-8db454544011&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should create validator with all keys after finalization&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #createBallotToAddNewValidator should create validator with all keys after finalization&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1390,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(accounts[0]);\nconst {logs} = await keysManager.removePayoutKey(miningKeyForVotingKey);\nlogs[0].event.should.be.equal(\&quot;PayoutKeyChanged\&quot;);\nawait addMiningKey(accounts[3]);\nawait addVotingKey(accounts[4], accounts[3]);\nawait addMiningKey(accounts[5]);\nawait addVotingKey(accounts[6], accounts[5]);\nawait proxyStorageMock.setVotingContractMock(voting.address);\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nawait voting.createBallotToAddNewValidator(\n  VOTING_START_DATE, // _startTime\n  VOTING_END_DATE,   // _endTime\n  \&quot;memo\&quot;,            // _memo\n  accounts[7],       // _newMiningKey\n  accounts[8],       // _newVotingKey\n  accounts[9],       // _newPayoutKey\n  {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.accept, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.accept, {from: accounts[4]}).should.be.fulfilled;\nawait voting.vote(id, choice.accept, {from: accounts[6]}).should.be.fulfilled;\n(await poaNetworkConsensusMock.isValidator.call(accounts[7])).should.be.equal(false);\n(await keysManager.isMiningActive.call(accounts[7])).should.be.equal(false);\n(await keysManager.isVotingActive.call(accounts[8])).should.be.equal(false);\n(await keysManager.miningKeyByVoting.call(accounts[8])).should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);\n(await keysManager.miningKeyByPayout.call(accounts[9])).should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);\nawait voting.setTime(VOTING_END_DATE+1);\nawait finalize(id, true, {from: votingKey});\n(await poaNetworkConsensusMock.isValidator.call(accounts[7])).should.be.equal(true);\n(await keysManager.isMiningActive.call(accounts[7])).should.be.equal(true);\n(await keysManager.isVotingActive.call(accounts[8])).should.be.equal(true);\n(await keysManager.miningKeyByVoting.call(accounts[8])).should.be.equal(accounts[7]);\n(await keysManager.miningKeyByPayout.call(accounts[9])).should.be.equal(accounts[7]);\n(await poaNetworkConsensusMock.getCurrentValidatorsLength.call()).should.be.bignumber.equal(4);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\n(await poaNetworkConsensusMock.getCurrentValidatorsLength.call()).should.be.bignumber.equal(5);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;117d768a-40ce-4589-b0b4-2d192dea8369&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow removing new validator if finalizeChange did not happen&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #createBallotToAddNewValidator should allow removing new validator if finalizeChange did not happen&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2312,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(accounts[0]);\nconst {logs} = await keysManager.removePayoutKey(miningKeyForVotingKey);\nlogs[0].event.should.be.equal(\&quot;PayoutKeyChanged\&quot;);\nawait addMiningKey(accounts[3]);\nawait addVotingKey(accounts[4], accounts[3]);\nawait addMiningKey(accounts[5]);\nawait addVotingKey(accounts[6], accounts[5]);\nawait proxyStorageMock.setVotingContractMock(voting.address);\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nawait voting.createBallotToAddNewValidator(\n  VOTING_START_DATE, // _startTime\n  VOTING_END_DATE,   // _endTime\n  \&quot;memo\&quot;,            // _memo\n  accounts[7],       // _newMiningKey\n  accounts[8],       // _newVotingKey\n  accounts[9],       // _newPayoutKey\n  {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.accept, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.accept, {from: accounts[4]}).should.be.fulfilled;\nawait voting.vote(id, choice.accept, {from: accounts[6]}).should.be.fulfilled;\n(await poaNetworkConsensusMock.isValidator.call(accounts[7])).should.be.equal(false);\n(await keysManager.isMiningActive.call(accounts[7])).should.be.equal(false);\n(await keysManager.isVotingActive.call(accounts[8])).should.be.equal(false);\n(await keysManager.miningKeyByVoting.call(accounts[8])).should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);\n(await keysManager.miningKeyByPayout.call(accounts[9])).should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);\nawait voting.setTime(VOTING_END_DATE+1);\nawait finalize(id, true, {from: votingKey});\n(await poaNetworkConsensusMock.isValidator.call(accounts[7])).should.be.equal(true);\n(await keysManager.isMiningActive.call(accounts[7])).should.be.equal(true);\n(await keysManager.isVotingActive.call(accounts[8])).should.be.equal(true);\n(await keysManager.miningKeyByVoting.call(accounts[8])).should.be.equal(accounts[7]);\n(await keysManager.miningKeyByPayout.call(accounts[9])).should.be.equal(accounts[7]);\n(await poaNetworkConsensusMock.getCurrentValidatorsLength.call()).should.be.bignumber.equal(4);\nVOTING_START_DATE = moment.utc().add(20, &#x27;days&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(30, &#x27;days&#x27;).unix();\nid = await voting.nextBallotId.call();\nawait voting.createBallot(\n  VOTING_START_DATE, // _startTime\n  VOTING_END_DATE,   // _endTime\n  2,                 // _ballotType (KeyRemoval)\n  1,                 // _affectedKeyType (MiningKey)\n  \&quot;memo\&quot;,            // _memo\n  accounts[7],       // _affectedKey\n  accounts[7],       // _miningKey\n  {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.accept, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.accept, {from: accounts[4]}).should.be.fulfilled;\nawait voting.vote(id, choice.accept, {from: accounts[6]}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE+1);\nawait finalize(id, true, {from: votingKey});\n(await poaNetworkConsensusMock.isValidator.call(accounts[7])).should.be.equal(false);\n(await keysManager.isMiningActive.call(accounts[7])).should.be.equal(false);\n(await keysManager.isVotingActive.call(accounts[8])).should.be.equal(false);\n(await keysManager.isPayoutActive.call(accounts[7])).should.be.equal(false);\n(await keysManager.miningKeyByVoting.call(accounts[8])).should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);\n(await keysManager.miningKeyByPayout.call(accounts[9])).should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);\n(await keysManager.getVotingByMining.call(accounts[7])).should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);\n(await keysManager.getPayoutByMining.call(accounts[7])).should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);\n\n(await poaNetworkConsensusMock.getCurrentValidatorsLength.call()).should.be.bignumber.equal(4);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\n(await poaNetworkConsensusMock.getCurrentValidatorsLength.call()).should.be.bignumber.equal(4);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;eea795f2-917f-458c-906a-6b3b1434c36d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;80325ed0-4fae-49f4-b3bc-897f2f19e531&quot;,&quot;25dab491-7974-4e91-9ef9-22ada3ea41a4&quot;,&quot;48fb2b27-7e94-4ac3-9fb9-8db454544011&quot;,&quot;117d768a-40ce-4589-b0b4-2d192dea8369&quot;,&quot;eea795f2-917f-458c-906a-6b3b1434c36d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4235,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;f26a3754-4542-446f-9c57-5a28e19fd158&quot;,&quot;title&quot;:&quot;#vote&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_keys_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_keys_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:310,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait addMiningKey(accounts[1]);\nawait addVotingKey(votingKey, accounts[1]);\nid = await voting.nextBallotId.call();\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1,\n  1,\n  \&quot;memo\&quot;,\n  accounts[3], \n  accounts[1],\n  {from: votingKey}\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;31248c57-0107-4d33-acc6-193687814d8c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should let a validator to vote&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote should let a validator to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:183,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nconst {logs} = await voting.vote(id, choice.accept, {from: votingKey}).should.be.fulfilled;\nlet progress = (await voting.getBallotInfo.call(id))[8];\nprogress.should.be.bignumber.equal(1);\nlet totalVoters = await voting.getTotalVoters.call(id);\ntotalVoters.should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(&#x27;Vote&#x27;);\nlogs[0].args.decision.should.be.bignumber.equal(1);\nlogs[0].args.voter.should.be.equal(votingKey);\nlogs[0].args.time.should.be.bignumber.equal(VOTING_START_DATE);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2e7f365b-4cc3-4eee-af2f-bb2e1f28c5a8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;reject vote should be accepted&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote reject vote should be accepted&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:184,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nconst {logs} = await voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\nlet progress = (await voting.getBallotInfo.call(id))[8];\nprogress.should.be.bignumber.equal(-1);\nlet totalVoters = await voting.getTotalVoters.call(id);\ntotalVoters.should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(&#x27;Vote&#x27;);\nlogs[0].args.decision.should.be.bignumber.equal(2);\nlogs[0].args.voter.should.be.equal(votingKey);\nlogs[0].args.time.should.be.bignumber.equal(VOTING_START_DATE);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3206ff89-f047-4188-ae7a-c8733d3266b3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow multiple voters to vote&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote should allow multiple voters to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:831,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait addVotingKey(accounts[3], accounts[1]);\nawait voting.vote(id, choice.reject, {from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);\n// add new voter\nawait addMiningKey(accounts[2]);\nawait addVotingKey(accounts[4], accounts[2]);\nawait voting.vote(id, choice.reject, {from: accounts[4]}).should.be.fulfilled;\nlet progress = (await voting.getBallotInfo.call(id))[8];\nprogress.should.be.bignumber.equal(-2);\nlet totalVoters = await voting.getTotalVoters.call(id);\ntotalVoters.should.be.bignumber.equal(2);\nawait addMiningKey(accounts[3]);\nawait addVotingKey(accounts[5], accounts[3]);\nawait voting.vote(id, choice.accept, {from: accounts[5]}).should.be.fulfilled;\nprogress = (await voting.getBallotInfo.call(id))[8];\nprogress.should.be.bignumber.equal(-1);\ntotalVoters = await voting.getTotalVoters.call(id);\ntotalVoters.should.be.bignumber.equal(3);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c0f79b47-5b2d-4312-a5f6-fc484ded7e02&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote nonVoting key&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote should not let vote nonVoting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:64,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, {from: accounts[0]}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e4a871b4-8b58-4e74-bbfd-d7e7c55f83fc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote before startTime key&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote should not let vote before startTime key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:98,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE - 1);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;19ee17e7-53ed-4c2e-ab17-655998a59a35&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote after endTime key&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote should not let vote after endTime key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:95,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE + 1);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;90f37028-8834-47a5-925d-1b11f9cc4bef&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with already voted key&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote should not let vote with already voted key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:192,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;704afee2-813d-43b0-bd6a-c8d8de5fb782&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with invalid choice&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote should not let vote with invalid choice&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:164,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(id, 0, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(id, 3, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c31bca85-a1dd-4c24-883e-74df0a07fd47&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with invalid id&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #vote should not let vote with invalid id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:176,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(99, 1, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(-3, 1, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b32b96a8-4c00-49c1-be62-eee721405641&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2e7f365b-4cc3-4eee-af2f-bb2e1f28c5a8&quot;,&quot;3206ff89-f047-4188-ae7a-c8733d3266b3&quot;,&quot;c0f79b47-5b2d-4312-a5f6-fc484ded7e02&quot;,&quot;e4a871b4-8b58-4e74-bbfd-d7e7c55f83fc&quot;,&quot;19ee17e7-53ed-4c2e-ab17-655998a59a35&quot;,&quot;90f37028-8834-47a5-925d-1b11f9cc4bef&quot;,&quot;704afee2-813d-43b0-bd6a-c8d8de5fb782&quot;,&quot;c31bca85-a1dd-4c24-883e-74df0a07fd47&quot;,&quot;b32b96a8-4c00-49c1-be62-eee721405641&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1987,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;e4d272b6-5f00-415e-a9e1-bba7d0b13e25&quot;,&quot;title&quot;:&quot;#finalize&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_keys_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_keys_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:464,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;votingKey  = accounts[3];\nvotingKey2 = accounts[5];\nvotingKey3 = accounts[6];\npayoutKeyToAdd = accounts[0];\nVOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait addMiningKey(accounts[1]);\nawait addVotingKey(votingKey, accounts[1]);\nawait addMiningKey(accounts[2]);\nawait addVotingKey(votingKey2, accounts[2]);\nawait addMiningKey(accounts[4]);\nawait addVotingKey(votingKey3, accounts[4]);\nawait proxyStorageMock.setVotingContractMock(voting.address);\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e19a5388-a37c-42c7-b8b1-8c4c19c1b2f8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path - no action since it did not meet minimum number of totalVoters&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize happy path - no action since it did not meet minimum number of totalVoters&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:706,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1,\n  3,\n  \&quot;memo\&quot;,\n  payoutKeyToAdd,\n  accounts[1],\n  {from: votingKey}\n);\nlet activeBallotsLength = await voting.activeBallotsLength.call();\nvotingId = await voting.activeBallots.call(activeBallotsLength.toNumber() - 1);\nawait voting.finalize(votingId, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.finalize(votingId).should.be.rejectedWith(ERROR_MSG);\nawait voting.setTime(VOTING_END_DATE + 1);\nconst {logs} = await voting.finalize(votingId, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(votingId, choice.accept, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nactiveBallotsLength = await voting.activeBallotsLength.call();\nactiveBallotsLength.should.be.bignumber.equal(0);\ntrue.should.be.equal((await voting.getBallotInfo.call(votingId))[9]); // isFinalized\n// Finalized(msg.sender);\nlogs[0].event.should.be.equal(\&quot;BallotFinalized\&quot;);\nlogs[0].args.voter.should.be.equal(votingKey);\nconst ballotInfo = await voting.getBallotInfo.call(votingId);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  payoutKeyToAdd, // affectedKey\n  new web3.BigNumber(3), // affectedKeyType\n  \&quot;0x0000000000000000000000000000000000000000\&quot;, // newVotingKey\n  \&quot;0x0000000000000000000000000000000000000000\&quot;, // newPayoutKey\n  accounts[1], // miningKey\n  new web3.BigNumber(1), // totalVoters\n  new web3.BigNumber(-1), // progress\n  true, // isFinalized\n  new web3.BigNumber(1), // ballotType\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false // canBeFinalizedNow\n]);\n(await voting.getQuorumState.call(votingId)).should.be.bignumber.equal(3);\n(await voting.getIndex.call(votingId)).should.be.bignumber.equal(0);\n(await voting.getMinThresholdOfVoters.call(votingId)).should.be.bignumber.equal(3);\n\ntrue.should.be.equal(\n  await voting.hasAlreadyVoted.call(votingId, votingKey)\n);\nconst keysState = await keysManager.validatorKeys.call(accounts[1]);\nkeysState.should.be.deep.equal(\n  [ votingKey,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  true,\n  false ]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6529ddfb-fa9f-449f-a1a2-6c2e0e0ad05a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize addition of payout key&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize finalize addition of payout key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1141,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Ballot to Add Payout Key for miner account[1]\nawait deployAndTestBallot({\n  _affectedKey: payoutKeyToAdd,\n  _affectedKeyType: 3,\n  _miningKey: accounts[1],\n  _ballotType: 1,\n})\nconst keysState = await keysManager.validatorKeys.call(accounts[1]);\nkeysState.should.be.deep.equal(\n  [ votingKey,\n  payoutKeyToAdd,\n  true,\n  true,\n  true ]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;564f9df9-b8a1-4887-84bd-4dcd71623a5d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize addition of VotingKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize finalize addition of VotingKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1152,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[7];\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait addMiningKey(miningKey);\nawait proxyStorageMock.setVotingContractMock(voting.address);\n// Ballot to Add Voting Key for miner account[1]\nlet votingKeyToAdd = accounts[8];\n// uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n// uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nawait deployAndTestBallot({\n  _affectedKey: votingKeyToAdd,\n  _affectedKeyType: 2,\n  _miningKey: miningKey,\n  _ballotType: 1,\n})\nconst keysState = await keysManager.validatorKeys.call(miningKey);\nkeysState.should.be.deep.equal(\n  [ votingKeyToAdd,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  true,\n  false ]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7e5e25de-0eaf-424d-a84f-184420ea4991&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot create ballot for using previous mining key&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize cannot create ballot for using previous mining key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2305,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(voting.address);\nlet miningKey = accounts[6];\n// uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n// uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nawait deployAndTestBallot({\n  _affectedKey: miningKey,\n  _affectedKeyType: 1,\n  _miningKey: &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  _ballotType: 1,\n})\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\ntrue.should.be.equal(await poaNetworkConsensusMock.isValidator.call(miningKey));\nlet validators = await poaNetworkConsensusMock.getValidators.call();\nawait voting.setTime(VOTING_START_DATE - 1);\nawait deployAndTestBallot({\n  _affectedKey: accounts[5],\n  _affectedKeyType: 1,\n  _miningKey: miningKey,\n  _ballotType: 3,\n  \n})\nawait voting.setTime(VOTING_START_DATE - 1);\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  3,\n  1,\n  \&quot;memo\&quot;,\n  miningKey,\n  accounts[5],\n  {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8c6e879c-68d3-40c0-9d47-c3a1433dd2c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize addition of MiningKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize finalize addition of MiningKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1194,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(voting.address);\nlet miningKey = accounts[6];\n// uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n// uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nawait deployAndTestBallot({\n  _affectedKey: miningKey,\n  _affectedKeyType: 1,\n  _miningKey: &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  _ballotType: 1,\n  \n})\nconst keysState = await keysManager.validatorKeys.call(miningKey);\nkeysState.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  false,\n  false ]\n)\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nconst validators = await poaNetworkConsensusMock.getValidators.call();\nvalidators.should.contain(miningKey);\ntrue.should.be.equal(await poaNetworkConsensusMock.isValidator.call(miningKey));&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fc3b5219-d292-4f20-bcef-10909938efc0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize removal of MiningKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize finalize removal of MiningKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2031,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[6];\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait addMiningKey(miningKey);\nawait proxyStorageMock.setVotingContractMock(voting.address);\n// Ballot to Add Voting Key for miner account[1]\n// uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n// uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nawait deployAndTestBallot({\n  _affectedKey: miningKey,\n  _affectedKeyType: 1,\n  _miningKey: miningKey,\n  _ballotType: 2,\n})\nconst keysState = await keysManager.validatorKeys.call(miningKey);\nkeysState.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  false,\n  false,\n  false ]\n)\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nconst validators = await poaNetworkConsensusMock.getValidators.call();\nvalidators.should.not.contain(miningKey);\nfalse.should.be.equal(await poaNetworkConsensusMock.isValidator.call(miningKey));&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;10458bca-7082-49d4-8297-0699bdbb791e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize removal of VotingKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize finalize removal of VotingKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1194,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[7];\nlet votingKeyToAdd = accounts[8];\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait addMiningKey(miningKey);\nawait addVotingKey(votingKeyToAdd, miningKey);\nawait proxyStorageMock.setVotingContractMock(voting.address);\n// uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n// uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nawait deployAndTestBallot({\n  _affectedKey: votingKeyToAdd,\n  _affectedKeyType: 2,\n  _miningKey: miningKey,\n  _ballotType: 2,\n})\nconst keysState = await keysManager.validatorKeys.call(miningKey);\nkeysState.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  false,\n  false ]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2ca42ab3-d7f1-423d-932d-8b052c389ce4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize removal of PayoutKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize finalize removal of PayoutKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1118,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[7];\nlet affectedKey = accounts[8];\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(miningKey);\nawait addPayoutKey(affectedKey, miningKey);\nawait proxyStorageMock.setVotingContractMock(voting.address);\n// uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n// uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nawait deployAndTestBallot({\n  _affectedKey: affectedKey,\n  _affectedKeyType: 3,\n  _miningKey: miningKey,\n  _ballotType: 2,\n})\nconst keysState = await keysManager.validatorKeys.call(miningKey);\nkeysState.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  false,\n  false ]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8c17ef4f-8559-4da5-9cb7-7c6dfcf6e826&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize swap of VotingKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize finalize swap of VotingKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1255,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[7];\nlet affectedKey = accounts[8];\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(miningKey);\nawait addVotingKey(affectedKey, miningKey);\nawait proxyStorageMock.setVotingContractMock(voting.address);\n// uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n// uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nlet newVotingKey = accounts[2];\nawait deployAndTestBallot({\n  _affectedKey: newVotingKey,\n  _affectedKeyType: 2,\n  _miningKey: miningKey,\n  _ballotType: 3,\n})\nconst keysState = await keysManager.validatorKeys.call(miningKey);\nkeysState.should.be.deep.equal(\n  [ newVotingKey,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  true,\n  false ]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a1d9ec3d-35b5-4983-a398-83b19ff8c520&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize swap of PayoutKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize finalize swap of PayoutKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1108,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[7];\nlet affectedKey = accounts[8];\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(miningKey);\nawait addPayoutKey(affectedKey, miningKey);\nawait proxyStorageMock.setVotingContractMock(voting.address);\n// Ballot to Add Voting Key for miner account[1]\n// uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n// uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nlet newPayoutKey = accounts[2];\nawait deployAndTestBallot({\n  _affectedKey: newPayoutKey,\n  _affectedKeyType: 3,\n  _miningKey: miningKey,\n  _ballotType: 3,\n})\nconst keysState = await keysManager.validatorKeys.call(miningKey);\nkeysState.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  newPayoutKey,\n  true,\n  false,\n  true ]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b83873bd-b0d8-4276-ad91-27f4d52d3e4f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize swap of MiningKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize finalize swap of MiningKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1448,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[6];\nlet affectedKey = accounts[5];\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait addMiningKey(miningKey);\nawait proxyStorageMock.setVotingContractMock(voting.address);\n// Ballot to Add Voting Key for miner account[1]\n// uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n// uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nawait deployAndTestBallot({\n  _affectedKey: affectedKey,\n  _affectedKeyType: 1,\n  _miningKey: miningKey,\n  _ballotType: 3,\n})\nconst keysState = await keysManager.validatorKeys.call(miningKey);\nkeysState.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  false,\n  false,\n  false ]\n)\nconst keysStateNew = await keysManager.validatorKeys.call(affectedKey);\nkeysStateNew.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  false,\n  false ]\n)\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nconst validators = await poaNetworkConsensusMock.getValidators.call();\nvalidators.should.not.contain(miningKey);\nvalidators.should.contain(affectedKey);\nfalse.should.be.equal(await poaNetworkConsensusMock.isValidator.call(miningKey));\ntrue.should.be.equal(await poaNetworkConsensusMock.isValidator.call(affectedKey));&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;df519fee-7ee4-4e5d-9e8c-a81d9b83ddb4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;prevent double finalize&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize prevent double finalize&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1874,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[6];\nlet affectedKey = accounts[5];\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait addMiningKey(miningKey);\nawait proxyStorageMock.setVotingContractMock(voting.address);\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  3,\n  1,\n  \&quot;memo\&quot;,\n  affectedKey,\n  miningKey,\n  {from: votingKey}\n);\nawait voting.createBallot(\n  VOTING_START_DATE+2,\n  VOTING_END_DATE+2,\n  2,\n  1,\n  \&quot;memo\&quot;,\n  affectedKey,\n  miningKey,\n  {from: votingKey}\n);\nconst activeBallotsLength = await voting.activeBallotsLength.call();\nvotingId = await voting.activeBallots.call(activeBallotsLength.toNumber() - 2);\nlet votingIdForSecond = votingId.add(1);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.reject, {from: votingKey}).should.be.fulfilled;\nfalse.should.be.equal(await voting.hasAlreadyVoted.call(votingId, votingKey2));\nawait voting.vote(votingId, choice.accept, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(votingId, choice.accept, {from: votingKey3}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nfalse.should.be.equal((await voting.getBallotInfo.call(votingId))[9]); // isFinalized\nawait finalize(votingId, true, {from: votingKey});\nnew web3.BigNumber(3).should.be.bignumber.equal(await voting.getBallotType.call(votingId));\ntrue.should.be.equal((await voting.getBallotInfo.call(votingId))[9]); // isFinalized\nawait voting.finalize(votingId, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.finalize(votingIdForSecond, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nnew web3.BigNumber(2).should.be.bignumber.equal(await voting.getBallotType.call(votingIdForSecond));\nfalse.should.be.equal((await voting.getBallotInfo.call(votingIdForSecond))[9]); // isFinalized\nawait voting.vote(votingIdForSecond, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 3);\nawait finalize(votingIdForSecond, true, {from: votingKey});\nnew web3.BigNumber(-1).should.be.bignumber.equal((await voting.getBallotInfo.call(votingIdForSecond))[8]) // progress\nnew web3.BigNumber(1).should.be.bignumber.equal((await voting.getBallotInfo.call(votingId))[8]) // progress&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;96f255f1-6939-4159-9e6f-66dfb152cd85&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;allowed at once after all validators gave their votes&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #finalize allowed at once after all validators gave their votes&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1836,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const miningKey = accounts[4];\nconst affectedKey = accounts[6];\nawait voting.createBallot(\n  VOTING_START_DATE, // uint256 _startTime\n  VOTING_END_DATE,   // uint256 _endTime\n  3,                 // uint256 _ballotType (KeySwap)\n  1,                 // uint256 _affectedKeyType (MiningKey)\n  \&quot;memo\&quot;,            // string _memo\n  affectedKey,       // address _affectedKey\n  miningKey,         // address _miningKey\n  {from: votingKey3}\n).should.be.fulfilled;\nfalse.should.be.equal((await voting.getBallotInfo.call(0))[9]); // isFinalized\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(0, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(0, choice.reject, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(0, choice.accept, {from: votingKey3}).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE+1);\nawait voting.finalize(0, {from: votingKey2}).should.be.rejectedWith(ERROR_MSG);\nfalse.should.be.equal((await voting.getBallotInfo.call(0))[9]); // isFinalized\nawait voting.setTime(VOTING_START_DATE+172800+1);\n(await voting.getTime.call()).should.be.bignumber.below(VOTING_END_DATE);\nawait finalize(0, true, {from: votingKey2});\ntrue.should.be.equal((await voting.getBallotInfo.call(0))[9]); // isFinalized\nawait voting.setTime(VOTING_END_DATE+1);\nawait voting.finalize(0, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nVOTING_START_DATE = moment.utc().add(12, &#x27;days&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(22, &#x27;days&#x27;).unix();\nawait voting.createBallot(\n  VOTING_START_DATE, // uint256 _startTime\n  VOTING_END_DATE,   // uint256 _endTime\n  3,                 // uint256 _ballotType (KeySwap)\n  1,                 // uint256 _affectedKeyType (MiningKey)\n  \&quot;memo\&quot;,            // string _memo\n  affectedKey,       // address _affectedKey\n  miningKey,         // address _miningKey\n  {from: votingKey3}\n).should.be.fulfilled;\nfalse.should.be.equal((await voting.getBallotInfo.call(1))[9]); // isFinalized\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(1, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(1, choice.reject, {from: votingKey2}).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE+172800+1);\n(await voting.getTime.call()).should.be.bignumber.below(VOTING_END_DATE);\nawait voting.finalize(1, {from: votingKey2}).should.be.rejectedWith(ERROR_MSG);\nfalse.should.be.equal((await voting.getBallotInfo.call(1))[9]); // isFinalized\nawait voting.setTime(VOTING_END_DATE+1);\nawait finalize(1, true, {from: votingKey2});\ntrue.should.be.equal((await voting.getBallotInfo.call(1))[9]); // isFinalized&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;432537d0-c666-4ae6-b07f-532a0a8ec6f9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6529ddfb-fa9f-449f-a1a2-6c2e0e0ad05a&quot;,&quot;564f9df9-b8a1-4887-84bd-4dcd71623a5d&quot;,&quot;7e5e25de-0eaf-424d-a84f-184420ea4991&quot;,&quot;8c6e879c-68d3-40c0-9d47-c3a1433dd2c0&quot;,&quot;fc3b5219-d292-4f20-bcef-10909938efc0&quot;,&quot;10458bca-7082-49d4-8297-0699bdbb791e&quot;,&quot;2ca42ab3-d7f1-423d-932d-8b052c389ce4&quot;,&quot;8c17ef4f-8559-4da5-9cb7-7c6dfcf6e826&quot;,&quot;a1d9ec3d-35b5-4983-a398-83b19ff8c520&quot;,&quot;b83873bd-b0d8-4276-ad91-27f4d52d3e4f&quot;,&quot;df519fee-7ee4-4e5d-9e8c-a81d9b83ddb4&quot;,&quot;96f255f1-6939-4159-9e6f-66dfb152cd85&quot;,&quot;432537d0-c666-4ae6-b07f-532a0a8ec6f9&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:18362,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;225903d0-44a9-467b-acf7-124af5a1af32&quot;,&quot;title&quot;:&quot;#migrate&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_keys_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_keys_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should copy a ballot to the new contract&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #migrate should copy a ballot to the new contract&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2288,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(miningKeyForVotingKey);\nawait addVotingKey(votingKey, miningKeyForVotingKey);\nawait addMiningKey(accounts[3]);\nawait addVotingKey(accounts[4], accounts[3]);\nawait addMiningKey(accounts[5]);\nawait addVotingKey(accounts[6], accounts[5]);\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nVOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nconst id = await voting.nextBallotId.call();\nawait voting.createBallot(\n  VOTING_START_DATE, // _startTime\n  VOTING_END_DATE,   // _endTime\n  1,                 // _ballotType (KeyAdding)\n  1,                 // _affectedKeyType (MiningKey)\n  \&quot;memo\&quot;,            // _memo\n  accounts[7],       // _affectedKey\n  accounts[2],       // _miningKey\n  {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.reject, {from: accounts[4]}).should.be.fulfilled;\nawait voting.vote(id, choice.reject, {from: accounts[6]}).should.be.fulfilled;\nlet votingNew = await VotingToChangeKeysMock.new();\nvotingEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, votingNew.address);\nvotingNew = await VotingToChangeKeysMock.at(votingEternalStorage.address);\nawait votingNew.init(172800).should.be.fulfilled;\nawait votingNew.setTime(VOTING_START_DATE);\nawait votingNew.migrateBasicOne(\n  id,\n  voting.address,\n  [miningKeyForVotingKey, accounts[3], accounts[5]]\n).should.be.fulfilled;\nconst ballotInfo = await votingNew.getBallotInfo.call(id);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  accounts[7], // affectedKey\n  new web3.BigNumber(1), // affectedKeyType\n  \&quot;0x0000000000000000000000000000000000000000\&quot;, // newVotingKey\n  \&quot;0x0000000000000000000000000000000000000000\&quot;, // newPayoutKey\n  accounts[2], // miningKey\n  new web3.BigNumber(3), // totalVoters\n  new web3.BigNumber(-3), // progress\n  false, // isFinalized\n  new web3.BigNumber(1), // ballotType\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false // canBeFinalizedNow\n]);\n(await votingNew.getQuorumState.call(id)).should.be.bignumber.equal(1);\n(await votingNew.getIndex.call(id)).should.be.bignumber.equal(0);\n(await votingNew.getMinThresholdOfVoters.call(id)).should.be.bignumber.equal(3);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, miningKeyForVotingKey)).should.be.equal(true);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, accounts[2])).should.be.equal(false);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, accounts[3])).should.be.equal(true);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, accounts[4])).should.be.equal(false);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, accounts[5])).should.be.equal(true);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, accounts[6])).should.be.equal(false);\n(await votingNew.nextBallotId.call()).should.be.bignumber.equal(0);\n(await votingNew.activeBallotsLength.call()).should.be.bignumber.equal(0);\n(await votingNew.validatorActiveBallots.call(miningKeyForVotingKey)).should.be.bignumber.equal(0);\nawait votingNew.migrateBasicAll(voting.address, {from: accounts[6]}).should.be.rejectedWith(ERROR_MSG);\nawait votingNew.migrateBasicAll(&#x27;0x0000000000000000000000000000000000000000&#x27;).should.be.rejectedWith(ERROR_MSG);\nawait votingNew.migrateBasicAll(voting.address).should.be.fulfilled;\nawait votingNew.migrateBasicAll(voting.address).should.be.fulfilled;\n(await votingNew.nextBallotId.call()).should.be.bignumber.equal(1);\n(await votingNew.activeBallotsLength.call()).should.be.bignumber.equal(1);\n(await votingNew.validatorActiveBallots.call(miningKeyForVotingKey)).should.be.bignumber.equal(1);\n(await votingNew.migrateDisabled.call()).should.be.equal(false);\nawait votingNew.migrateDisable({from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait votingNew.migrateDisable().should.be.fulfilled;\n(await votingNew.migrateDisabled.call()).should.be.equal(true);\nawait votingNew.migrateBasicAll(voting.address).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;553e3e40-4180-4a84-801f-26d43ca7d6a3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;553e3e40-4180-4a84-801f-26d43ca7d6a3&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2288,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;55c9413f-152a-4479-8e68-bf7b60d8c98a&quot;,&quot;title&quot;:&quot;#upgradeTo&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_keys_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_keys_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #upgradeTo \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:145,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;proxyStorageStubAddress = accounts[8];\nvoting = await VotingToChangeKeysMock.new();\nvotingOldImplementation = voting.address;\nvotingEternalStorage = await EternalStorageProxy.new(proxyStorageStubAddress, voting.address);\nvoting = await VotingToChangeKeysMock.at(votingEternalStorage.address);\nawait voting.init(172800).should.be.fulfilled;\nawait voting.migrateDisable().should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;876d7017-fb88-4b6e-905d-579b65e8e6f7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called by ProxyStorage&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #upgradeTo may only be called by ProxyStorage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:123,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let votingNew = await VotingToChangeKeysNew.new();\nawait votingEternalStorage.upgradeTo(votingNew.address, {from: accounts[0]}).should.be.rejectedWith(ERROR_MSG);\nawait upgradeTo(votingNew.address, {from: proxyStorageStubAddress});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;319f98d5-ecca-44c9-bfeb-5f892068f2ac&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change implementation address&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #upgradeTo should change implementation address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:101,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let votingNew = await VotingToChangeKeysNew.new();\nlet newImplementation = votingNew.address;\n(await votingEternalStorage.implementation.call()).should.be.equal(votingOldImplementation);\nawait upgradeTo(newImplementation, {from: proxyStorageStubAddress});\n(await votingEternalStorage.implementation.call()).should.be.equal(newImplementation);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cb09f6d3-b994-496a-9fc1-c6726aaf594b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should increment implementation version&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #upgradeTo should increment implementation version&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:108,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let votingNew = await VotingToChangeKeysNew.new();\nlet oldVersion = await votingEternalStorage.version.call();\nlet newVersion = oldVersion.add(1);\nawait upgradeTo(votingNew.address, {from: proxyStorageStubAddress});\n(await votingEternalStorage.version.call()).should.be.bignumber.equal(newVersion);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c9161ea5-dc12-4480-acdb-13c782cf9f8d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should work&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #upgradeTo new implementation should work&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:129,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let votingNew = await VotingToChangeKeysNew.new();\nawait upgradeTo(votingNew.address, {from: proxyStorageStubAddress});\nvotingNew = await VotingToChangeKeysNew.at(votingEternalStorage.address);\n(await votingNew.initialized.call()).should.be.equal(false);\nawait votingNew.initialize();\n(await votingNew.initialized.call()).should.be.equal(true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2bcda613-fb32-425b-acef-1f8b13eaf741&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should use the same proxyStorage address&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #upgradeTo new implementation should use the same proxyStorage address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:100,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let votingNew = await VotingToChangeKeysNew.new();\nawait upgradeTo(votingNew.address, {from: proxyStorageStubAddress});\nvotingNew = await VotingToChangeKeysNew.at(votingEternalStorage.address);\n(await votingNew.proxyStorage.call()).should.be.equal(proxyStorageStubAddress);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2cee2e94-3d20-49e6-ac51-137c52da127b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should use the same storage&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys [all features] #upgradeTo new implementation should use the same storage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:996,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const payoutKeyToAdd = accounts[0];\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait addMiningKey(accounts[1]);\nawait addVotingKey(votingKey, accounts[1]);\nawait proxyStorageMock.setVotingContractMock(voting.address);\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nVOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait votingEternalStorage.setProxyStorage(proxyStorageMock.address);\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1,\n  3,\n  \&quot;memo\&quot;,\n  payoutKeyToAdd,\n  accounts[1],\n  {from: votingKey}\n);\nconst activeBallotsLength = await voting.activeBallotsLength.call();\nconst votingId = await voting.activeBallots.call(activeBallotsLength.toNumber() - 1);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nawait finalize(votingId, true, {from: votingKey});\nawait votingEternalStorage.setProxyStorage(proxyStorageStubAddress);\nlet votingNew = await VotingToChangeKeysNew.new();\nawait upgradeTo(votingNew.address, {from: proxyStorageStubAddress});\nvotingNew = await VotingToChangeKeysNew.at(votingEternalStorage.address);\nconst ballotInfo = await votingNew.getBallotInfo.call(votingId);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  payoutKeyToAdd, // affectedKey\n  new web3.BigNumber(3), // affectedKeyType\n  \&quot;0x0000000000000000000000000000000000000000\&quot;, // newVotingKey\n  \&quot;0x0000000000000000000000000000000000000000\&quot;, // newPayoutKey\n  accounts[1], // miningKey\n  new web3.BigNumber(1), // totalVoters\n  new web3.BigNumber(-1), // progress\n  true, // isFinalized\n  new web3.BigNumber(1), // ballotType\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false // canBeFinalizedNow\n]);\n(await votingNew.getQuorumState.call(votingId)).should.be.bignumber.equal(3);\n(await votingNew.getIndex.call(votingId)).should.be.bignumber.equal(0);\n(await votingNew.getMinThresholdOfVoters.call(votingId)).should.be.bignumber.equal(3);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;306211d5-a1fe-4f1d-91b7-c51980c2af4c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;319f98d5-ecca-44c9-bfeb-5f892068f2ac&quot;,&quot;cb09f6d3-b994-496a-9fc1-c6726aaf594b&quot;,&quot;c9161ea5-dc12-4480-acdb-13c782cf9f8d&quot;,&quot;2bcda613-fb32-425b-acef-1f8b13eaf741&quot;,&quot;2cee2e94-3d20-49e6-ac51-137c52da127b&quot;,&quot;306211d5-a1fe-4f1d-91b7-c51980c2af4c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1557,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;09b46b71-cdb4-489e-8d60-d5b30973a77f&quot;,&quot;title&quot;:&quot;Contract: Voting to change keys upgraded [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_keys_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_keys_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3615,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;94584579-170c-4984-b305-139871395cc3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e3daaab5-44c6-4e82-bd0f-9d5c538ab049&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1052,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;votingKey = accounts[2];\nminingKeyForVotingKey = accounts[1];\nmasterOfCeremony = accounts[0];\npoaNetworkConsensusMock = await PoaNetworkConsensusMock.new(masterOfCeremony, []);\n\nproxyStorageMock = await ProxyStorageMock.new();\nconst proxyStorageEternalStorage = await EternalStorageProxy.new(0, proxyStorageMock.address);\nproxyStorageMock = await ProxyStorageMock.at(proxyStorageEternalStorage.address);\nawait proxyStorageMock.init(poaNetworkConsensusMock.address).should.be.fulfilled;\n\nawait poaNetworkConsensusMock.setProxyStorage(proxyStorageMock.address);\nkeysManager = await KeysManagerMock.new();\nconst keysManagerEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, keysManager.address);\nkeysManager = await KeysManagerMock.at(keysManagerEternalStorage.address);\nawait keysManager.init(\n  \&quot;0x0000000000000000000000000000000000000000\&quot;\n).should.be.fulfilled;\nlet ballotsStorage = await BallotsStorage.new();\nconst ballotsEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, ballotsStorage.address);\nconst validatorMetadata = await ValidatorMetadata.new();\nconst validatorMetadataEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, validatorMetadata.address);\nvoting = await VotingToChangeKeysMock.new();\nvotingEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, voting.address);\nawait proxyStorageMock.initializeAddresses(\n  keysManagerEternalStorage.address,\n  votingEternalStorage.address,\n  accounts[0],\n  accounts[0],\n  accounts[0],\n  ballotsEternalStorage.address,\n  validatorMetadataEternalStorage.address,\n  accounts[0]\n);\nballotsStorage = await BallotsStorage.at(ballotsEternalStorage.address);\nawait ballotsStorage.init([3, 2]).should.be.fulfilled;\nvoting = await VotingToChangeKeysMock.at(votingEternalStorage.address);\nawait voting.init(172800).should.be.fulfilled;\nawait voting.migrateDisable().should.be.fulfilled;\nlet votingNew = await VotingToChangeKeysMock.new();\nawait votingEternalStorage.setProxyStorage(accounts[6]);\nconst {logs} = await votingEternalStorage.upgradeTo(votingNew.address, {from: accounts[6]});\nlogs[0].event.should.be.equal(\&quot;Upgraded\&quot;);\nawait votingEternalStorage.setProxyStorage(proxyStorageMock.address);\nvoting = await VotingToChangeKeysMock.at(votingEternalStorage.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c944b6be-3b7c-48f6-a8d4-b036f849c970&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d82b5d6b-06a3-42c6-9d62-880c4a29848e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;f946696d-7302-4791-8294-17ff04ecc668&quot;,&quot;title&quot;:&quot;#createBallot&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_keys_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_keys_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #createBallot happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:744,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(accounts[1]);\nlet result = await keysManager.swapMiningKey(accounts[3], accounts[1]);\nresult.logs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nawait addVotingKey(votingKey, accounts[3]);\nVOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nconst id = await voting.nextBallotId.call();\n\nawait voting.createBallot(\n  VOTING_START_DATE, // _startTime\n  VOTING_END_DATE,   // _endTime\n  1,                 // _ballotType (KeyAdding)\n  1,                 // _affectedKeyType (MiningKey)\n  \&quot;memo\&quot;,            // _memo\n  accounts[4],       // _affectedKey\n  accounts[5],       // _miningKey\n  {from: miningKeyForVotingKey}\n).should.be.rejectedWith(ERROR_MSG);\nawait voting.createBallot(\n  VOTING_START_DATE, // _startTime\n  VOTING_END_DATE,   // _endTime\n  1,                 // _ballotType (KeyAdding)\n  1,                 // _affectedKeyType (MiningKey)\n  \&quot;memo\&quot;,            // _memo\n  accounts[3],       // _affectedKey\n  accounts[5],       // _miningKey\n  {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);\nconst {logs} = await voting.createBallot(\n  VOTING_START_DATE, // _startTime\n  VOTING_END_DATE,   // _endTime\n  1,                 // _ballotType (KeyAdding)\n  1,                 // _affectedKeyType (MiningKey)\n  \&quot;memo\&quot;,            // _memo\n  accounts[4],       // _affectedKey\n  accounts[5],       // _miningKey\n  {from: votingKey}\n).should.be.fulfilled;\nconst ballotInfo = await voting.getBallotInfo.call(id);\nballotInfo[0].should.be.bignumber.equal(VOTING_START_DATE);\nballotInfo[1].should.be.bignumber.equal(VOTING_END_DATE);\n(await voting.getKeysManager.call()).should.be.equal(keysManager.address);\nlogs[0].event.should.be.equal(\&quot;BallotCreated\&quot;);\nlogs[0].args.id.should.be.bignumber.equal(0);\nlogs[0].args.creator.should.be.equal(votingKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e5fa1f2e-99d1-4023-94f8-42ded8c72304&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create voting with invalid duration&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #createBallot should not let create voting with invalid duration&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:164,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(2, &#x27;seconds&#x27;).unix();\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1, // _ballotType\n  1, // _affectedKeyType\n  \&quot;memo\&quot;,\n  accounts[1], // _affectedKey\n  accounts[2], // _miningKey\n  {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);\nVOTING_START_DATE = 0\nVOTING_END_DATE = moment.utc().add(2, &#x27;seconds&#x27;).unix();\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1, // _ballotType\n  1, // _affectedKeyType\n  \&quot;memo\&quot;,\n  accounts[1], // _affectedKey\n  accounts[2], // _miningKey\n  {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);\nVOTING_START_DATE = moment.utc().add(2, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = 0\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1, // _ballotType\n  1, // _affectedKeyType\n  \&quot;memo\&quot;,\n  accounts[1], // _affectedKey\n  accounts[2], // _miningKey\n  {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0b11c32b-fea5-4e6b-858a-7ff1b700ad2a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let add votingKey for MoC&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #createBallot should not let add votingKey for MoC&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:434,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait addMiningKey(accounts[1]);\nawait addVotingKey(votingKey, accounts[1]);\nawait addMiningKey(accounts[2]);\nawait proxyStorageMock.setVotingContractMock(voting.address);\nVOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1, // _ballotType\n  2, // _affectedKeyType\n  \&quot;memo\&quot;,\n  accounts[5], // _affectedKey\n  masterOfCeremony, // _miningKey\n  {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1, // _ballotType\n  2, // _affectedKeyType\n  \&quot;memo\&quot;,\n  accounts[5], // _affectedKey\n  accounts[2], // _miningKey\n  {from: votingKey}\n).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1f1b4534-a7d2-4115-a489-6d659d6c24a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let add votingKey for 0x0&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #createBallot should not let add votingKey for 0x0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:442,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(accounts[1]);\nawait addVotingKey(votingKey, accounts[1]);\nawait addMiningKey(accounts[2]);\nawait proxyStorageMock.setVotingContractMock(voting.address);\nVOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1, // _ballotType\n  2, // _affectedKeyType\n  \&quot;memo\&quot;,\n  accounts[5], // _affectedKey\n  &#x27;0x0000000000000000000000000000000000000000&#x27;, // _miningKey\n  {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1, // _ballotType\n  2, // _affectedKeyType\n  \&quot;memo\&quot;,\n  accounts[5], // _affectedKey\n  accounts[2], // _miningKey\n  {from: votingKey}\n).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;803d8682-87d5-4b65-aaa5-9b56e63c8ebd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let add payoutKey for 0x0&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #createBallot should not let add payoutKey for 0x0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:436,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(accounts[1]);\nawait addVotingKey(votingKey, accounts[1]);\nawait addMiningKey(accounts[2]);\nawait proxyStorageMock.setVotingContractMock(voting.address);\nVOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1,\n  3,\n  \&quot;memo\&quot;,\n  accounts[5],\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1,\n  3,\n  \&quot;memo\&quot;,\n  accounts[5],\n  accounts[2],\n  {from: votingKey}\n).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c0da9b32-8b2e-43c1-8e80-08bb99694168&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create more ballots than the limit&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #createBallot should not let create more ballots than the limit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10447,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait addMiningKey(accounts[1]);\nawait addVotingKey(votingKey, accounts[1]);\nVOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1,\n  1,\n  \&quot;memo\&quot;,\n  accounts[3],\n  accounts[2],\n  {from: votingKey}\n);\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1,\n  1,\n  \&quot;memo\&quot;,\n  accounts[3],\n  accounts[2],\n  {from: votingKey}\n);\nnew web3.BigNumber(200).should.be.bignumber.equal(await voting.getBallotLimitPerValidator.call());\nawait addValidators({proxyStorageMock, keysManager, poaNetworkConsensusMock}); //add 100 validators, so total will be 101 validator\nnew web3.BigNumber(1).should.be.bignumber.equal(await voting.getBallotLimitPerValidator.call());\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1,\n  1,\n  \&quot;memo\&quot;,\n  accounts[3],\n  accounts[2],\n  {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;430595d8-5d6b-4b69-b5ae-49f3622aa15e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e5fa1f2e-99d1-4023-94f8-42ded8c72304&quot;,&quot;0b11c32b-fea5-4e6b-858a-7ff1b700ad2a&quot;,&quot;1f1b4534-a7d2-4115-a489-6d659d6c24a6&quot;,&quot;803d8682-87d5-4b65-aaa5-9b56e63c8ebd&quot;,&quot;c0da9b32-8b2e-43c1-8e80-08bb99694168&quot;,&quot;430595d8-5d6b-4b69-b5ae-49f3622aa15e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:12667,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;4573b08d-5db0-4fee-80d7-33ab8d5060a7&quot;,&quot;title&quot;:&quot;#createBallotToAddNewValidator&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_keys_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_keys_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #createBallotToAddNewValidator \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:313,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(miningKeyForVotingKey);\nawait addVotingKey(votingKey, miningKeyForVotingKey);\nawait addPayoutKey(accounts[6], miningKeyForVotingKey);\nawait proxyStorageMock.setVotingContractMock(voting.address);\nVOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nid = await voting.nextBallotId.call();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;274f84ab-83c9-4ea1-9db4-421c17ddf38b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #createBallotToAddNewValidator happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:381,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallotToAddNewValidator(\n  VOTING_START_DATE, // _startTime\n  VOTING_END_DATE,   // _endTime\n  \&quot;memo\&quot;,            // _memo\n  accounts[3],       // _newMiningKey\n  accounts[4],       // _newVotingKey\n  accounts[5],       // _newPayoutKey\n  {from: miningKeyForVotingKey}\n).should.be.rejectedWith(ERROR_MSG);\nconst {logs} = await voting.createBallotToAddNewValidator(\n  VOTING_START_DATE, // _startTime\n  VOTING_END_DATE,   // _endTime\n  \&quot;memo\&quot;,            // _memo\n  accounts[3],       // _newMiningKey\n  accounts[4],       // _newVotingKey\n  accounts[5],       // _newPayoutKey\n  {from: votingKey}\n).should.be.fulfilled;\n\n(await voting.getKeysManager.call()).should.be.equal(keysManager.address);\nconst ballotInfo = await voting.getBallotInfo.call(id);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  accounts[3], // affectedKey\n  new web3.BigNumber(1), // affectedKeyType\n  accounts[4], // newVotingKey\n  accounts[5], // newPayoutKey\n  &#x27;0x0000000000000000000000000000000000000000&#x27;, // miningKey\n  new web3.BigNumber(0), // totalVoters\n  new web3.BigNumber(0), // progress\n  false, // isFinalized\n  new web3.BigNumber(1), // ballotType\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false // canBeFinalizedNow\n]);\n\nlogs[0].event.should.be.equal(\&quot;BallotCreated\&quot;);\nlogs[0].args.id.should.be.bignumber.equal(0);\nlogs[0].args.ballotType.should.be.bignumber.equal(1);\nlogs[0].args.creator.should.be.equal(votingKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d9b228f4-9e7b-487d-b3a6-fe9248075d56&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;deny adding already existed voting key&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #createBallotToAddNewValidator deny adding already existed voting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:34,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallotToAddNewValidator(\n  VOTING_START_DATE, // _startTime\n  VOTING_END_DATE,   // _endTime\n  \&quot;memo\&quot;,            // _memo\n  accounts[3],       // _newMiningKey\n  votingKey,         // _newVotingKey\n  accounts[5],       // _newPayoutKey\n  {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;815470ab-c1df-41d8-ab2f-bcc34a95603a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;deny adding already existed payout key&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #createBallotToAddNewValidator deny adding already existed payout key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:207,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallotToAddNewValidator(\n  VOTING_START_DATE, // _startTime\n  VOTING_END_DATE,   // _endTime\n  \&quot;memo\&quot;,            // _memo\n  accounts[3],       // _newMiningKey\n  accounts[4],       // _newVotingKey\n  accounts[6],       // _newPayoutKey\n  {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);\nawait voting.createBallotToAddNewValidator(\n  VOTING_START_DATE, // _startTime\n  VOTING_END_DATE,   // _endTime\n  \&quot;memo\&quot;,            // _memo\n  accounts[3],       // _newMiningKey\n  accounts[4],       // _newVotingKey\n  accounts[5],       // _newPayoutKey\n  {from: votingKey}\n).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fccb50e7-9490-4dc7-8d2f-8914d20fdbb3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should create validator with all keys after finalization&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #createBallotToAddNewValidator should create validator with all keys after finalization&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1263,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(accounts[0]);\nconst {logs} = await keysManager.removePayoutKey(miningKeyForVotingKey);\nlogs[0].event.should.be.equal(\&quot;PayoutKeyChanged\&quot;);\nawait addMiningKey(accounts[3]);\nawait addVotingKey(accounts[4], accounts[3]);\nawait addMiningKey(accounts[5]);\nawait addVotingKey(accounts[6], accounts[5]);\nawait proxyStorageMock.setVotingContractMock(voting.address);\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nawait voting.createBallotToAddNewValidator(\n  VOTING_START_DATE, // _startTime\n  VOTING_END_DATE,   // _endTime\n  \&quot;memo\&quot;,            // _memo\n  accounts[7],       // _newMiningKey\n  accounts[8],       // _newVotingKey\n  accounts[9],       // _newPayoutKey\n  {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.accept, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.accept, {from: accounts[4]}).should.be.fulfilled;\nawait voting.vote(id, choice.accept, {from: accounts[6]}).should.be.fulfilled;\n(await poaNetworkConsensusMock.isValidator.call(accounts[7])).should.be.equal(false);\n(await keysManager.isMiningActive.call(accounts[7])).should.be.equal(false);\n(await keysManager.isVotingActive.call(accounts[8])).should.be.equal(false);\n(await keysManager.miningKeyByVoting.call(accounts[8])).should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);\n(await keysManager.miningKeyByPayout.call(accounts[9])).should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);\nawait voting.setTime(VOTING_END_DATE+1);\nawait finalize(id, true, {from: votingKey});\n(await poaNetworkConsensusMock.isValidator.call(accounts[7])).should.be.equal(true);\n(await keysManager.isMiningActive.call(accounts[7])).should.be.equal(true);\n(await keysManager.isVotingActive.call(accounts[8])).should.be.equal(true);\n(await keysManager.miningKeyByVoting.call(accounts[8])).should.be.equal(accounts[7]);\n(await keysManager.miningKeyByPayout.call(accounts[9])).should.be.equal(accounts[7]);\n(await poaNetworkConsensusMock.getCurrentValidatorsLength.call()).should.be.bignumber.equal(4);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\n(await poaNetworkConsensusMock.getCurrentValidatorsLength.call()).should.be.bignumber.equal(5);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e068966f-1c4b-4ce0-99f0-137332c6ba8c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow removing new validator if finalizeChange did not happen&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #createBallotToAddNewValidator should allow removing new validator if finalizeChange did not happen&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2155,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(accounts[0]);\nconst {logs} = await keysManager.removePayoutKey(miningKeyForVotingKey);\nlogs[0].event.should.be.equal(\&quot;PayoutKeyChanged\&quot;);\nawait addMiningKey(accounts[3]);\nawait addVotingKey(accounts[4], accounts[3]);\nawait addMiningKey(accounts[5]);\nawait addVotingKey(accounts[6], accounts[5]);\nawait proxyStorageMock.setVotingContractMock(voting.address);\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nawait voting.createBallotToAddNewValidator(\n  VOTING_START_DATE, // _startTime\n  VOTING_END_DATE,   // _endTime\n  \&quot;memo\&quot;,            // _memo\n  accounts[7],       // _newMiningKey\n  accounts[8],       // _newVotingKey\n  accounts[9],       // _newPayoutKey\n  {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.accept, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.accept, {from: accounts[4]}).should.be.fulfilled;\nawait voting.vote(id, choice.accept, {from: accounts[6]}).should.be.fulfilled;\n(await poaNetworkConsensusMock.isValidator.call(accounts[7])).should.be.equal(false);\n(await keysManager.isMiningActive.call(accounts[7])).should.be.equal(false);\n(await keysManager.isVotingActive.call(accounts[8])).should.be.equal(false);\n(await keysManager.miningKeyByVoting.call(accounts[8])).should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);\n(await keysManager.miningKeyByPayout.call(accounts[9])).should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);\nawait voting.setTime(VOTING_END_DATE+1);\nawait finalize(id, true, {from: votingKey});\n(await poaNetworkConsensusMock.isValidator.call(accounts[7])).should.be.equal(true);\n(await keysManager.isMiningActive.call(accounts[7])).should.be.equal(true);\n(await keysManager.isVotingActive.call(accounts[8])).should.be.equal(true);\n(await keysManager.miningKeyByVoting.call(accounts[8])).should.be.equal(accounts[7]);\n(await keysManager.miningKeyByPayout.call(accounts[9])).should.be.equal(accounts[7]);\n(await poaNetworkConsensusMock.getCurrentValidatorsLength.call()).should.be.bignumber.equal(4);\nVOTING_START_DATE = moment.utc().add(20, &#x27;days&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(30, &#x27;days&#x27;).unix();\nid = await voting.nextBallotId.call();\nawait voting.createBallot(\n  VOTING_START_DATE, // _startTime\n  VOTING_END_DATE,   // _endTime\n  2,                 // _ballotType (KeyRemoval)\n  1,                 // _affectedKeyType (MiningKey)\n  \&quot;memo\&quot;,            // _memo\n  accounts[7],       // _affectedKey\n  accounts[7],       // _miningKey\n  {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.accept, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.accept, {from: accounts[4]}).should.be.fulfilled;\nawait voting.vote(id, choice.accept, {from: accounts[6]}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE+1);\nawait finalize(id, true, {from: votingKey});\n(await poaNetworkConsensusMock.isValidator.call(accounts[7])).should.be.equal(false);\n(await keysManager.isMiningActive.call(accounts[7])).should.be.equal(false);\n(await keysManager.isVotingActive.call(accounts[8])).should.be.equal(false);\n(await keysManager.isPayoutActive.call(accounts[7])).should.be.equal(false);\n(await keysManager.miningKeyByVoting.call(accounts[8])).should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);\n(await keysManager.miningKeyByPayout.call(accounts[9])).should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);\n(await keysManager.getVotingByMining.call(accounts[7])).should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);\n(await keysManager.getPayoutByMining.call(accounts[7])).should.be.equal(&#x27;0x0000000000000000000000000000000000000000&#x27;);\n\n(await poaNetworkConsensusMock.getCurrentValidatorsLength.call()).should.be.bignumber.equal(4);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\n(await poaNetworkConsensusMock.getCurrentValidatorsLength.call()).should.be.bignumber.equal(4);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;55dd7ee2-a44f-43aa-9f3a-edbd1d440683&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d9b228f4-9e7b-487d-b3a6-fe9248075d56&quot;,&quot;815470ab-c1df-41d8-ab2f-bcc34a95603a&quot;,&quot;fccb50e7-9490-4dc7-8d2f-8914d20fdbb3&quot;,&quot;e068966f-1c4b-4ce0-99f0-137332c6ba8c&quot;,&quot;55dd7ee2-a44f-43aa-9f3a-edbd1d440683&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4040,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;f6c5f981-6f2c-41bb-8bff-2d8a0d18fafc&quot;,&quot;title&quot;:&quot;#vote&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_keys_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_keys_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #vote \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:302,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait addMiningKey(accounts[1]);\nawait addVotingKey(votingKey, accounts[1]);\nid = await voting.nextBallotId.call();\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1,\n  1,\n  \&quot;memo\&quot;,\n  accounts[3], \n  accounts[1],\n  {from: votingKey}\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;74357624-e694-4428-81e8-6c81666d6a79&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should let a validator to vote&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #vote should let a validator to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:189,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nconst {logs} = await voting.vote(id, choice.accept, {from: votingKey}).should.be.fulfilled;\nlet progress = (await voting.getBallotInfo.call(id))[8];\nprogress.should.be.bignumber.equal(1);\nlet totalVoters = await voting.getTotalVoters.call(id);\ntotalVoters.should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(&#x27;Vote&#x27;);\nlogs[0].args.decision.should.be.bignumber.equal(1);\nlogs[0].args.voter.should.be.equal(votingKey);\nlogs[0].args.time.should.be.bignumber.equal(VOTING_START_DATE);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;540f099a-4ec5-43ea-b4db-de6318759599&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;reject vote should be accepted&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #vote reject vote should be accepted&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:185,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nconst {logs} = await voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\nlet progress = (await voting.getBallotInfo.call(id))[8];\nprogress.should.be.bignumber.equal(-1);\nlet totalVoters = await voting.getTotalVoters.call(id);\ntotalVoters.should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(&#x27;Vote&#x27;);\nlogs[0].args.decision.should.be.bignumber.equal(2);\nlogs[0].args.voter.should.be.equal(votingKey);\nlogs[0].args.time.should.be.bignumber.equal(VOTING_START_DATE);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8489d35d-14ac-40d4-a0b2-4709f057de46&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow multiple voters to vote&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #vote should allow multiple voters to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:813,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait addVotingKey(accounts[3], accounts[1]);\nawait voting.vote(id, choice.reject, {from: accounts[3]}).should.be.rejectedWith(ERROR_MSG);\n// add new voter\nawait addMiningKey(accounts[2]);\nawait addVotingKey(accounts[4], accounts[2]);\nawait voting.vote(id, choice.reject, {from: accounts[4]}).should.be.fulfilled;\nlet progress = (await voting.getBallotInfo.call(id))[8];\nprogress.should.be.bignumber.equal(-2);\nlet totalVoters = await voting.getTotalVoters.call(id);\ntotalVoters.should.be.bignumber.equal(2);\nawait addMiningKey(accounts[3]);\nawait addVotingKey(accounts[5], accounts[3]);\nawait voting.vote(id, choice.accept, {from: accounts[5]}).should.be.fulfilled;\nprogress = (await voting.getBallotInfo.call(id))[8];\nprogress.should.be.bignumber.equal(-1);\ntotalVoters = await voting.getTotalVoters.call(id);\ntotalVoters.should.be.bignumber.equal(3);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;17443995-f112-4ed5-9a50-eaf0d61f85e5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote nonVoting key&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #vote should not let vote nonVoting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:54,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, {from: accounts[0]}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a64695c0-b35f-4dcc-b6f7-41a49a85869b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote before startTime key&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #vote should not let vote before startTime key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:108,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE - 1);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5c6839b0-276d-4b1d-a79c-51c2b667583d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote after endTime key&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #vote should not let vote after endTime key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:98,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE + 1);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4afee8a5-25ee-45b4-b542-e038ebbd3f55&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with already voted key&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #vote should not let vote with already voted key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:194,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d239e64c-3b28-4473-a561-34ace6925828&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with invalid choice&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #vote should not let vote with invalid choice&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:190,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(id, 0, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(id, 3, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;93cf8ee6-3b75-4135-9a37-9a722d083e5a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with invalid id&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #vote should not let vote with invalid id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:180,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(99, 1, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(-3, 1, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;72f1ccd5-30da-4775-ac43-15e2f36eaad1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;540f099a-4ec5-43ea-b4db-de6318759599&quot;,&quot;8489d35d-14ac-40d4-a0b2-4709f057de46&quot;,&quot;17443995-f112-4ed5-9a50-eaf0d61f85e5&quot;,&quot;a64695c0-b35f-4dcc-b6f7-41a49a85869b&quot;,&quot;5c6839b0-276d-4b1d-a79c-51c2b667583d&quot;,&quot;4afee8a5-25ee-45b4-b542-e038ebbd3f55&quot;,&quot;d239e64c-3b28-4473-a561-34ace6925828&quot;,&quot;93cf8ee6-3b75-4135-9a37-9a722d083e5a&quot;,&quot;72f1ccd5-30da-4775-ac43-15e2f36eaad1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2011,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;9f92ed2d-06f7-4150-95df-67441f78a5a1&quot;,&quot;title&quot;:&quot;#finalize&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_keys_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_keys_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #finalize \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:469,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;votingKey  = accounts[3];\nvotingKey2 = accounts[5];\nvotingKey3 = accounts[6];\npayoutKeyToAdd = accounts[0];\nVOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait addMiningKey(accounts[1]);\nawait addVotingKey(votingKey, accounts[1]);\nawait addMiningKey(accounts[2]);\nawait addVotingKey(votingKey2, accounts[2]);\nawait addMiningKey(accounts[4]);\nawait addVotingKey(votingKey3, accounts[4]);\nawait proxyStorageMock.setVotingContractMock(voting.address);\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;30ff833c-5f6e-4c48-bceb-617cdee0b757&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path - no action since it did not meet minimum number of totalVoters&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #finalize happy path - no action since it did not meet minimum number of totalVoters&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:706,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1,\n  3,\n  \&quot;memo\&quot;,\n  payoutKeyToAdd,\n  accounts[1],\n  {from: votingKey}\n);\nlet activeBallotsLength = await voting.activeBallotsLength.call();\nvotingId = await voting.activeBallots.call(activeBallotsLength.toNumber() - 1);\nawait voting.finalize(votingId, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.finalize(votingId).should.be.rejectedWith(ERROR_MSG);\nawait voting.setTime(VOTING_END_DATE + 1);\nconst {logs} = await voting.finalize(votingId, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(votingId, choice.accept, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nactiveBallotsLength = await voting.activeBallotsLength.call();\nactiveBallotsLength.should.be.bignumber.equal(0);\ntrue.should.be.equal((await voting.getBallotInfo.call(votingId))[9]); // isFinalized\n// Finalized(msg.sender);\nlogs[0].event.should.be.equal(\&quot;BallotFinalized\&quot;);\nlogs[0].args.voter.should.be.equal(votingKey);\nconst ballotInfo = await voting.getBallotInfo.call(votingId);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  payoutKeyToAdd, // affectedKey\n  new web3.BigNumber(3), // affectedKeyType\n  \&quot;0x0000000000000000000000000000000000000000\&quot;, // newVotingKey\n  \&quot;0x0000000000000000000000000000000000000000\&quot;, // newPayoutKey\n  accounts[1], // miningKey\n  new web3.BigNumber(1), // totalVoters\n  new web3.BigNumber(-1), // progress\n  true, // isFinalized\n  new web3.BigNumber(1), // ballotType\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false // canBeFinalizedNow\n]);\n(await voting.getQuorumState.call(votingId)).should.be.bignumber.equal(3);\n(await voting.getIndex.call(votingId)).should.be.bignumber.equal(0);\n(await voting.getMinThresholdOfVoters.call(votingId)).should.be.bignumber.equal(3);\n\ntrue.should.be.equal(\n  await voting.hasAlreadyVoted.call(votingId, votingKey)\n);\nconst keysState = await keysManager.validatorKeys.call(accounts[1]);\nkeysState.should.be.deep.equal(\n  [ votingKey,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  true,\n  false ]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;02ff3203-aadb-467d-b993-58a0894fad0c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize addition of payout key&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #finalize finalize addition of payout key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1091,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// Ballot to Add Payout Key for miner account[1]\nawait deployAndTestBallot({\n  _affectedKey: payoutKeyToAdd,\n  _affectedKeyType: 3,\n  _miningKey: accounts[1],\n  _ballotType: 1,\n})\nconst keysState = await keysManager.validatorKeys.call(accounts[1]);\nkeysState.should.be.deep.equal(\n  [ votingKey,\n  payoutKeyToAdd,\n  true,\n  true,\n  true ]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b3452a2f-6027-460c-9add-517f39eaa4c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize addition of VotingKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #finalize finalize addition of VotingKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1170,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[7];\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait addMiningKey(miningKey);\nawait proxyStorageMock.setVotingContractMock(voting.address);\n// Ballot to Add Voting Key for miner account[1]\nlet votingKeyToAdd = accounts[8];\n// uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n// uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nawait deployAndTestBallot({\n  _affectedKey: votingKeyToAdd,\n  _affectedKeyType: 2,\n  _miningKey: miningKey,\n  _ballotType: 1,\n})\nconst keysState = await keysManager.validatorKeys.call(miningKey);\nkeysState.should.be.deep.equal(\n  [ votingKeyToAdd,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  true,\n  false ]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;338a8609-9097-40d7-a71e-fce7d18eca14&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot create ballot for using previous mining key&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #finalize cannot create ballot for using previous mining key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2570,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(voting.address);\nlet miningKey = accounts[6];\n// uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n// uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nawait deployAndTestBallot({\n  _affectedKey: miningKey,\n  _affectedKeyType: 1,\n  _miningKey: &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  _ballotType: 1,\n})\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\ntrue.should.be.equal(await poaNetworkConsensusMock.isValidator.call(miningKey));\nlet validators = await poaNetworkConsensusMock.getValidators.call();\nawait voting.setTime(VOTING_START_DATE - 1);\nawait deployAndTestBallot({\n  _affectedKey: accounts[5],\n  _affectedKeyType: 1,\n  _miningKey: miningKey,\n  _ballotType: 3,\n  \n})\nawait voting.setTime(VOTING_START_DATE - 1);\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  3,\n  1,\n  \&quot;memo\&quot;,\n  miningKey,\n  accounts[5],\n  {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;41c7a7f3-97a0-4e69-a3fa-88d742dcf382&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize addition of MiningKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #finalize finalize addition of MiningKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1271,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(voting.address);\nlet miningKey = accounts[6];\n// uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n// uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nawait deployAndTestBallot({\n  _affectedKey: miningKey,\n  _affectedKeyType: 1,\n  _miningKey: &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  _ballotType: 1,\n  \n})\nconst keysState = await keysManager.validatorKeys.call(miningKey);\nkeysState.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  false,\n  false ]\n)\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nconst validators = await poaNetworkConsensusMock.getValidators.call();\nvalidators.should.contain(miningKey);\ntrue.should.be.equal(await poaNetworkConsensusMock.isValidator.call(miningKey));&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4a8e0ccc-95fb-4e80-98cc-d37ce7989c2d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize removal of MiningKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #finalize finalize removal of MiningKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2322,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[6];\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait addMiningKey(miningKey);\nawait proxyStorageMock.setVotingContractMock(voting.address);\n// Ballot to Add Voting Key for miner account[1]\n// uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n// uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nawait deployAndTestBallot({\n  _affectedKey: miningKey,\n  _affectedKeyType: 1,\n  _miningKey: miningKey,\n  _ballotType: 2,\n})\nconst keysState = await keysManager.validatorKeys.call(miningKey);\nkeysState.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  false,\n  false,\n  false ]\n)\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nconst validators = await poaNetworkConsensusMock.getValidators.call();\nvalidators.should.not.contain(miningKey);\nfalse.should.be.equal(await poaNetworkConsensusMock.isValidator.call(miningKey));&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8c93e50f-14aa-4b61-a1c1-6e49aa9e4982&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize removal of VotingKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #finalize finalize removal of VotingKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1294,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[7];\nlet votingKeyToAdd = accounts[8];\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait addMiningKey(miningKey);\nawait addVotingKey(votingKeyToAdd, miningKey);\nawait proxyStorageMock.setVotingContractMock(voting.address);\n// uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n// uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nawait deployAndTestBallot({\n  _affectedKey: votingKeyToAdd,\n  _affectedKeyType: 2,\n  _miningKey: miningKey,\n  _ballotType: 2,\n})\nconst keysState = await keysManager.validatorKeys.call(miningKey);\nkeysState.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  false,\n  false ]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9e14e65e-d266-4106-aee2-3e1f281246b0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize removal of PayoutKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #finalize finalize removal of PayoutKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1127,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[7];\nlet affectedKey = accounts[8];\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(miningKey);\nawait addPayoutKey(affectedKey, miningKey);\nawait proxyStorageMock.setVotingContractMock(voting.address);\n// uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n// uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nawait deployAndTestBallot({\n  _affectedKey: affectedKey,\n  _affectedKeyType: 3,\n  _miningKey: miningKey,\n  _ballotType: 2,\n})\nconst keysState = await keysManager.validatorKeys.call(miningKey);\nkeysState.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  false,\n  false ]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b3340669-4169-4ba7-aa3d-704f0dac168e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize swap of VotingKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #finalize finalize swap of VotingKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1124,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[7];\nlet affectedKey = accounts[8];\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(miningKey);\nawait addVotingKey(affectedKey, miningKey);\nawait proxyStorageMock.setVotingContractMock(voting.address);\n// uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n// uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nlet newVotingKey = accounts[2];\nawait deployAndTestBallot({\n  _affectedKey: newVotingKey,\n  _affectedKeyType: 2,\n  _miningKey: miningKey,\n  _ballotType: 3,\n})\nconst keysState = await keysManager.validatorKeys.call(miningKey);\nkeysState.should.be.deep.equal(\n  [ newVotingKey,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  true,\n  false ]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9272a6fe-d7e0-4751-9fbf-039a11e5ffbc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize swap of PayoutKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #finalize finalize swap of PayoutKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1099,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[7];\nlet affectedKey = accounts[8];\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(miningKey);\nawait addPayoutKey(affectedKey, miningKey);\nawait proxyStorageMock.setVotingContractMock(voting.address);\n// Ballot to Add Voting Key for miner account[1]\n// uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n// uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nlet newPayoutKey = accounts[2];\nawait deployAndTestBallot({\n  _affectedKey: newPayoutKey,\n  _affectedKeyType: 3,\n  _miningKey: miningKey,\n  _ballotType: 3,\n})\nconst keysState = await keysManager.validatorKeys.call(miningKey);\nkeysState.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  newPayoutKey,\n  true,\n  false,\n  true ]\n)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d99232c4-b771-4a88-81bb-c08961713463&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize swap of MiningKey&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #finalize finalize swap of MiningKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1381,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[6];\nlet affectedKey = accounts[5];\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait addMiningKey(miningKey);\nawait proxyStorageMock.setVotingContractMock(voting.address);\n// Ballot to Add Voting Key for miner account[1]\n// uint256 _affectedKeyType, [enum KeyTypes {Invalid, MiningKey, VotingKey, PayoutKey}]\n// uint256 _ballotType [  enum BallotTypes {Invalid, Adding, Removal, Swap} ]\nawait deployAndTestBallot({\n  _affectedKey: affectedKey,\n  _affectedKeyType: 1,\n  _miningKey: miningKey,\n  _ballotType: 3,\n})\nconst keysState = await keysManager.validatorKeys.call(miningKey);\nkeysState.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  false,\n  false,\n  false ]\n)\nconst keysStateNew = await keysManager.validatorKeys.call(affectedKey);\nkeysStateNew.should.be.deep.equal(\n  [ &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  true,\n  false,\n  false ]\n)\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nconst validators = await poaNetworkConsensusMock.getValidators.call();\nvalidators.should.not.contain(miningKey);\nvalidators.should.contain(affectedKey);\nfalse.should.be.equal(await poaNetworkConsensusMock.isValidator.call(miningKey));\ntrue.should.be.equal(await poaNetworkConsensusMock.isValidator.call(affectedKey));&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1676cdc3-328e-4c93-9037-a9787bad2002&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;prevent double finalize&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #finalize prevent double finalize&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1941,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let miningKey = accounts[6];\nlet affectedKey = accounts[5];\nawait proxyStorageMock.setVotingContractMock(masterOfCeremony);\nawait addMiningKey(miningKey);\nawait proxyStorageMock.setVotingContractMock(voting.address);\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  3,\n  1,\n  \&quot;memo\&quot;,\n  affectedKey,\n  miningKey,\n  {from: votingKey}\n);\nawait voting.createBallot(\n  VOTING_START_DATE+2,\n  VOTING_END_DATE+2,\n  2,\n  1,\n  \&quot;memo\&quot;,\n  affectedKey,\n  miningKey,\n  {from: votingKey}\n);\nconst activeBallotsLength = await voting.activeBallotsLength.call();\nvotingId = await voting.activeBallots.call(activeBallotsLength.toNumber() - 2);\nlet votingIdForSecond = votingId.add(1);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.reject, {from: votingKey}).should.be.fulfilled;\nfalse.should.be.equal(await voting.hasAlreadyVoted.call(votingId, votingKey2));\nawait voting.vote(votingId, choice.accept, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(votingId, choice.accept, {from: votingKey3}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nfalse.should.be.equal((await voting.getBallotInfo.call(votingId))[9]); // isFinalized\nawait finalize(votingId, true, {from: votingKey});\nnew web3.BigNumber(3).should.be.bignumber.equal(await voting.getBallotType.call(votingId));\ntrue.should.be.equal((await voting.getBallotInfo.call(votingId))[9]); // isFinalized\nawait voting.finalize(votingId, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.finalize(votingIdForSecond, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nnew web3.BigNumber(2).should.be.bignumber.equal(await voting.getBallotType.call(votingIdForSecond));\nfalse.should.be.equal((await voting.getBallotInfo.call(votingIdForSecond))[9]); // isFinalized\nawait voting.vote(votingIdForSecond, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 3);\nawait finalize(votingIdForSecond, true, {from: votingKey});\nnew web3.BigNumber(-1).should.be.bignumber.equal((await voting.getBallotInfo.call(votingIdForSecond))[8]) // progress\nnew web3.BigNumber(1).should.be.bignumber.equal((await voting.getBallotInfo.call(votingId))[8]) // progress&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2815539f-141c-4dce-8615-5226ba909905&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;allowed at once after all validators gave their votes&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #finalize allowed at once after all validators gave their votes&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1731,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const miningKey = accounts[4];\nconst affectedKey = accounts[6];\nawait voting.createBallot(\n  VOTING_START_DATE, // uint256 _startTime\n  VOTING_END_DATE,   // uint256 _endTime\n  3,                 // uint256 _ballotType (KeySwap)\n  1,                 // uint256 _affectedKeyType (MiningKey)\n  \&quot;memo\&quot;,            // string _memo\n  affectedKey,       // address _affectedKey\n  miningKey,         // address _miningKey\n  {from: votingKey3}\n).should.be.fulfilled;\nfalse.should.be.equal((await voting.getBallotInfo.call(0))[9]); // isFinalized\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(0, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(0, choice.reject, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(0, choice.accept, {from: votingKey3}).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE+1);\nawait voting.finalize(0, {from: votingKey2}).should.be.rejectedWith(ERROR_MSG);\nfalse.should.be.equal((await voting.getBallotInfo.call(0))[9]); // isFinalized\nawait voting.setTime(VOTING_START_DATE+172800+1);\n(await voting.getTime.call()).should.be.bignumber.below(VOTING_END_DATE);\nawait finalize(0, true, {from: votingKey2});\ntrue.should.be.equal((await voting.getBallotInfo.call(0))[9]); // isFinalized\nawait voting.setTime(VOTING_END_DATE+1);\nawait voting.finalize(0, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nVOTING_START_DATE = moment.utc().add(12, &#x27;days&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(22, &#x27;days&#x27;).unix();\nawait voting.createBallot(\n  VOTING_START_DATE, // uint256 _startTime\n  VOTING_END_DATE,   // uint256 _endTime\n  3,                 // uint256 _ballotType (KeySwap)\n  1,                 // uint256 _affectedKeyType (MiningKey)\n  \&quot;memo\&quot;,            // string _memo\n  affectedKey,       // address _affectedKey\n  miningKey,         // address _miningKey\n  {from: votingKey3}\n).should.be.fulfilled;\nfalse.should.be.equal((await voting.getBallotInfo.call(1))[9]); // isFinalized\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(1, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(1, choice.reject, {from: votingKey2}).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE+172800+1);\n(await voting.getTime.call()).should.be.bignumber.below(VOTING_END_DATE);\nawait voting.finalize(1, {from: votingKey2}).should.be.rejectedWith(ERROR_MSG);\nfalse.should.be.equal((await voting.getBallotInfo.call(1))[9]); // isFinalized\nawait voting.setTime(VOTING_END_DATE+1);\nawait finalize(1, true, {from: votingKey2});\ntrue.should.be.equal((await voting.getBallotInfo.call(1))[9]); // isFinalized&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0d0d58cf-13f5-443c-a260-466477b57fa0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;02ff3203-aadb-467d-b993-58a0894fad0c&quot;,&quot;b3452a2f-6027-460c-9add-517f39eaa4c0&quot;,&quot;338a8609-9097-40d7-a71e-fce7d18eca14&quot;,&quot;41c7a7f3-97a0-4e69-a3fa-88d742dcf382&quot;,&quot;4a8e0ccc-95fb-4e80-98cc-d37ce7989c2d&quot;,&quot;8c93e50f-14aa-4b61-a1c1-6e49aa9e4982&quot;,&quot;9e14e65e-d266-4106-aee2-3e1f281246b0&quot;,&quot;b3340669-4169-4ba7-aa3d-704f0dac168e&quot;,&quot;9272a6fe-d7e0-4751-9fbf-039a11e5ffbc&quot;,&quot;d99232c4-b771-4a88-81bb-c08961713463&quot;,&quot;1676cdc3-328e-4c93-9037-a9787bad2002&quot;,&quot;2815539f-141c-4dce-8615-5226ba909905&quot;,&quot;0d0d58cf-13f5-443c-a260-466477b57fa0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:18827,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;8df2dc3d-70da-4d06-a558-e72300bc6ee7&quot;,&quot;title&quot;:&quot;#migrate&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_keys_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_keys_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should copy a ballot to the new contract&quot;,&quot;fullTitle&quot;:&quot;Contract: Voting to change keys upgraded [all features] #migrate should copy a ballot to the new contract&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2061,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(miningKeyForVotingKey);\nawait addVotingKey(votingKey, miningKeyForVotingKey);\nawait addMiningKey(accounts[3]);\nawait addVotingKey(accounts[4], accounts[3]);\nawait addMiningKey(accounts[5]);\nawait addVotingKey(accounts[6], accounts[5]);\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nVOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nconst id = await voting.nextBallotId.call();\nawait voting.createBallot(\n  VOTING_START_DATE, // _startTime\n  VOTING_END_DATE,   // _endTime\n  1,                 // _ballotType (KeyAdding)\n  1,                 // _affectedKeyType (MiningKey)\n  \&quot;memo\&quot;,            // _memo\n  accounts[7],       // _affectedKey\n  accounts[2],       // _miningKey\n  {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.reject, {from: accounts[4]}).should.be.fulfilled;\nawait voting.vote(id, choice.reject, {from: accounts[6]}).should.be.fulfilled;\nlet votingNew = await VotingToChangeKeysMock.new();\nvotingEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, votingNew.address);\nvotingNew = await VotingToChangeKeysMock.at(votingEternalStorage.address);\nawait votingNew.init(172800).should.be.fulfilled;\nawait votingNew.setTime(VOTING_START_DATE);\nawait votingNew.migrateBasicOne(\n  id,\n  voting.address,\n  [miningKeyForVotingKey, accounts[3], accounts[5]]\n).should.be.fulfilled;\nconst ballotInfo = await votingNew.getBallotInfo.call(id);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  accounts[7], // affectedKey\n  new web3.BigNumber(1), // affectedKeyType\n  \&quot;0x0000000000000000000000000000000000000000\&quot;, // newVotingKey\n  \&quot;0x0000000000000000000000000000000000000000\&quot;, // newPayoutKey\n  accounts[2], // miningKey\n  new web3.BigNumber(3), // totalVoters\n  new web3.BigNumber(-3), // progress\n  false, // isFinalized\n  new web3.BigNumber(1), // ballotType\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false // canBeFinalizedNow\n]);\n(await votingNew.getQuorumState.call(id)).should.be.bignumber.equal(1);\n(await votingNew.getIndex.call(id)).should.be.bignumber.equal(0);\n(await votingNew.getMinThresholdOfVoters.call(id)).should.be.bignumber.equal(3);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, miningKeyForVotingKey)).should.be.equal(true);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, accounts[2])).should.be.equal(false);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, accounts[3])).should.be.equal(true);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, accounts[4])).should.be.equal(false);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, accounts[5])).should.be.equal(true);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, accounts[6])).should.be.equal(false);\n(await votingNew.nextBallotId.call()).should.be.bignumber.equal(0);\n(await votingNew.activeBallotsLength.call()).should.be.bignumber.equal(0);\n(await votingNew.validatorActiveBallots.call(miningKeyForVotingKey)).should.be.bignumber.equal(0);\nawait votingNew.migrateBasicAll(voting.address, {from: accounts[6]}).should.be.rejectedWith(ERROR_MSG);\nawait votingNew.migrateBasicAll(&#x27;0x0000000000000000000000000000000000000000&#x27;).should.be.rejectedWith(ERROR_MSG);\nawait votingNew.migrateBasicAll(voting.address).should.be.fulfilled;\nawait votingNew.migrateBasicAll(voting.address).should.be.fulfilled;\n(await votingNew.nextBallotId.call()).should.be.bignumber.equal(1);\n(await votingNew.activeBallotsLength.call()).should.be.bignumber.equal(1);\n(await votingNew.validatorActiveBallots.call(miningKeyForVotingKey)).should.be.bignumber.equal(1);\n(await votingNew.migrateDisabled.call()).should.be.equal(false);\nawait votingNew.migrateDisable({from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait votingNew.migrateDisable().should.be.fulfilled;\n(await votingNew.migrateDisabled.call()).should.be.equal(true);\nawait votingNew.migrateBasicAll(voting.address).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;00e711f2-5668-4b2d-a47b-f3feed201b46&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;00e711f2-5668-4b2d-a47b-f3feed201b46&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2061,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;47deeb60-2277-4015-9297-63e8960f167f&quot;,&quot;title&quot;:&quot;Contract: VotingToChangeMinThreshold [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_min_threshold_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_min_threshold_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3335,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8c4b306e-b354-4c0c-a220-d4f783fbb094&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;74732489-314d-4149-b542-5005d5663acd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1358,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;votingKey = accounts[3];\nvotingKey2 = accounts[5];\nvotingKey3 = accounts[6];\nmasterOfCeremony = accounts[0];\nminingKeyForVotingKey = accounts[1];\npoaNetworkConsensusMock = await PoaNetworkConsensusMock.new(masterOfCeremony, []);\n\nproxyStorageMock = await ProxyStorageMock.new();\nconst proxyStorageEternalStorage = await EternalStorageProxy.new(0, proxyStorageMock.address);\nproxyStorageMock = await ProxyStorageMock.at(proxyStorageEternalStorage.address);\nawait proxyStorageMock.init(poaNetworkConsensusMock.address).should.be.fulfilled;\n\nkeysManager = await KeysManagerMock.new();\nconst keysManagerEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, keysManager.address);\nkeysManager = await KeysManagerMock.at(keysManagerEternalStorage.address);\nawait keysManager.init(\n  \&quot;0x0000000000000000000000000000000000000000\&quot;\n).should.be.fulfilled;\n\nballotsStorage = await BallotsStorage.new();\nconst ballotsEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, ballotsStorage.address);\nconst validatorMetadata = await ValidatorMetadata.new();\nconst validatorMetadataEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, validatorMetadata.address);\n\nawait poaNetworkConsensusMock.setProxyStorage(proxyStorageMock.address);\n\nvoting = await Voting.new();\nvotingEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, voting.address);\nvoting = await Voting.at(votingEternalStorage.address);\nawait voting.init(172800, 0).should.be.rejectedWith(ERROR_MSG);\nawait voting.init(172800, 3).should.be.fulfilled;\nawait voting.migrateDisable().should.be.fulfilled;\n\nawait proxyStorageMock.initializeAddresses(\n  keysManager.address,\n  accounts[0],\n  voting.address,\n  accounts[0],\n  accounts[0],\n  ballotsEternalStorage.address,\n  validatorMetadataEternalStorage.address,\n  accounts[0]\n);\n\nballotsStorage = await BallotsStorage.at(ballotsEternalStorage.address);\nawait ballotsStorage.init([3, 2]).should.be.fulfilled;\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(miningKeyForVotingKey);\nawait addVotingKey(votingKey, miningKeyForVotingKey);\nawait addMiningKey(accounts[2]);\nawait addVotingKey(votingKey2, accounts[2]);\nawait addMiningKey(accounts[4]);\nawait addVotingKey(votingKey3, accounts[4]);\nawait addMiningKey(accounts[7]);\nawait addMiningKey(accounts[8]);\nawait addMiningKey(accounts[9]);\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5c5a4dcb-2852-4796-9435-7fcb2c1957a6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8a74609a-55da-4aab-bb66-1d2bf43ae411&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;692fa19d-65b6-4a78-9cac-86b4af2f7ccd&quot;,&quot;title&quot;:&quot;#createBallot&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_min_threshold_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_min_threshold_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #createBallot \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nid = await voting.nextBallotId.call();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8bef8885-d633-4727-8839-7c17beaf2c6f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #createBallot happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:288,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await voting.createBallot(VOTING_START_DATE, VOTING_END_DATE, 4, \&quot;memo\&quot;, {from: votingKey});\nconst keysManagerFromContract = await voting.getKeysManager.call();\nconst ballotInfo = await voting.getBallotInfo.call(id, votingKey);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  new web3.BigNumber(0), // totalVoters\n  new web3.BigNumber(0), // progress\n  false, // isFinalized\n  new web3.BigNumber(4), // proposedValue\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false, // canBeFinalizedNow\n  false // hasAlreadyVoted\n]);\n(await voting.getQuorumState.call(id)).should.be.bignumber.equal(1);\n(await voting.getIndex.call(id)).should.be.bignumber.equal(0);\n(await voting.getMinThresholdOfVoters.call(id)).should.be.bignumber.equal(3);\nkeysManagerFromContract.should.be.equal(keysManager.address);\nlogs[0].event.should.be.equal(\&quot;BallotCreated\&quot;);\nlogs[0].args.id.should.be.bignumber.equal(0);\nlogs[0].args.creator.should.be.equal(votingKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;87ccd948-3e57-4ec9-8a55-dede96ebe027&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;proposed value should be more than or equal to 3&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #createBallot proposed value should be more than or equal to 3&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(VOTING_START_DATE, VOTING_END_DATE, 2,\&quot;memo\&quot;, {from: votingKey}).should.be.fulfilled.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c35b8316-1cde-45bd-b8dc-2aab3f7469be&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;proposed value should not be equal to the same value&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #createBallot proposed value should not be equal to the same value&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:34,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(VOTING_START_DATE, VOTING_END_DATE, 3,\&quot;memo\&quot;, {from: votingKey}).should.be.fulfilled.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ecc834c2-a158-4332-b433-92d968b4e21c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create more ballots than the limit&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #createBallot should not let create more ballots than the limit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10288,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait voting.createBallot(VOTING_START_DATE, VOTING_END_DATE, 4,\&quot;memo\&quot;, {from: votingKey});\nawait voting.createBallot(VOTING_START_DATE, VOTING_END_DATE, 4,\&quot;memo\&quot;, {from: votingKey});\n// we have 6 validators, so 200 limit / 6 = 33.3 ~ 33\nnew web3.BigNumber(33).should.be.bignumber.equal(await voting.getBallotLimitPerValidator.call());\nawait addValidators({proxyStorageMock, keysManager, poaNetworkConsensusMock}); // add 100 validators, so total will be 106 validators\nnew web3.BigNumber(1).should.be.bignumber.equal(await voting.getBallotLimitPerValidator.call());\nawait voting.createBallot(VOTING_START_DATE, VOTING_END_DATE, 4, \&quot;memo\&quot;,{from: votingKey}).should.be.rejectedWith(ERROR_MSG)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9c72ed19-b158-4410-b26c-3c40b3168ed0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;87ccd948-3e57-4ec9-8a55-dede96ebe027&quot;,&quot;c35b8316-1cde-45bd-b8dc-2aab3f7469be&quot;,&quot;ecc834c2-a158-4332-b433-92d968b4e21c&quot;,&quot;9c72ed19-b158-4410-b26c-3c40b3168ed0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:10635,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;982b6d8b-012b-4e0a-b2e9-8afc74f85e0f&quot;,&quot;title&quot;:&quot;#vote&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_min_threshold_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_min_threshold_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:172,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nid = await voting.nextBallotId.call();\nlet validators = await poaNetworkConsensusMock.getValidators.call();\nawait voting.createBallot(VOTING_START_DATE, VOTING_END_DATE, 4, \&quot;memo\&quot;,{from: votingKey});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;58bfa8d0-35d4-4e0c-8edb-923664fe15c2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should let a validator to vote&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote should let a validator to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:192,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nconst {logs} = await voting.vote(id, choice.accept, {from: votingKey}).should.be.fulfilled;\nlet progress = (await voting.getBallotInfo.call(id, votingKey))[3];\nprogress.should.be.bignumber.equal(1);\nlet totalVoters = await voting.getTotalVoters.call(id);\ntotalVoters.should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(&#x27;Vote&#x27;);\nlogs[0].args.decision.should.be.bignumber.equal(1);\nlogs[0].args.voter.should.be.equal(votingKey);\nlogs[0].args.time.should.be.bignumber.equal(VOTING_START_DATE);\nlogs[0].args.voterMiningKey.should.be.equal(miningKeyForVotingKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a411d28c-3807-40cc-8018-720164a76766&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;reject vote should be accepted&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote reject vote should be accepted&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:203,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nconst {logs} = await voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\nlet progress = (await voting.getBallotInfo.call(id, votingKey))[3];\nprogress.should.be.bignumber.equal(-1);\nlet totalVoters = await voting.getTotalVoters.call(id);\ntotalVoters.should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(&#x27;Vote&#x27;);\nlogs[0].args.decision.should.be.bignumber.equal(2);\nlogs[0].args.voter.should.be.equal(votingKey);\nlogs[0].args.time.should.be.bignumber.equal(VOTING_START_DATE);\nlogs[0].args.voterMiningKey.should.be.equal(miningKeyForVotingKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8d6eae3d-37f6-477d-9274-4de36ee3bbf8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow multiple voters to vote&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote should allow multiple voters to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:447,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\n// add new voter\nawait voting.vote(id, choice.reject, {from: votingKey2}).should.be.fulfilled;\nlet progress = (await voting.getBallotInfo.call(id, votingKey))[3];\nprogress.should.be.bignumber.equal(-2);\nlet totalVoters = await voting.getTotalVoters.call(id);\ntotalVoters.should.be.bignumber.equal(2);\nawait voting.vote(id, choice.accept, {from: votingKey3}).should.be.fulfilled;\nprogress = (await voting.getBallotInfo.call(id, votingKey))[3];\nprogress.should.be.bignumber.equal(-1);\ntotalVoters = await voting.getTotalVoters.call(id);\ntotalVoters.should.be.bignumber.equal(3);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;47e53b56-90dc-4c92-a943-269026f547c8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote nonVoting key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote should not let vote nonVoting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, {from: accounts[0]}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;852062bf-d460-46ba-a361-b4811eacc4f7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote before startTime key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote should not let vote before startTime key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:92,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE - 1);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d38a5314-7862-4cd0-8827-00b0d0780978&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote after endTime key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote should not let vote after endTime key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:96,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE + 1);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6ef03e55-4f8a-4096-a239-0cc3b05f16d7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with already voted key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote should not let vote with already voted key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:183,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fd8b369d-d3d7-40ea-a7e5-8405cbd2df1a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with invalid choice&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote should not let vote with invalid choice&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:184,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(id, 0, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(id, 3, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d114cc54-a818-40d5-91fc-fb85395f5a47&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with invalid id&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #vote should not let vote with invalid id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:171,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(99, 1, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(-3, 1, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d11e1c68-59d3-40c7-ac75-b35031b3e200&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a411d28c-3807-40cc-8018-720164a76766&quot;,&quot;8d6eae3d-37f6-477d-9274-4de36ee3bbf8&quot;,&quot;47e53b56-90dc-4c92-a943-269026f547c8&quot;,&quot;852062bf-d460-46ba-a361-b4811eacc4f7&quot;,&quot;d38a5314-7862-4cd0-8827-00b0d0780978&quot;,&quot;6ef03e55-4f8a-4096-a239-0cc3b05f16d7&quot;,&quot;fd8b369d-d3d7-40ea-a7e5-8405cbd2df1a&quot;,&quot;d114cc54-a818-40d5-91fc-fb85395f5a47&quot;,&quot;d11e1c68-59d3-40c7-ac75-b35031b3e200&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1624,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;af335973-aeee-4b8f-8c65-2253f923894d&quot;,&quot;title&quot;:&quot;#finalize&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_min_threshold_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_min_threshold_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #finalize \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;payoutKeyToAdd = accounts[0];\nVOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0c618fa4-cfdc-44bc-8307-a92a536ca557&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;does not change if it did not pass minimum threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #finalize does not change if it did not pass minimum threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:733,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let proposedValue = 4;\nvotingId = await voting.nextBallotId.call();\nawait voting.createBallot(VOTING_START_DATE, VOTING_END_DATE, proposedValue, \&quot;memo\&quot;, {from: votingKey});\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.accept, {from: votingKey}).should.be.fulfilled;\n// await voting.vote(votingId, choice.accept, {from: votingKey2}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nconst {logs} = await voting.finalize(votingId, {from: votingKey});\nactiveBallotsLength = await voting.activeBallotsLength.call();\nactiveBallotsLength.should.be.bignumber.equal(0);\ntrue.should.be.equal((await voting.getBallotInfo.call(votingId, votingKey))[4]); // isFinalized\n// Finalized(msg.sender);\nlogs[0].event.should.be.equal(\&quot;BallotFinalized\&quot;);\nlogs[0].args.voter.should.be.equal(votingKey);\nconst ballotInfo = await voting.getBallotInfo.call(votingId, votingKey);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  new web3.BigNumber(1), // totalVoters\n  new web3.BigNumber(1), // progress\n  true, // isFinalized\n  new web3.BigNumber(proposedValue), // proposedValue\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false, // canBeFinalizedNow\n  true // hasAlreadyVoted\n]);\n(await voting.getQuorumState.call(votingId)).should.be.bignumber.equal(3);\n(await voting.getIndex.call(votingId)).should.be.bignumber.equal(0);\n(await voting.getMinThresholdOfVoters.call(votingId)).should.be.bignumber.equal(3);\nconst minThresholdOfVoters = await ballotsStorage.getBallotThreshold.call(1);\nminThresholdOfVoters.should.be.bignumber.equal(3);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;73e7eab8-6195-4bc2-b4c2-8cd6233946ef&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change to proposedValue when quorum is reached&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #finalize should change to proposedValue when quorum is reached&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1258,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let proposedValue = 4;\nvotingId = await voting.nextBallotId.call();\nawait voting.createBallot(VOTING_START_DATE, VOTING_END_DATE, proposedValue, \&quot;memo\&quot;, {from: votingKey});\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.accept, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(votingId, choice.accept, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(votingId, choice.accept, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(votingId, choice.reject, {from: votingKey3}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nconst {logs} = await voting.finalize(votingId, {from: votingKey});\nactiveBallotsLength = await voting.activeBallotsLength.call();\nactiveBallotsLength.should.be.bignumber.equal(0);\ntrue.should.be.equal((await voting.getBallotInfo.call(votingId, votingKey))[4]); // isFinalized\n// Finalized(msg.sender);\nlogs[0].event.should.be.equal(\&quot;BallotFinalized\&quot;);\nlogs[0].args.voter.should.be.equal(votingKey);\nconst ballotInfo = await voting.getBallotInfo.call(votingId, votingKey);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  new web3.BigNumber(3), // totalVoters\n  new web3.BigNumber(1), // progress\n  true, // isFinalized\n  new web3.BigNumber(proposedValue), // proposedValue\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false, // canBeFinalizedNow\n  true // hasAlreadyVoted\n]);\n(await voting.getQuorumState.call(votingId)).should.be.bignumber.equal(2);\n(await voting.getIndex.call(votingId)).should.be.bignumber.equal(0);\n(await voting.getMinThresholdOfVoters.call(votingId)).should.be.bignumber.equal(3);\ntrue.should.be.equal(\n  await voting.hasAlreadyVoted.call(votingId, votingKey2)\n);\ntrue.should.be.equal(\n  await voting.hasAlreadyVoted.call(votingId, votingKey3)\n);\nconst minThresholdOfVoters = await ballotsStorage.getBallotThreshold.call(1);\nminThresholdOfVoters.should.be.bignumber.equal(proposedValue);\nlet votingForKeys = await VotingForKeys.new();\nconst votingForKeysEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, votingForKeys.address);\nvotingForKeys = await VotingForKeys.at(votingForKeysEternalStorage.address);\nawait votingForKeys.init(172800);\nawait votingForKeys.migrateDisable();\nconst nextId = await votingForKeys.nextBallotId.call();\nawait votingForKeys.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1,\n  3,\n  \&quot;memo\&quot;,\n  accounts[5],\n  accounts[1],\n  {from: votingKey}\n);\nconst minThresholdVotingForKeys = await votingForKeys.getMinThresholdOfVoters.call(nextId);\nminThresholdVotingForKeys.should.be.bignumber.equal(proposedValue);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;094a424a-f723-4010-9673-dd5371c5448f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;prevents double finalize&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #finalize prevents double finalize&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1766,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let proposedValue1 = 4;\nlet proposedValue2 = 5;\nawait voting.createBallot(VOTING_START_DATE, VOTING_END_DATE, proposedValue1, \&quot;memo\&quot;,{from: votingKey});\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(\&quot;0xa6Bf70bd230867c870eF13631D7EFf1AE8Ab85c9\&quot;);\nawait addMiningKey(\&quot;0xa6Bf70bd230867c870eF13631D7EFf1AE8Ab85d9\&quot;);\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nawait voting.createBallot(VOTING_START_DATE+2, VOTING_END_DATE+2, proposedValue2, \&quot;memo\&quot;,{from: votingKey});\nawait voting.finalize(votingId, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nconst activeBallotsLength = await voting.activeBallotsLength.call();\nvotingId = await voting.activeBallots.call(activeBallotsLength.toNumber() - 2);\nlet votingIdForSecond = votingId.add(1);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.reject, {from: votingKey}).should.be.fulfilled;\nfalse.should.be.equal(await voting.hasAlreadyVoted.call(votingId, votingKey2));\nawait voting.vote(votingId, choice.accept, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(votingId, choice.accept, {from: votingKey3}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nfalse.should.be.equal((await voting.getBallotInfo.call(votingId, votingKey))[4]); // isFinalized\nawait finalize(votingId, true, {from: votingKey});\nawait voting.vote(votingId, choice.accept, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nnew web3.BigNumber(4).should.be.bignumber.equal(await voting.getProposedValue.call(votingId));\ntrue.should.be.equal((await voting.getBallotInfo.call(votingId, votingKey))[4]); // isFinalized\nawait voting.finalize(votingId, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.finalize(votingIdForSecond, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nnew web3.BigNumber(5).should.be.bignumber.equal(await voting.getProposedValue.call(votingIdForSecond));\nfalse.should.be.equal((await voting.getBallotInfo.call(votingIdForSecond, votingKey))[4]); // isFinalized\nawait voting.vote(votingIdForSecond, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 3);\nawait finalize(votingIdForSecond, true, {from: votingKey});\nnew web3.BigNumber(-1).should.be.bignumber.equal((await voting.getBallotInfo.call(votingIdForSecond, votingKey))[3]) // progress\nnew web3.BigNumber(1).should.be.bignumber.equal((await voting.getBallotInfo.call(votingId, votingKey))[3]) // progress&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;24600790-ad94-48c2-8801-a9db9f279da8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;allowed at once after all validators gave their votes&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #finalize allowed at once after all validators gave their votes&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2147,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let result = await keysManager.removeMiningKey(accounts[7]);\nresult.logs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nresult = await keysManager.removeMiningKey(accounts[8]);\nresult.logs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nresult = await keysManager.removeMiningKey(accounts[9]);\nresult.logs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nawait voting.setMinPossibleThreshold(2);\nawait voting.createBallot(\n  VOTING_START_DATE, // uint256 _startTime\n  VOTING_END_DATE,   // uint256 _endTime\n  2,                 // uint256 _proposedValue\n  \&quot;memo\&quot;,            // string _memo\n  {from: votingKey3}\n).should.be.fulfilled;\nfalse.should.be.equal((await voting.getBallotInfo.call(0, votingKey3))[4]); // isFinalized\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(0, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(0, choice.reject, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(0, choice.accept, {from: votingKey3}).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE+1);\nawait voting.finalize(0, {from: votingKey2}).should.be.rejectedWith(ERROR_MSG);\nfalse.should.be.equal((await voting.getBallotInfo.call(0, votingKey2))[4]); // isFinalized\nawait voting.setTime(VOTING_START_DATE+172800+1);\n(await voting.getTime.call()).should.be.bignumber.below(VOTING_END_DATE);\nawait finalize(0, true, {from: votingKey2});\ntrue.should.be.equal((await voting.getBallotInfo.call(0, votingKey2))[4]); // isFinalized\nawait voting.setTime(VOTING_END_DATE+1);\nawait voting.finalize(0, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nVOTING_START_DATE = moment.utc().add(12, &#x27;days&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(22, &#x27;days&#x27;).unix();\nawait voting.createBallot(\n  VOTING_START_DATE, // uint256 _startTime\n  VOTING_END_DATE,   // uint256 _endTime\n  2,                 // uint256 _proposedValue\n  \&quot;memo\&quot;,            // string _memo\n  {from: votingKey3}\n).should.be.fulfilled;\nfalse.should.be.equal((await voting.getBallotInfo.call(1, votingKey3))[4]); // isFinalized\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(1, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(1, choice.reject, {from: votingKey2}).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE+172800+1);\n(await voting.getTime.call()).should.be.bignumber.below(VOTING_END_DATE);\nawait voting.finalize(1, {from: votingKey2}).should.be.rejectedWith(ERROR_MSG);\nfalse.should.be.equal((await voting.getBallotInfo.call(1, votingKey2))[4]); // isFinalized\nawait voting.setTime(VOTING_END_DATE+1);\nawait finalize(1, true, {from: votingKey2});\ntrue.should.be.equal((await voting.getBallotInfo.call(1, votingKey2))[4]); // isFinalized&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e463636f-6124-465b-aa39-6f44ecabd1db&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should decrease validator limit only once when calling finalize more than once&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #finalize should decrease validator limit only once when calling finalize more than once&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1666,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let result = await keysManager.removeMiningKey(accounts[7]);\nresult.logs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nresult = await keysManager.removeMiningKey(accounts[8]);\nresult.logs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nresult = await keysManager.removeMiningKey(accounts[9]);\nresult.logs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nawait voting.setMinPossibleThreshold(2);\nawait ballotsStorage.setThresholdMock(1, 1);\nvotingId = await voting.nextBallotId.call();\nawait voting.createBallot(VOTING_START_DATE, VOTING_END_DATE, 2, \&quot;memo\&quot;, {from: votingKey});\nawait voting.createBallot(VOTING_START_DATE, VOTING_END_DATE, 2, \&quot;memo\&quot;, {from: votingKey});\n(await voting.validatorActiveBallots.call(miningKeyForVotingKey)).should.be.bignumber.equal(2);\n\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.accept, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(votingId, choice.accept, {from: votingKey2}).should.be.fulfilled;\nawait ballotsStorage.setThresholdMock(2, 1);\nawait voting.setTime(VOTING_END_DATE + 1);\nresult = await voting.finalize(votingId, {from: votingKey});\nresult.logs.length.should.be.equal(0);\n(await voting.validatorActiveBallots.call(miningKeyForVotingKey)).should.be.bignumber.equal(1);\n(await voting.getIsFinalized.call(votingId)).should.be.equal(false);\n(await voting.getQuorumState.call(votingId)).should.be.bignumber.equal(1);\nresult = await voting.finalize(votingId, {from: votingKey});\nresult.logs.length.should.be.equal(0);\n(await voting.validatorActiveBallots.call(miningKeyForVotingKey)).should.be.bignumber.equal(1);\n(await voting.getIsFinalized.call(votingId)).should.be.equal(false);\n(await voting.getQuorumState.call(votingId)).should.be.bignumber.equal(1);\nawait ballotsStorage.setThresholdMock(1, 1);\nresult = await voting.finalize(votingId, {from: votingKey});\nresult.logs[0].event.should.equal(\&quot;BallotFinalized\&quot;);\n(await voting.validatorActiveBallots.call(miningKeyForVotingKey)).should.be.bignumber.equal(1);\n(await voting.getIsFinalized.call(votingId)).should.be.equal(true);\n(await voting.getQuorumState.call(votingId)).should.be.bignumber.equal(2);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b4e25354-7a82-4e0e-bdd1-7333390284c5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;73e7eab8-6195-4bc2-b4c2-8cd6233946ef&quot;,&quot;094a424a-f723-4010-9673-dd5371c5448f&quot;,&quot;24600790-ad94-48c2-8801-a9db9f279da8&quot;,&quot;e463636f-6124-465b-aa39-6f44ecabd1db&quot;,&quot;b4e25354-7a82-4e0e-bdd1-7333390284c5&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:7570,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;b58c6ecd-d3e2-4127-b23c-e05a5fa30a49&quot;,&quot;title&quot;:&quot;#migrate&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_min_threshold_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_min_threshold_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should copy a ballot to the new contract&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #migrate should copy a ballot to the new contract&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1576,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nconst id = await voting.nextBallotId.call();\nawait voting.createBallot(VOTING_START_DATE, VOTING_END_DATE, 4, \&quot;memo\&quot;, {from: votingKey}).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.reject, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(id, choice.reject, {from: votingKey3}).should.be.fulfilled;\nlet votingNew = await Voting.new();\nvotingEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, votingNew.address);\nvotingNew = await Voting.at(votingEternalStorage.address);\nawait votingNew.init(172800, 3).should.be.fulfilled;\nawait votingNew.setTime(VOTING_START_DATE);\nawait votingNew.migrateBasicOne(\n  id,\n  voting.address,\n  [miningKeyForVotingKey, accounts[2], accounts[4]]\n).should.be.fulfilled;\nconst ballotInfo = await votingNew.getBallotInfo.call(id, votingKey);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  new web3.BigNumber(3), // totalVoters\n  new web3.BigNumber(-3), // progress\n  false, // isFinalized\n  new web3.BigNumber(4), // proposedValue\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false, // canBeFinalizedNow\n  true // hasAlreadyVoted\n]);\n(await votingNew.getQuorumState.call(id)).should.be.bignumber.equal(1);\n(await votingNew.getIndex.call(id)).should.be.bignumber.equal(0);\n(await votingNew.getMinThresholdOfVoters.call(id)).should.be.bignumber.equal(3);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, miningKeyForVotingKey)).should.be.equal(true);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, accounts[2])).should.be.equal(true);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, accounts[4])).should.be.equal(true);\n(await votingNew.nextBallotId.call()).should.be.bignumber.equal(0);\n(await votingNew.activeBallotsLength.call()).should.be.bignumber.equal(0);\n(await votingNew.validatorActiveBallots.call(accounts[1])).should.be.bignumber.equal(0);\nawait votingNew.migrateBasicAll(voting.address, {from: accounts[6]}).should.be.rejectedWith(ERROR_MSG);\nawait votingNew.migrateBasicAll(&#x27;0x0000000000000000000000000000000000000000&#x27;).should.be.rejectedWith(ERROR_MSG);\nawait votingNew.migrateBasicAll(voting.address).should.be.fulfilled;\nawait votingNew.migrateBasicAll(voting.address).should.be.fulfilled;\n(await votingNew.nextBallotId.call()).should.be.bignumber.equal(1);\n(await votingNew.activeBallotsLength.call()).should.be.bignumber.equal(1);\n(await votingNew.validatorActiveBallots.call(accounts[1])).should.be.bignumber.equal(1);\n(await votingNew.migrateDisabled.call()).should.be.equal(false);\nawait votingNew.migrateDisable({from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait votingNew.migrateDisable().should.be.fulfilled;\n(await votingNew.migrateDisabled.call()).should.be.equal(true);\nawait votingNew.migrateBasicAll(voting.address).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;88f7b509-51bb-446a-800d-9de8f136cc6e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;88f7b509-51bb-446a-800d-9de8f136cc6e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1576,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;d19fc8f2-357c-4f59-b970-0fae80d09fbc&quot;,&quot;title&quot;:&quot;#upgradeTo&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_min_threshold_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_min_threshold_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #upgradeTo \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:145,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;proxyStorageStubAddress = accounts[8];\nvoting = await Voting.new();\nvotingOldImplementation = voting.address;\nvotingEternalStorage = await EternalStorageProxy.new(proxyStorageStubAddress, voting.address);\nvoting = await Voting.at(votingEternalStorage.address);\nawait voting.init(172800, 3).should.be.fulfilled;\nawait voting.migrateDisable().should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1883c863-7da0-41f0-b4fa-5aa96282c83d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called by ProxyStorage&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #upgradeTo may only be called by ProxyStorage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:91,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let votingNew = await VotingNew.new();\nawait votingEternalStorage.upgradeTo(votingNew.address, {from: accounts[0]}).should.be.rejectedWith(ERROR_MSG);\nawait upgradeTo(votingNew.address, {from: proxyStorageStubAddress});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0b95e2b7-d173-4377-8d19-95443ed42ddd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change implementation address&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #upgradeTo should change implementation address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:90,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let votingNew = await VotingNew.new();\nlet newImplementation = votingNew.address;\n(await votingEternalStorage.implementation.call()).should.be.equal(votingOldImplementation);\nawait upgradeTo(newImplementation, {from: proxyStorageStubAddress});\n(await votingEternalStorage.implementation.call()).should.be.equal(newImplementation);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;66117ed9-fc20-425d-ba4c-e0a31caa8436&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should increment implementation version&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #upgradeTo should increment implementation version&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:93,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let votingNew = await VotingNew.new();\nlet oldVersion = await votingEternalStorage.version.call();\nlet newVersion = oldVersion.add(1);\nawait upgradeTo(votingNew.address, {from: proxyStorageStubAddress});\n(await votingEternalStorage.version.call()).should.be.bignumber.equal(newVersion);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a18fa387-00c6-4c26-92b0-2dbb5db7af11&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should work&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #upgradeTo new implementation should work&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:116,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let votingNew = await VotingNew.new();\nawait upgradeTo(votingNew.address, {from: proxyStorageStubAddress});\nvotingNew = await VotingNew.at(votingEternalStorage.address);\n(await votingNew.initialized.call()).should.be.equal(false);\nawait votingNew.initialize();\n(await votingNew.initialized.call()).should.be.equal(true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bcdf0dc3-6f06-43b7-847a-1618951bc35a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should use the same proxyStorage address&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #upgradeTo new implementation should use the same proxyStorage address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:103,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let votingNew = await VotingNew.new();\nawait upgradeTo(votingNew.address, {from: proxyStorageStubAddress});\nvotingNew = await VotingNew.at(votingEternalStorage.address);\n(await votingNew.proxyStorage.call()).should.be.equal(proxyStorageStubAddress);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9456651f-67e5-437b-bf2e-27734f0c5551&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should use the same storage&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold [all features] #upgradeTo new implementation should use the same storage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:406,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nconst id = await voting.nextBallotId.call();\nawait votingEternalStorage.setProxyStorage(proxyStorageMock.address);\nawait voting.createBallot(VOTING_START_DATE, VOTING_END_DATE, 4, \&quot;memo\&quot;, {from: votingKey}).should.be.fulfilled;\nawait votingEternalStorage.setProxyStorage(proxyStorageStubAddress);\nlet votingNew = await VotingNew.new();\nawait upgradeTo(votingNew.address, {from: proxyStorageStubAddress});\nvotingNew = await VotingNew.at(votingEternalStorage.address);\nawait votingEternalStorage.setProxyStorage(proxyStorageMock.address);\nconst ballotInfo = await votingNew.getBallotInfo.call(id, votingKey);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  new web3.BigNumber(0), // totalVoters\n  new web3.BigNumber(0), // progress\n  false, // isFinalized\n  new web3.BigNumber(4), // proposedValue\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false, // canBeFinalizedNow\n  false // hasAlreadyVoted\n]);\n(await votingNew.getQuorumState.call(id)).should.be.bignumber.equal(1);\n(await votingNew.getIndex.call(id)).should.be.bignumber.equal(0);\n(await votingNew.getMinThresholdOfVoters.call(id)).should.be.bignumber.equal(3);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;40014619-0e2f-4298-bd9c-2cd2abff367f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0b95e2b7-d173-4377-8d19-95443ed42ddd&quot;,&quot;66117ed9-fc20-425d-ba4c-e0a31caa8436&quot;,&quot;a18fa387-00c6-4c26-92b0-2dbb5db7af11&quot;,&quot;bcdf0dc3-6f06-43b7-847a-1618951bc35a&quot;,&quot;9456651f-67e5-437b-bf2e-27734f0c5551&quot;,&quot;40014619-0e2f-4298-bd9c-2cd2abff367f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:899,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;e5f4e429-c6e2-4def-b13f-5c2c54f744d3&quot;,&quot;title&quot;:&quot;Contract: VotingToChangeMinThreshold upgraded [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_min_threshold_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_min_threshold_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold upgraded [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3000,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b24d5a28-f3ef-4bb5-8e48-ba8d23c3b3e0&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold upgraded [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c5ba5a1e-9c9c-40a9-8f86-9602d0b6ede3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold upgraded [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1710,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;votingKey = accounts[3];\nvotingKey2 = accounts[5];\nvotingKey3 = accounts[6];\nmasterOfCeremony = accounts[0];\nminingKeyForVotingKey = accounts[1];\npoaNetworkConsensusMock = await PoaNetworkConsensusMock.new(masterOfCeremony, []);\n\nproxyStorageMock = await ProxyStorageMock.new();\nconst proxyStorageEternalStorage = await EternalStorageProxy.new(0, proxyStorageMock.address);\nproxyStorageMock = await ProxyStorageMock.at(proxyStorageEternalStorage.address);\nawait proxyStorageMock.init(poaNetworkConsensusMock.address).should.be.fulfilled;\n\nkeysManager = await KeysManagerMock.new();\nconst keysManagerEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, keysManager.address);\nkeysManager = await KeysManagerMock.at(keysManagerEternalStorage.address);\nawait keysManager.init(\n  \&quot;0x0000000000000000000000000000000000000000\&quot;\n).should.be.fulfilled;\n\nballotsStorage = await BallotsStorage.new();\nconst ballotsEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, ballotsStorage.address);\nconst validatorMetadata = await ValidatorMetadata.new();\nconst validatorMetadataEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, validatorMetadata.address);\n\nawait poaNetworkConsensusMock.setProxyStorage(proxyStorageMock.address);\n\nvoting = await Voting.new();\nvotingEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, voting.address);\nvoting = await Voting.at(votingEternalStorage.address);\nawait voting.init(172800, 0).should.be.rejectedWith(ERROR_MSG);\nawait voting.init(172800, 3).should.be.fulfilled;\nawait voting.migrateDisable().should.be.fulfilled;\nconst votingNew = await VotingNew.new();\nawait votingEternalStorage.setProxyStorage(accounts[6]);\nconst {logs} = await votingEternalStorage.upgradeTo(votingNew.address, {from: accounts[6]});\nlogs[0].event.should.be.equal(\&quot;Upgraded\&quot;);\nawait votingEternalStorage.setProxyStorage(proxyStorageMock.address);\nvoting = await VotingNew.at(votingEternalStorage.address);\n\nawait proxyStorageMock.initializeAddresses(\n  keysManager.address,\n  accounts[0],\n  voting.address,\n  accounts[0],\n  accounts[0],\n  ballotsEternalStorage.address,\n  validatorMetadataEternalStorage.address,\n  accounts[0]\n);\n\nballotsStorage = await BallotsStorage.at(ballotsEternalStorage.address);\nawait ballotsStorage.init([3, 2]).should.be.fulfilled;\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(miningKeyForVotingKey);\nawait addVotingKey(votingKey, miningKeyForVotingKey);\nawait addMiningKey(accounts[2]);\nawait addVotingKey(votingKey2, accounts[2]);\nawait addMiningKey(accounts[4]);\nawait addVotingKey(votingKey3, accounts[4]);\nawait addMiningKey(accounts[7]);\nawait addMiningKey(accounts[8]);\nawait addMiningKey(accounts[9]);\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6c652081-4e56-4e0b-b714-834f89f29776&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold upgraded [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a5bee32d-ca68-4ab2-abe6-5f36d1c2505a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;32451210-f2de-408d-a3c5-d659604c4a1b&quot;,&quot;title&quot;:&quot;#createBallot&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_min_threshold_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_min_threshold_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold upgraded [all features] #createBallot \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nid = await voting.nextBallotId.call();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;818d3294-a74c-4bc9-ab5f-abc008ab33ad&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold upgraded [all features] #createBallot happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:236,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await voting.createBallot(VOTING_START_DATE, VOTING_END_DATE, 4, \&quot;memo\&quot;, {from: votingKey});\nconst keysManagerFromContract = await voting.getKeysManager.call();\nconst ballotInfo = await voting.getBallotInfo.call(id, votingKey);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  new web3.BigNumber(0), // totalVoters\n  new web3.BigNumber(0), // progress\n  false, // isFinalized\n  new web3.BigNumber(4), // proposedValue\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false, // canBeFinalizedNow\n  false // hasAlreadyVoted\n]);\n(await voting.getQuorumState.call(id)).should.be.bignumber.equal(1);\n(await voting.getIndex.call(id)).should.be.bignumber.equal(0);\n(await voting.getMinThresholdOfVoters.call(id)).should.be.bignumber.equal(3);\nkeysManagerFromContract.should.be.equal(keysManager.address);\nlogs[0].event.should.be.equal(\&quot;BallotCreated\&quot;);\nlogs[0].args.id.should.be.bignumber.equal(0);\nlogs[0].args.creator.should.be.equal(votingKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;30601dc2-de87-46d5-a20c-66b31edc16e0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;proposed value should be more than or equal to 3&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold upgraded [all features] #createBallot proposed value should be more than or equal to 3&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(VOTING_START_DATE, VOTING_END_DATE, 2,\&quot;memo\&quot;, {from: votingKey}).should.be.fulfilled.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f0ea4229-4f82-481a-a53d-b193600f364b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;proposed value should not be equal to the same value&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold upgraded [all features] #createBallot proposed value should not be equal to the same value&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(VOTING_START_DATE, VOTING_END_DATE, 3,\&quot;memo\&quot;, {from: votingKey}).should.be.fulfilled.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;034212d0-ace7-4826-b0bd-4e2cb0893c39&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create more ballots than the limit&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold upgraded [all features] #createBallot should not let create more ballots than the limit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10301,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait voting.createBallot(VOTING_START_DATE, VOTING_END_DATE, 4,\&quot;memo\&quot;, {from: votingKey});\nawait voting.createBallot(VOTING_START_DATE, VOTING_END_DATE, 4,\&quot;memo\&quot;, {from: votingKey});\n// we have 6 validators, so 200 limit / 6 = 33.3 ~ 33\nnew web3.BigNumber(33).should.be.bignumber.equal(await voting.getBallotLimitPerValidator.call());\nawait addValidators({proxyStorageMock, keysManager, poaNetworkConsensusMock}); // add 100 validators, so total will be 106 validators\nnew web3.BigNumber(1).should.be.bignumber.equal(await voting.getBallotLimitPerValidator.call());\nawait voting.createBallot(VOTING_START_DATE, VOTING_END_DATE, 4, \&quot;memo\&quot;,{from: votingKey}).should.be.rejectedWith(ERROR_MSG)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d5fab31c-d777-4f9c-a500-c62f7734762f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;30601dc2-de87-46d5-a20c-66b31edc16e0&quot;,&quot;f0ea4229-4f82-481a-a53d-b193600f364b&quot;,&quot;034212d0-ace7-4826-b0bd-4e2cb0893c39&quot;,&quot;d5fab31c-d777-4f9c-a500-c62f7734762f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:10591,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;0bd83764-73f8-4dbc-9b0c-c68b4e48f38e&quot;,&quot;title&quot;:&quot;#vote&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_min_threshold_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_min_threshold_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold upgraded [all features] #vote \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:174,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nid = await voting.nextBallotId.call();\nlet validators = await poaNetworkConsensusMock.getValidators.call();\nawait voting.createBallot(VOTING_START_DATE, VOTING_END_DATE, 4, \&quot;memo\&quot;,{from: votingKey});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;20fa92cf-759d-44db-8f6f-010c79db07a5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should let a validator to vote&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold upgraded [all features] #vote should let a validator to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:196,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nconst {logs} = await voting.vote(id, choice.accept, {from: votingKey}).should.be.fulfilled;\nlet progress = (await voting.getBallotInfo.call(id, votingKey))[3];\nprogress.should.be.bignumber.equal(1);\nlet totalVoters = await voting.getTotalVoters.call(id);\ntotalVoters.should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(&#x27;Vote&#x27;);\nlogs[0].args.decision.should.be.bignumber.equal(1);\nlogs[0].args.voter.should.be.equal(votingKey);\nlogs[0].args.time.should.be.bignumber.equal(VOTING_START_DATE);\nlogs[0].args.voterMiningKey.should.be.equal(miningKeyForVotingKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;951a8fb4-3a4c-4aa3-b46a-e61a42585428&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;reject vote should be accepted&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold upgraded [all features] #vote reject vote should be accepted&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:200,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nconst {logs} = await voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\nlet progress = (await voting.getBallotInfo.call(id, votingKey))[3];\nprogress.should.be.bignumber.equal(-1);\nlet totalVoters = await voting.getTotalVoters.call(id);\ntotalVoters.should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(&#x27;Vote&#x27;);\nlogs[0].args.decision.should.be.bignumber.equal(2);\nlogs[0].args.voter.should.be.equal(votingKey);\nlogs[0].args.time.should.be.bignumber.equal(VOTING_START_DATE);\nlogs[0].args.voterMiningKey.should.be.equal(miningKeyForVotingKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;afc01708-caa6-4f7e-b4fd-31caa9523148&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow multiple voters to vote&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold upgraded [all features] #vote should allow multiple voters to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:513,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\n// add new voter\nawait voting.vote(id, choice.reject, {from: votingKey2}).should.be.fulfilled;\nlet progress = (await voting.getBallotInfo.call(id, votingKey))[3];\nprogress.should.be.bignumber.equal(-2);\nlet totalVoters = await voting.getTotalVoters.call(id);\ntotalVoters.should.be.bignumber.equal(2);\nawait voting.vote(id, choice.accept, {from: votingKey3}).should.be.fulfilled;\nprogress = (await voting.getBallotInfo.call(id, votingKey))[3];\nprogress.should.be.bignumber.equal(-1);\ntotalVoters = await voting.getTotalVoters.call(id);\ntotalVoters.should.be.bignumber.equal(3);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;dd187731-0daa-4fb0-b389-d49286443849&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote nonVoting key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold upgraded [all features] #vote should not let vote nonVoting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, {from: accounts[0]}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4e3c0e44-bb34-4b7d-bbce-807c570f9f6d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote before startTime key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold upgraded [all features] #vote should not let vote before startTime key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:96,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE - 1);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bc48e222-e46f-4f4f-b1c8-9b155bb1c9ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote after endTime key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold upgraded [all features] #vote should not let vote after endTime key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:101,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE + 1);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c1748c12-0f68-4877-a405-7fbad5c2ec7a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with already voted key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold upgraded [all features] #vote should not let vote with already voted key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:184,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bccc8d58-2391-4b2c-a0bf-c70e14f12cb8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with invalid choice&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold upgraded [all features] #vote should not let vote with invalid choice&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:162,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(id, 0, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(id, 3, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3fae44a3-98df-4861-82cc-20480ec1653f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with invalid id&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold upgraded [all features] #vote should not let vote with invalid id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:173,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(99, 1, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(-3, 1, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8ed974fa-34ae-438c-8b34-54e430c80243&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;951a8fb4-3a4c-4aa3-b46a-e61a42585428&quot;,&quot;afc01708-caa6-4f7e-b4fd-31caa9523148&quot;,&quot;dd187731-0daa-4fb0-b389-d49286443849&quot;,&quot;4e3c0e44-bb34-4b7d-bbce-807c570f9f6d&quot;,&quot;bc48e222-e46f-4f4f-b1c8-9b155bb1c9ba&quot;,&quot;c1748c12-0f68-4877-a405-7fbad5c2ec7a&quot;,&quot;bccc8d58-2391-4b2c-a0bf-c70e14f12cb8&quot;,&quot;3fae44a3-98df-4861-82cc-20480ec1653f&quot;,&quot;8ed974fa-34ae-438c-8b34-54e430c80243&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1671,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;0829f7de-48d6-4817-ae3f-ec9031309fd7&quot;,&quot;title&quot;:&quot;#finalize&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_min_threshold_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_min_threshold_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold upgraded [all features] #finalize \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;payoutKeyToAdd = accounts[0];\nVOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6d9938a2-b37d-4378-8af8-acda17e5e74f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;does not change if it did not pass minimum threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold upgraded [all features] #finalize does not change if it did not pass minimum threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:681,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let proposedValue = 4;\nvotingId = await voting.nextBallotId.call();\nawait voting.createBallot(VOTING_START_DATE, VOTING_END_DATE, proposedValue, \&quot;memo\&quot;, {from: votingKey});\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.accept, {from: votingKey}).should.be.fulfilled;\n// await voting.vote(votingId, choice.accept, {from: votingKey2}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nconst {logs} = await voting.finalize(votingId, {from: votingKey});\nactiveBallotsLength = await voting.activeBallotsLength.call();\nactiveBallotsLength.should.be.bignumber.equal(0);\ntrue.should.be.equal((await voting.getBallotInfo.call(votingId, votingKey))[4]); // isFinalized\n// Finalized(msg.sender);\nlogs[0].event.should.be.equal(\&quot;BallotFinalized\&quot;);\nlogs[0].args.voter.should.be.equal(votingKey);\nconst ballotInfo = await voting.getBallotInfo.call(votingId, votingKey);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  new web3.BigNumber(1), // totalVoters\n  new web3.BigNumber(1), // progress\n  true, // isFinalized\n  new web3.BigNumber(proposedValue), // proposedValue\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false, // canBeFinalizedNow\n  true // hasAlreadyVoted\n]);\n(await voting.getQuorumState.call(votingId)).should.be.bignumber.equal(3);\n(await voting.getIndex.call(votingId)).should.be.bignumber.equal(0);\n(await voting.getMinThresholdOfVoters.call(votingId)).should.be.bignumber.equal(3);\nconst minThresholdOfVoters = await ballotsStorage.getBallotThreshold.call(1);\nminThresholdOfVoters.should.be.bignumber.equal(3);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1a1e190c-8fc5-4157-8f7d-307efbf27f17&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change to proposedValue when quorum is reached&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold upgraded [all features] #finalize should change to proposedValue when quorum is reached&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1338,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let proposedValue = 4;\nvotingId = await voting.nextBallotId.call();\nawait voting.createBallot(VOTING_START_DATE, VOTING_END_DATE, proposedValue, \&quot;memo\&quot;, {from: votingKey});\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.accept, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(votingId, choice.accept, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(votingId, choice.accept, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(votingId, choice.reject, {from: votingKey3}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nconst {logs} = await voting.finalize(votingId, {from: votingKey});\nactiveBallotsLength = await voting.activeBallotsLength.call();\nactiveBallotsLength.should.be.bignumber.equal(0);\ntrue.should.be.equal((await voting.getBallotInfo.call(votingId, votingKey))[4]); // isFinalized\n// Finalized(msg.sender);\nlogs[0].event.should.be.equal(\&quot;BallotFinalized\&quot;);\nlogs[0].args.voter.should.be.equal(votingKey);\nconst ballotInfo = await voting.getBallotInfo.call(votingId, votingKey);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  new web3.BigNumber(3), // totalVoters\n  new web3.BigNumber(1), // progress\n  true, // isFinalized\n  new web3.BigNumber(proposedValue), // proposedValue\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false, // canBeFinalizedNow\n  true // hasAlreadyVoted\n]);\n(await voting.getQuorumState.call(votingId)).should.be.bignumber.equal(2);\n(await voting.getIndex.call(votingId)).should.be.bignumber.equal(0);\n(await voting.getMinThresholdOfVoters.call(votingId)).should.be.bignumber.equal(3);\ntrue.should.be.equal(\n  await voting.hasAlreadyVoted.call(votingId, votingKey2)\n);\ntrue.should.be.equal(\n  await voting.hasAlreadyVoted.call(votingId, votingKey3)\n);\nconst minThresholdOfVoters = await ballotsStorage.getBallotThreshold.call(1);\nminThresholdOfVoters.should.be.bignumber.equal(proposedValue);\nlet votingForKeys = await VotingForKeys.new();\nconst votingForKeysEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, votingForKeys.address);\nvotingForKeys = await VotingForKeys.at(votingForKeysEternalStorage.address);\nawait votingForKeys.init(172800);\nawait votingForKeys.migrateDisable();\nconst nextId = await votingForKeys.nextBallotId.call();\nawait votingForKeys.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1,\n  3,\n  \&quot;memo\&quot;,\n  accounts[5],\n  accounts[1],\n  {from: votingKey}\n);\nconst minThresholdVotingForKeys = await votingForKeys.getMinThresholdOfVoters.call(nextId);\nminThresholdVotingForKeys.should.be.bignumber.equal(proposedValue);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;04560be7-d2bd-4995-9258-66da0d594bdb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;prevents double finalize&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold upgraded [all features] #finalize prevents double finalize&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1910,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let proposedValue1 = 4;\nlet proposedValue2 = 5;\nawait voting.createBallot(VOTING_START_DATE, VOTING_END_DATE, proposedValue1, \&quot;memo\&quot;,{from: votingKey});\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(\&quot;0xa6Bf70bd230867c870eF13631D7EFf1AE8Ab85c9\&quot;);\nawait addMiningKey(\&quot;0xa6Bf70bd230867c870eF13631D7EFf1AE8Ab85d9\&quot;);\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nawait voting.createBallot(VOTING_START_DATE+2, VOTING_END_DATE+2, proposedValue2, \&quot;memo\&quot;,{from: votingKey});\nawait voting.finalize(votingId, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nconst activeBallotsLength = await voting.activeBallotsLength.call();\nvotingId = await voting.activeBallots.call(activeBallotsLength.toNumber() - 2);\nlet votingIdForSecond = votingId.add(1);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.reject, {from: votingKey}).should.be.fulfilled;\nfalse.should.be.equal(await voting.hasAlreadyVoted.call(votingId, votingKey2));\nawait voting.vote(votingId, choice.accept, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(votingId, choice.accept, {from: votingKey3}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nfalse.should.be.equal((await voting.getBallotInfo.call(votingId, votingKey))[4]); // isFinalized\nawait finalize(votingId, true, {from: votingKey});\nawait voting.vote(votingId, choice.accept, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nnew web3.BigNumber(4).should.be.bignumber.equal(await voting.getProposedValue.call(votingId));\ntrue.should.be.equal((await voting.getBallotInfo.call(votingId, votingKey))[4]); // isFinalized\nawait voting.finalize(votingId, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.finalize(votingIdForSecond, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nnew web3.BigNumber(5).should.be.bignumber.equal(await voting.getProposedValue.call(votingIdForSecond));\nfalse.should.be.equal((await voting.getBallotInfo.call(votingIdForSecond, votingKey))[4]); // isFinalized\nawait voting.vote(votingIdForSecond, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 3);\nawait finalize(votingIdForSecond, true, {from: votingKey});\nnew web3.BigNumber(-1).should.be.bignumber.equal((await voting.getBallotInfo.call(votingIdForSecond, votingKey))[3]) // progress\nnew web3.BigNumber(1).should.be.bignumber.equal((await voting.getBallotInfo.call(votingId, votingKey))[3]) // progress&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;47eb2627-fedd-48f1-91f1-6816ac0a5f95&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;allowed at once after all validators gave their votes&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold upgraded [all features] #finalize allowed at once after all validators gave their votes&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2089,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let result = await keysManager.removeMiningKey(accounts[7]);\nresult.logs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nresult = await keysManager.removeMiningKey(accounts[8]);\nresult.logs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nresult = await keysManager.removeMiningKey(accounts[9]);\nresult.logs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nawait voting.setMinPossibleThreshold(2);\nawait voting.createBallot(\n  VOTING_START_DATE, // uint256 _startTime\n  VOTING_END_DATE,   // uint256 _endTime\n  2,                 // uint256 _proposedValue\n  \&quot;memo\&quot;,            // string _memo\n  {from: votingKey3}\n).should.be.fulfilled;\nfalse.should.be.equal((await voting.getBallotInfo.call(0, votingKey3))[4]); // isFinalized\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(0, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(0, choice.reject, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(0, choice.accept, {from: votingKey3}).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE+1);\nawait voting.finalize(0, {from: votingKey2}).should.be.rejectedWith(ERROR_MSG);\nfalse.should.be.equal((await voting.getBallotInfo.call(0, votingKey2))[4]); // isFinalized\nawait voting.setTime(VOTING_START_DATE+172800+1);\n(await voting.getTime.call()).should.be.bignumber.below(VOTING_END_DATE);\nawait finalize(0, true, {from: votingKey2});\ntrue.should.be.equal((await voting.getBallotInfo.call(0, votingKey2))[4]); // isFinalized\nawait voting.setTime(VOTING_END_DATE+1);\nawait voting.finalize(0, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nVOTING_START_DATE = moment.utc().add(12, &#x27;days&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(22, &#x27;days&#x27;).unix();\nawait voting.createBallot(\n  VOTING_START_DATE, // uint256 _startTime\n  VOTING_END_DATE,   // uint256 _endTime\n  2,                 // uint256 _proposedValue\n  \&quot;memo\&quot;,            // string _memo\n  {from: votingKey3}\n).should.be.fulfilled;\nfalse.should.be.equal((await voting.getBallotInfo.call(1, votingKey3))[4]); // isFinalized\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(1, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(1, choice.reject, {from: votingKey2}).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE+172800+1);\n(await voting.getTime.call()).should.be.bignumber.below(VOTING_END_DATE);\nawait voting.finalize(1, {from: votingKey2}).should.be.rejectedWith(ERROR_MSG);\nfalse.should.be.equal((await voting.getBallotInfo.call(1, votingKey2))[4]); // isFinalized\nawait voting.setTime(VOTING_END_DATE+1);\nawait finalize(1, true, {from: votingKey2});\ntrue.should.be.equal((await voting.getBallotInfo.call(1, votingKey2))[4]); // isFinalized&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;9ebddab5-51c8-48fe-8810-e4344b6fec67&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should decrease validator limit only once when calling finalize more than once&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold upgraded [all features] #finalize should decrease validator limit only once when calling finalize more than once&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1563,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let result = await keysManager.removeMiningKey(accounts[7]);\nresult.logs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nresult = await keysManager.removeMiningKey(accounts[8]);\nresult.logs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nresult = await keysManager.removeMiningKey(accounts[9]);\nresult.logs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nawait voting.setMinPossibleThreshold(2);\nawait ballotsStorage.setThresholdMock(1, 1);\nvotingId = await voting.nextBallotId.call();\nawait voting.createBallot(VOTING_START_DATE, VOTING_END_DATE, 2, \&quot;memo\&quot;, {from: votingKey});\nawait voting.createBallot(VOTING_START_DATE, VOTING_END_DATE, 2, \&quot;memo\&quot;, {from: votingKey});\n(await voting.validatorActiveBallots.call(miningKeyForVotingKey)).should.be.bignumber.equal(2);\n\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.accept, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(votingId, choice.accept, {from: votingKey2}).should.be.fulfilled;\nawait ballotsStorage.setThresholdMock(2, 1);\nawait voting.setTime(VOTING_END_DATE + 1);\nresult = await voting.finalize(votingId, {from: votingKey});\nresult.logs.length.should.be.equal(0);\n(await voting.validatorActiveBallots.call(miningKeyForVotingKey)).should.be.bignumber.equal(1);\n(await voting.getIsFinalized.call(votingId)).should.be.equal(false);\n(await voting.getQuorumState.call(votingId)).should.be.bignumber.equal(1);\nresult = await voting.finalize(votingId, {from: votingKey});\nresult.logs.length.should.be.equal(0);\n(await voting.validatorActiveBallots.call(miningKeyForVotingKey)).should.be.bignumber.equal(1);\n(await voting.getIsFinalized.call(votingId)).should.be.equal(false);\n(await voting.getQuorumState.call(votingId)).should.be.bignumber.equal(1);\nawait ballotsStorage.setThresholdMock(1, 1);\nresult = await voting.finalize(votingId, {from: votingKey});\nresult.logs[0].event.should.equal(\&quot;BallotFinalized\&quot;);\n(await voting.validatorActiveBallots.call(miningKeyForVotingKey)).should.be.bignumber.equal(1);\n(await voting.getIsFinalized.call(votingId)).should.be.equal(true);\n(await voting.getQuorumState.call(votingId)).should.be.bignumber.equal(2);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a7cac9a4-011e-4894-b7f5-a9ebfc195338&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1a1e190c-8fc5-4157-8f7d-307efbf27f17&quot;,&quot;04560be7-d2bd-4995-9258-66da0d594bdb&quot;,&quot;47eb2627-fedd-48f1-91f1-6816ac0a5f95&quot;,&quot;9ebddab5-51c8-48fe-8810-e4344b6fec67&quot;,&quot;a7cac9a4-011e-4894-b7f5-a9ebfc195338&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:7581,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;35c058bf-c169-4f77-9d5e-dacfbeef527a&quot;,&quot;title&quot;:&quot;#migrate&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_min_threshold_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_min_threshold_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should copy a ballot to the new contract&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeMinThreshold upgraded [all features] #migrate should copy a ballot to the new contract&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1522,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nconst id = await voting.nextBallotId.call();\nawait voting.createBallot(VOTING_START_DATE, VOTING_END_DATE, 4, \&quot;memo\&quot;, {from: votingKey}).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.reject, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(id, choice.reject, {from: votingKey3}).should.be.fulfilled;\nlet votingNew = await Voting.new();\nvotingEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, votingNew.address);\nvotingNew = await Voting.at(votingEternalStorage.address);\nawait votingNew.init(172800, 3).should.be.fulfilled;\nawait votingNew.setTime(VOTING_START_DATE);\nawait votingNew.migrateBasicOne(\n  id,\n  voting.address,\n  [miningKeyForVotingKey, accounts[2], accounts[4]]\n).should.be.fulfilled;\nconst ballotInfo = await votingNew.getBallotInfo.call(id, votingKey);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  new web3.BigNumber(3), // totalVoters\n  new web3.BigNumber(-3), // progress\n  false, // isFinalized\n  new web3.BigNumber(4), // proposedValue\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false, // canBeFinalizedNow\n  true // hasAlreadyVoted\n]);\n(await votingNew.getQuorumState.call(id)).should.be.bignumber.equal(1);\n(await votingNew.getIndex.call(id)).should.be.bignumber.equal(0);\n(await votingNew.getMinThresholdOfVoters.call(id)).should.be.bignumber.equal(3);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, miningKeyForVotingKey)).should.be.equal(true);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, accounts[2])).should.be.equal(true);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, accounts[4])).should.be.equal(true);\n(await votingNew.nextBallotId.call()).should.be.bignumber.equal(0);\n(await votingNew.activeBallotsLength.call()).should.be.bignumber.equal(0);\n(await votingNew.validatorActiveBallots.call(accounts[1])).should.be.bignumber.equal(0);\nawait votingNew.migrateBasicAll(voting.address, {from: accounts[6]}).should.be.rejectedWith(ERROR_MSG);\nawait votingNew.migrateBasicAll(&#x27;0x0000000000000000000000000000000000000000&#x27;).should.be.rejectedWith(ERROR_MSG);\nawait votingNew.migrateBasicAll(voting.address).should.be.fulfilled;\nawait votingNew.migrateBasicAll(voting.address).should.be.fulfilled;\n(await votingNew.nextBallotId.call()).should.be.bignumber.equal(1);\n(await votingNew.activeBallotsLength.call()).should.be.bignumber.equal(1);\n(await votingNew.validatorActiveBallots.call(accounts[1])).should.be.bignumber.equal(1);\n(await votingNew.migrateDisabled.call()).should.be.equal(false);\nawait votingNew.migrateDisable({from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait votingNew.migrateDisable().should.be.fulfilled;\n(await votingNew.migrateDisabled.call()).should.be.equal(true);\nawait votingNew.migrateBasicAll(voting.address).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f4847a31-fe4b-4264-a035-b7126cc13b0a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f4847a31-fe4b-4264-a035-b7126cc13b0a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1522,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;6913772c-cc14-4435-b324-19396c6cd8f5&quot;,&quot;title&quot;:&quot;Contract: VotingToChangeProxyAddress [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_proxy_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_proxy_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2274,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;976eafd6-a8b8-4fdb-a074-3a5ae350366d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8c9e3c9f-8c85-4832-9e34-72710ce61e08&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1307,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;votingKey = accounts[2];\nmasterOfCeremony = accounts[0];\nminingKeyForVotingKey = accounts[1];\npoaNetworkConsensusMock = await PoaNetworkConsensusMock.new(masterOfCeremony, []);\n\nproxyStorageMock = await ProxyStorageMock.new();\nproxyStorageEternalStorage = await EternalStorageProxy.new(0, proxyStorageMock.address);\nproxyStorageMock = await ProxyStorageMock.at(proxyStorageEternalStorage.address);\nawait proxyStorageMock.init(poaNetworkConsensusMock.address).should.be.fulfilled;\nawait poaNetworkConsensusMock.setProxyStorage(proxyStorageMock.address);\n\nkeysManager = await KeysManagerMock.new();\nconst keysManagerEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, keysManager.address);\nkeysManager = await KeysManagerMock.at(keysManagerEternalStorage.address);\nawait keysManager.init(\n  \&quot;0x0000000000000000000000000000000000000000\&quot;\n).should.be.fulfilled;\n\nballotsStorage = await BallotsStorage.new();\nconst ballotsEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, ballotsStorage.address);\nballotsStorage = await BallotsStorage.at(ballotsEternalStorage.address);\nawait ballotsStorage.init([3, 2]).should.be.fulfilled;\nlet votingForKeys = await VotingForKeys.new();\nvotingForKeysEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, votingForKeys.address);\nvotingForKeys = await VotingForKeys.at(votingForKeysEternalStorage.address);\nawait votingForKeys.init(172800).should.be.fulfilled;\nlet votingForMinThreshold = await VotingForMinThreshold.new();\nconst votingForMinThresholdEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, votingForMinThreshold.address);\nvotingForMinThreshold = await VotingForMinThreshold.at(votingForMinThresholdEternalStorage.address);\nawait votingForMinThreshold.init(172800, 3).should.be.fulfilled;\nlet votingForEmissionFunds = await VotingForEmissionFunds.new();\nconst votingForEmissionFundsEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, votingForEmissionFunds.address);\nvotingForEmissionFunds = await VotingForEmissionFunds.at(votingForEmissionFundsEternalStorage.address);\n\nvoting = await VotingToChangeProxyAddress.new();\nvotingEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, voting.address);\nvoting = await VotingToChangeProxyAddress.at(votingEternalStorage.address);\nawait voting.init(172800, {from: accounts[8]}).should.be.rejectedWith(ERROR_MSG);\nawait voting.init(172800).should.be.fulfilled;\nawait voting.migrateDisable().should.be.fulfilled;\nconst validatorMetadata = await ValidatorMetadata.new();\nconst validatorMetadataEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, validatorMetadata.address);\nlet rewardByBlock = await RewardByBlock.new();\nconst rewardByBlockEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, rewardByBlock.address);\nrewardByBlock = await RewardByBlock.at(rewardByBlockEternalStorage.address);\nawait proxyStorageMock.initializeAddresses(\n  keysManagerEternalStorage.address,\n  votingForKeysEternalStorage.address,\n  votingForMinThresholdEternalStorage.address,\n  votingEternalStorage.address,\n  votingForEmissionFunds.address,\n  ballotsEternalStorage.address,\n  validatorMetadataEternalStorage.address,\n  rewardByBlock.address\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a923edc3-6bb0-4a82-8dbb-001474d14e9a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3b8c95a0-4eae-4e32-bf6a-a248856dd2bd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;910d8d45-139f-40c8-9756-543c6c6bd91f&quot;,&quot;title&quot;:&quot;#createBallot&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_proxy_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_proxy_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #createBallot \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:183,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(accounts[1]);\nawait addVotingKey(votingKey, accounts[1]);\nawait proxyStorageMock.setVotingContractMock(votingForKeysEternalStorage.address);\nVOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nid = await voting.nextBallotId.call();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e53e2e51-bc6a-43cc-ae21-d4ce7f8c0b23&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #createBallot happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:276,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1,\n  \&quot;memo\&quot;,\n  accounts[5],\n  { from: votingKey }\n);\nconst keysManagerFromContract = await voting.getKeysManager.call();\nconst ballotInfo = await voting.getBallotInfo.call(id, votingKey);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  new web3.BigNumber(0), // totalVoters\n  new web3.BigNumber(0), // progress\n  false, // isFinalized\n  accounts[5], // proposedValue\n  new web3.BigNumber(1), // contractType\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false, // canBeFinalizedNow\n  false // hasAlreadyVoted\n]);\n\n(await voting.getQuorumState.call(id)).should.be.bignumber.equal(1);\n(await voting.getIndex.call(id)).should.be.bignumber.equal(0);\n(await voting.getMinThresholdOfVoters.call(id)).should.be.bignumber.equal(1);\n\nlet activeBallotsLength = await voting.activeBallotsLength.call();\nactiveBallotsLength.should.be.bignumber.equal(1);\nlet nextBallotId = await voting.nextBallotId.call();\nnextBallotId.should.be.bignumber.equal(1);\nkeysManagerFromContract.should.be.equal(keysManager.address);\nlogs[0].event.should.be.equal(\&quot;BallotCreated\&quot;);\nlogs[0].args.id.should.be.bignumber.equal(0);\nlogs[0].args.creator.should.be.equal(votingKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2b3112b5-ed03-4e37-a4c3-d147a7c186c8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;proposed address should not be 0x0&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #createBallot proposed address should not be 0x0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  2,\n  \&quot;memo\&quot;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  { from: votingKey }\n).should.be.fulfilled.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ccf04e10-46f3-4f16-9976-d99712a235ea&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;can create multiple ballots&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #createBallot can create multiple ballots&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:376,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const { logs } = await voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1,\n  \&quot;memo\&quot;,\n  accounts[5],\n  { from: votingKey }\n);\nconst keysManagerFromContract = await voting.getKeysManager.call();\nlet activeBallotsLength = await voting.activeBallotsLength.call();\nactiveBallotsLength.should.be.bignumber.equal(1);\nlet nextBallotId = await voting.nextBallotId.call();\nnextBallotId.should.be.bignumber.equal(1);\nawait voting.createBallot(\n  VOTING_START_DATE + 1,\n  VOTING_END_DATE + 1,\n  2,\n  \&quot;memo\&quot;,\n  accounts[5],\n  { from: votingKey }\n);\nconst ballotInfo = await voting.getBallotInfo.call(nextBallotId, votingKey);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE+1), // startTime\n  new web3.BigNumber(VOTING_END_DATE+1), // endTime\n  new web3.BigNumber(0), // totalVoters\n  new web3.BigNumber(0), // progress\n  false, // isFinalized\n  accounts[5], // proposedValue\n  new web3.BigNumber(2), // contractType\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false, // canBeFinalizedNow\n  false // hasAlreadyVoted\n]);\n(await voting.getQuorumState.call(nextBallotId)).should.be.bignumber.equal(1);\n(await voting.getIndex.call(nextBallotId)).should.be.bignumber.equal(1);\n(await voting.getMinThresholdOfVoters.call(nextBallotId)).should.be.bignumber.equal(1);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;22816c32-a302-41c4-b5dc-e2ec3c92fd8d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create more ballots than the limit&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #createBallot should not let create more ballots than the limit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10112,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  2,\n  \&quot;memo\&quot;,\n  accounts[5],\n  {from: votingKey}\n);\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  2,\n  \&quot;memo\&quot;,\n  accounts[5],\n  {from: votingKey}\n);\n// we have 1 validator, so 200 limit / 1 = 200\nnew web3.BigNumber(200).should.be.bignumber.equal(await voting.getBallotLimitPerValidator.call());\nawait addValidators({proxyStorageMock, keysManager, poaNetworkConsensusMock}); // add 100 validators, so total will be 101 validator\nnew web3.BigNumber(1).should.be.bignumber.equal(await voting.getBallotLimitPerValidator.call());\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  2,\n  \&quot;memo\&quot;,\n  accounts[5],\n  {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;88074da3-3610-49cd-8d54-59e0d8d65e86&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2b3112b5-ed03-4e37-a4c3-d147a7c186c8&quot;,&quot;ccf04e10-46f3-4f16-9976-d99712a235ea&quot;,&quot;22816c32-a302-41c4-b5dc-e2ec3c92fd8d&quot;,&quot;88074da3-3610-49cd-8d54-59e0d8d65e86&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:10780,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;e52bd21b-756d-45d9-9944-8e39fe2871c3&quot;,&quot;title&quot;:&quot;#vote&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_proxy_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_proxy_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:361,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(accounts[1]);\nawait addVotingKey(votingKey, accounts[1]);\nid = await voting.nextBallotId.call();\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1,\n  \&quot;memo\&quot;,\n  accounts[5],\n  { from: votingKey }\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b78d9717-9f8e-4179-be10-f7041ff3c672&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should let a validator to vote&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote should let a validator to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:185,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nconst { logs } = await voting.vote(id, choice.accept, { from: votingKey }).should.be.fulfilled;\nlet progress = (await voting.getBallotInfo.call(id, votingKey))[3];\nprogress.should.be.bignumber.equal(1);\nlet totalVoters = await voting.getTotalVoters.call(id);\ntotalVoters.should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(&#x27;Vote&#x27;);\nlogs[0].args.decision.should.be.bignumber.equal(1);\nlogs[0].args.voter.should.be.equal(votingKey);\nlogs[0].args.time.should.be.bignumber.equal(VOTING_START_DATE);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;30933a95-1d4d-4b62-b8e4-624ff8d48422&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;reject vote should be accepted&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote reject vote should be accepted&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:200,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nconst { logs } = await voting.vote(id, choice.reject, { from: votingKey }).should.be.fulfilled;\nlet progress = (await voting.getBallotInfo.call(id, votingKey))[3];\nprogress.should.be.bignumber.equal(-1);\nlet totalVoters = await voting.getTotalVoters.call(id);\ntotalVoters.should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(&#x27;Vote&#x27;);\nlogs[0].args.decision.should.be.bignumber.equal(2);\nlogs[0].args.voter.should.be.equal(votingKey);\nlogs[0].args.time.should.be.bignumber.equal(VOTING_START_DATE);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4f8d4079-b76f-4317-b59d-56472bb26bf4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow multiple voters to vote&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote should allow multiple voters to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:815,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, { from: votingKey }).should.be.fulfilled;\nawait addVotingKey(accounts[3], accounts[1]);\nawait voting.vote(id, choice.reject, { from: accounts[3] }).should.be.rejectedWith(ERROR_MSG);\n// add new voter\nawait addMiningKey(accounts[2]);\nawait addVotingKey(accounts[4], accounts[2]);\nawait voting.vote(id, choice.reject, { from: accounts[4] }).should.be.fulfilled;\nlet progress = (await voting.getBallotInfo.call(id, votingKey))[3];\nprogress.should.be.bignumber.equal(-2);\nlet totalVoters = await voting.getTotalVoters.call(id);\ntotalVoters.should.be.bignumber.equal(2);\nawait addMiningKey(accounts[3]);\nawait addVotingKey(accounts[5], accounts[3]);\nawait voting.vote(id, choice.accept, { from: accounts[5] }).should.be.fulfilled;\nprogress = (await voting.getBallotInfo.call(id, votingKey))[3];\nprogress.should.be.bignumber.equal(-1);\ntotalVoters = await voting.getTotalVoters.call(id);\ntotalVoters.should.be.bignumber.equal(3);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d17eee48-5953-484c-899e-5364197152c3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote nonVoting key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote should not let vote nonVoting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:52,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, { from: accounts[0] }).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;16994fcb-3487-4ebb-9aab-bb2c726d997a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote before startTime key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote should not let vote before startTime key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:94,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE - 1);\nawait voting.vote(id, choice.reject, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5c291463-91fa-459e-aece-9487e6ad6ed9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote after endTime key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote should not let vote after endTime key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:105,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE + 1);\nawait voting.vote(id, choice.reject, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a9a14a5d-e8bf-4606-9bfb-6130896d0930&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with already voted key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote should not let vote with already voted key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:198,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(id, choice.reject, { from: votingKey }).should.be.fulfilled;\nawait voting.vote(id, choice.reject, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7957a966-3932-473a-95b3-cd63ddfe2a2f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with invalid choice&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote should not let vote with invalid choice&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:175,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(id, 0, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(id, 3, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;77fc7128-bbf2-4b88-bd53-bf0883ef0ea7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with invalid id&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #vote should not let vote with invalid id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:175,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(99, 1, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(-3, 1, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a0332b5c-0bd5-4b51-ae99-f02935d0b43f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;30933a95-1d4d-4b62-b8e4-624ff8d48422&quot;,&quot;4f8d4079-b76f-4317-b59d-56472bb26bf4&quot;,&quot;d17eee48-5953-484c-899e-5364197152c3&quot;,&quot;16994fcb-3487-4ebb-9aab-bb2c726d997a&quot;,&quot;5c291463-91fa-459e-aece-9487e6ad6ed9&quot;,&quot;a9a14a5d-e8bf-4606-9bfb-6130896d0930&quot;,&quot;7957a966-3932-473a-95b3-cd63ddfe2a2f&quot;,&quot;77fc7128-bbf2-4b88-bd53-bf0883ef0ea7&quot;,&quot;a0332b5c-0bd5-4b51-ae99-f02935d0b43f&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1999,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;ca416f83-d3d3-40dc-870c-c0c27524f4ff&quot;,&quot;title&quot;:&quot;#finalize&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_proxy_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_proxy_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:450,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;votingKey = accounts[2];\nvotingKey2 = accounts[3];\nvotingKey3 = accounts[5];\npayoutKeyToAdd = accounts[0];\nVOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(accounts[1]);\nawait addVotingKey(votingKey, accounts[1]);\nawait addMiningKey(accounts[6]);\nawait addVotingKey(votingKey2, accounts[6]);\nawait addMiningKey(accounts[4]);\nawait addVotingKey(votingKey3, accounts[4]);\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nawait proxyStorageMock.setVotingContractMock(votingForKeysEternalStorage.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b25b1666-21fc-467c-b3f3-b54905632b61&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;does not change if it did not pass minimum threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize does not change if it did not pass minimum threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:907,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let proposedValue = 5;\nlet contractType = 1; //keysManager\nvotingId = await voting.nextBallotId.call();\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  contractType,\n  \&quot;memo\&quot;,\n  accounts[5],\n  { from: votingKey }\n);\nawait voting.finalize(votingId, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.accept, { from: votingKey }).should.be.fulfilled;\n// await voting.vote(votingId, choice.accept, {from: votingKey2}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nconst { logs } = await voting.finalize(votingId, { from: votingKey });\nawait voting.vote(votingId, choice.accept, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nactiveBallotsLength = await voting.activeBallotsLength.call();\nactiveBallotsLength.should.be.bignumber.equal(0);\ntrue.should.be.equal((await voting.getBallotInfo.call(votingId, votingKey))[4]); // isFinalized\n// Finalized(msg.sender);\nlogs[0].event.should.be.equal(\&quot;BallotFinalized\&quot;);\nlogs[0].args.voter.should.be.equal(votingKey);\nconst ballotInfo = await voting.getBallotInfo.call(votingId, votingKey);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  new web3.BigNumber(1), // totalVoters\n  new web3.BigNumber(1), // progress\n  true, // isFinalized\n  accounts[5], // proposedValue\n  new web3.BigNumber(contractType), // contractType\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false, // canBeFinalizedNow\n  true // hasAlreadyVoted\n]);\n(await voting.getQuorumState.call(votingId)).should.be.bignumber.equal(3);\n(await voting.getIndex.call(votingId)).should.be.bignumber.equal(0);\n(await voting.getMinThresholdOfVoters.call(votingId)).should.be.bignumber.equal(2);\nconst minThresholdOfVoters = await ballotsStorage.getBallotThreshold.call(1);\nminThresholdOfVoters.should.be.bignumber.equal(3);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8e12da0a-84eb-475c-9c2d-da100c49835d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change KeysManager implementation&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize should change KeysManager implementation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:883,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let contractType = 1;\nlet keysManagerNew = await KeysManagerMock.new();\nlet newAddress = keysManagerNew.address;\nawait deployAndTest({contractType, newAddress})\nlet eternalProxyAddress = await proxyStorageMock.getKeysManager.call();\nlet eternalProxy = await EternalStorageProxy.at(eternalProxyAddress);\nnewAddress.should.be.equal(await eternalProxy.implementation.call());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;607bb382-df89-465d-b17d-223684f36260&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change VotingToChangeKeys implementation&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize should change VotingToChangeKeys implementation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1070,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let contractType = 2;\nlet votingToChangeKeysNew = await VotingForKeys.new();\nlet newAddress = votingToChangeKeysNew.address;\nawait deployAndTest({contractType, newAddress})\nlet eternalProxyAddress = await proxyStorageMock.getVotingToChangeKeys.call();\nlet eternalProxy = await EternalStorageProxy.at(eternalProxyAddress);\nnewAddress.should.be.equal(await eternalProxy.implementation.call());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;049e524d-13ca-4404-99b9-f306d660f2dd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change VotingToChangeMinThreshold implementation&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize should change VotingToChangeMinThreshold implementation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1069,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let contractType = 3;\nlet votingToChangeMinThresholdNew = await VotingForMinThreshold.new();\nlet newAddress = votingToChangeMinThresholdNew.address;\nawait deployAndTest({contractType, newAddress})\nlet eternalProxyAddress = await proxyStorageMock.getVotingToChangeMinThreshold.call();\nlet eternalProxy = await EternalStorageProxy.at(eternalProxyAddress);\nnewAddress.should.be.equal(await eternalProxy.implementation.call());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d3aa1d68-8da9-4ba8-95d5-b0a183ec9915&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change VotingToChangeProxy implementation&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize should change VotingToChangeProxy implementation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1068,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let contractType = 4;\nlet votingToChangeProxyNew = await VotingToChangeProxyAddress.new();\nlet newAddress = votingToChangeProxyNew.address;\nawait deployAndTest({contractType, newAddress})\nlet eternalProxyAddress = await proxyStorageMock.getVotingToChangeProxy.call();\nlet eternalProxy = await EternalStorageProxy.at(eternalProxyAddress);\nnewAddress.should.be.equal(await eternalProxy.implementation.call());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c0818379-42c3-41a1-87b1-a71510299e24&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change BallotsStorage implementation&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize should change BallotsStorage implementation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:984,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let contractType = 5;\nlet ballotsStorageNew = await BallotsStorage.new();\nlet newAddress = ballotsStorageNew.address;\nawait deployAndTest({contractType, newAddress})\nlet eternalProxyAddress = await proxyStorageMock.getBallotsStorage.call();\nlet eternalProxy = await EternalStorageProxy.at(eternalProxyAddress);\nnewAddress.should.be.equal(await eternalProxy.implementation.call());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2234e4f6-f6fd-4349-8a27-167eaa70c85d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change ValidatorMetadata implementation&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize should change ValidatorMetadata implementation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1056,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let contractType = 7;\nlet validatorMetadataNew = await ValidatorMetadata.new();\nlet newAddress = validatorMetadataNew.address;\nawait deployAndTest({contractType, newAddress})\nlet eternalProxyAddress = await proxyStorageMock.getValidatorMetadata.call();\nlet eternalProxy = await EternalStorageProxy.at(eternalProxyAddress);\nnewAddress.should.be.equal(await eternalProxy.implementation.call());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7616a8c3-5fe5-4069-afbe-ff7f065e5bfb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change ProxyStorage implementation&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize should change ProxyStorage implementation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:990,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const contractType = 8;\nconst proxyStorageNew = await ProxyStorageMock.new();\nconst newAddress = proxyStorageNew.address;\nawait deployAndTest({contractType, newAddress})\nnewAddress.should.be.equal(await proxyStorageEternalStorage.implementation.call());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d0d3c49a-c029-4321-a3eb-66400c26836e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;prevents double finalize&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize prevents double finalize&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1494,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let newAddress1 = accounts[4];\nlet newAddress2 = accounts[5];\nlet contractType1 = 100;\nlet contractType2 = 101;\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  contractType1,\n  \&quot;memo\&quot;,\n  newAddress1,\n  { from: votingKey }\n);\nawait voting.createBallot(\n  VOTING_START_DATE+2,\n  VOTING_END_DATE+2,\n  contractType2,\n  \&quot;memo\&quot;,\n  newAddress2,\n  { from: votingKey }\n);\nconst activeBallotsLength = await voting.activeBallotsLength.call();\nvotingId = await voting.activeBallots.call(activeBallotsLength.toNumber() - 2);\nlet votingIdForSecond = votingId.add(1);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.reject, {from: votingKey}).should.be.fulfilled;\nfalse.should.be.equal(await voting.hasAlreadyVoted.call(votingId, votingKey2));\nawait voting.vote(votingId, choice.reject, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(votingId, choice.accept, {from: votingKey3}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nfalse.should.be.equal((await voting.getBallotInfo.call(votingId, votingKey))[4]); // isFinalized\nawait finalize(votingId, true, {from: votingKey});\ntrue.should.be.equal((await voting.getBallotInfo.call(votingId, votingKey))[4]); // isFinalized\nawait voting.finalize(votingId, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\n\nawait voting.finalize(votingIdForSecond, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nfalse.should.be.equal(await voting.getIsFinalized.call(votingIdForSecond));\nawait voting.vote(votingIdForSecond, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 3);\nawait finalize(votingIdForSecond, true, {from: votingKey});\nnew web3.BigNumber(-1).should.be.bignumber.equal((await voting.getBallotInfo.call(votingIdForSecond, votingKey))[3]) // progress\nlet ballotInfo = await voting.getBallotInfo.call(votingId, votingKey);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  new web3.BigNumber(3), // totalVoters\n  new web3.BigNumber(-1), // progress\n  true, // isFinalized\n  newAddress1, // proposedValue\n  new web3.BigNumber(contractType1), // contractType\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false, // canBeFinalizedNow\n  true // hasAlreadyVoted\n]);\n(await voting.getQuorumState.call(votingId)).should.be.bignumber.equal(3);\n(await voting.getIndex.call(votingId)).should.be.bignumber.equal(0);\n(await voting.getMinThresholdOfVoters.call(votingId)).should.be.bignumber.equal(2);\nballotInfo = await voting.getBallotInfo.call(votingIdForSecond, votingKey);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE+2), // startTime\n  new web3.BigNumber(VOTING_END_DATE+2), // endTime\n  new web3.BigNumber(1), // totalVoters\n  new web3.BigNumber(-1), // progress\n  true, // isFinalized\n  newAddress2, // proposedValue\n  new web3.BigNumber(contractType2), // contractType\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false, // canBeFinalizedNow\n  true // hasAlreadyVoted\n]);\n(await voting.getQuorumState.call(votingIdForSecond)).should.be.bignumber.equal(3);\n(await voting.getIndex.call(votingIdForSecond)).should.be.bignumber.equal(0);\n(await voting.getMinThresholdOfVoters.call(votingIdForSecond)).should.be.bignumber.equal(2);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cba0e18a-f9f8-4dea-a304-150afd4a4c32&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;allowed at once after all validators gave their votes&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #finalize allowed at once after all validators gave their votes&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1747,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, // uint256 _startTime\n  VOTING_END_DATE,   // uint256 _endTime\n  100,               // uint256 _contractType\n  \&quot;memo\&quot;,            // string _memo\n  accounts[7],       // address _proposedValue\n  {from: votingKey}\n).should.be.fulfilled;\nfalse.should.be.equal((await voting.getBallotInfo.call(0, votingKey))[4]); // isFinalized\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(0, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(0, choice.reject, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(0, choice.accept, {from: votingKey3}).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE+1);\nawait voting.finalize(0, {from: votingKey2}).should.be.rejectedWith(ERROR_MSG);\nfalse.should.be.equal((await voting.getBallotInfo.call(0, votingKey2))[4]); // isFinalized\nawait voting.setTime(VOTING_START_DATE+172800+1);\n(await voting.getTime.call()).should.be.bignumber.below(VOTING_END_DATE);\nawait finalize(0, true, {from: votingKey2});\ntrue.should.be.equal((await voting.getBallotInfo.call(0, votingKey2))[4]); // isFinalized\nawait voting.setTime(VOTING_END_DATE+1);\nawait voting.finalize(0, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nVOTING_START_DATE = moment.utc().add(12, &#x27;days&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(22, &#x27;days&#x27;).unix();\nawait voting.createBallot(\n  VOTING_START_DATE, // uint256 _startTime\n  VOTING_END_DATE,   // uint256 _endTime\n  100,               // uint256 _contractType\n  \&quot;memo\&quot;,            // string _memo\n  accounts[8],       // address _proposedValue\n  {from: votingKey}\n).should.be.fulfilled;\nfalse.should.be.equal((await voting.getBallotInfo.call(1, votingKey))[4]); // isFinalized\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(1, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(1, choice.reject, {from: votingKey2}).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE+172800+1);\n(await voting.getTime.call()).should.be.bignumber.below(VOTING_END_DATE);\nawait voting.finalize(1, {from: votingKey2}).should.be.rejectedWith(ERROR_MSG);\nfalse.should.be.equal((await voting.getBallotInfo.call(1, votingKey2))[4]); // isFinalized\nawait voting.setTime(VOTING_END_DATE+1);\nawait finalize(1, true, {from: votingKey2});\ntrue.should.be.equal((await voting.getBallotInfo.call(1, votingKey2))[4]); // isFinalized&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;39bec7ab-856e-4ce4-9829-33672727c389&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8e12da0a-84eb-475c-9c2d-da100c49835d&quot;,&quot;607bb382-df89-465d-b17d-223684f36260&quot;,&quot;049e524d-13ca-4404-99b9-f306d660f2dd&quot;,&quot;d3aa1d68-8da9-4ba8-95d5-b0a183ec9915&quot;,&quot;c0818379-42c3-41a1-87b1-a71510299e24&quot;,&quot;2234e4f6-f6fd-4349-8a27-167eaa70c85d&quot;,&quot;7616a8c3-5fe5-4069-afbe-ff7f065e5bfb&quot;,&quot;d0d3c49a-c029-4321-a3eb-66400c26836e&quot;,&quot;cba0e18a-f9f8-4dea-a304-150afd4a4c32&quot;,&quot;39bec7ab-856e-4ce4-9829-33672727c389&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:11268,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;747932d0-030b-4d75-a13a-26b4ce8af7b1&quot;,&quot;title&quot;:&quot;#migrate&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_proxy_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_proxy_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should copy a ballot to the new contract&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #migrate should copy a ballot to the new contract&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2033,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(miningKeyForVotingKey);\nawait addVotingKey(votingKey, miningKeyForVotingKey);\nawait addMiningKey(accounts[3]);\nawait addVotingKey(accounts[4], accounts[3]);\nawait addMiningKey(accounts[5]);\nawait addVotingKey(accounts[6], accounts[5]);\nawait proxyStorageMock.setVotingContractMock(votingForKeysEternalStorage.address);\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nVOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nconst id = await voting.nextBallotId.call();\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1,\n  \&quot;memo\&quot;,\n  accounts[7],\n  {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.reject, {from: accounts[4]}).should.be.fulfilled;\nawait voting.vote(id, choice.reject, {from: accounts[6]}).should.be.fulfilled;\nlet votingNew = await VotingToChangeProxyAddress.new();\nvotingEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, votingNew.address);\nvotingNew = await VotingToChangeProxyAddress.at(votingEternalStorage.address);\nawait votingNew.init(172800).should.be.fulfilled;\nawait votingNew.setTime(VOTING_START_DATE);\nawait votingNew.migrateBasicOne(\n  id,\n  voting.address,\n  [miningKeyForVotingKey, accounts[3], accounts[5]]\n).should.be.fulfilled;\nconst ballotInfo = await votingNew.getBallotInfo.call(id, votingKey);\n\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  new web3.BigNumber(3), // totalVoters\n  new web3.BigNumber(-3), // progress\n  false, // isFinalized\n  accounts[7], // proposedValue\n  new web3.BigNumber(1), // contractType\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false, // canBeFinalizedNow\n  true // hasAlreadyVoted\n]);\n(await votingNew.getQuorumState.call(id)).should.be.bignumber.equal(1);\n(await votingNew.getIndex.call(id)).should.be.bignumber.equal(0);\n(await votingNew.getMinThresholdOfVoters.call(id)).should.be.bignumber.equal(2);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, miningKeyForVotingKey)).should.be.equal(true);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, accounts[2])).should.be.equal(false);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, accounts[3])).should.be.equal(true);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, accounts[4])).should.be.equal(false);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, accounts[5])).should.be.equal(true);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, accounts[6])).should.be.equal(false);\n(await votingNew.nextBallotId.call()).should.be.bignumber.equal(0);\n(await votingNew.activeBallotsLength.call()).should.be.bignumber.equal(0);\n(await votingNew.validatorActiveBallots.call(accounts[1])).should.be.bignumber.equal(0);\nawait votingNew.migrateBasicAll(voting.address, {from: accounts[6]}).should.be.rejectedWith(ERROR_MSG);\nawait votingNew.migrateBasicAll(&#x27;0x0000000000000000000000000000000000000000&#x27;).should.be.rejectedWith(ERROR_MSG);\nawait votingNew.migrateBasicAll(voting.address).should.be.fulfilled;\nawait votingNew.migrateBasicAll(voting.address).should.be.fulfilled;\n(await votingNew.nextBallotId.call()).should.be.bignumber.equal(1);\n(await votingNew.activeBallotsLength.call()).should.be.bignumber.equal(1);\n(await votingNew.validatorActiveBallots.call(accounts[1])).should.be.bignumber.equal(1);\n(await votingNew.migrateDisabled.call()).should.be.equal(false);\nawait votingNew.migrateDisable({from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait votingNew.migrateDisable().should.be.fulfilled;\n(await votingNew.migrateDisabled.call()).should.be.equal(true);\nawait votingNew.migrateBasicAll(voting.address).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;86a24268-d3f3-4dc8-91dc-ef179852aa8a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;86a24268-d3f3-4dc8-91dc-ef179852aa8a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2033,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;bcbb6864-f734-4351-96ba-9e2aa0187108&quot;,&quot;title&quot;:&quot;#upgradeTo&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_proxy_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_proxy_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #upgradeTo \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:149,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;proxyStorageStubAddress = accounts[8];\nvoting = await VotingToChangeProxyAddress.new();\nvotingOldImplementation = voting.address;\nvotingEternalStorage = await EternalStorageProxy.new(proxyStorageStubAddress, voting.address);\nvoting = await VotingToChangeProxyAddress.at(votingEternalStorage.address);\nawait voting.init(172800).should.be.fulfilled;\nawait voting.migrateDisable().should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e81eb29b-e84d-44cf-b42d-f441d07b700f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called by ProxyStorage&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #upgradeTo may only be called by ProxyStorage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:86,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let votingNew = await VotingToChangeProxyAddressNew.new();\nawait votingEternalStorage.upgradeTo(votingNew.address, {from: accounts[0]}).should.be.rejectedWith(ERROR_MSG);\nawait upgradeTo(votingNew.address, {from: proxyStorageStubAddress});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e8064778-1611-45b2-ab11-f71f25a27cb7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change implementation address&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #upgradeTo should change implementation address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:90,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let votingNew = await VotingToChangeProxyAddressNew.new();\nlet newImplementation = votingNew.address;\n(await votingEternalStorage.implementation.call()).should.be.equal(votingOldImplementation);\nawait upgradeTo(newImplementation, {from: proxyStorageStubAddress});\n(await votingEternalStorage.implementation.call()).should.be.equal(newImplementation);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;263249b1-837f-4830-8f41-e5f4c7c5f678&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should increment implementation version&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #upgradeTo should increment implementation version&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:150,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let votingNew = await VotingToChangeProxyAddressNew.new();\nlet oldVersion = await votingEternalStorage.version.call();\nlet newVersion = oldVersion.add(1);\nawait upgradeTo(votingNew.address, {from: proxyStorageStubAddress});\n(await votingEternalStorage.version.call()).should.be.bignumber.equal(newVersion);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;288a2d35-ac82-4120-8612-0abd3333c6cf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should work&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #upgradeTo new implementation should work&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:130,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let votingNew = await VotingToChangeProxyAddressNew.new();\nawait upgradeTo(votingNew.address, {from: proxyStorageStubAddress});\nvotingNew = await VotingToChangeProxyAddressNew.at(votingEternalStorage.address);\n(await votingNew.initialized.call()).should.be.equal(false);\nawait votingNew.initialize();\n(await votingNew.initialized.call()).should.be.equal(true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;11418a7c-0f5f-4938-bace-7bc32e03c5cc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should use the same proxyStorage address&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #upgradeTo new implementation should use the same proxyStorage address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:96,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let votingNew = await VotingToChangeProxyAddressNew.new();\nawait upgradeTo(votingNew.address, {from: proxyStorageStubAddress});\nvotingNew = await VotingToChangeProxyAddressNew.at(votingEternalStorage.address);\n(await votingNew.proxyStorage.call()).should.be.equal(proxyStorageStubAddress);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e259143e-67eb-43e4-84a1-fdd704747ebb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should use the same storage&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress [all features] #upgradeTo new implementation should use the same storage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:536,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nconst id = await voting.nextBallotId.call();\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(miningKeyForVotingKey);\nawait addVotingKey(votingKey, miningKeyForVotingKey);\nawait proxyStorageMock.setVotingContractMock(votingForKeysEternalStorage.address);\nawait votingEternalStorage.setProxyStorage(proxyStorageMock.address);\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1,\n  \&quot;memo\&quot;,\n  accounts[5],\n  { from: votingKey }\n).should.be.fulfilled;\nawait votingEternalStorage.setProxyStorage(proxyStorageStubAddress);\nlet votingNew = await VotingToChangeProxyAddressNew.new();\nawait upgradeTo(votingNew.address, {from: proxyStorageStubAddress});\nvotingNew = await VotingToChangeProxyAddressNew.at(votingEternalStorage.address);\nawait votingEternalStorage.setProxyStorage(proxyStorageMock.address);\nconst ballotInfo = await votingNew.getBallotInfo.call(id, votingKey);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  new web3.BigNumber(0), // totalVoters\n  new web3.BigNumber(0), // progress\n  false, // isFinalized\n  accounts[5], // proposedValue\n  new web3.BigNumber(1), // contractType\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false, // canBeFinalizedNow\n  false // hasAlreadyVoted\n]);\n(await votingNew.getQuorumState.call(id)).should.be.bignumber.equal(1);\n(await votingNew.getIndex.call(id)).should.be.bignumber.equal(0);\n(await votingNew.getMinThresholdOfVoters.call(id)).should.be.bignumber.equal(1);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1c4e6388-422b-46d5-8ae0-4d79ec89e85d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e8064778-1611-45b2-ab11-f71f25a27cb7&quot;,&quot;263249b1-837f-4830-8f41-e5f4c7c5f678&quot;,&quot;288a2d35-ac82-4120-8612-0abd3333c6cf&quot;,&quot;11418a7c-0f5f-4938-bace-7bc32e03c5cc&quot;,&quot;e259143e-67eb-43e4-84a1-fdd704747ebb&quot;,&quot;1c4e6388-422b-46d5-8ae0-4d79ec89e85d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1088,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;a99077cf-8f80-46c9-92c9-2eadfb259af3&quot;,&quot;title&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_proxy_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_proxy_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3655,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0c260b95-96c7-4587-8c0b-3a25b7238101&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;496f19ef-d7d4-4692-b035-645fd8e3bae5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1232,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;votingKey = accounts[2];\nmasterOfCeremony = accounts[0];\nminingKeyForVotingKey = accounts[1];\npoaNetworkConsensusMock = await PoaNetworkConsensusMock.new(masterOfCeremony, []);\n\nproxyStorageMock = await ProxyStorageMock.new();\nproxyStorageEternalStorage = await EternalStorageProxy.new(0, proxyStorageMock.address);\nproxyStorageMock = await ProxyStorageMock.at(proxyStorageEternalStorage.address);\nawait proxyStorageMock.init(poaNetworkConsensusMock.address).should.be.fulfilled;\nawait poaNetworkConsensusMock.setProxyStorage(proxyStorageMock.address);\n\nkeysManager = await KeysManagerMock.new();\nconst keysManagerEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, keysManager.address);\nkeysManager = await KeysManagerMock.at(keysManagerEternalStorage.address);\nawait keysManager.init(\n  \&quot;0x0000000000000000000000000000000000000000\&quot;\n).should.be.fulfilled;\n\nballotsStorage = await BallotsStorage.new();\nconst ballotsEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, ballotsStorage.address);\nballotsStorage = await BallotsStorage.at(ballotsEternalStorage.address);\nawait ballotsStorage.init([3, 2]).should.be.fulfilled;\nlet votingForKeys = await VotingForKeys.new();\nvotingForKeysEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, votingForKeys.address);\nvotingForKeys = await VotingForKeys.at(votingForKeysEternalStorage.address);\nawait votingForKeys.init(172800).should.be.fulfilled;\nlet votingForMinThreshold = await VotingForMinThreshold.new();\nconst votingForMinThresholdEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, votingForMinThreshold.address);\nvotingForMinThreshold = await VotingForMinThreshold.at(votingForMinThresholdEternalStorage.address);\nawait votingForMinThreshold.init(172800, 3).should.be.fulfilled;\nlet votingForEmissionFunds = await VotingForEmissionFunds.new();\nconst votingForEmissionFundsEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, votingForEmissionFunds.address);\nvotingForEmissionFunds = await VotingForEmissionFunds.at(votingForEmissionFundsEternalStorage.address);\n\nvoting = await VotingToChangeProxyAddress.new();\nvotingEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, voting.address);\nvoting = await VotingToChangeProxyAddress.at(votingEternalStorage.address);\nawait voting.init(172800, {from: accounts[8]}).should.be.rejectedWith(ERROR_MSG);\nawait voting.init(172800).should.be.fulfilled;\nawait voting.migrateDisable().should.be.fulfilled;\nvotingNew = await VotingToChangeProxyAddressNew.new();\nawait votingEternalStorage.setProxyStorage(accounts[7]);\nconst {logs} = await votingEternalStorage.upgradeTo(votingNew.address, {from: accounts[7]}).should.be.fulfilled;\nlogs[0].event.should.be.equal(\&quot;Upgraded\&quot;);\nawait votingEternalStorage.setProxyStorage(proxyStorageMock.address);\nvoting = await VotingToChangeProxyAddressNew.at(votingEternalStorage.address);\nconst validatorMetadata = await ValidatorMetadata.new();\nconst validatorMetadataEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, validatorMetadata.address);\nlet rewardByBlock = await RewardByBlock.new();\nconst rewardByBlockEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, rewardByBlock.address);\nrewardByBlock = await RewardByBlock.at(rewardByBlockEternalStorage.address);\nawait proxyStorageMock.initializeAddresses(\n  keysManagerEternalStorage.address,\n  votingForKeysEternalStorage.address,\n  votingForMinThresholdEternalStorage.address,\n  votingEternalStorage.address,\n  votingForEmissionFunds.address,\n  ballotsEternalStorage.address,\n  validatorMetadataEternalStorage.address,\n  rewardByBlock.address\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ad4f75e1-10f0-4839-9a90-b1e3467c6b99&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ad1bf77d-e6b4-4f98-a3ff-3cd113011edb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a5a03aba-8046-4182-bef5-dc02a8cfd4b0&quot;,&quot;title&quot;:&quot;#createBallot&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_proxy_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_proxy_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] #createBallot \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:301,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(accounts[1]);\nawait addVotingKey(votingKey, accounts[1]);\nawait proxyStorageMock.setVotingContractMock(votingForKeysEternalStorage.address);\nVOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nid = await voting.nextBallotId.call();&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;970a3677-1ddf-4d41-98a2-7f40e37bb5b7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] #createBallot happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:250,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const {logs} = await voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1,\n  \&quot;memo\&quot;,\n  accounts[5],\n  { from: votingKey }\n);\nconst keysManagerFromContract = await voting.getKeysManager.call();\nconst ballotInfo = await voting.getBallotInfo.call(id, votingKey);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  new web3.BigNumber(0), // totalVoters\n  new web3.BigNumber(0), // progress\n  false, // isFinalized\n  accounts[5], // proposedValue\n  new web3.BigNumber(1), // contractType\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false, // canBeFinalizedNow\n  false // hasAlreadyVoted\n]);\n\n(await voting.getQuorumState.call(id)).should.be.bignumber.equal(1);\n(await voting.getIndex.call(id)).should.be.bignumber.equal(0);\n(await voting.getMinThresholdOfVoters.call(id)).should.be.bignumber.equal(1);\n\nlet activeBallotsLength = await voting.activeBallotsLength.call();\nactiveBallotsLength.should.be.bignumber.equal(1);\nlet nextBallotId = await voting.nextBallotId.call();\nnextBallotId.should.be.bignumber.equal(1);\nkeysManagerFromContract.should.be.equal(keysManager.address);\nlogs[0].event.should.be.equal(\&quot;BallotCreated\&quot;);\nlogs[0].args.id.should.be.bignumber.equal(0);\nlogs[0].args.creator.should.be.equal(votingKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;397ec3dd-9e28-4c44-a8a6-9c8c202d087b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;proposed address should not be 0x0&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] #createBallot proposed address should not be 0x0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  2,\n  \&quot;memo\&quot;,\n  &#x27;0x0000000000000000000000000000000000000000&#x27;,\n  { from: votingKey }\n).should.be.fulfilled.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d0f4371f-d283-4f2e-a2d0-7c5ac7d04d2e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;can create multiple ballots&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] #createBallot can create multiple ballots&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:423,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const { logs } = await voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1,\n  \&quot;memo\&quot;,\n  accounts[5],\n  { from: votingKey }\n);\nconst keysManagerFromContract = await voting.getKeysManager.call();\nlet activeBallotsLength = await voting.activeBallotsLength.call();\nactiveBallotsLength.should.be.bignumber.equal(1);\nlet nextBallotId = await voting.nextBallotId.call();\nnextBallotId.should.be.bignumber.equal(1);\nawait voting.createBallot(\n  VOTING_START_DATE + 1,\n  VOTING_END_DATE + 1,\n  2,\n  \&quot;memo\&quot;,\n  accounts[5],\n  { from: votingKey }\n);\nconst ballotInfo = await voting.getBallotInfo.call(nextBallotId, votingKey);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE+1), // startTime\n  new web3.BigNumber(VOTING_END_DATE+1), // endTime\n  new web3.BigNumber(0), // totalVoters\n  new web3.BigNumber(0), // progress\n  false, // isFinalized\n  accounts[5], // proposedValue\n  new web3.BigNumber(2), // contractType\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false, // canBeFinalizedNow\n  false // hasAlreadyVoted\n]);\n(await voting.getQuorumState.call(nextBallotId)).should.be.bignumber.equal(1);\n(await voting.getIndex.call(nextBallotId)).should.be.bignumber.equal(1);\n(await voting.getMinThresholdOfVoters.call(nextBallotId)).should.be.bignumber.equal(1);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1fb54dd8-b353-4f92-80c1-f85106617636&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let create more ballots than the limit&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] #createBallot should not let create more ballots than the limit&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10272,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  2,\n  \&quot;memo\&quot;,\n  accounts[5],\n  {from: votingKey}\n);\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  2,\n  \&quot;memo\&quot;,\n  accounts[5],\n  {from: votingKey}\n);\n// we have 1 validator, so 200 limit / 1 = 200\nnew web3.BigNumber(200).should.be.bignumber.equal(await voting.getBallotLimitPerValidator.call());\nawait addValidators({proxyStorageMock, keysManager, poaNetworkConsensusMock}); // add 100 validators, so total will be 101 validator\nnew web3.BigNumber(1).should.be.bignumber.equal(await voting.getBallotLimitPerValidator.call());\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  2,\n  \&quot;memo\&quot;,\n  accounts[5],\n  {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG)&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7845c5d3-a19b-40d0-92e3-0d7484b9a0e7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;397ec3dd-9e28-4c44-a8a6-9c8c202d087b&quot;,&quot;d0f4371f-d283-4f2e-a2d0-7c5ac7d04d2e&quot;,&quot;1fb54dd8-b353-4f92-80c1-f85106617636&quot;,&quot;7845c5d3-a19b-40d0-92e3-0d7484b9a0e7&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:10961,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;a4e682a0-b3a6-4c21-98b6-362df7651678&quot;,&quot;title&quot;:&quot;#vote&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_proxy_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_proxy_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] #vote \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:294,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(accounts[1]);\nawait addVotingKey(votingKey, accounts[1]);\nid = await voting.nextBallotId.call();\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1,\n  \&quot;memo\&quot;,\n  accounts[5],\n  { from: votingKey }\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c3ccf6fe-d705-413a-9165-351822c3fe55&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should let a validator to vote&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] #vote should let a validator to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:188,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nconst { logs } = await voting.vote(id, choice.accept, { from: votingKey }).should.be.fulfilled;\nlet progress = (await voting.getBallotInfo.call(id, votingKey))[3];\nprogress.should.be.bignumber.equal(1);\nlet totalVoters = await voting.getTotalVoters.call(id);\ntotalVoters.should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(&#x27;Vote&#x27;);\nlogs[0].args.decision.should.be.bignumber.equal(1);\nlogs[0].args.voter.should.be.equal(votingKey);\nlogs[0].args.time.should.be.bignumber.equal(VOTING_START_DATE);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8b5dd896-85e5-4088-bdf3-a5e0a5dad535&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;reject vote should be accepted&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] #vote reject vote should be accepted&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:232,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nconst { logs } = await voting.vote(id, choice.reject, { from: votingKey }).should.be.fulfilled;\nlet progress = (await voting.getBallotInfo.call(id, votingKey))[3];\nprogress.should.be.bignumber.equal(-1);\nlet totalVoters = await voting.getTotalVoters.call(id);\ntotalVoters.should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(&#x27;Vote&#x27;);\nlogs[0].args.decision.should.be.bignumber.equal(2);\nlogs[0].args.voter.should.be.equal(votingKey);\nlogs[0].args.time.should.be.bignumber.equal(VOTING_START_DATE);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c28df48f-be8e-4173-ae42-5a0395977876&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow multiple voters to vote&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] #vote should allow multiple voters to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:858,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, { from: votingKey }).should.be.fulfilled;\nawait addVotingKey(accounts[3], accounts[1]);\nawait voting.vote(id, choice.reject, { from: accounts[3] }).should.be.rejectedWith(ERROR_MSG);\n// add new voter\nawait addMiningKey(accounts[2]);\nawait addVotingKey(accounts[4], accounts[2]);\nawait voting.vote(id, choice.reject, { from: accounts[4] }).should.be.fulfilled;\nlet progress = (await voting.getBallotInfo.call(id, votingKey))[3];\nprogress.should.be.bignumber.equal(-2);\nlet totalVoters = await voting.getTotalVoters.call(id);\ntotalVoters.should.be.bignumber.equal(2);\nawait addMiningKey(accounts[3]);\nawait addVotingKey(accounts[5], accounts[3]);\nawait voting.vote(id, choice.accept, { from: accounts[5] }).should.be.fulfilled;\nprogress = (await voting.getBallotInfo.call(id, votingKey))[3];\nprogress.should.be.bignumber.equal(-1);\ntotalVoters = await voting.getTotalVoters.call(id);\ntotalVoters.should.be.bignumber.equal(3);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a8a97506-25b8-4092-9063-a843bfbfd970&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote nonVoting key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] #vote should not let vote nonVoting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:58,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, { from: accounts[0] }).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5ddefe4a-e999-4c79-baac-a307204eec92&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote before startTime key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] #vote should not let vote before startTime key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:164,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE - 1);\nawait voting.vote(id, choice.reject, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a07f8249-51e7-4b9b-94c1-3008e2f5de28&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote after endTime key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] #vote should not let vote after endTime key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:101,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE + 1);\nawait voting.vote(id, choice.reject, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e1e1aacb-1fea-4750-8548-c2d02944555c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with already voted key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] #vote should not let vote with already voted key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:187,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(id, choice.reject, { from: votingKey }).should.be.fulfilled;\nawait voting.vote(id, choice.reject, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;293b02f0-9381-4b82-b9af-554aa43707bd&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with invalid choice&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] #vote should not let vote with invalid choice&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:177,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(id, 0, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(id, 3, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;449b8b2d-5cc6-4c06-8066-9c3d818441ea&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with invalid id&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] #vote should not let vote with invalid id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:294,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE);\nawait voting.vote(99, 1, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(-3, 1, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1168f9aa-e608-4af4-9301-9ce42cfcd35c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8b5dd896-85e5-4088-bdf3-a5e0a5dad535&quot;,&quot;c28df48f-be8e-4173-ae42-5a0395977876&quot;,&quot;a8a97506-25b8-4092-9063-a843bfbfd970&quot;,&quot;5ddefe4a-e999-4c79-baac-a307204eec92&quot;,&quot;a07f8249-51e7-4b9b-94c1-3008e2f5de28&quot;,&quot;e1e1aacb-1fea-4750-8548-c2d02944555c&quot;,&quot;293b02f0-9381-4b82-b9af-554aa43707bd&quot;,&quot;449b8b2d-5cc6-4c06-8066-9c3d818441ea&quot;,&quot;1168f9aa-e608-4af4-9301-9ce42cfcd35c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2259,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;f012a960-88c0-402f-a324-ffcc721639de&quot;,&quot;title&quot;:&quot;#finalize&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_proxy_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_proxy_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] #finalize \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:440,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;votingKey = accounts[2];\nvotingKey2 = accounts[3];\nvotingKey3 = accounts[5];\npayoutKeyToAdd = accounts[0];\nVOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nawait proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(accounts[1]);\nawait addVotingKey(votingKey, accounts[1]);\nawait addMiningKey(accounts[6]);\nawait addVotingKey(votingKey2, accounts[6]);\nawait addMiningKey(accounts[4]);\nawait addVotingKey(votingKey3, accounts[4]);\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nawait proxyStorageMock.setVotingContractMock(votingForKeysEternalStorage.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1d3d2518-7c15-433b-9bf1-6d2089a48766&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;does not change if it did not pass minimum threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] #finalize does not change if it did not pass minimum threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:650,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let proposedValue = 5;\nlet contractType = 1; //keysManager\nvotingId = await voting.nextBallotId.call();\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  contractType,\n  \&quot;memo\&quot;,\n  accounts[5],\n  { from: votingKey }\n);\nawait voting.finalize(votingId, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.accept, { from: votingKey }).should.be.fulfilled;\n// await voting.vote(votingId, choice.accept, {from: votingKey2}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nconst { logs } = await voting.finalize(votingId, { from: votingKey });\nawait voting.vote(votingId, choice.accept, { from: votingKey }).should.be.rejectedWith(ERROR_MSG);\nactiveBallotsLength = await voting.activeBallotsLength.call();\nactiveBallotsLength.should.be.bignumber.equal(0);\ntrue.should.be.equal((await voting.getBallotInfo.call(votingId, votingKey))[4]); // isFinalized\n// Finalized(msg.sender);\nlogs[0].event.should.be.equal(\&quot;BallotFinalized\&quot;);\nlogs[0].args.voter.should.be.equal(votingKey);\nconst ballotInfo = await voting.getBallotInfo.call(votingId, votingKey);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  new web3.BigNumber(1), // totalVoters\n  new web3.BigNumber(1), // progress\n  true, // isFinalized\n  accounts[5], // proposedValue\n  new web3.BigNumber(contractType), // contractType\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false, // canBeFinalizedNow\n  true // hasAlreadyVoted\n]);\n(await voting.getQuorumState.call(votingId)).should.be.bignumber.equal(3);\n(await voting.getIndex.call(votingId)).should.be.bignumber.equal(0);\n(await voting.getMinThresholdOfVoters.call(votingId)).should.be.bignumber.equal(2);\nconst minThresholdOfVoters = await ballotsStorage.getBallotThreshold.call(1);\nminThresholdOfVoters.should.be.bignumber.equal(3);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e7bdd31f-316c-4537-8d6a-2e9eba6f4bea&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change KeysManager implementation&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] #finalize should change KeysManager implementation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:870,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let contractType = 1;\nlet keysManagerNew = await KeysManagerMock.new();\nlet newAddress = keysManagerNew.address;\nawait deployAndTest({contractType, newAddress})\nlet eternalProxyAddress = await proxyStorageMock.getKeysManager.call();\nlet eternalProxy = await EternalStorageProxy.at(eternalProxyAddress);\nnewAddress.should.be.equal(await eternalProxy.implementation.call());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c0efe6a8-3ea3-42eb-9809-3f29cef671fc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change VotingToChangeKeys implementation&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] #finalize should change VotingToChangeKeys implementation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1102,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let contractType = 2;\nlet votingToChangeKeysNew = await VotingForKeys.new();\nlet newAddress = votingToChangeKeysNew.address;\nawait deployAndTest({contractType, newAddress})\nlet eternalProxyAddress = await proxyStorageMock.getVotingToChangeKeys.call();\nlet eternalProxy = await EternalStorageProxy.at(eternalProxyAddress);\nnewAddress.should.be.equal(await eternalProxy.implementation.call());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8197c8a4-5753-47ac-b2c1-63d57d26ce81&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change VotingToChangeMinThreshold implementation&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] #finalize should change VotingToChangeMinThreshold implementation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1017,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let contractType = 3;\nlet votingToChangeMinThresholdNew = await VotingForMinThreshold.new();\nlet newAddress = votingToChangeMinThresholdNew.address;\nawait deployAndTest({contractType, newAddress})\nlet eternalProxyAddress = await proxyStorageMock.getVotingToChangeMinThreshold.call();\nlet eternalProxy = await EternalStorageProxy.at(eternalProxyAddress);\nnewAddress.should.be.equal(await eternalProxy.implementation.call());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a9adecd0-cad1-462c-bc38-94cc99d634a5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change VotingToChangeProxy implementation&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] #finalize should change VotingToChangeProxy implementation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1113,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let contractType = 4;\nlet votingToChangeProxyNew = await VotingToChangeProxyAddress.new();\nlet newAddress = votingToChangeProxyNew.address;\nawait deployAndTest({contractType, newAddress})\nlet eternalProxyAddress = await proxyStorageMock.getVotingToChangeProxy.call();\nlet eternalProxy = await EternalStorageProxy.at(eternalProxyAddress);\nnewAddress.should.be.equal(await eternalProxy.implementation.call());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;54990816-c7f3-4220-834b-d4a51a8e9e79&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change BallotsStorage implementation&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] #finalize should change BallotsStorage implementation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1032,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let contractType = 5;\nlet ballotsStorageNew = await BallotsStorage.new();\nlet newAddress = ballotsStorageNew.address;\nawait deployAndTest({contractType, newAddress})\nlet eternalProxyAddress = await proxyStorageMock.getBallotsStorage.call();\nlet eternalProxy = await EternalStorageProxy.at(eternalProxyAddress);\nnewAddress.should.be.equal(await eternalProxy.implementation.call());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;71588bc8-9b84-4a97-9074-872666030592&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change ValidatorMetadata implementation&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] #finalize should change ValidatorMetadata implementation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1002,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let contractType = 7;\nlet validatorMetadataNew = await ValidatorMetadata.new();\nlet newAddress = validatorMetadataNew.address;\nawait deployAndTest({contractType, newAddress})\nlet eternalProxyAddress = await proxyStorageMock.getValidatorMetadata.call();\nlet eternalProxy = await EternalStorageProxy.at(eternalProxyAddress);\nnewAddress.should.be.equal(await eternalProxy.implementation.call());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;48982c49-03f9-4e67-af36-a439d8374934&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change ProxyStorage implementation&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] #finalize should change ProxyStorage implementation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1032,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const contractType = 8;\nconst proxyStorageNew = await ProxyStorageMock.new();\nconst newAddress = proxyStorageNew.address;\nawait deployAndTest({contractType, newAddress})\nnewAddress.should.be.equal(await proxyStorageEternalStorage.implementation.call());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d0c7b2f2-c703-49dc-b46f-7d2d9dac4f14&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;prevents double finalize&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] #finalize prevents double finalize&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1497,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let newAddress1 = accounts[4];\nlet newAddress2 = accounts[5];\nlet contractType1 = 100;\nlet contractType2 = 101;\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  contractType1,\n  \&quot;memo\&quot;,\n  newAddress1,\n  { from: votingKey }\n);\nawait voting.createBallot(\n  VOTING_START_DATE+2,\n  VOTING_END_DATE+2,\n  contractType2,\n  \&quot;memo\&quot;,\n  newAddress2,\n  { from: votingKey }\n);\nconst activeBallotsLength = await voting.activeBallotsLength.call();\nvotingId = await voting.activeBallots.call(activeBallotsLength.toNumber() - 2);\nlet votingIdForSecond = votingId.add(1);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(votingId, choice.reject, {from: votingKey}).should.be.fulfilled;\nfalse.should.be.equal(await voting.hasAlreadyVoted.call(votingId, votingKey2));\nawait voting.vote(votingId, choice.reject, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(votingId, choice.accept, {from: votingKey3}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nfalse.should.be.equal((await voting.getBallotInfo.call(votingId, votingKey))[4]); // isFinalized\nawait finalize(votingId, true, {from: votingKey});\ntrue.should.be.equal((await voting.getBallotInfo.call(votingId, votingKey))[4]); // isFinalized\nawait voting.finalize(votingId, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\n\nawait voting.finalize(votingIdForSecond, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nfalse.should.be.equal(await voting.getIsFinalized.call(votingIdForSecond));\nawait voting.vote(votingIdForSecond, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 3);\nawait finalize(votingIdForSecond, true, {from: votingKey});\nnew web3.BigNumber(-1).should.be.bignumber.equal((await voting.getBallotInfo.call(votingIdForSecond, votingKey))[3]) // progress\nlet ballotInfo = await voting.getBallotInfo.call(votingId, votingKey);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  new web3.BigNumber(3), // totalVoters\n  new web3.BigNumber(-1), // progress\n  true, // isFinalized\n  newAddress1, // proposedValue\n  new web3.BigNumber(contractType1), // contractType\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false, // canBeFinalizedNow\n  true // hasAlreadyVoted\n]);\n(await voting.getQuorumState.call(votingId)).should.be.bignumber.equal(3);\n(await voting.getIndex.call(votingId)).should.be.bignumber.equal(0);\n(await voting.getMinThresholdOfVoters.call(votingId)).should.be.bignumber.equal(2);\nballotInfo = await voting.getBallotInfo.call(votingIdForSecond, votingKey);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE+2), // startTime\n  new web3.BigNumber(VOTING_END_DATE+2), // endTime\n  new web3.BigNumber(1), // totalVoters\n  new web3.BigNumber(-1), // progress\n  true, // isFinalized\n  newAddress2, // proposedValue\n  new web3.BigNumber(contractType2), // contractType\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false, // canBeFinalizedNow\n  true // hasAlreadyVoted\n]);\n(await voting.getQuorumState.call(votingIdForSecond)).should.be.bignumber.equal(3);\n(await voting.getIndex.call(votingIdForSecond)).should.be.bignumber.equal(0);\n(await voting.getMinThresholdOfVoters.call(votingIdForSecond)).should.be.bignumber.equal(2);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ab4f5160-51af-4de1-b2ad-f79ab4a418b4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;allowed at once after all validators gave their votes&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] #finalize allowed at once after all validators gave their votes&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1694,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, // uint256 _startTime\n  VOTING_END_DATE,   // uint256 _endTime\n  100,               // uint256 _contractType\n  \&quot;memo\&quot;,            // string _memo\n  accounts[7],       // address _proposedValue\n  {from: votingKey}\n).should.be.fulfilled;\nfalse.should.be.equal((await voting.getBallotInfo.call(0, votingKey))[4]); // isFinalized\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(0, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(0, choice.reject, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(0, choice.accept, {from: votingKey3}).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE+1);\nawait voting.finalize(0, {from: votingKey2}).should.be.rejectedWith(ERROR_MSG);\nfalse.should.be.equal((await voting.getBallotInfo.call(0, votingKey2))[4]); // isFinalized\nawait voting.setTime(VOTING_START_DATE+172800+1);\n(await voting.getTime.call()).should.be.bignumber.below(VOTING_END_DATE);\nawait finalize(0, true, {from: votingKey2});\ntrue.should.be.equal((await voting.getBallotInfo.call(0, votingKey2))[4]); // isFinalized\nawait voting.setTime(VOTING_END_DATE+1);\nawait voting.finalize(0, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nVOTING_START_DATE = moment.utc().add(12, &#x27;days&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(22, &#x27;days&#x27;).unix();\nawait voting.createBallot(\n  VOTING_START_DATE, // uint256 _startTime\n  VOTING_END_DATE,   // uint256 _endTime\n  100,               // uint256 _contractType\n  \&quot;memo\&quot;,            // string _memo\n  accounts[8],       // address _proposedValue\n  {from: votingKey}\n).should.be.fulfilled;\nfalse.should.be.equal((await voting.getBallotInfo.call(1, votingKey))[4]); // isFinalized\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(1, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(1, choice.reject, {from: votingKey2}).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE+172800+1);\n(await voting.getTime.call()).should.be.bignumber.below(VOTING_END_DATE);\nawait voting.finalize(1, {from: votingKey2}).should.be.rejectedWith(ERROR_MSG);\nfalse.should.be.equal((await voting.getBallotInfo.call(1, votingKey2))[4]); // isFinalized\nawait voting.setTime(VOTING_END_DATE+1);\nawait finalize(1, true, {from: votingKey2});\ntrue.should.be.equal((await voting.getBallotInfo.call(1, votingKey2))[4]); // isFinalized&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;75822218-4ad1-4ed5-bb4e-9b9e9905e1ac&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e7bdd31f-316c-4537-8d6a-2e9eba6f4bea&quot;,&quot;c0efe6a8-3ea3-42eb-9809-3f29cef671fc&quot;,&quot;8197c8a4-5753-47ac-b2c1-63d57d26ce81&quot;,&quot;a9adecd0-cad1-462c-bc38-94cc99d634a5&quot;,&quot;54990816-c7f3-4220-834b-d4a51a8e9e79&quot;,&quot;71588bc8-9b84-4a97-9074-872666030592&quot;,&quot;48982c49-03f9-4e67-af36-a439d8374934&quot;,&quot;d0c7b2f2-c703-49dc-b46f-7d2d9dac4f14&quot;,&quot;ab4f5160-51af-4de1-b2ad-f79ab4a418b4&quot;,&quot;75822218-4ad1-4ed5-bb4e-9b9e9905e1ac&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:11009,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;7c0681d2-1f66-48fd-a6b8-71dbb49e791b&quot;,&quot;title&quot;:&quot;#migrate&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_change_proxy_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_change_proxy_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should copy a ballot to the new contract&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToChangeProxyAddress upgraded [all features] #migrate should copy a ballot to the new contract&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1982,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await proxyStorageMock.setVotingContractMock(accounts[0]);\nawait addMiningKey(miningKeyForVotingKey);\nawait addVotingKey(votingKey, miningKeyForVotingKey);\nawait addMiningKey(accounts[3]);\nawait addVotingKey(accounts[4], accounts[3]);\nawait addMiningKey(accounts[5]);\nawait addVotingKey(accounts[6], accounts[5]);\nawait proxyStorageMock.setVotingContractMock(votingForKeysEternalStorage.address);\nawait poaNetworkConsensusMock.setSystemAddress(accounts[0]);\nawait poaNetworkConsensusMock.finalizeChange().should.be.fulfilled;\nVOTING_START_DATE = moment.utc().add(20, &#x27;seconds&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(10, &#x27;days&#x27;).unix();\nconst id = await voting.nextBallotId.call();\nawait voting.createBallot(\n  VOTING_START_DATE,\n  VOTING_END_DATE,\n  1,\n  \&quot;memo\&quot;,\n  accounts[7],\n  {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.reject, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.reject, {from: accounts[4]}).should.be.fulfilled;\nawait voting.vote(id, choice.reject, {from: accounts[6]}).should.be.fulfilled;\nlet votingNew = await VotingToChangeProxyAddress.new();\nvotingEternalStorage = await EternalStorageProxy.new(proxyStorageMock.address, votingNew.address);\nvotingNew = await VotingToChangeProxyAddress.at(votingEternalStorage.address);\nawait votingNew.init(172800).should.be.fulfilled;\nawait votingNew.setTime(VOTING_START_DATE);\nawait votingNew.migrateBasicOne(\n  id,\n  voting.address,\n  [miningKeyForVotingKey, accounts[3], accounts[5]]\n).should.be.fulfilled;\nconst ballotInfo = await votingNew.getBallotInfo.call(id, votingKey);\n\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  new web3.BigNumber(3), // totalVoters\n  new web3.BigNumber(-3), // progress\n  false, // isFinalized\n  accounts[7], // proposedValue\n  new web3.BigNumber(1), // contractType\n  miningKeyForVotingKey, // creator\n  \&quot;memo\&quot;, // memo\n  false, // canBeFinalizedNow\n  true // hasAlreadyVoted\n]);\n(await votingNew.getQuorumState.call(id)).should.be.bignumber.equal(1);\n(await votingNew.getIndex.call(id)).should.be.bignumber.equal(0);\n(await votingNew.getMinThresholdOfVoters.call(id)).should.be.bignumber.equal(2);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, miningKeyForVotingKey)).should.be.equal(true);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, accounts[2])).should.be.equal(false);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, accounts[3])).should.be.equal(true);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, accounts[4])).should.be.equal(false);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, accounts[5])).should.be.equal(true);\n(await votingNew.hasMiningKeyAlreadyVoted.call(id, accounts[6])).should.be.equal(false);\n(await votingNew.nextBallotId.call()).should.be.bignumber.equal(0);\n(await votingNew.activeBallotsLength.call()).should.be.bignumber.equal(0);\n(await votingNew.validatorActiveBallots.call(accounts[1])).should.be.bignumber.equal(0);\nawait votingNew.migrateBasicAll(voting.address, {from: accounts[6]}).should.be.rejectedWith(ERROR_MSG);\nawait votingNew.migrateBasicAll(&#x27;0x0000000000000000000000000000000000000000&#x27;).should.be.rejectedWith(ERROR_MSG);\nawait votingNew.migrateBasicAll(voting.address).should.be.fulfilled;\nawait votingNew.migrateBasicAll(voting.address).should.be.fulfilled;\n(await votingNew.nextBallotId.call()).should.be.bignumber.equal(1);\n(await votingNew.activeBallotsLength.call()).should.be.bignumber.equal(1);\n(await votingNew.validatorActiveBallots.call(accounts[1])).should.be.bignumber.equal(1);\n(await votingNew.migrateDisabled.call()).should.be.equal(false);\nawait votingNew.migrateDisable({from: accounts[1]}).should.be.rejectedWith(ERROR_MSG);\nawait votingNew.migrateDisable().should.be.fulfilled;\n(await votingNew.migrateDisabled.call()).should.be.equal(true);\nawait votingNew.migrateBasicAll(voting.address).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8150ce07-c27c-4364-a4d2-240dda2ea67d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8150ce07-c27c-4364-a4d2-240dda2ea67d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1982,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;563768f3-0fc9-4a95-8a28-763057d5fceb&quot;,&quot;title&quot;:&quot;Contract: VotingToManageEmissionFunds [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_manage_emission_funds_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_manage_emission_funds_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3309,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;11ae087f-f2cc-4293-a670-8cd531a84147&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;039d0c51-1ce9-48d5-a926-4343a85576ff&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2267,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;coinbase = accounts[0];\nmasterOfCeremony = accounts[0];\nvotingKey = accounts[2];\nvotingKey2 = accounts[3];\nvotingKey3 = accounts[4];\nvotingKey4 = accounts[7];\nminingKey = accounts[1];\nminingKey2 = accounts[5];\nminingKey3 = accounts[6];\nminingKey4 = accounts[8];\npoaNetworkConsensus = await PoaNetworkConsensus.new(masterOfCeremony, []);\n\nproxyStorage = await ProxyStorage.new();\nconst proxyStorageEternalStorage = await EternalStorageProxy.new(0, proxyStorage.address);\nproxyStorage = await ProxyStorage.at(proxyStorageEternalStorage.address);\nawait proxyStorage.init(poaNetworkConsensus.address).should.be.fulfilled;\nawait poaNetworkConsensus.setProxyStorage(proxyStorage.address);\n\nkeysManager = await KeysManager.new();\nconst keysManagerEternalStorage = await EternalStorageProxy.new(proxyStorage.address, keysManager.address);\nkeysManager = await KeysManager.at(keysManagerEternalStorage.address);\nawait keysManager.init(\n  \&quot;0x0000000000000000000000000000000000000000\&quot;\n).should.be.fulfilled;\n\nballotsStorage = await BallotsStorage.new();\nconst ballotsEternalStorage = await EternalStorageProxy.new(proxyStorage.address, ballotsStorage.address);\nballotsStorage = await BallotsStorage.at(ballotsEternalStorage.address);\nawait ballotsStorage.init([3, 2]).should.be.fulfilled;\nlet votingForKeys = await VotingForKeys.new();\nvotingForKeysEternalStorage = await EternalStorageProxy.new(proxyStorage.address, votingForKeys.address);\nvotingForKeys = await VotingForKeys.at(votingForKeysEternalStorage.address);\nawait votingForKeys.init(172800).should.be.fulfilled;\nlet votingForMinThreshold = await VotingForMinThreshold.new();\nconst votingForMinThresholdEternalStorage = await EternalStorageProxy.new(proxyStorage.address, votingForMinThreshold.address);\nvotingForMinThreshold = await VotingForMinThreshold.at(votingForMinThresholdEternalStorage.address);\nawait votingForMinThreshold.init(172800, 3).should.be.fulfilled;\nlet votingForProxy = await VotingForProxy.new();\nconst votingForProxyEternalStorage = await EternalStorageProxy.new(proxyStorage.address, votingForProxy.address);\nvotingForProxy = await VotingForProxy.at(votingForProxyEternalStorage.address);\nawait votingForProxy.init(172800).should.be.fulfilled;\nconst validatorMetadata = await ValidatorMetadata.new();\nconst validatorMetadataEternalStorage = await EternalStorageProxy.new(proxyStorage.address, validatorMetadata.address);\nvoting = await VotingToManageEmissionFunds.new();\nvotingEternalStorage = await EternalStorageProxy.new(proxyStorage.address, voting.address);\nvoting = await VotingToManageEmissionFunds.at(votingEternalStorage.address);\nemissionFunds = await EmissionFunds.new(voting.address);\nemissionReleaseTime = moment.utc().add(10, &#x27;minutes&#x27;).unix();\nemissionReleaseThreshold = moment.duration(3, &#x27;months&#x27;).asSeconds();\ndistributionThreshold = moment.duration(7, &#x27;days&#x27;).asSeconds();\nawait voting.init(\n  emissionReleaseTime,\n  emissionReleaseThreshold,\n  distributionThreshold,\n  emissionFunds.address,\n  {from: accounts[8]}\n).should.be.rejectedWith(ERROR_MSG);\nawait voting.init(\n  emissionReleaseTime,\n  emissionReleaseThreshold,\n  300,\n  emissionFunds.address\n).should.be.rejectedWith(ERROR_MSG);\nawait voting.init(\n  emissionReleaseTime,\n  emissionReleaseThreshold,\n  distributionThreshold,\n  emissionFunds.address\n).should.be.fulfilled;\nrewardByBlock = await RewardByBlock.new();\nconst rewardByBlockEternalStorage = await EternalStorageProxy.new(proxyStorage.address, rewardByBlock.address);\nrewardByBlock = await RewardByBlock.at(rewardByBlockEternalStorage.address);\n\nawait proxyStorage.initializeAddresses(\n  keysManagerEternalStorage.address,\n  votingForKeysEternalStorage.address,\n  votingForMinThresholdEternalStorage.address,\n  votingForProxyEternalStorage.address,\n  votingEternalStorage.address,\n  ballotsEternalStorage.address,\n  validatorMetadataEternalStorage.address,\n  rewardByBlockEternalStorage.address\n);\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.equal(0);\nconst coinbaseInitBalance = await web3.eth.getBalance(coinbase);\nconst howMuchToSend = web3.toWei(10, &#x27;ether&#x27;);\nconst hash = await web3.eth.sendTransaction({\n  from: coinbase,\n  to: emissionFunds.address,\n  value: howMuchToSend\n});\nconst receipt = await web3.eth.getTransactionReceipt(hash);\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.equal(howMuchToSend);\nemissionFundsInitBalance = howMuchToSend;\n(await web3.eth.getBalance(coinbase)).should.be.bignumber.equal(coinbaseInitBalance.sub(howMuchToSend).sub(receipt.gasUsed));&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d0bb49f3-b2ef-4bd7-ab57-212da320cb02&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e6852c9e-f889-4e1e-a065-9e0c28ed0279&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;47601db1-3789-46ab-b4d4-eea0a0de4305&quot;,&quot;title&quot;:&quot;#init&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_manage_emission_funds_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_manage_emission_funds_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should change state correctly&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #init should change state correctly&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:104,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await voting.distributionThreshold.call()).should.be.bignumber.equal(distributionThreshold);\n(await voting.emissionFunds.call()).should.be.equal(emissionFunds.address);\n(await voting.emissionReleaseThreshold.call()).should.be.bignumber.equal(emissionReleaseThreshold);\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(emissionReleaseTime);\n(await voting.noActiveBallotExists.call()).should.be.equal(true);\n(await voting.initDisabled.call()).should.be.equal(true);\n(await voting.proxyStorage.call()).should.be.equal(proxyStorage.address);\n(await voting.getKeysManager.call()).should.be.equal(keysManager.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;82f33493-4d44-477d-8de0-ac07a53e6ce7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot be called more than once&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #init cannot be called more than once&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:36,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.init(\n  emissionReleaseTime,\n  emissionReleaseThreshold,\n  distributionThreshold,\n  emissionFunds.address\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cee9474e-960d-48e8-9694-544ad4369abb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;82f33493-4d44-477d-8de0-ac07a53e6ce7&quot;,&quot;cee9474e-960d-48e8-9694-544ad4369abb&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:140,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;5e288a6b-7108-4900-8009-0691bb981cc0&quot;,&quot;title&quot;:&quot;#createBallot&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_manage_emission_funds_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_manage_emission_funds_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #createBallot \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:271,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addValidator(votingKey, miningKey);\nVOTING_START_DATE = moment.utc().add(31, &#x27;minutes&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(7, &#x27;days&#x27;).unix();\nid = await voting.nextBallotId.call();\nawait voting.setTime(moment.utc().add(15, &#x27;minutes&#x27;).unix());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fb5e19ba-9231-4b1a-954e-ea9f2d67a636&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #createBallot happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:958,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addValidator(votingKey2, miningKey2);\nawait addValidator(votingKey3, miningKey3);\nconst emissionFundsAmount = await web3.eth.getBalance(emissionFunds.address);\nconst {logs} = await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nconst ballotInfo = await voting.getBallotInfo.call(id);\nballotInfo.should.be.deep.equal([\n  await voting.getTime.call(), // creationTime\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  false, // isCanceled\n  false, // isFinalized\n  miningKey, // creator\n  \&quot;memo\&quot;, // memo\n  new web3.BigNumber(emissionFundsAmount), // amount\n  new web3.BigNumber(0), // burnVotes\n  new web3.BigNumber(0), // freezeVotes\n  new web3.BigNumber(0), // sendVotes\n  accounts[5] // receiver\n]);\n(await voting.getQuorumState.call(id)).should.be.bignumber.equal(1);\n(await voting.getMinThresholdOfVoters.call(id)).should.be.bignumber.equal(2);\n(await voting.getEmissionReleaseTimeSnapshot.call(id)).should.be.bignumber.equal(emissionReleaseTime);\n(await voting.noActiveBallotExists.call()).should.be.equal(false);\n(await voting.nextBallotId.call()).should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(\&quot;BallotCreated\&quot;);\nlogs[0].args.id.should.be.bignumber.equal(0);\nlogs[0].args.ballotType.should.be.bignumber.equal(6);\nlogs[0].args.creator.should.be.equal(votingKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;08c714e8-e72d-42d6-a629-d15e1845d905&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;may only be called by valid voting key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #createBallot may only be called by valid voting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:167,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: accounts[3]}\n).should.be.rejectedWith(ERROR_MSG);\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8e8cf363-0578-4e30-ba5d-dcb587375066&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;endTime must be greater than startTime&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #createBallot endTime must be greater than startTime&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_END_DATE = moment.utc().add(19, &#x27;minutes&#x27;).unix();\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c15230fa-54b7-40c4-9b40-25a6c381c3a7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;startTime must be greater than current time&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #createBallot startTime must be greater than current time&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(14, &#x27;minutes&#x27;).unix();\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c91d727c-ea1a-458d-958d-9ec963bf42b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot be called before emission release time&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #createBallot cannot be called before emission release time&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:81,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(moment.utc().add(7, &#x27;minutes&#x27;).unix());\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7f726798-4692-4136-8e3c-e11b5decd685&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;ballot cannot last longer than distribution threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #createBallot ballot cannot last longer than distribution threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:45,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_END_DATE = moment.utc().add(8, &#x27;days&#x27;).unix();\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;10c7290e-7689-429a-bfe1-fda5d1e21369&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;receiver address should not be 0x0&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #createBallot receiver address should not be 0x0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:64,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, &#x27;0x0000000000000000000000000000000000000000&#x27;, \&quot;memo\&quot;, {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);\n(await voting.nextBallotId.call()).should.be.bignumber.equal(0);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ad725a6f-4700-4b21-86ed-0d0219136d20&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot create multiple ballots during the same distribution period&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #createBallot cannot create multiple ballots during the same distribution period&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:465,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\n(await voting.nextBallotId.call()).should.be.bignumber.equal(1);\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[6], \&quot;memo\&quot;, {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);\n(await voting.nextBallotId.call()).should.be.bignumber.equal(1);\nawait voting.setTime(VOTING_END_DATE + 1);\nconst {logs} = await voting.finalize(0, {from: votingKey}).should.be.fulfilled;\nlogs[0].event.should.be.equal(\&quot;BallotFinalized\&quot;);\nlogs[0].args.id.should.be.bignumber.equal(0);\nlogs[0].args.voter.should.be.equal(votingKey);\nawait voting.setTime(\n  emissionReleaseTime + emissionReleaseThreshold + 1\n);\nVOTING_START_DATE = emissionReleaseTime + emissionReleaseThreshold + 2;\nVOTING_END_DATE = VOTING_START_DATE + 100;\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\n(await voting.nextBallotId.call()).should.be.bignumber.equal(2);\n(await voting.getEmissionReleaseTimeSnapshot.call(1)).should.be.bignumber.equal(\n  emissionReleaseTime + emissionReleaseThreshold\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;98832646-52cf-4418-a4ce-6ba94c8395e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow creating new ballot after the next emission release threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #createBallot should allow creating new ballot after the next emission release threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:472,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(\n  emissionReleaseTime + emissionReleaseThreshold + 1\n);\nVOTING_START_DATE = emissionReleaseTime + emissionReleaseThreshold + 2;\nVOTING_END_DATE = VOTING_START_DATE + 900;\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime + emissionReleaseThreshold\n);\n(await voting.getEmissionReleaseTimeSnapshot.call(0)).should.be.bignumber.equal(\n  emissionReleaseTime\n);\nawait voting.setTime(VOTING_END_DATE + 1);\nawait voting.finalize(0, {from: votingKey}).should.be.fulfilled;\nawait voting.setTime(\n  emissionReleaseTime + emissionReleaseThreshold*5 + 1\n);\nVOTING_START_DATE = emissionReleaseTime + emissionReleaseThreshold*5 - 2;\nVOTING_END_DATE = VOTING_START_DATE + 900;\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);\nVOTING_START_DATE = emissionReleaseTime + emissionReleaseThreshold*5 + 2;\nVOTING_END_DATE = VOTING_START_DATE + 900;\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime + emissionReleaseThreshold*5\n);\n(await voting.getEmissionReleaseTimeSnapshot.call(1)).should.be.bignumber.equal(\n  emissionReleaseTime + emissionReleaseThreshold*2\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0c7e5668-6097-4e55-8f34-72a864ce79b3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;08c714e8-e72d-42d6-a629-d15e1845d905&quot;,&quot;8e8cf363-0578-4e30-ba5d-dcb587375066&quot;,&quot;c15230fa-54b7-40c4-9b40-25a6c381c3a7&quot;,&quot;c91d727c-ea1a-458d-958d-9ec963bf42b8&quot;,&quot;7f726798-4692-4136-8e3c-e11b5decd685&quot;,&quot;10c7290e-7689-429a-bfe1-fda5d1e21369&quot;,&quot;ad725a6f-4700-4b21-86ed-0d0219136d20&quot;,&quot;98832646-52cf-4418-a4ce-6ba94c8395e6&quot;,&quot;0c7e5668-6097-4e55-8f34-72a864ce79b3&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2344,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;7313f453-18da-4c2a-90cc-b89daefafa13&quot;,&quot;title&quot;:&quot;#cancelNewBallot&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_manage_emission_funds_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_manage_emission_funds_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #cancelNewBallot \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:354,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addValidator(votingKey, miningKey);\nVOTING_START_DATE = moment.utc().add(31, &#x27;minutes&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(7, &#x27;days&#x27;).unix();\nid = await voting.nextBallotId.call();\nawait voting.setTime(moment.utc().add(15, &#x27;minutes&#x27;).unix());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c8218644-cdbe-4e08-b618-c47462729256&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #cancelNewBallot happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:915,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const emissionFundsAmount = await web3.eth.getBalance(emissionFunds.address);\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nlet creationTime = await voting.getTime.call();\nawait voting.setTime(moment.utc().add(20, &#x27;minutes&#x27;).unix());\nlet result = await voting.cancelNewBallot({from: votingKey}).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(\&quot;BallotCanceled\&quot;);\nresult.logs[0].args.id.should.be.bignumber.equal(id);\nresult.logs[0].args.votingKey.should.be.equal(votingKey);\nlet ballotInfo = await voting.getBallotInfo.call(id);\nballotInfo.should.be.deep.equal([\n  creationTime, // creationTime\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  true, // isCanceled\n  false, // isFinalized\n  miningKey, // creator\n  \&quot;memo\&quot;, // memo\n  new web3.BigNumber(emissionFundsAmount), // amount\n  new web3.BigNumber(0), // burnVotes\n  new web3.BigNumber(0), // freezeVotes\n  new web3.BigNumber(0), // sendVotes\n  accounts[5] // receiver\n]);\n(await voting.noActiveBallotExists.call()).should.be.equal(true);\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(emissionReleaseTime);\nid = await voting.nextBallotId.call();\ncreationTime = moment.utc().add(22, &#x27;minutes&#x27;).unix();\nawait voting.setTime(creationTime);\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.freeze, {from: votingKey}).should.be.fulfilled;\n(await voting.noActiveBallotExists.call()).should.be.equal(false);\nawait voting.setTime(VOTING_END_DATE + 1);\nawait voting.finalize(id, {from: votingKey}).should.be.fulfilled;\nballotInfo = await voting.getBallotInfo.call(id);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(creationTime), // creationTime\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  false, // isCanceled\n  true, // isFinalized\n  miningKey, // creator\n  \&quot;memo\&quot;, // memo\n  new web3.BigNumber(emissionFundsAmount), // amount\n  new web3.BigNumber(0), // burnVotes\n  new web3.BigNumber(1), // freezeVotes\n  new web3.BigNumber(0), // sendVotes\n  accounts[5] // receiver\n]);\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime + emissionReleaseThreshold\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;02526f89-fc88-42e7-8306-5ad441ae33b1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot cancel nonexistent or finalized ballot&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #cancelNewBallot cannot cancel nonexistent or finalized ballot&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:307,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.cancelNewBallot({from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nawait voting.finalize(id, {from: votingKey}).should.be.fulfilled;\nawait voting.setTime(moment.utc().add(20, &#x27;minutes&#x27;).unix());\nawait voting.cancelNewBallot({from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;423714be-f869-490c-a9ac-cf79dca53654&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;may only be called by creator of a ballot&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #cancelNewBallot may only be called by creator of a ballot&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:340,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(moment.utc().add(20, &#x27;minutes&#x27;).unix());\nawait voting.cancelNewBallot({from: votingKey2}).should.be.rejectedWith(ERROR_MSG);\nconst {logs} = await voting.cancelNewBallot({from: votingKey}).should.be.fulfilled;\nlogs[0].event.should.be.equal(\&quot;BallotCanceled\&quot;);\nlogs[0].args.id.should.be.bignumber.equal(id);\nlogs[0].args.votingKey.should.be.equal(votingKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8a9b77a3-12bd-495a-b614-99d68a81f248&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;may only be called within ballot canceling threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #cancelNewBallot may only be called within ballot canceling threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:246,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(moment.utc().add(31, &#x27;minutes&#x27;).unix());\nawait voting.cancelNewBallot({from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.setTime(moment.utc().add(29, &#x27;minutes&#x27;).unix());\nawait voting.cancelNewBallot({from: votingKey}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;365484a8-698d-4e7a-a612-e8bdec3ec0fe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot cancel already cancelled ballot&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #cancelNewBallot cannot cancel already cancelled ballot&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:233,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(moment.utc().add(29, &#x27;minutes&#x27;).unix());\nawait voting.cancelNewBallot({from: votingKey}).should.be.fulfilled;\nawait voting.cancelNewBallot({from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ef50813e-8f2e-4b74-ad49-7e08e496e74b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should restore emission release time&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #cancelNewBallot should restore emission release time&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:498,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nawait voting.finalize(id, {from: votingKey}).should.be.fulfilled;\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime + emissionReleaseThreshold\n);\nawait voting.setTime(\n  emissionReleaseTime + emissionReleaseThreshold*5 + 1\n);\nVOTING_START_DATE = emissionReleaseTime + emissionReleaseThreshold*5 + 2;\nVOTING_END_DATE = VOTING_START_DATE + 900;\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime + emissionReleaseThreshold*5\n);\n(await voting.getEmissionReleaseTimeSnapshot.call(1)).should.be.bignumber.equal(\n  emissionReleaseTime + emissionReleaseThreshold\n);\nawait voting.setTime(emissionReleaseTime + emissionReleaseThreshold*5 + 10);\nawait voting.cancelNewBallot({from: votingKey}).should.be.fulfilled;\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime + emissionReleaseThreshold\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;921c69b9-0905-48b8-a03c-67979513f676&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;02526f89-fc88-42e7-8306-5ad441ae33b1&quot;,&quot;423714be-f869-490c-a9ac-cf79dca53654&quot;,&quot;8a9b77a3-12bd-495a-b614-99d68a81f248&quot;,&quot;365484a8-698d-4e7a-a612-e8bdec3ec0fe&quot;,&quot;ef50813e-8f2e-4b74-ad49-7e08e496e74b&quot;,&quot;921c69b9-0905-48b8-a03c-67979513f676&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2539,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;0b86954a-a361-440c-802f-3e5522a3353c&quot;,&quot;title&quot;:&quot;#refreshEmissionReleaseTime&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_manage_emission_funds_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_manage_emission_funds_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should not update until the next threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #refreshEmissionReleaseTime should not update until the next threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:141,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime\n);\nawait voting.setTime(moment.utc().add(15, &#x27;minutes&#x27;).unix());\nawait voting.refreshEmissionReleaseTime();\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime\n);\nawait voting.setTime(moment.utc().add(2, &#x27;months&#x27;).unix());\nawait voting.refreshEmissionReleaseTime();\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;74857211-aaf9-4a63-bf08-6d5a469aa7d3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should update to the next threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #refreshEmissionReleaseTime should update to the next threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:73,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime\n);\nawait voting.setTime(moment.utc().add(4, &#x27;months&#x27;).unix());\nawait voting.refreshEmissionReleaseTime();\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime + emissionReleaseThreshold\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;05e10bb9-6604-4562-905a-8f1ee63b23c8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should update to the future threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #refreshEmissionReleaseTime should update to the future threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:80,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime\n);\nawait voting.setTime(moment.utc().add(7, &#x27;months&#x27;).unix());\nawait voting.refreshEmissionReleaseTime();\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime + emissionReleaseThreshold*2\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0e6c52f8-9412-4ce3-abe4-dea2e3232cf1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;74857211-aaf9-4a63-bf08-6d5a469aa7d3&quot;,&quot;05e10bb9-6604-4562-905a-8f1ee63b23c8&quot;,&quot;0e6c52f8-9412-4ce3-abe4-dea2e3232cf1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:294,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;ca17c725-c4c4-43a1-95fe-19c739c26115&quot;,&quot;title&quot;:&quot;#vote&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_manage_emission_funds_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_manage_emission_funds_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #vote \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:518,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;receiver = accounts[9];\nawait addValidator(votingKey, miningKey);\nVOTING_START_DATE = moment.utc().add(31, &#x27;minutes&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(7, &#x27;days&#x27;).unix();\nid = await voting.nextBallotId.call();\nawait voting.setTime(moment.utc().add(15, &#x27;minutes&#x27;).unix());\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5ce19de6-d666-4027-98eb-8e3b2ece90d5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should let a validator to vote&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #vote should let a validator to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:837,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const emissionFundsBalanceOld = await web3.eth.getBalance(emissionFunds.address);\nconst receiverBalanceOld = await web3.eth.getBalance(receiver);\nawait voting.setTime(VOTING_START_DATE);\nconst {logs} = await voting.vote(id, choice.freeze, {from: votingKey}).should.be.fulfilled;\nconst ballotInfo = await voting.getBallotInfo.call(id);\nballotInfo[4].should.be.equal(true); // isFinalized\nballotInfo[8].should.be.bignumber.equal(0); // burnVotes\nballotInfo[9].should.be.bignumber.equal(1); // freezeVotes\nballotInfo[10].should.be.bignumber.equal(0); // sendVotes\n(await voting.noActiveBallotExists.call()).should.be.equal(true);\n(await voting.getQuorumState.call(id)).should.be.bignumber.equal(4);\n(await voting.getMinThresholdOfVoters.call(id)).should.be.bignumber.equal(1);\n(await voting.hasAlreadyVoted.call(id, votingKey)).should.be.equal(true);\nlogs[0].event.should.be.equal(&#x27;Vote&#x27;);\nlogs[0].args.id.should.be.bignumber.equal(0);\nlogs[0].args.decision.should.be.bignumber.equal(choice.freeze);\nlogs[0].args.voter.should.be.equal(votingKey);\nlogs[0].args.time.should.be.bignumber.equal(VOTING_START_DATE);\nlogs[0].args.voterMiningKey.should.be.equal(miningKey);\nlogs[1].event.should.be.equal(&#x27;BallotFinalized&#x27;);\nlogs[1].args.id.should.be.bignumber.equal(0);\nlogs[1].args.voter.should.be.equal(votingKey);\nemissionFundsBalanceOld.should.be.bignumber.equal(await web3.eth.getBalance(emissionFunds.address));\nreceiverBalanceOld.should.be.bignumber.equal(await web3.eth.getBalance(receiver));&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8b860fb8-c035-401d-915d-0170ee7185d3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow multiple voters to vote&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #vote should allow multiple voters to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1422,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addValidator(votingKey2, miningKey2);\nawait addValidator(votingKey3, miningKey3);\nawait voting.setTime(VOTING_START_DATE+1);\nawait voting.vote(id, choice.burn, {from: votingKey}).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE+2);\nawait voting.vote(id, choice.burn, {from: votingKey2}).should.be.fulfilled;\n(await voting.getAmount.call(id)).should.be.bignumber.equal(\n  await web3.eth.getBalance(emissionFunds.address)\n);\n(await voting.getAmount.call(id)).should.be.bignumber.above(0);\nawait voting.setTime(VOTING_START_DATE+3);\nawait voting.vote(id, choice.burn, {from: votingKey3}).should.be.fulfilled;\nconst ballotInfo = await voting.getBallotInfo.call(id);\nballotInfo[4].should.be.equal(true); // isFinalized\nballotInfo[8].should.be.bignumber.equal(3); // burnVotes\nballotInfo[9].should.be.bignumber.equal(0); // freezeVotes\nballotInfo[10].should.be.bignumber.equal(0); // sendVotes\n(await voting.hasMiningKeyAlreadyVoted.call(id, miningKey)).should.be.equal(true);\n(await voting.hasMiningKeyAlreadyVoted.call(id, miningKey2)).should.be.equal(true);\n(await voting.hasMiningKeyAlreadyVoted.call(id, miningKey3)).should.be.equal(true);\n(await voting.noActiveBallotExists.call()).should.be.equal(true);\n(await voting.getQuorumState.call(id)).should.be.bignumber.equal(3);\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.equal(0);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;148242c2-b204-4b07-a66d-eb12948d89d3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote by nonvoting key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #vote should not let vote by nonvoting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:58,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.send, {from: accounts[0]}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;52cf8422-b4bc-46fd-bb04-b884f563e120&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote before startTime&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #vote should not let vote before startTime&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:100,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE - 1);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;86b107c0-3b54-44ed-9452-764bcf5af756&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote after endTime&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #vote should not let vote after endTime&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:259,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE + 1);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.setTime(VOTING_END_DATE);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ba5df4cc-331e-4e8e-b10c-f783003f4990&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with already voted key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #vote should not let vote with already voted key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:201,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e7929d39-f0a9-4f4b-b968-7044ef129be9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with invalid choice&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #vote should not let vote with invalid choice&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:150,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, 0, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(id, 4, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;14a4c24e-6d2f-4878-b6b4-7bd744d35d1c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with invalid id&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #vote should not let vote with invalid id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:156,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(99, choice.send, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(-3, choice.send, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;08bf0d83-b9e5-46b0-aa5a-5ac1ad796646&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote if already finalized&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #vote should not let vote if already finalized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1601,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addValidator(votingKey2, miningKey2);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.fulfilled;\nfalse.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\nawait voting.setTime(VOTING_END_DATE + 1);\nawait voting.finalize(id, {from: votingKey}).should.be.fulfilled;\ntrue.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\nawait voting.vote(id, choice.send, {from: votingKey2}).should.be.rejectedWith(ERROR_MSG);\nawait voting.setTime(VOTING_START_DATE + 1);\nawait voting.vote(id, choice.send, {from: votingKey2}).should.be.rejectedWith(ERROR_MSG);\nid = await voting.nextBallotId.call();\nVOTING_START_DATE += emissionReleaseThreshold;\nVOTING_END_DATE += emissionReleaseThreshold;\nawait voting.setTime(VOTING_START_DATE - 5*60);\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE + 11*60);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.send, {from: votingKey2}).should.be.fulfilled;\ntrue.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\nawait addValidator(votingKey3, miningKey3);\nawait voting.vote(id, choice.send, {from: votingKey3}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c8d7d570-93d5-4e72-a0b1-32ffde4dc6ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with old miningKey&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #vote should not let vote with old miningKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2327,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addValidator(votingKey2, miningKey2);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.fulfilled;\nfalse.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\nawait proxyStorage.setVotingContractMock(coinbase);\nconst {logs} = await keysManager.swapMiningKey(miningKey3, miningKey);\nlogs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nawait proxyStorage.setVotingContractMock(votingForKeysEternalStorage.address);\nawait poaNetworkConsensus.setSystemAddress(coinbase);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nawait poaNetworkConsensus.setSystemAddress(&#x27;0xffffFFFfFFffffffffffffffFfFFFfffFFFfFFfE&#x27;);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait proxyStorage.setVotingContractMock(coinbase);\nawait swapVotingKey(votingKey3, miningKey3);\nawait proxyStorage.setVotingContractMock(votingForKeysEternalStorage.address);\nawait voting.vote(id, choice.send, {from: votingKey3}).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(id, choice.send, {from: votingKey2}).should.be.fulfilled;\ntrue.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\nid = await voting.nextBallotId.call();\nVOTING_START_DATE += emissionReleaseThreshold;\nVOTING_END_DATE += emissionReleaseThreshold;\nawait voting.setTime(VOTING_START_DATE - 5*60);\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey2}\n).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE + 11*60);\nawait voting.vote(id, choice.send, {from: votingKey3}).should.be.fulfilled;\nfalse.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\nawait proxyStorage.setVotingContractMock(coinbase);\nlet result = await keysManager.swapMiningKey(miningKey, miningKey3);\nresult.logs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nawait swapVotingKey(votingKey, miningKey);\nawait proxyStorage.setVotingContractMock(votingForKeysEternalStorage.address);\nawait poaNetworkConsensus.setSystemAddress(coinbase);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nawait poaNetworkConsensus.setSystemAddress(&#x27;0xffffFFFfFFffffffffffffffFfFFFfffFFFfFFfE&#x27;);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(id, choice.send, {from: votingKey2}).should.be.fulfilled;\ntrue.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;fd555f01-d198-4332-abc4-66a87ec259c1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote if ballot is canceled&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #vote should not let vote if ballot is canceled&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:127,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(moment.utc().add(20, &#x27;minutes&#x27;).unix());\nconst {logs} = await voting.cancelNewBallot({from: votingKey}).should.be.fulfilled;\nlogs[0].event.should.be.equal(\&quot;BallotCanceled\&quot;);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;57790742-79d5-4afc-a6d5-dceab686e327&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;8b860fb8-c035-401d-915d-0170ee7185d3&quot;,&quot;148242c2-b204-4b07-a66d-eb12948d89d3&quot;,&quot;52cf8422-b4bc-46fd-bb04-b884f563e120&quot;,&quot;86b107c0-3b54-44ed-9452-764bcf5af756&quot;,&quot;ba5df4cc-331e-4e8e-b10c-f783003f4990&quot;,&quot;e7929d39-f0a9-4f4b-b968-7044ef129be9&quot;,&quot;14a4c24e-6d2f-4878-b6b4-7bd744d35d1c&quot;,&quot;08bf0d83-b9e5-46b0-aa5a-5ac1ad796646&quot;,&quot;c8d7d570-93d5-4e72-a0b1-32ffde4dc6ba&quot;,&quot;fd555f01-d198-4332-abc4-66a87ec259c1&quot;,&quot;57790742-79d5-4afc-a6d5-dceab686e327&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:7238,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;b72abc8c-2b0c-44fa-b12f-22ab8c4b17b3&quot;,&quot;title&quot;:&quot;#finalize&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_manage_emission_funds_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_manage_emission_funds_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #finalize \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:381,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;receiver = accounts[9];\nawait addValidator(votingKey, miningKey);\nVOTING_START_DATE = moment.utc().add(31, &#x27;minutes&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(7, &#x27;days&#x27;).unix();\nid = await voting.nextBallotId.call();\nawait voting.setTime(moment.utc().add(15, &#x27;minutes&#x27;).unix());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;743e939e-ffb5-4ff1-a7de-a5e2dcf8a858&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #finalize happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:637,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nfalse.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\n(await voting.noActiveBallotExists.call()).should.be.equal(false);\nawait addValidator(votingKey2, miningKey2);\nawait voting.setTime(VOTING_END_DATE + 1);\nconst {logs} = await voting.finalize(id, {from: votingKey2}).should.be.fulfilled;\ntrue.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\n(await voting.noActiveBallotExists.call()).should.be.equal(true);\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime + emissionReleaseThreshold\n);\nlogs[0].event.should.be.equal(&#x27;BallotFinalized&#x27;);\nlogs[0].args.id.should.be.bignumber.equal(id);\nlogs[0].args.voter.should.be.equal(votingKey2);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;76030390-99a7-4b6e-9427-b96b08e46bbb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;freeze funds if it did not pass minimum voters count&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #finalize freeze funds if it did not pass minimum voters count&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1031,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addValidator(votingKey2, miningKey2);\nawait addValidator(votingKey3, miningKey3);\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\n(await voting.getMinThresholdOfVoters.call(id)).should.be.bignumber.equal(2);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.burn, {from: votingKey}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nawait voting.finalize(id, {from: votingKey3}).should.be.fulfilled;\n(await voting.getQuorumState.call(id)).should.be.bignumber.equal(4);\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.equal(emissionFundsInitBalance);\nemissionFundsInitBalance.should.be.bignumber.above(0);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4b5300d4-a938-42cd-ad05-8c6231f74da1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;freeze funds if there is no majority of 3 votes&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #finalize freeze funds if there is no majority of 3 votes&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1167,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait addValidator(votingKey2, miningKey2);\nawait addValidator(votingKey3, miningKey3);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.burn, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(id, choice.freeze, {from: votingKey3}).should.be.fulfilled;\ntrue.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\n(await voting.getQuorumState.call(id)).should.be.bignumber.equal(4);\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.equal(emissionFundsInitBalance);\nemissionFundsInitBalance.should.be.bignumber.above(0);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;80d26eb8-dfed-4501-91b8-67925fadb5ff&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;freeze funds if there is no majority of 4 votes&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #finalize freeze funds if there is no majority of 4 votes&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1670,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait addValidator(votingKey2, miningKey2);\nawait addValidator(votingKey3, miningKey3);\nawait addValidator(votingKey4, miningKey4);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.burn, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(id, choice.send, {from: votingKey3}).should.be.fulfilled;\nawait voting.vote(id, choice.burn, {from: votingKey4}).should.be.fulfilled;\ntrue.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\n(await voting.getQuorumState.call(id)).should.be.bignumber.equal(4);\n(await voting.getTotalVoters.call(id)).should.be.bignumber.equal(4);\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.equal(emissionFundsInitBalance);\nemissionFundsInitBalance.should.be.bignumber.above(0);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;03996188-70ee-4a3e-bc52-403dd5ccb9d5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;send funds to receiver if most votes are for sending&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #finalize send funds to receiver if most votes are for sending&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2174,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait addValidator(votingKey2, miningKey2);\nawait addValidator(votingKey3, miningKey3);\nawait addValidator(votingKey4, miningKey4);\nconst receiverInitBalance = await web3.eth.getBalance(receiver);\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.equal(emissionFundsInitBalance);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.send, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(id, choice.burn, {from: votingKey3}).should.be.fulfilled;\nawait voting.vote(id, choice.freeze, {from: votingKey4}).should.be.fulfilled;\ntrue.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\n(await voting.getQuorumState.call(id)).should.be.bignumber.equal(2);\n(await voting.getTotalVoters.call(id)).should.be.bignumber.equal(4);\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.equal(0);\n(await web3.eth.getBalance(receiver)).should.be.bignumber.equal(\n  receiverInitBalance.add(emissionFundsInitBalance)\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;d7d64deb-9ab6-4512-b5a8-e41273cfb074&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;send funds to receiver if most votes are for sending&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #finalize send funds to receiver if most votes are for sending&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1813,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait addValidator(votingKey2, miningKey2);\nawait addValidator(votingKey3, miningKey3);\nconst receiverInitBalance = await web3.eth.getBalance(receiver);\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.equal(emissionFundsInitBalance);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.send, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(id, choice.burn, {from: votingKey3}).should.be.fulfilled;\ntrue.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\n(await voting.getQuorumState.call(id)).should.be.bignumber.equal(2);\n(await voting.getTotalVoters.call(id)).should.be.bignumber.equal(3);\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.equal(0);\n(await web3.eth.getBalance(receiver)).should.be.bignumber.equal(\n  receiverInitBalance.add(emissionFundsInitBalance)\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c583fb74-84ec-457e-bf17-5a0eae85e874&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;burn funds if most votes are for burning&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #finalize burn funds if most votes are for burning&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1864,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait addValidator(votingKey2, miningKey2);\nawait addValidator(votingKey3, miningKey3);\nconst receiverInitBalance = await web3.eth.getBalance(receiver);\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.above(0);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.burn, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(id, choice.burn, {from: votingKey3}).should.be.fulfilled;\ntrue.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\n(await voting.getQuorumState.call(id)).should.be.bignumber.equal(3);\n(await voting.getTotalVoters.call(id)).should.be.bignumber.equal(3);\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.equal(0);\n(await web3.eth.getBalance(receiver)).should.be.bignumber.equal(receiverInitBalance);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;243ad9f0-9b31-4105-ac07-8d0d57aea329&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;prevents finalize with invalid id&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #finalize prevents finalize with invalid id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:225,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nawait voting.finalize(1, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;de5c6af5-bdbb-4067-b410-df87dd9fe21b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;do not let finalize if a ballot is active&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #finalize do not let finalize if a ballot is active&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:186,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE + 1);\nawait voting.finalize(0, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;41b4f89b-36e4-43eb-8631-542380afd639&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize immediately if the last validator gave his vote&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #finalize finalize immediately if the last validator gave his vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1183,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait addValidator(votingKey2, miningKey2);\nawait addValidator(votingKey3, miningKey3);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.fulfilled;\n\nawait voting.vote(id, choice.burn, {from: votingKey2}).should.be.fulfilled;\nfalse.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\n\nawait voting.vote(id, choice.burn, {from: votingKey3}).should.be.fulfilled;\ntrue.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\n\n(await voting.noActiveBallotExists.call()).should.be.equal(true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6448f980-63d1-4440-b468-8cc52edfe179&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;does not finalize immediately until ballot canceling threshold is reached&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #finalize does not finalize immediately until ballot canceling threshold is reached&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1268,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(17, &#x27;minutes&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(20, &#x27;minutes&#x27;).unix();\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait addValidator(votingKey2, miningKey2);\nawait addValidator(votingKey3, miningKey3);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.burn, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(id, choice.burn, {from: votingKey3}).should.be.fulfilled;\n\nfalse.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\nawait voting.setTime(moment.utc().add(31, &#x27;minutes&#x27;).unix());\nawait voting.finalize(id, {from: votingKey3}).should.be.fulfilled;\ntrue.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;87241901-d269-4f79-9869-86fbfa8cc901&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;prevents double finalize&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #finalize prevents double finalize&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:289,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nawait voting.finalize(0, {from: votingKey}).should.be.fulfilled;\nawait voting.finalize(0, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c73f9c0c-f055-4d42-bbf4-256bf84552a8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should refresh emission release time&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #finalize should refresh emission release time&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:282,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime\n);\nawait voting.setTime(VOTING_END_DATE + 1);\nawait voting.finalize(0, {from: votingKey}).should.be.fulfilled;\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime + emissionReleaseThreshold\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;41559d05-6e2e-4da5-a927-960efb7bc712&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;deny finalization if the voting key is a contract&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #finalize deny finalization if the voting key is a contract&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:814,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const voter = await VotingKey.new(voting.address);\nvotingKey2 = voter.address;\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nfalse.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\n(await voting.noActiveBallotExists.call()).should.be.equal(false);\nawait addValidator(votingKey2, miningKey2);\nawait voting.setTime(VOTING_END_DATE + 1);\n\nawait voter.callFinalize(id).should.be.rejectedWith(ERROR_MSG);\nfalse.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\nawait voting.finalize(id, {from: votingKey}).should.be.fulfilled;\ntrue.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\n(await voting.noActiveBallotExists.call()).should.be.equal(true);\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime + emissionReleaseThreshold\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;8849956a-c999-4457-915c-f82e834ae5b0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;deny finalization within ballot canceling threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #finalize deny finalization within ballot canceling threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:347,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(17, &#x27;minutes&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(20, &#x27;minutes&#x27;).unix();\n\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nawait voting.finalize(id, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.setTime(moment.utc().add(31, &#x27;minutes&#x27;).unix());\nawait voting.finalize(id, {from: votingKey}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b9044236-b922-4620-b257-3339b7a28a17&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;deny finalization of canceled ballot&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #finalize deny finalization of canceled ballot&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:281,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(moment.utc().add(20, &#x27;minutes&#x27;).unix());\nlet result = await voting.cancelNewBallot({from: votingKey}).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(\&quot;BallotCanceled\&quot;);\nresult.logs[0].args.id.should.be.bignumber.equal(id);\nresult.logs[0].args.votingKey.should.be.equal(votingKey);\nawait voting.setTime(VOTING_END_DATE + 1);\nawait voting.finalize(id, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;809bdfde-880d-4ca1-8ebd-7c5646f45dec&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;76030390-99a7-4b6e-9427-b96b08e46bbb&quot;,&quot;4b5300d4-a938-42cd-ad05-8c6231f74da1&quot;,&quot;80d26eb8-dfed-4501-91b8-67925fadb5ff&quot;,&quot;03996188-70ee-4a3e-bc52-403dd5ccb9d5&quot;,&quot;d7d64deb-9ab6-4512-b5a8-e41273cfb074&quot;,&quot;c583fb74-84ec-457e-bf17-5a0eae85e874&quot;,&quot;243ad9f0-9b31-4105-ac07-8d0d57aea329&quot;,&quot;de5c6af5-bdbb-4067-b410-df87dd9fe21b&quot;,&quot;41b4f89b-36e4-43eb-8631-542380afd639&quot;,&quot;6448f980-63d1-4440-b468-8cc52edfe179&quot;,&quot;87241901-d269-4f79-9869-86fbfa8cc901&quot;,&quot;c73f9c0c-f055-4d42-bbf4-256bf84552a8&quot;,&quot;41559d05-6e2e-4da5-a927-960efb7bc712&quot;,&quot;8849956a-c999-4457-915c-f82e834ae5b0&quot;,&quot;b9044236-b922-4620-b257-3339b7a28a17&quot;,&quot;809bdfde-880d-4ca1-8ebd-7c5646f45dec&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:15231,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;40b97506-6e5b-4dfb-846e-a01f02f2d1ed&quot;,&quot;title&quot;:&quot;#upgradeTo&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_manage_emission_funds_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_manage_emission_funds_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #upgradeTo \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:123,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;proxyStorageStubAddress = accounts[8];\nvoting = await VotingToManageEmissionFunds.new();\nvotingOldImplementation = voting.address;\nvotingEternalStorage = await EternalStorageProxy.new(proxyStorageStubAddress, voting.address);\nvoting = await VotingToManageEmissionFunds.at(votingEternalStorage.address);\nawait voting.init(\n  emissionReleaseTime,\n  emissionReleaseThreshold,\n  distributionThreshold,\n  emissionFunds.address\n).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c12d99e3-4538-42ea-92c5-75fa174aa03f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;may only be called by ProxyStorage&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #upgradeTo may only be called by ProxyStorage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:95,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let votingNew = await VotingToManageEmissionFundsNew.new();\nawait votingEternalStorage.upgradeTo(votingNew.address, {from: accounts[0]}).should.be.rejectedWith(ERROR_MSG);\nawait upgradeTo(votingNew.address, {from: proxyStorageStubAddress});&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;abd60f66-7a70-4219-9437-b89afb5f0b62&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should change implementation address&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #upgradeTo should change implementation address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:181,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let votingNew = await VotingToManageEmissionFundsNew.new();\nlet newImplementation = votingNew.address;\n(await votingEternalStorage.implementation.call()).should.be.equal(votingOldImplementation);\nawait upgradeTo(newImplementation, {from: proxyStorageStubAddress});\n(await votingEternalStorage.implementation.call()).should.be.equal(newImplementation);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;018859df-e6aa-486b-bcfc-bc350114db34&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should increment implementation version&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #upgradeTo should increment implementation version&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:86,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let votingNew = await VotingToManageEmissionFundsNew.new();\nlet oldVersion = await votingEternalStorage.version.call();\nlet newVersion = oldVersion.add(1);\nawait upgradeTo(votingNew.address, {from: proxyStorageStubAddress});\n(await votingEternalStorage.version.call()).should.be.bignumber.equal(newVersion);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c7bac718-98a4-44f7-8fce-c369fd80f9b4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should work&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #upgradeTo new implementation should work&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:124,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let votingNew = await VotingToManageEmissionFundsNew.new();\nawait upgradeTo(votingNew.address, {from: proxyStorageStubAddress});\nvotingNew = await VotingToManageEmissionFundsNew.at(votingEternalStorage.address);\n(await votingNew.initialized.call()).should.be.equal(false);\nawait votingNew.initialize();\n(await votingNew.initialized.call()).should.be.equal(true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7e5f9b7c-2dcf-4fe0-8c3a-daafa0808f96&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should use the same proxyStorage address&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #upgradeTo new implementation should use the same proxyStorage address&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:97,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let votingNew = await VotingToManageEmissionFundsNew.new();\nawait upgradeTo(votingNew.address, {from: proxyStorageStubAddress});\nvotingNew = await VotingToManageEmissionFundsNew.at(votingEternalStorage.address);\n(await votingNew.proxyStorage.call()).should.be.equal(proxyStorageStubAddress);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cfff5a63-c4fb-481f-a45b-dbe5a06a0c26&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;new implementation should use the same storage&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds [all features] #upgradeTo new implementation should use the same storage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:864,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addValidator(votingKey, miningKey);\nconst emissionFundsAmount = await web3.eth.getBalance(emissionFunds.address);\nconst VOTING_START_DATE = moment.utc().add(31, &#x27;minutes&#x27;).unix();\nconst VOTING_END_DATE = moment.utc().add(7, &#x27;days&#x27;).unix();\nconst id = await voting.nextBallotId.call();\nconst receiver = accounts[9];\nawait voting.setTime(moment.utc().add(15, &#x27;minutes&#x27;).unix());\nawait votingEternalStorage.setProxyStorage(proxyStorage.address);\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait votingEternalStorage.setProxyStorage(proxyStorageStubAddress);\nlet votingNew = await VotingToManageEmissionFundsNew.new();\nawait upgradeTo(votingNew.address, {from: proxyStorageStubAddress});\nvotingNew = await VotingToManageEmissionFundsNew.at(votingEternalStorage.address);\nawait votingEternalStorage.setProxyStorage(proxyStorage.address);\nconst ballotInfo = await votingNew.getBallotInfo.call(id);\nballotInfo.should.be.deep.equal([\n  await voting.getTime.call(), // creationTime\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  false, // isCanceled\n  false, // isFinalized\n  miningKey, // creator\n  \&quot;memo\&quot;, // memo\n  new web3.BigNumber(emissionFundsAmount), // amount\n  new web3.BigNumber(0), // burnVotes\n  new web3.BigNumber(0), // freezeVotes\n  new web3.BigNumber(0), // sendVotes\n  receiver // receiver\n]);\n(await votingNew.getQuorumState.call(id)).should.be.bignumber.equal(1);\n(await votingNew.getMinThresholdOfVoters.call(id)).should.be.bignumber.equal(1);\n(await votingNew.noActiveBallotExists.call()).should.be.equal(false);\n(await votingNew.nextBallotId.call()).should.be.bignumber.equal(1);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f1cec35b-c680-483f-b6f5-045df06bad98&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;abd60f66-7a70-4219-9437-b89afb5f0b62&quot;,&quot;018859df-e6aa-486b-bcfc-bc350114db34&quot;,&quot;c7bac718-98a4-44f7-8fce-c369fd80f9b4&quot;,&quot;7e5f9b7c-2dcf-4fe0-8c3a-daafa0808f96&quot;,&quot;cfff5a63-c4fb-481f-a45b-dbe5a06a0c26&quot;,&quot;f1cec35b-c680-483f-b6f5-045df06bad98&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1447,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;7efa218a-e51d-4e72-810c-bc95cb3bddf5&quot;,&quot;title&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features]&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_manage_emission_funds_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_manage_emission_funds_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: prepare suite&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] \&quot;before all\&quot; hook: prepare suite&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6489,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(runner.BEFORE_TIMEOUT);\nrunner.initialize(done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;317271dc-130f-40da-af08-ce3e55773723&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: before test&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] \&quot;before each\&quot; hook: before test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.startTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;82291879-c372-4500-b0c4-9b612675817e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2485,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;coinbase = accounts[0];\nmasterOfCeremony = accounts[0];\nvotingKey = accounts[2];\nvotingKey2 = accounts[3];\nvotingKey3 = accounts[4];\nvotingKey4 = accounts[7];\nminingKey = accounts[1];\nminingKey2 = accounts[5];\nminingKey3 = accounts[6];\nminingKey4 = accounts[8];\npoaNetworkConsensus = await PoaNetworkConsensus.new(masterOfCeremony, []);\n\nproxyStorage = await ProxyStorage.new();\nconst proxyStorageEternalStorage = await EternalStorageProxy.new(0, proxyStorage.address);\nproxyStorage = await ProxyStorage.at(proxyStorageEternalStorage.address);\nawait proxyStorage.init(poaNetworkConsensus.address).should.be.fulfilled;\nawait poaNetworkConsensus.setProxyStorage(proxyStorage.address);\n\nkeysManager = await KeysManager.new();\nconst keysManagerEternalStorage = await EternalStorageProxy.new(proxyStorage.address, keysManager.address);\nkeysManager = await KeysManager.at(keysManagerEternalStorage.address);\nawait keysManager.init(\n  \&quot;0x0000000000000000000000000000000000000000\&quot;\n).should.be.fulfilled;\n\nballotsStorage = await BallotsStorage.new();\nconst ballotsEternalStorage = await EternalStorageProxy.new(proxyStorage.address, ballotsStorage.address);\nballotsStorage = await BallotsStorage.at(ballotsEternalStorage.address);\nawait ballotsStorage.init([3, 2]).should.be.fulfilled;\nlet votingForKeys = await VotingForKeys.new();\nvotingForKeysEternalStorage = await EternalStorageProxy.new(proxyStorage.address, votingForKeys.address);\nvotingForKeys = await VotingForKeys.at(votingForKeysEternalStorage.address);\nawait votingForKeys.init(172800).should.be.fulfilled;\nlet votingForMinThreshold = await VotingForMinThreshold.new();\nconst votingForMinThresholdEternalStorage = await EternalStorageProxy.new(proxyStorage.address, votingForMinThreshold.address);\nvotingForMinThreshold = await VotingForMinThreshold.at(votingForMinThresholdEternalStorage.address);\nawait votingForMinThreshold.init(172800, 3).should.be.fulfilled;\nlet votingForProxy = await VotingForProxy.new();\nconst votingForProxyEternalStorage = await EternalStorageProxy.new(proxyStorage.address, votingForProxy.address);\nvotingForProxy = await VotingForProxy.at(votingForProxyEternalStorage.address);\nawait votingForProxy.init(172800).should.be.fulfilled;\nconst validatorMetadata = await ValidatorMetadata.new();\nconst validatorMetadataEternalStorage = await EternalStorageProxy.new(proxyStorage.address, validatorMetadata.address);\nvoting = await VotingToManageEmissionFunds.new();\nvotingEternalStorage = await EternalStorageProxy.new(proxyStorage.address, voting.address);\nvoting = await VotingToManageEmissionFunds.at(votingEternalStorage.address);\nemissionFunds = await EmissionFunds.new(voting.address);\nemissionReleaseTime = moment.utc().add(10, &#x27;minutes&#x27;).unix();\nemissionReleaseThreshold = moment.duration(3, &#x27;months&#x27;).asSeconds();\ndistributionThreshold = moment.duration(7, &#x27;days&#x27;).asSeconds();\nawait voting.init(\n  emissionReleaseTime,\n  emissionReleaseThreshold,\n  distributionThreshold,\n  emissionFunds.address,\n  {from: accounts[8]}\n).should.be.rejectedWith(ERROR_MSG);\nawait voting.init(\n  emissionReleaseTime,\n  emissionReleaseThreshold,\n  300,\n  emissionFunds.address\n).should.be.rejectedWith(ERROR_MSG);\nawait voting.init(\n  emissionReleaseTime,\n  emissionReleaseThreshold,\n  distributionThreshold,\n  emissionFunds.address\n).should.be.fulfilled;\nrewardByBlock = await RewardByBlock.new();\nconst rewardByBlockEternalStorage = await EternalStorageProxy.new(proxyStorage.address, rewardByBlock.address);\nrewardByBlock = await RewardByBlock.at(rewardByBlockEternalStorage.address);\n\nawait proxyStorage.initializeAddresses(\n  keysManagerEternalStorage.address,\n  votingForKeysEternalStorage.address,\n  votingForMinThresholdEternalStorage.address,\n  votingForProxyEternalStorage.address,\n  votingEternalStorage.address,\n  ballotsEternalStorage.address,\n  validatorMetadataEternalStorage.address,\n  rewardByBlockEternalStorage.address\n);\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.equal(0);\nconst coinbaseInitBalance = await web3.eth.getBalance(coinbase);\nconst howMuchToSend = web3.toWei(10, &#x27;ether&#x27;);\nconst hash = await web3.eth.sendTransaction({\n  from: coinbase,\n  to: emissionFunds.address,\n  value: howMuchToSend\n});\nconst receipt = await web3.eth.getTransactionReceipt(hash);\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.equal(howMuchToSend);\nemissionFundsInitBalance = howMuchToSend;\n(await web3.eth.getBalance(coinbase)).should.be.bignumber.equal(coinbaseInitBalance.sub(howMuchToSend).sub(receipt.gasUsed));\nconst votingNew = await VotingToManageEmissionFundsNew.new();\nawait votingEternalStorage.setProxyStorage(accounts[6]);\nconst {logs} = await votingEternalStorage.upgradeTo(votingNew.address, {from: accounts[6]});\nlogs[0].event.should.be.equal(\&quot;Upgraded\&quot;);\nawait votingEternalStorage.setProxyStorage(proxyStorage.address);\nvoting = await VotingToManageEmissionFundsNew.at(votingEternalStorage.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e63b16df-1acf-49a8-8e93-820fffa755d3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: after test&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] \&quot;after each\&quot; hook: after test&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;runner.endTest(this, done);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ea4558c5-53fd-457a-ba42-01e39217b9a4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0fac8d93-8f2f-4676-a33a-379f7fc09cc1&quot;,&quot;title&quot;:&quot;#init&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_manage_emission_funds_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_manage_emission_funds_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should change state correctly&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #init should change state correctly&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:106,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await voting.distributionThreshold.call()).should.be.bignumber.equal(distributionThreshold);\n(await voting.emissionFunds.call()).should.be.equal(emissionFunds.address);\n(await voting.emissionReleaseThreshold.call()).should.be.bignumber.equal(emissionReleaseThreshold);\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(emissionReleaseTime);\n(await voting.noActiveBallotExists.call()).should.be.equal(true);\n(await voting.initDisabled.call()).should.be.equal(true);\n(await voting.proxyStorage.call()).should.be.equal(proxyStorage.address);\n(await voting.getKeysManager.call()).should.be.equal(keysManager.address);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e4ee3d04-0003-447a-99c2-c249ef28d260&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot be called more than once&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #init cannot be called more than once&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.init(\n  emissionReleaseTime,\n  emissionReleaseThreshold,\n  distributionThreshold,\n  emissionFunds.address\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;cbf6c5e2-1bda-4220-835b-b30c764ee448&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e4ee3d04-0003-447a-99c2-c249ef28d260&quot;,&quot;cbf6c5e2-1bda-4220-835b-b30c764ee448&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:125,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;aa774876-0801-4a61-9d75-3b1384234d50&quot;,&quot;title&quot;:&quot;#createBallot&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_manage_emission_funds_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_manage_emission_funds_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #createBallot \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:312,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addValidator(votingKey, miningKey);\nVOTING_START_DATE = moment.utc().add(31, &#x27;minutes&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(7, &#x27;days&#x27;).unix();\nid = await voting.nextBallotId.call();\nawait voting.setTime(moment.utc().add(15, &#x27;minutes&#x27;).unix());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ab20d1f4-5c60-4c78-8050-a5017be7b283&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #createBallot happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:900,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addValidator(votingKey2, miningKey2);\nawait addValidator(votingKey3, miningKey3);\nconst emissionFundsAmount = await web3.eth.getBalance(emissionFunds.address);\nconst {logs} = await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nconst ballotInfo = await voting.getBallotInfo.call(id);\nballotInfo.should.be.deep.equal([\n  await voting.getTime.call(), // creationTime\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  false, // isCanceled\n  false, // isFinalized\n  miningKey, // creator\n  \&quot;memo\&quot;, // memo\n  new web3.BigNumber(emissionFundsAmount), // amount\n  new web3.BigNumber(0), // burnVotes\n  new web3.BigNumber(0), // freezeVotes\n  new web3.BigNumber(0), // sendVotes\n  accounts[5] // receiver\n]);\n(await voting.getQuorumState.call(id)).should.be.bignumber.equal(1);\n(await voting.getMinThresholdOfVoters.call(id)).should.be.bignumber.equal(2);\n(await voting.getEmissionReleaseTimeSnapshot.call(id)).should.be.bignumber.equal(emissionReleaseTime);\n(await voting.noActiveBallotExists.call()).should.be.equal(false);\n(await voting.nextBallotId.call()).should.be.bignumber.equal(1);\nlogs[0].event.should.be.equal(\&quot;BallotCreated\&quot;);\nlogs[0].args.id.should.be.bignumber.equal(0);\nlogs[0].args.ballotType.should.be.bignumber.equal(6);\nlogs[0].args.creator.should.be.equal(votingKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1cb71cd3-c96e-4117-90c1-061a75264c41&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;may only be called by valid voting key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #createBallot may only be called by valid voting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:173,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: accounts[3]}\n).should.be.rejectedWith(ERROR_MSG);\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;685e9df6-827b-4777-88ee-772e97fa1425&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;endTime must be greater than startTime&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #createBallot endTime must be greater than startTime&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_END_DATE = moment.utc().add(19, &#x27;minutes&#x27;).unix();\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;29c6270c-f717-477c-b26c-bf9e0391ff17&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;startTime must be greater than current time&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #createBallot startTime must be greater than current time&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:42,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(14, &#x27;minutes&#x27;).unix();\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;44babdd0-f1e7-4933-82fd-8c248735ddfb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot be called before emission release time&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #createBallot cannot be called before emission release time&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:64,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(moment.utc().add(7, &#x27;minutes&#x27;).unix());\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4812f347-6a66-43ea-ada8-13f19b17a917&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;ballot cannot last longer than distribution threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #createBallot ballot cannot last longer than distribution threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:43,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_END_DATE = moment.utc().add(8, &#x27;days&#x27;).unix();\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ce941686-bebb-4e6c-8041-c3528cfd5b61&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;receiver address should not be 0x0&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #createBallot receiver address should not be 0x0&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, &#x27;0x0000000000000000000000000000000000000000&#x27;, \&quot;memo\&quot;, {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);\n(await voting.nextBallotId.call()).should.be.bignumber.equal(0);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;68977cc2-328d-4513-a72f-2d9113b6618b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot create multiple ballots during the same distribution period&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #createBallot cannot create multiple ballots during the same distribution period&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:469,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\n(await voting.nextBallotId.call()).should.be.bignumber.equal(1);\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[6], \&quot;memo\&quot;, {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);\n(await voting.nextBallotId.call()).should.be.bignumber.equal(1);\nawait voting.setTime(VOTING_END_DATE + 1);\nconst {logs} = await voting.finalize(0, {from: votingKey}).should.be.fulfilled;\nlogs[0].event.should.be.equal(\&quot;BallotFinalized\&quot;);\nlogs[0].args.id.should.be.bignumber.equal(0);\nlogs[0].args.voter.should.be.equal(votingKey);\nawait voting.setTime(\n  emissionReleaseTime + emissionReleaseThreshold + 1\n);\nVOTING_START_DATE = emissionReleaseTime + emissionReleaseThreshold + 2;\nVOTING_END_DATE = VOTING_START_DATE + 100;\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\n(await voting.nextBallotId.call()).should.be.bignumber.equal(2);\n(await voting.getEmissionReleaseTimeSnapshot.call(1)).should.be.bignumber.equal(\n  emissionReleaseTime + emissionReleaseThreshold\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;0fc0dae0-9b79-4395-88f3-fcc9e892242e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow creating new ballot after the next emission release threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #createBallot should allow creating new ballot after the next emission release threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:471,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(\n  emissionReleaseTime + emissionReleaseThreshold + 1\n);\nVOTING_START_DATE = emissionReleaseTime + emissionReleaseThreshold + 2;\nVOTING_END_DATE = VOTING_START_DATE + 900;\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime + emissionReleaseThreshold\n);\n(await voting.getEmissionReleaseTimeSnapshot.call(0)).should.be.bignumber.equal(\n  emissionReleaseTime\n);\nawait voting.setTime(VOTING_END_DATE + 1);\nawait voting.finalize(0, {from: votingKey}).should.be.fulfilled;\nawait voting.setTime(\n  emissionReleaseTime + emissionReleaseThreshold*5 + 1\n);\nVOTING_START_DATE = emissionReleaseTime + emissionReleaseThreshold*5 - 2;\nVOTING_END_DATE = VOTING_START_DATE + 900;\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.rejectedWith(ERROR_MSG);\nVOTING_START_DATE = emissionReleaseTime + emissionReleaseThreshold*5 + 2;\nVOTING_END_DATE = VOTING_START_DATE + 900;\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime + emissionReleaseThreshold*5\n);\n(await voting.getEmissionReleaseTimeSnapshot.call(1)).should.be.bignumber.equal(\n  emissionReleaseTime + emissionReleaseThreshold*2\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;426eadd4-bf72-4290-b4ee-c5264328c271&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1cb71cd3-c96e-4117-90c1-061a75264c41&quot;,&quot;685e9df6-827b-4777-88ee-772e97fa1425&quot;,&quot;29c6270c-f717-477c-b26c-bf9e0391ff17&quot;,&quot;44babdd0-f1e7-4933-82fd-8c248735ddfb&quot;,&quot;4812f347-6a66-43ea-ada8-13f19b17a917&quot;,&quot;ce941686-bebb-4e6c-8041-c3528cfd5b61&quot;,&quot;68977cc2-328d-4513-a72f-2d9113b6618b&quot;,&quot;0fc0dae0-9b79-4395-88f3-fcc9e892242e&quot;,&quot;426eadd4-bf72-4290-b4ee-c5264328c271&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2254,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;93d1013f-758e-4145-9612-e24784745087&quot;,&quot;title&quot;:&quot;#cancelNewBallot&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_manage_emission_funds_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_manage_emission_funds_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #cancelNewBallot \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:355,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addValidator(votingKey, miningKey);\nVOTING_START_DATE = moment.utc().add(31, &#x27;minutes&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(7, &#x27;days&#x27;).unix();\nid = await voting.nextBallotId.call();\nawait voting.setTime(moment.utc().add(15, &#x27;minutes&#x27;).unix());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3a87f606-1289-484d-b23c-be9018ef4315&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #cancelNewBallot happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:856,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const emissionFundsAmount = await web3.eth.getBalance(emissionFunds.address);\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nlet creationTime = await voting.getTime.call();\nawait voting.setTime(moment.utc().add(20, &#x27;minutes&#x27;).unix());\nlet result = await voting.cancelNewBallot({from: votingKey}).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(\&quot;BallotCanceled\&quot;);\nresult.logs[0].args.id.should.be.bignumber.equal(id);\nresult.logs[0].args.votingKey.should.be.equal(votingKey);\nlet ballotInfo = await voting.getBallotInfo.call(id);\nballotInfo.should.be.deep.equal([\n  creationTime, // creationTime\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  true, // isCanceled\n  false, // isFinalized\n  miningKey, // creator\n  \&quot;memo\&quot;, // memo\n  new web3.BigNumber(emissionFundsAmount), // amount\n  new web3.BigNumber(0), // burnVotes\n  new web3.BigNumber(0), // freezeVotes\n  new web3.BigNumber(0), // sendVotes\n  accounts[5] // receiver\n]);\n(await voting.noActiveBallotExists.call()).should.be.equal(true);\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(emissionReleaseTime);\nid = await voting.nextBallotId.call();\ncreationTime = moment.utc().add(22, &#x27;minutes&#x27;).unix();\nawait voting.setTime(creationTime);\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.freeze, {from: votingKey}).should.be.fulfilled;\n(await voting.noActiveBallotExists.call()).should.be.equal(false);\nawait voting.setTime(VOTING_END_DATE + 1);\nawait voting.finalize(id, {from: votingKey}).should.be.fulfilled;\nballotInfo = await voting.getBallotInfo.call(id);\nballotInfo.should.be.deep.equal([\n  new web3.BigNumber(creationTime), // creationTime\n  new web3.BigNumber(VOTING_START_DATE), // startTime\n  new web3.BigNumber(VOTING_END_DATE), // endTime\n  false, // isCanceled\n  true, // isFinalized\n  miningKey, // creator\n  \&quot;memo\&quot;, // memo\n  new web3.BigNumber(emissionFundsAmount), // amount\n  new web3.BigNumber(0), // burnVotes\n  new web3.BigNumber(1), // freezeVotes\n  new web3.BigNumber(0), // sendVotes\n  accounts[5] // receiver\n]);\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime + emissionReleaseThreshold\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;586d8a16-5453-48c6-9c0b-b46da0bb7ed1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot cancel nonexistent or finalized ballot&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #cancelNewBallot cannot cancel nonexistent or finalized ballot&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:325,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.cancelNewBallot({from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nawait voting.finalize(id, {from: votingKey}).should.be.fulfilled;\nawait voting.setTime(moment.utc().add(20, &#x27;minutes&#x27;).unix());\nawait voting.cancelNewBallot({from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;83646649-f6da-456c-9f54-da5464f7874b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;may only be called by creator of a ballot&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #cancelNewBallot may only be called by creator of a ballot&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:239,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(moment.utc().add(20, &#x27;minutes&#x27;).unix());\nawait voting.cancelNewBallot({from: votingKey2}).should.be.rejectedWith(ERROR_MSG);\nconst {logs} = await voting.cancelNewBallot({from: votingKey}).should.be.fulfilled;\nlogs[0].event.should.be.equal(\&quot;BallotCanceled\&quot;);\nlogs[0].args.id.should.be.bignumber.equal(id);\nlogs[0].args.votingKey.should.be.equal(votingKey);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1e24466f-8f4f-4333-b5ad-d0d49520c155&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;may only be called within ballot canceling threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #cancelNewBallot may only be called within ballot canceling threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:240,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(moment.utc().add(31, &#x27;minutes&#x27;).unix());\nawait voting.cancelNewBallot({from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.setTime(moment.utc().add(29, &#x27;minutes&#x27;).unix());\nawait voting.cancelNewBallot({from: votingKey}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2f4e5343-e13c-4d4c-a6f1-c161d3db8816&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;cannot cancel already cancelled ballot&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #cancelNewBallot cannot cancel already cancelled ballot&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:352,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(moment.utc().add(29, &#x27;minutes&#x27;).unix());\nawait voting.cancelNewBallot({from: votingKey}).should.be.fulfilled;\nawait voting.cancelNewBallot({from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b3c8d23b-0184-455e-b816-0e3212ca6439&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should restore emission release time&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #cancelNewBallot should restore emission release time&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:502,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nawait voting.finalize(id, {from: votingKey}).should.be.fulfilled;\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime + emissionReleaseThreshold\n);\nawait voting.setTime(\n  emissionReleaseTime + emissionReleaseThreshold*5 + 1\n);\nVOTING_START_DATE = emissionReleaseTime + emissionReleaseThreshold*5 + 2;\nVOTING_END_DATE = VOTING_START_DATE + 900;\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, accounts[5], \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime + emissionReleaseThreshold*5\n);\n(await voting.getEmissionReleaseTimeSnapshot.call(1)).should.be.bignumber.equal(\n  emissionReleaseTime + emissionReleaseThreshold\n);\nawait voting.setTime(emissionReleaseTime + emissionReleaseThreshold*5 + 10);\nawait voting.cancelNewBallot({from: votingKey}).should.be.fulfilled;\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime + emissionReleaseThreshold\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b757736b-b856-44d6-87a0-47a2527d2b88&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;586d8a16-5453-48c6-9c0b-b46da0bb7ed1&quot;,&quot;83646649-f6da-456c-9f54-da5464f7874b&quot;,&quot;1e24466f-8f4f-4333-b5ad-d0d49520c155&quot;,&quot;2f4e5343-e13c-4d4c-a6f1-c161d3db8816&quot;,&quot;b3c8d23b-0184-455e-b816-0e3212ca6439&quot;,&quot;b757736b-b856-44d6-87a0-47a2527d2b88&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2514,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;b80dc4f2-d6a2-445d-b2a8-a060901094b3&quot;,&quot;title&quot;:&quot;#refreshEmissionReleaseTime&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_manage_emission_funds_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_manage_emission_funds_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should not update until the next threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #refreshEmissionReleaseTime should not update until the next threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:131,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime\n);\nawait voting.setTime(moment.utc().add(15, &#x27;minutes&#x27;).unix());\nawait voting.refreshEmissionReleaseTime();\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime\n);\nawait voting.setTime(moment.utc().add(2, &#x27;months&#x27;).unix());\nawait voting.refreshEmissionReleaseTime();\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a362901c-0e38-45a6-b04c-ae23506c0322&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should update to the next threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #refreshEmissionReleaseTime should update to the next threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:151,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime\n);\nawait voting.setTime(moment.utc().add(4, &#x27;months&#x27;).unix());\nawait voting.refreshEmissionReleaseTime();\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime + emissionReleaseThreshold\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;bc3173fa-1276-4678-9c8a-5f6fdf66680b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should update to the future threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #refreshEmissionReleaseTime should update to the future threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:69,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime\n);\nawait voting.setTime(moment.utc().add(7, &#x27;months&#x27;).unix());\nawait voting.refreshEmissionReleaseTime();\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime + emissionReleaseThreshold*2\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;da091e2e-8a65-4f3b-a7cf-698f8d157d5d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a362901c-0e38-45a6-b04c-ae23506c0322&quot;,&quot;bc3173fa-1276-4678-9c8a-5f6fdf66680b&quot;,&quot;da091e2e-8a65-4f3b-a7cf-698f8d157d5d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:351,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;ce9c7517-27fc-4a94-bf71-1bca1e24c9fb&quot;,&quot;title&quot;:&quot;#vote&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_manage_emission_funds_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_manage_emission_funds_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #vote \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:482,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;receiver = accounts[9];\nawait addValidator(votingKey, miningKey);\nVOTING_START_DATE = moment.utc().add(31, &#x27;minutes&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(7, &#x27;days&#x27;).unix();\nid = await voting.nextBallotId.call();\nawait voting.setTime(moment.utc().add(15, &#x27;minutes&#x27;).unix());\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;3c06d023-dd75-499f-88f2-578025cdf399&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should let a validator to vote&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #vote should let a validator to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:844,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const emissionFundsBalanceOld = await web3.eth.getBalance(emissionFunds.address);\nconst receiverBalanceOld = await web3.eth.getBalance(receiver);\nawait voting.setTime(VOTING_START_DATE);\nconst {logs} = await voting.vote(id, choice.freeze, {from: votingKey}).should.be.fulfilled;\nconst ballotInfo = await voting.getBallotInfo.call(id);\nballotInfo[4].should.be.equal(true); // isFinalized\nballotInfo[8].should.be.bignumber.equal(0); // burnVotes\nballotInfo[9].should.be.bignumber.equal(1); // freezeVotes\nballotInfo[10].should.be.bignumber.equal(0); // sendVotes\n(await voting.noActiveBallotExists.call()).should.be.equal(true);\n(await voting.getQuorumState.call(id)).should.be.bignumber.equal(4);\n(await voting.getMinThresholdOfVoters.call(id)).should.be.bignumber.equal(1);\n(await voting.hasAlreadyVoted.call(id, votingKey)).should.be.equal(true);\nlogs[0].event.should.be.equal(&#x27;Vote&#x27;);\nlogs[0].args.id.should.be.bignumber.equal(0);\nlogs[0].args.decision.should.be.bignumber.equal(choice.freeze);\nlogs[0].args.voter.should.be.equal(votingKey);\nlogs[0].args.time.should.be.bignumber.equal(VOTING_START_DATE);\nlogs[0].args.voterMiningKey.should.be.equal(miningKey);\nlogs[1].event.should.be.equal(&#x27;BallotFinalized&#x27;);\nlogs[1].args.id.should.be.bignumber.equal(0);\nlogs[1].args.voter.should.be.equal(votingKey);\nemissionFundsBalanceOld.should.be.bignumber.equal(await web3.eth.getBalance(emissionFunds.address));\nreceiverBalanceOld.should.be.bignumber.equal(await web3.eth.getBalance(receiver));&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f329647f-ce59-4457-bb68-763c92881b76&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should allow multiple voters to vote&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #vote should allow multiple voters to vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1439,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addValidator(votingKey2, miningKey2);\nawait addValidator(votingKey3, miningKey3);\nawait voting.setTime(VOTING_START_DATE+1);\nawait voting.vote(id, choice.burn, {from: votingKey}).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE+2);\nawait voting.vote(id, choice.burn, {from: votingKey2}).should.be.fulfilled;\n(await voting.getAmount.call(id)).should.be.bignumber.equal(\n  await web3.eth.getBalance(emissionFunds.address)\n);\n(await voting.getAmount.call(id)).should.be.bignumber.above(0);\nawait voting.setTime(VOTING_START_DATE+3);\nawait voting.vote(id, choice.burn, {from: votingKey3}).should.be.fulfilled;\nconst ballotInfo = await voting.getBallotInfo.call(id);\nballotInfo[4].should.be.equal(true); // isFinalized\nballotInfo[8].should.be.bignumber.equal(3); // burnVotes\nballotInfo[9].should.be.bignumber.equal(0); // freezeVotes\nballotInfo[10].should.be.bignumber.equal(0); // sendVotes\n(await voting.hasMiningKeyAlreadyVoted.call(id, miningKey)).should.be.equal(true);\n(await voting.hasMiningKeyAlreadyVoted.call(id, miningKey2)).should.be.equal(true);\n(await voting.hasMiningKeyAlreadyVoted.call(id, miningKey3)).should.be.equal(true);\n(await voting.noActiveBallotExists.call()).should.be.equal(true);\n(await voting.getQuorumState.call(id)).should.be.bignumber.equal(3);\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.equal(0);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f386b3a9-d491-4f43-9466-1bb7d2e49024&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote by nonvoting key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #vote should not let vote by nonvoting key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:60,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.send, {from: accounts[0]}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1325af8c-ff81-45fc-8d3a-0a1fcef87a66&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote before startTime&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #vote should not let vote before startTime&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:92,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE - 1);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;67291961-d655-4eab-b7fd-c3c0b63402c9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote after endTime&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #vote should not let vote after endTime&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:269,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_END_DATE + 1);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.setTime(VOTING_END_DATE);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;b986c438-8dbb-4447-88b5-7cf126ed8589&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with already voted key&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #vote should not let vote with already voted key&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:202,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;78c7fc4f-4589-4bbb-9fa2-a0d5e9d853d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with invalid choice&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #vote should not let vote with invalid choice&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:154,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, 0, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(id, 4, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;00cf40cb-77cb-44f8-b9f3-19213e80117a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with invalid id&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #vote should not let vote with invalid id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:156,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(VOTING_START_DATE);\nawait voting.vote(99, choice.send, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(-3, choice.send, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;46e32f53-27ab-465e-ab34-05a5ce63b14e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote if already finalized&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #vote should not let vote if already finalized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1518,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addValidator(votingKey2, miningKey2);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.fulfilled;\nfalse.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\nawait voting.setTime(VOTING_END_DATE + 1);\nawait voting.finalize(id, {from: votingKey}).should.be.fulfilled;\ntrue.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\nawait voting.vote(id, choice.send, {from: votingKey2}).should.be.rejectedWith(ERROR_MSG);\nawait voting.setTime(VOTING_START_DATE + 1);\nawait voting.vote(id, choice.send, {from: votingKey2}).should.be.rejectedWith(ERROR_MSG);\nid = await voting.nextBallotId.call();\nVOTING_START_DATE += emissionReleaseThreshold;\nVOTING_END_DATE += emissionReleaseThreshold;\nawait voting.setTime(VOTING_START_DATE - 5*60);\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE + 11*60);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.send, {from: votingKey2}).should.be.fulfilled;\ntrue.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\nawait addValidator(votingKey3, miningKey3);\nawait voting.vote(id, choice.send, {from: votingKey3}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;7479da22-59ea-438a-a4fb-97831a2aade5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote with old miningKey&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #vote should not let vote with old miningKey&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2416,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addValidator(votingKey2, miningKey2);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.fulfilled;\nfalse.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\nawait proxyStorage.setVotingContractMock(coinbase);\nconst {logs} = await keysManager.swapMiningKey(miningKey3, miningKey);\nlogs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nawait proxyStorage.setVotingContractMock(votingForKeysEternalStorage.address);\nawait poaNetworkConsensus.setSystemAddress(coinbase);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nawait poaNetworkConsensus.setSystemAddress(&#x27;0xffffFFFfFFffffffffffffffFfFFFfffFFFfFFfE&#x27;);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait proxyStorage.setVotingContractMock(coinbase);\nawait swapVotingKey(votingKey3, miningKey3);\nawait proxyStorage.setVotingContractMock(votingForKeysEternalStorage.address);\nawait voting.vote(id, choice.send, {from: votingKey3}).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(id, choice.send, {from: votingKey2}).should.be.fulfilled;\ntrue.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\nid = await voting.nextBallotId.call();\nVOTING_START_DATE += emissionReleaseThreshold;\nVOTING_END_DATE += emissionReleaseThreshold;\nawait voting.setTime(VOTING_START_DATE - 5*60);\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey2}\n).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE + 11*60);\nawait voting.vote(id, choice.send, {from: votingKey3}).should.be.fulfilled;\nfalse.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\nawait proxyStorage.setVotingContractMock(coinbase);\nlet result = await keysManager.swapMiningKey(miningKey, miningKey3);\nresult.logs[0].event.should.equal(\&quot;MiningKeyChanged\&quot;);\nawait swapVotingKey(votingKey, miningKey);\nawait proxyStorage.setVotingContractMock(votingForKeysEternalStorage.address);\nawait poaNetworkConsensus.setSystemAddress(coinbase);\nawait poaNetworkConsensus.finalizeChange().should.be.fulfilled;\nawait poaNetworkConsensus.setSystemAddress(&#x27;0xffffFFFfFFffffffffffffffFfFFFfffFFFfFFfE&#x27;);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.vote(id, choice.send, {from: votingKey2}).should.be.fulfilled;\ntrue.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;94c8b4cd-5fe1-4fe2-943d-94b9804c71ff&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let vote if ballot is canceled&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #vote should not let vote if ballot is canceled&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:140,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.setTime(moment.utc().add(20, &#x27;minutes&#x27;).unix());\nconst {logs} = await voting.cancelNewBallot({from: votingKey}).should.be.fulfilled;\nlogs[0].event.should.be.equal(\&quot;BallotCanceled\&quot;);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;6776747c-825d-4151-a075-3530b4b31caf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f329647f-ce59-4457-bb68-763c92881b76&quot;,&quot;f386b3a9-d491-4f43-9466-1bb7d2e49024&quot;,&quot;1325af8c-ff81-45fc-8d3a-0a1fcef87a66&quot;,&quot;67291961-d655-4eab-b7fd-c3c0b63402c9&quot;,&quot;b986c438-8dbb-4447-88b5-7cf126ed8589&quot;,&quot;78c7fc4f-4589-4bbb-9fa2-a0d5e9d853d1&quot;,&quot;00cf40cb-77cb-44f8-b9f3-19213e80117a&quot;,&quot;46e32f53-27ab-465e-ab34-05a5ce63b14e&quot;,&quot;7479da22-59ea-438a-a4fb-97831a2aade5&quot;,&quot;94c8b4cd-5fe1-4fe2-943d-94b9804c71ff&quot;,&quot;6776747c-825d-4151-a075-3530b4b31caf&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:7290,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000},{&quot;uuid&quot;:&quot;ca2ee695-b3d6-4730-9691-6a2ffd220a00&quot;,&quot;title&quot;:&quot;#finalize&quot;,&quot;fullFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/test/voting_to_manage_emission_funds_upgrade_test.js&quot;,&quot;file&quot;:&quot;/test/voting_to_manage_emission_funds_upgrade_test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #finalize \&quot;before each\&quot; hook&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:299,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;receiver = accounts[9];\nawait addValidator(votingKey, miningKey);\nVOTING_START_DATE = moment.utc().add(31, &#x27;minutes&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(7, &#x27;days&#x27;).unix();\nid = await voting.nextBallotId.call();\nawait voting.setTime(moment.utc().add(15, &#x27;minutes&#x27;).unix());&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;ec6a02e4-23ae-4f28-b117-9e7d0d9376cd&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;happy path&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #finalize happy path&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:593,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nfalse.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\n(await voting.noActiveBallotExists.call()).should.be.equal(false);\nawait addValidator(votingKey2, miningKey2);\nawait voting.setTime(VOTING_END_DATE + 1);\nconst {logs} = await voting.finalize(id, {from: votingKey2}).should.be.fulfilled;\ntrue.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\n(await voting.noActiveBallotExists.call()).should.be.equal(true);\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime + emissionReleaseThreshold\n);\nlogs[0].event.should.be.equal(&#x27;BallotFinalized&#x27;);\nlogs[0].args.id.should.be.bignumber.equal(id);\nlogs[0].args.voter.should.be.equal(votingKey2);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;f7398719-f684-49ce-a575-533981b673fc&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;freeze funds if it did not pass minimum voters count&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #finalize freeze funds if it did not pass minimum voters count&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1073,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addValidator(votingKey2, miningKey2);\nawait addValidator(votingKey3, miningKey3);\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\n(await voting.getMinThresholdOfVoters.call(id)).should.be.bignumber.equal(2);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.burn, {from: votingKey}).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nawait voting.finalize(id, {from: votingKey3}).should.be.fulfilled;\n(await voting.getQuorumState.call(id)).should.be.bignumber.equal(4);\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.equal(emissionFundsInitBalance);\nemissionFundsInitBalance.should.be.bignumber.above(0);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;c0c833ef-fdf7-4837-8983-973b5baae10e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;freeze funds if there is no majority of 3 votes&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #finalize freeze funds if there is no majority of 3 votes&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1257,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait addValidator(votingKey2, miningKey2);\nawait addValidator(votingKey3, miningKey3);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.burn, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(id, choice.freeze, {from: votingKey3}).should.be.fulfilled;\ntrue.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\n(await voting.getQuorumState.call(id)).should.be.bignumber.equal(4);\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.equal(emissionFundsInitBalance);\nemissionFundsInitBalance.should.be.bignumber.above(0);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2a3b382b-5633-4392-b595-b9b420707307&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;freeze funds if there is no majority of 4 votes&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #finalize freeze funds if there is no majority of 4 votes&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1648,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait addValidator(votingKey2, miningKey2);\nawait addValidator(votingKey3, miningKey3);\nawait addValidator(votingKey4, miningKey4);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.burn, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(id, choice.send, {from: votingKey3}).should.be.fulfilled;\nawait voting.vote(id, choice.burn, {from: votingKey4}).should.be.fulfilled;\ntrue.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\n(await voting.getQuorumState.call(id)).should.be.bignumber.equal(4);\n(await voting.getTotalVoters.call(id)).should.be.bignumber.equal(4);\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.equal(emissionFundsInitBalance);\nemissionFundsInitBalance.should.be.bignumber.above(0);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;5a6722ac-341b-48fe-ad8e-ce6232117d0d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;send funds to receiver if most votes are for sending&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #finalize send funds to receiver if most votes are for sending&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2436,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait addValidator(votingKey2, miningKey2);\nawait addValidator(votingKey3, miningKey3);\nawait addValidator(votingKey4, miningKey4);\nconst receiverInitBalance = await web3.eth.getBalance(receiver);\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.equal(emissionFundsInitBalance);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.send, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(id, choice.burn, {from: votingKey3}).should.be.fulfilled;\nawait voting.vote(id, choice.freeze, {from: votingKey4}).should.be.fulfilled;\ntrue.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\n(await voting.getQuorumState.call(id)).should.be.bignumber.equal(2);\n(await voting.getTotalVoters.call(id)).should.be.bignumber.equal(4);\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.equal(0);\n(await web3.eth.getBalance(receiver)).should.be.bignumber.equal(\n  receiverInitBalance.add(emissionFundsInitBalance)\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;145aaf8a-8d99-4b2f-b7c1-1c168c3b3649&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;send funds to receiver if most votes are for sending&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #finalize send funds to receiver if most votes are for sending&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1689,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait addValidator(votingKey2, miningKey2);\nawait addValidator(votingKey3, miningKey3);\nconst receiverInitBalance = await web3.eth.getBalance(receiver);\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.equal(emissionFundsInitBalance);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.send, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(id, choice.burn, {from: votingKey3}).should.be.fulfilled;\ntrue.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\n(await voting.getQuorumState.call(id)).should.be.bignumber.equal(2);\n(await voting.getTotalVoters.call(id)).should.be.bignumber.equal(3);\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.equal(0);\n(await web3.eth.getBalance(receiver)).should.be.bignumber.equal(\n  receiverInitBalance.add(emissionFundsInitBalance)\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;94427948-3155-474b-9c57-5fd20eb51b95&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;burn funds if most votes are for burning&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #finalize burn funds if most votes are for burning&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1768,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait addValidator(votingKey2, miningKey2);\nawait addValidator(votingKey3, miningKey3);\nconst receiverInitBalance = await web3.eth.getBalance(receiver);\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.above(0);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.burn, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(id, choice.burn, {from: votingKey3}).should.be.fulfilled;\ntrue.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\n(await voting.getQuorumState.call(id)).should.be.bignumber.equal(3);\n(await voting.getTotalVoters.call(id)).should.be.bignumber.equal(3);\n(await web3.eth.getBalance(emissionFunds.address)).should.be.bignumber.equal(0);\n(await web3.eth.getBalance(receiver)).should.be.bignumber.equal(receiverInitBalance);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;029480f9-aaea-4194-bc4b-ff3ded2a226f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;prevents finalize with invalid id&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #finalize prevents finalize with invalid id&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:270,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nawait voting.finalize(1, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;1eae2ac9-bca4-4671-a90d-c6fb00cd3a88&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;do not let finalize if a ballot is active&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #finalize do not let finalize if a ballot is active&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:191,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(VOTING_START_DATE + 1);\nawait voting.finalize(0, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;77c6c9c2-e586-4039-8472-7afb33a1ccb8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;finalize immediately if the last validator gave his vote&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #finalize finalize immediately if the last validator gave his vote&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1119,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait addValidator(votingKey2, miningKey2);\nawait addValidator(votingKey3, miningKey3);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.fulfilled;\n\nawait voting.vote(id, choice.burn, {from: votingKey2}).should.be.fulfilled;\nfalse.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\n\nawait voting.vote(id, choice.burn, {from: votingKey3}).should.be.fulfilled;\ntrue.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\n\n(await voting.noActiveBallotExists.call()).should.be.equal(true);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;2b237025-ce6e-42a4-bdb4-25a6094171d5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;does not finalize immediately until ballot canceling threshold is reached&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #finalize does not finalize immediately until ballot canceling threshold is reached&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1319,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(17, &#x27;minutes&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(20, &#x27;minutes&#x27;).unix();\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait addValidator(votingKey2, miningKey2);\nawait addValidator(votingKey3, miningKey3);\nawait voting.setTime(VOTING_START_DATE);\nawait voting.vote(id, choice.send, {from: votingKey}).should.be.fulfilled;\nawait voting.vote(id, choice.burn, {from: votingKey2}).should.be.fulfilled;\nawait voting.vote(id, choice.burn, {from: votingKey3}).should.be.fulfilled;\n\nfalse.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\nawait voting.setTime(moment.utc().add(31, &#x27;minutes&#x27;).unix());\nawait voting.finalize(id, {from: votingKey3}).should.be.fulfilled;\ntrue.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;4cfc3e4a-4444-4073-86b4-998e1429f39e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;prevents double finalize&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #finalize prevents double finalize&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:291,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nawait voting.finalize(0, {from: votingKey}).should.be.fulfilled;\nawait voting.finalize(0, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;19db711a-947b-4d3a-928d-359ac318b880&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should refresh emission release time&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #finalize should refresh emission release time&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:246,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime\n);\nawait voting.setTime(VOTING_END_DATE + 1);\nawait voting.finalize(0, {from: votingKey}).should.be.fulfilled;\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime + emissionReleaseThreshold\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;e356f548-1b76-4b9d-837e-126a09223d4e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;deny finalization if the voting key is a contract&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #finalize deny finalization if the voting key is a contract&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:758,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const voter = await VotingKey.new(voting.address);\nvotingKey2 = voter.address;\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nfalse.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\n(await voting.noActiveBallotExists.call()).should.be.equal(false);\nawait addValidator(votingKey2, miningKey2);\nawait voting.setTime(VOTING_END_DATE + 1);\n\nawait voter.callFinalize(id).should.be.rejectedWith(ERROR_MSG);\nfalse.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\nawait voting.finalize(id, {from: votingKey}).should.be.fulfilled;\ntrue.should.be.equal((await voting.getBallotInfo.call(id))[4]); // isFinalized\n(await voting.noActiveBallotExists.call()).should.be.equal(true);\n(await voting.emissionReleaseTime.call()).should.be.bignumber.equal(\n  emissionReleaseTime + emissionReleaseThreshold\n);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;606a9a45-f8bb-4b4c-ae7b-58b28e0be161&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;deny finalization within ballot canceling threshold&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #finalize deny finalization within ballot canceling threshold&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:292,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;VOTING_START_DATE = moment.utc().add(17, &#x27;minutes&#x27;).unix();\nVOTING_END_DATE = moment.utc().add(20, &#x27;minutes&#x27;).unix();\n\nawait voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(VOTING_END_DATE + 1);\nawait voting.finalize(id, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);\nawait voting.setTime(moment.utc().add(31, &#x27;minutes&#x27;).unix());\nawait voting.finalize(id, {from: votingKey}).should.be.fulfilled;&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;a920df7a-7e18-459d-abc2-00dc0958588b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;deny finalization of canceled ballot&quot;,&quot;fullTitle&quot;:&quot;Contract: VotingToManageEmissionFunds upgraded [all features] #finalize deny finalization of canceled ballot&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:298,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await voting.createBallot(\n  VOTING_START_DATE, VOTING_END_DATE, receiver, \&quot;memo\&quot;, {from: votingKey}\n).should.be.fulfilled;\nawait voting.setTime(moment.utc().add(20, &#x27;minutes&#x27;).unix());\nlet result = await voting.cancelNewBallot({from: votingKey}).should.be.fulfilled;\nresult.logs[0].event.should.be.equal(\&quot;BallotCanceled\&quot;);\nresult.logs[0].args.id.should.be.bignumber.equal(id);\nresult.logs[0].args.votingKey.should.be.equal(votingKey);\nawait voting.setTime(VOTING_END_DATE + 1);\nawait voting.finalize(id, {from: votingKey}).should.be.rejectedWith(ERROR_MSG);&quot;,&quot;err&quot;:{},&quot;isRoot&quot;:false,&quot;uuid&quot;:&quot;036c13d9-d782-45aa-aadf-a90b86e02b9a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f7398719-f684-49ce-a575-533981b673fc&quot;,&quot;c0c833ef-fdf7-4837-8983-973b5baae10e&quot;,&quot;2a3b382b-5633-4392-b595-b9b420707307&quot;,&quot;5a6722ac-341b-48fe-ad8e-ce6232117d0d&quot;,&quot;145aaf8a-8d99-4b2f-b7c1-1c168c3b3649&quot;,&quot;94427948-3155-474b-9c57-5fd20eb51b95&quot;,&quot;029480f9-aaea-4194-bc4b-ff3ded2a226f&quot;,&quot;1eae2ac9-bca4-4671-a90d-c6fb00cd3a88&quot;,&quot;77c6c9c2-e586-4039-8472-7afb33a1ccb8&quot;,&quot;2b237025-ce6e-42a4-bdb4-25a6094171d5&quot;,&quot;4cfc3e4a-4444-4073-86b4-998e1429f39e&quot;,&quot;19db711a-947b-4d3a-928d-359ac318b880&quot;,&quot;e356f548-1b76-4b9d-837e-126a09223d4e&quot;,&quot;606a9a45-f8bb-4b4c-ae7b-58b28e0be161&quot;,&quot;a920df7a-7e18-459d-abc2-00dc0958588b&quot;,&quot;036c13d9-d782-45aa-aadf-a90b86e02b9a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:15248,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:300000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:2000},&quot;copyrightYear&quot;:2018}" data-config="{&quot;reportFilename&quot;:&quot;mochawesome&quot;,&quot;reportDir&quot;:&quot;mochawesome-report&quot;,&quot;reportTitle&quot;:&quot;poa-network-consensus-contracts&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;cdn&quot;:false,&quot;charts&quot;:true,&quot;enableCharts&quot;:true,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:false,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showPassed&quot;:true,&quot;showFailed&quot;:true,&quot;showPending&quot;:true,&quot;showSkipped&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:true,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;assetsDir&quot;:&quot;mochawesome-report/assets&quot;,&quot;jsonFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/mochawesome-report/mochawesome.json&quot;,&quot;htmlFile&quot;:&quot;/home/travis/build/poanetwork/poa-network-consensus-contracts/mochawesome-report/mochawesome.html&quot;}"><div id="report"></div><script src="assets/app.js"></script></body></html>